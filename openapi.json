{
  "openapi": "3.0.0",
  "info": {
    "title": "CarbonTrack API",
    "version": "1.0.0",
    "description": "CarbonTrack碳足迹追踪应用的完整API文档。包含用户认证、碳活动计算、积分系统、消息管理等核心功能。所有API都支持幂等性、审计日志和安全验证。",
    "contact": {
      "name": "CarbonTrack Development Team",
      "email": "dev@carbontrack.com"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "x-middleware": {
    "description": "API中间件说明",
    "auth": {
      "description": "JWT认证中间件，验证Authorization头中的Bearer token",
      "headers": ["Authorization: Bearer {token}"],
      "error_codes": ["UNAUTHORIZED", "TOKEN_EXPIRED", "INVALID_TOKEN"]
    },
    "admin": {
      "description": "管理员权限中间件，验证用户是否具有管理员权限",
      "error_codes": ["AUTH_REQUIRED", "ADMIN_REQUIRED", "ACCESS_DENIED"]
    },
    "turnstile": {
      "description": "Cloudflare Turnstile机器人验证中间件，保护敏感操作",
      "required_routes": ["/auth/register", "/auth/login", "/auth/send-verification-code", "/carbon-track/record"],
      "headers": ["X-Turnstile-Token"],
      "body_fields": ["cf_turnstile_response"],
      "error_codes": ["TURNSTILE_VERIFICATION_FAILED", "MISSING_TURNSTILE_TOKEN"]
    },
    "idempotency": {
      "description": "幂等性中间件，防止重复提交敏感操作",
      "required_routes": ["/auth/register", "/carbon-track/record", "/exchange", "/messages"],
      "headers": ["X-Request-ID"],
      "requirements": "必须是有效的UUID格式，24小时内有效",
      "error_codes": ["BAD_REQUEST", "IDEMPOTENCY_KEY_REQUIRED", "INVALID_UUID"]
    },
    "cors": {
      "description": "跨域资源共享中间件",
      "allowed_origins": "环境变量CORS_ALLOWED_ORIGINS配置",
      "allowed_methods": "GET,POST,PUT,DELETE,OPTIONS",
      "allowed_headers": "Content-Type,Authorization,X-Request-ID",
      "credentials": true
    },
    "logging": {
      "description": "请求日志中间件，记录所有API请求和响应",
      "logs": ["请求信息", "响应状态", "执行时间", "错误信息"]
    }
  },
  "x-error-codes": {
    "description": "全局错误代码说明",
    "authentication": {
      "UNAUTHORIZED": "未授权访问，需要有效的JWT令牌",
      "TOKEN_EXPIRED": "JWT令牌已过期，需要重新登录",
      "INVALID_TOKEN": "无效的JWT令牌格式",
      "AUTH_REQUIRED": "需要身份验证",
      "ADMIN_REQUIRED": "需要管理员权限"
    },
    "validation": {
      "BAD_REQUEST": "请求参数错误或格式不正确",
      "MISSING_FIELDS": "缺少必需的字段",
      "INVALID_FORMAT": "字段格式不正确",
      "VALIDATION_FAILED": "数据验证失败"
    },
    "security": {
      "TURNSTILE_VERIFICATION_FAILED": "Turnstile验证失败",
      "MISSING_TURNSTILE_TOKEN": "缺少Turnstile验证令牌",
      "IDEMPOTENCY_KEY_REQUIRED": "缺少幂等性请求ID",
      "INVALID_UUID": "无效的UUID格式"
    },
    "business": {
      "USER_NOT_FOUND": "用户不存在",
      "ACTIVITY_NOT_FOUND": "碳活动不存在",
      "INSUFFICIENT_POINTS": "积分不足",
      "DUPLICATE_OPERATION": "重复操作"
    },
    "server": {
      "INTERNAL_ERROR": "内部服务器错误",
      "SERVICE_UNAVAILABLE": "服务暂时不可用",
      "DATABASE_ERROR": "数据库操作错误"
    }
  },
  "x-api-usage": {
    "description": "API使用指南",
    "authentication": {
      "description": "所有需要认证的API都需要在请求头中包含有效的JWT令牌",
      "example": "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "note": "令牌有效期为24小时，过期后需要重新登录"
    },
    "turnstile": {
      "description": "敏感操作需要Turnstile验证，防止机器人攻击",
      "required_operations": ["用户注册", "用户登录", "发送验证码", "提交碳记录"],
      "implementation": "前端需要集成Cloudflare Turnstile组件，获取验证令牌后随请求发送"
    },
    "idempotency": {
      "description": "敏感操作需要幂等性ID，防止重复提交",
      "required_operations": ["用户注册", "提交碳记录", "积分兑换", "发送消息"],
      "implementation": "生成UUID作为X-Request-ID请求头，24小时内相同ID的请求将返回相同结果"
    },
    "pagination": {
      "description": "列表类API支持分页，默认每页20条记录",
      "parameters": {
        "page": "页码，从1开始",
        "limit": "每页数量，最小10，最大100"
      },
      "response": "包含分页信息的响应结构"
    },
    "error_handling": {
      "description": "所有API都返回统一的错误响应格式",
      "structure": {
        "success": false,
        "message": "错误描述",
        "code": "错误代码"
      },
      "http_status": "HTTP状态码与错误类型对应"
    },
    "rate_limiting": {
      "description": "API有速率限制，防止滥用",
      "limits": {
        "auth": "登录尝试每分钟最多5次",
        "verification": "验证码发送每小时最多3次",
        "general": "其他API每分钟最多100次请求"
      }
    }
  },
  "servers": [
    {
      "url": "/api/v1",
      "description": "生产环境API服务器"
    },
    {
      "url": "http://localhost:8000/api/v1",
      "description": "本地开发环境"
    },
    {
      "url": "/",
      "description": "根路径服务器（用于健康检查 /）"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/auth/register": {
      "post": {
        "tags": ["Auth"],
        "summary": "用户注册",
        "description": "注册新用户账户。需要Turnstile验证以防止机器人注册。",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User registered successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegisterSuccessResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request (e.g., missing fields, password mismatch)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "Conflict (e.g., username or email already exists)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "用户登录",
        "description": "用户身份验证并获取JWT令牌。需要Turnstile验证以防止暴力破解攻击。",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginSuccessResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request (e.g., missing credentials)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized (e.g., invalid credentials)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": ["Auth"],
        "summary": "User Logout",
        "description": "Logs out the currently authenticated user.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Logout successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Logout successful" }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/send-verification-code": {
      "post": {
        "tags": ["Auth"],
        "summary": "发送验证码",
        "description": "向用户邮箱发送验证码，用于密码重置或邮箱验证。需要Turnstile验证以防止滥用。",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "cf_turnstile_response"],
                "properties": {
                  "email": { 
                    "type": "string", 
                    "format": "email", 
                    "example": "johndoe@example.com",
                    "description": "需要发送验证码的邮箱地址"
                  },
                  "cf_turnstile_response": { 
                    "type": "string",
                    "description": "Cloudflare Turnstile验证令牌"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "If the email exists, a verification code has been sent.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/reset-password": {
      "post": {
        "tags": ["Auth"],
        "summary": "Reset Password",
        "description": "Resets the user's password using a valid reset token.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["token", "password", "confirm_password"],
                "properties": {
                  "token": { "type": "string" },
                  "password": { "type": "string", "format": "password" },
                  "confirm_password": { "type": "string", "format": "password" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password reset successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Password reset successful" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request (e.g., invalid token, password mismatch)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/verify-email": {
      "post": {
        "tags": ["Auth"],
        "summary": "Verify Email",
        "description": "Verifies a user's email address with a token.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["token"],
                "properties": {
                  "token": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Email verified successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Email verified successfully" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request (e.g., invalid token)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/me": {
      "get": {
        "tags": ["User"],
        "summary": "获取当前用户信息",
        "description": "获取当前认证用户的详细信息。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功获取用户信息",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "put": {
        "tags": ["User"],
        "summary": "更新当前用户基本信息",
        "description": "更新当前认证用户的基本信息，如用户名、邮箱等。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": { "type": "string", "minLength": 3, "maxLength": 50, "pattern": "^[a-zA-Z0-9_]+$", "description": "用户名，只能包含字母、数字和下划线" },
                  "email": { "type": "string", "format": "email", "description": "有效的邮箱地址" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "用户信息更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "409": { "description": "冲突（如用户名或邮箱已存在）", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/users/{id}": {
      "get": {
        "tags": ["User"],
        "summary": "获取指定用户信息",
        "description": "获取指定ID用户的详细信息。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "用户ID" }
        ],
        "responses": {
          "200": {
            "description": "成功获取用户信息",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "用户不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
  },
      "put": {
        "tags": ["User"],
        "summary": "更新指定用户信息",
        "description": "管理员更新指定ID用户的基本信息。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "用户ID" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": { "type": "string", "minLength": 3, "maxLength": 50, "pattern": "^[a-zA-Z0-9_]+$", "description": "用户名，只能包含字母、数字和下划线" },
                  "email": { "type": "string", "format": "email", "description": "有效的邮箱地址" },
                  "real_name": { "type": "string", "maxLength": 100, "description": "真实姓名" },
                  "school_id": { "type": "integer", "minimum": 1, "description": "学校ID" },
                  "class_name": { "type": "string", "maxLength": 50, "description": "班级名称" },
                  "is_admin": { "type": "boolean", "description": "是否为管理员" },
                  "status": { "type": "string", "enum": ["active", "inactive", "suspended"], "description": "用户状态" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "用户信息更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "409": { "description": "冲突（如用户名或邮箱已存在）", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "delete": {
        "tags": ["User"],
        "summary": "删除指定用户",
        "description": "删除指定ID的用户（需要权限）。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "用户ID" }
        ],
        "responses": {
          "200": {
            "description": "用户删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "User deleted successfully" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "用户不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/users/me/profile": {
      "put": {
        "tags": ["User"],
        "summary": "更新当前用户资料",
        "description": "更新当前认证用户的个人资料信息。支持更新真实姓名、班级名称、学校ID和头像ID。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateProfileRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Profile updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "400": { "description": "Bad Request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "User not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/users/me/avatar": {
      "put": {
        "tags": ["User"],
        "summary": "选择头像",
        "description": "为当前认证用户选择头像。头像ID必须是系统中存在的有效头像。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["avatar_id"],
                "properties": {
                  "avatar_id": { 
                    "type": "integer",
                    "minimum": 1,
                    "description": "头像ID，必须是有效的头像标识符"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Avatar updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "avatar_id": { "type": "integer" },
                        "avatar_url": { "type": "string" },
                        "avatar_name": { "type": "string" }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": { "description": "Bad Request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/users/me/points-history": {
      "get": {
        "tags": ["User"],
        "summary": "Get Points History",
        "description": "Get the points transaction history for the currently authenticated user.",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PointsHistoryResponse" } } }
          },
          "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/users/me/stats": {
      "get": {
        "tags": ["User"],
        "summary": "Get User Stats",
        "description": "Get statistics for the currently authenticated user.",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserStatsResponse" } } }
          },
          "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/users/me/chart-data": {
      "get": {
        "tags": ["User"],
        "summary": "Get Chart Data",
        "description": "Get data for charts on the user dashboard (last 30 days).",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ChartDataResponse" } } }
          },
          "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/users/me/activities": {
      "get": {
        "tags": ["User"],
        "summary": "Get Recent Activities",
        "description": "Get recent activities for the user dashboard.",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RecentActivitiesResponse" } } }
          },
          "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/avatars": {
      "get": {
        "tags": ["Avatar"],
        "summary": "Get Avatars",
        "description": "Get a list of available avatars.",
        "parameters": [
          { "name": "category", "in": "query", "schema": { "type": "string" } },
          { "name": "include_inactive", "in": "query", "schema": { "type": "boolean" } }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AvatarsResponse" } } }
          },
          "403": { "description": "Forbidden", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/avatars/categories": {
      "get": {
        "tags": ["Avatar"],
        "summary": "Get Avatar Categories",
        "description": "Get a list of avatar categories.",
        "responses": {
          "200": {
            "description": "Successful response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AvatarCategoriesResponse" } } }
          },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/carbon-activities": {
      "get": {
        "tags": ["Carbon Activity"],
        "summary": "Get Carbon Activities",
        "description": "Get a list of carbon activities.",
        "parameters": [
          { "name": "category", "in": "query", "schema": { "type": "string" } },
          { "name": "search", "in": "query", "schema": { "type": "string" } },
          { "name": "grouped", "in": "query", "schema": { "type": "boolean" } }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CarbonActivitiesResponse" } } }
          },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/carbon-activities/{id}": {
      "get": {
        "tags": ["Carbon Activity"],
        "summary": "Get Carbon Activity",
        "description": "Get a single carbon activity by ID.",
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CarbonActivityResponse" } } }
          },
          "404": { "description": "Not Found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/carbon-track/calculate": {
      "post": {
        "tags": ["Carbon Track"],
        "summary": "Calculate Carbon Savings",
        "description": "Calculate carbon savings and points for an activity without creating a record.",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CalculateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Calculation successful",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CalculateResponse" } } }
          },
          "400": { "description": "Bad Request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "Activity not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/carbon-track/record": {
      "post": {
        "tags": ["Carbon Track"],
        "summary": "提交碳记录",
        "description": "提交碳减排记录供审核。需要幂等性ID防止重复提交。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "X-Request-ID",
            "in": "header",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "幂等性请求ID，必须是有效的UUID格式，24小时内有效"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubmitRecordRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Record submitted successfully",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SubmitRecordResponse" } } }
          },
          "400": { "description": "Bad Request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "Activity not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "Internal Server Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/carbon-track/transactions": {
      "get": {
        "tags": ["Carbon Track"],
        "summary": "获取用户碳记录",
        "description": "获取当前认证用户的碳减排记录列表。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } },
          { "name": "status", "in": "query", "schema": { "type": "string", "enum": ["pending", "approved", "rejected"] } },
          { "name": "activity_id", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "成功获取碳记录列表",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PointsHistoryResponse" } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/carbon-track/transactions/{id}": {
      "get": {
        "tags": ["Carbon Track"],
        "summary": "获取碳记录详情",
        "description": "获取指定ID的碳减排记录详情。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "碳记录ID" }
        ],
        "responses": {
          "200": {
            "description": "成功获取碳记录详情",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PointsHistoryResponse" } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "记录不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
  },
      "put": {
        "tags": ["Carbon Track"],
        "summary": "审核碳记录",
        "description": "管理员审核指定ID的碳减排记录（批准或拒绝）。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "碳记录ID" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["status"],
                "properties": {
                  "status": { "type": "string", "enum": ["approved", "rejected"], "description": "审核状态" },
                  "admin_notes": { "type": "string", "description": "管理员备注，可选" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "记录审核成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Record reviewed successfully" }
                  }
                }
              }
            }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "记录不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "delete": {
        "tags": ["Carbon Track"],
        "summary": "删除碳记录",
        "description": "删除指定ID的碳减排记录。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "碳记录ID" }
        ],
        "responses": {
          "200": {
            "description": "记录删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Record deleted successfully" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "记录不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/carbon-track/transactions/{id}/approve": {
      "put": {
        "tags": ["Carbon Track"],
        "summary": "审核通过碳记录 (别名)",
        "description": "等价于 PUT /carbon-track/transactions/{id} 并在请求体中传 status=approved。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } } ],
        "responses": { "200": { "description": "审核通过" }, "401": { "description": "未授权" }, "403": { "description": "禁止访问" }, "404": { "description": "记录不存在" } }
      }
    },
    "/carbon-track/transactions/{id}/reject": {
      "put": {
        "tags": ["Carbon Track"],
        "summary": "审核拒绝碳记录 (别名)",
        "description": "等价于 PUT /carbon-track/transactions/{id} 并在请求体中传 status=rejected。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } } ],
        "responses": { "200": { "description": "审核拒绝" }, "401": { "description": "未授权" }, "403": { "description": "禁止访问" }, "404": { "description": "记录不存在" } }
      }
    },
    "/admin/exchanges": {
      "get": {
        "tags": ["Admin", "Exchange"],
        "summary": "获取兑换记录列表 (管理员)",
        "description": "管理员获取所有产品兑换记录列表。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } },
          { "name": "status", "in": "query", "schema": { "type": "string", "enum": ["pending", "completed", "cancelled"] } },
          { "name": "user_id", "in": "query", "schema": { "type": "integer" } },
          { "name": "product_id", "in": "query", "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "成功获取兑换记录列表",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeTransactionsResponse" } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/exchanges/{id}": {
      "get": {
        "tags": ["Admin", "Exchange"],
        "summary": "获取兑换记录详情 (管理员)",
        "description": "管理员获取指定ID的产品兑换记录详情。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "兑换记录ID" }
        ],
        "responses": {
          "200": {
            "description": "成功获取兑换记录详情",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeTransactionResponse" } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "兑换记录不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "put": {
        "tags": ["Admin", "Exchange"],
        "summary": "更新兑换记录状态 (别名)",
        "description": "管理员更新指定ID的产品兑换记录状态，等价于 /admin/exchanges/{id}/status。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "兑换记录ID" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["status"],
                "properties": {
                  "status": { "type": "string", "enum": ["pending", "processing", "shipped", "completed", "cancelled"], "description": "新的状态" },
                  "admin_notes": { "type": "string", "description": "管理员备注，可选" },
                  "tracking_number": { "type": "string", "description": "物流单号，可选" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "兑换记录状态更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Exchange status updated successfully" }
                  }
                }
              }
            }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "兑换记录不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/exchanges/{id}/status": {
      "put": {
        "tags": ["Admin", "Exchange"],
        "summary": "更新兑换记录状态",
        "description": "管理员更新指定ID的产品兑换记录状态。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "兑换记录ID" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["status"],
                "properties": {
                  "status": { "type": "string", "enum": ["pending", "completed", "cancelled"], "description": "新的状态" },
                  "admin_notes": { "type": "string", "description": "管理员备注，可选" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "兑换记录状态更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Exchange status updated successfully" }
                  }
                }
              }
            }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "兑换记录不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/products": {
      "get": {
        "tags": ["Admin", "Product"],
        "summary": "获取产品列表 (管理员)",
        "description": "管理员获取产品列表，支持搜索、筛选和分页。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } },
          { "name": "search", "in": "query", "schema": { "type": "string" } },
          { "name": "category", "in": "query", "schema": { "type": "string" } },
          { "name": "min_points", "in": "query", "schema": { "type": "integer" } },
          { "name": "max_points", "in": "query", "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "成功获取产品列表",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductsResponse" } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
  },
  "post": {
        "tags": ["Admin", "Product"],
        "summary": "创建新产品 (管理员)",
        "description": "管理员创建新的可兑换产品。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateProductRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "产品创建成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductResponse" } } }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/products/{id}": {
      "put": {
        "tags": ["Admin", "Product"],
        "summary": "更新产品信息 (管理员)",
        "description": "管理员更新指定ID的产品信息。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "产品ID" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateProductRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "产品更新成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductResponse" } } }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "产品不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "delete": {
        "tags": ["Admin", "Product"],
        "summary": "删除产品 (管理员)",
        "description": "管理员删除指定ID的产品。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "产品ID" }
        ],
        "responses": {
          "200": {
            "description": "产品删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Product deleted successfully" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "产品不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/avatars": {
      "get": {
        "tags": ["Admin", "Avatar"],
        "summary": "获取头像列表 (管理员)",
        "description": "管理员获取所有头像列表，支持筛选和分页。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } },
          { "name": "category", "in": "query", "schema": { "type": "string" } },
          { "name": "is_active", "in": "query", "schema": { "type": "boolean" } }
        ],
        "responses": {
          "200": {
            "description": "成功获取头像列表",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AvatarsResponse" } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "post": {
        "tags": ["Admin", "Avatar"],
        "summary": "创建新头像",
        "description": "管理员创建新的头像。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateAvatarRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "头像创建成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AvatarResponse" } } }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/avatars/{id}": {
      "get": {
        "tags": ["Admin", "Avatar"],
        "summary": "获取头像详情 (管理员)",
        "description": "管理员获取指定ID的头像详细信息。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "头像ID" }
        ],
        "responses": {
          "200": {
            "description": "成功获取头像详情",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AvatarResponse" } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "头像不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "put": {
        "tags": ["Admin", "Avatar"],
        "summary": "更新头像信息",
        "description": "管理员更新指定ID的头像信息。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "头像ID" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateAvatarRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "头像更新成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AvatarResponse" } } }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "头像不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "delete": {
        "tags": ["Admin", "Avatar"],
        "summary": "删除头像",
        "description": "管理员删除指定ID的头像。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "头像ID" }
        ],
        "responses": {
          "200": {
            "description": "头像删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Avatar deleted successfully" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "头像不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/avatars/sort-orders": {
      "put": {
        "tags": ["Admin", "Avatar"],
        "summary": "更新头像排序顺序",
        "description": "管理员更新头像的排序顺序。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["sort_orders"],
                "properties": {
                  "sort_orders": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": ["id", "sort_order"],
                      "properties": {
                        "id": { "type": "integer", "description": "头像ID" },
                        "sort_order": { "type": "integer", "description": "新的排序顺序" }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "排序顺序更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Sort orders updated successfully" }
                  }
                }
              }
            }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/avatars/usage-stats": {
      "get": {
        "tags": ["Admin", "Avatar"],
        "summary": "获取头像使用统计",
        "description": "管理员获取头像的使用统计信息。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功获取统计信息",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "total_avatars": { "type": "integer" },
                        "active_avatars": { "type": "integer" },
                        "usage_counts": {
                          "type": "object",
                          "additionalProperties": { "type": "integer" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/avatars/upload": {
      "post": {
        "tags": ["Admin", "Avatar"],
        "summary": "上传头像文件",
        "description": "管理员上传头像文件。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": ["file"],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "要上传的头像文件"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "文件上传成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "File uploaded successfully" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "file_path": { "type": "string" },
                        "file_url": { "type": "string" }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/avatars/{id}/restore": {
      "post": {
        "tags": ["Admin", "Avatar"],
        "summary": "恢复头像",
        "description": "管理员恢复指定ID的已删除头像。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "头像ID" }
        ],
        "responses": {
          "200": {
            "description": "头像恢复成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Avatar restored successfully" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "头像不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/avatars/{id}/set-default": {
      "put": {
        "tags": ["Admin", "Avatar"],
        "summary": "设置默认头像",
        "description": "管理员设置指定ID的头像为默认头像。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "头像ID" }
        ],
        "responses": {
          "200": {
            "description": "默认头像设置成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Default avatar set successfully" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "头像不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/files/upload": {
      "post": {
        "tags": ["File Upload"],
        "summary": "上传单个文件",
        "description": "上传单个文件。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": ["file"],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "要上传的文件"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "文件上传成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "File uploaded successfully" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "file_path": { "type": "string" },
                        "file_url": { "type": "string" }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/files/upload-multiple": {
      "post": {
        "tags": ["File Upload"],
        "summary": "上传多个文件",
        "description": "上传多个文件。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": ["files"],
                "properties": {
                  "files": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "binary"
                    },
                    "description": "要上传的文件数组"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "文件上传成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Files uploaded successfully" },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "file_path": { "type": "string" },
                          "file_url": { "type": "string" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/files/{path}": {
      "delete": {
        "tags": ["File Upload"],
        "summary": "删除文件",
        "description": "删除指定路径的文件。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "path", "in": "path", "required": true, "schema": { "type": "string" }, "description": "文件路径" }
        ],
        "responses": {
          "200": {
            "description": "文件删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "File deleted successfully" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "文件不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/files/{path}/info": {
      "get": {
        "tags": ["File Upload"],
        "summary": "获取文件信息",
        "description": "获取指定路径的文件信息。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "path", "in": "path", "required": true, "schema": { "type": "string" }, "description": "文件路径" }
        ],
        "responses": {
          "200": {
            "description": "成功获取文件信息",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "file_name": { "type": "string" },
                        "file_size": { "type": "integer" },
                        "mime_type": { "type": "string" },
                        "created_at": { "type": "string", "format": "date-time" }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "文件不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/files/{path}/presigned-url": {
      "get": {
        "tags": ["File Upload"],
        "summary": "生成预签名URL",
        "description": "生成指定文件的预签名URL，用于临时访问。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "path", "in": "path", "required": true, "schema": { "type": "string" }, "description": "文件路径" },
          { "name": "expires_in", "in": "query", "schema": { "type": "integer", "default": 3600 }, "description": "URL有效期（秒）" }
        ],
        "responses": {
          "200": {
            "description": "成功生成预签名URL",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "presigned_url": { "type": "string", "format": "uri" }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "文件不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/files": {
      "get": {
        "tags": ["Admin", "File"],
        "summary": "获取文件列表 (管理员)",
        "description": "管理员获取文件列表，支持搜索、筛选和分页。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } },
          { "name": "search", "in": "query", "schema": { "type": "string" } },
          { "name": "order_by", "in": "query", "schema": { "type": "string", "enum": ["name", "size", "date"] } },
          { "name": "order_dir", "in": "query", "schema": { "type": "string", "enum": ["asc", "desc"] } }
        ],
        "responses": {
          "200": {
            "description": "成功获取文件列表",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/FilesResponse" } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/files/stats": {
      "get": {
        "tags": ["Admin", "File Upload"],
        "summary": "获取文件存储统计",
        "description": "管理员获取文件存储的统计信息。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功获取统计信息",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "total_files": { "type": "integer" },
                        "total_size": { "type": "integer" },
                        "expired_files": { "type": "integer" }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/admin/files/cleanup": {
      "post": {
        "tags": ["Admin", "File Upload"],
        "summary": "清理过期文件",
        "description": "管理员清理过期的临时文件。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "文件清理成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Expired files cleaned up successfully" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "cleaned_count": { "type": "integer" }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "403": { "description": "禁止访问，需要管理员权限", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/activities": {
      "get": {
        "tags": ["Carbon Track"],
        "summary": "获取用户碳记录 (兼容旧版)",
        "description": "获取当前认证用户的碳减排记录列表，用于向后兼容。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } }
        ],
        "responses": {
          "200": {
            "description": "成功获取碳记录列表",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PointsHistoryResponse" } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/activities/categories": {
      "get": {
        "tags": ["Carbon Activity"],
        "summary": "获取碳活动分类列表 (兼容旧版)",
        "description": "获取所有可用的碳活动分类列表，用于向后兼容。",
        "responses": {
          "200": {
            "description": "成功获取碳活动分类列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                }
              }
            }
          },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
  "/messages/mark-all-read": {
      "put": {
        "tags": ["Message"],
        "summary": "批量标记消息为已读",
        "description": "将当前用户的所有未读消息标记为已读状态。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "批量标记成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "updated_count": { "type": "integer", "description": "标记为已读的消息数量" }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/messages": {
      "get": {
        "tags": ["Message"],
        "summary": "获取用户消息列表",
        "description": "获取当前认证用户的消息列表。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } },
          { "name": "is_read", "in": "query", "schema": { "type": "boolean" } }
        ],
        "responses": {
          "200": {
            "description": "成功获取消息列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer" },
                          "title": { "type": "string" },
                          "content": { "type": "string" },
                          "is_read": { "type": "boolean" },
                          "created_at": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/messages/{id}": {
      "get": {
        "tags": ["Message"],
        "summary": "获取消息详情",
        "description": "获取指定ID的消息详情。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "消息ID" }
        ],
        "responses": {
          "200": {
            "description": "成功获取消息详情",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "integer" },
                        "title": { "type": "string" },
                        "content": { "type": "string" },
                        "is_read": { "type": "boolean" },
                        "created_at": { "type": "string", "format": "date-time" }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "消息不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "delete": {
        "tags": ["Message"],
        "summary": "删除消息",
        "description": "删除指定ID的消息。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "消息ID" }
        ],
        "responses": {
          "200": {
            "description": "消息删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "消息不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/messages/{id}/read": {
      "put": {
        "tags": ["Message"],
        "summary": "标记消息为已读",
        "description": "将指定ID的消息标记为已读。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "消息ID" }
        ],
        "responses": {
          "200": {
            "description": "标记成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "消息不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/messages/unread-count": {
      "get": {
        "tags": ["Message"],
        "summary": "获取未读消息数量",
        "description": "获取当前用户的未读消息数量。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功获取未读数量",
            "content": { "application/json": { "schema": { "type": "object", "properties": { "success": {"type":"boolean"}, "data": {"type":"object", "properties": { "unread_count": {"type":"integer"} } } } } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/exchange": {
      "post": {
        "tags": ["Exchange"],
        "summary": "兑换产品",
        "description": "提交兑换请求，从用户积分中扣除，创建兑换记录。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeRequest" } } } },
        "responses": {
          "200": { "description": "兑换成功", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeResponse" } } } },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "409": { "description": "库存不足或积分不足", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/exchange/transactions": {
      "get": {
        "tags": ["Exchange"],
        "summary": "获取用户兑换记录",
        "description": "获取当前认证用户的兑换记录列表。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } }
        ],
        "responses": {
          "200": { "description": "成功获取兑换记录", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeTransactionsResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/exchange/transactions/{id}": {
      "get": {
        "tags": ["Exchange"],
        "summary": "获取兑换记录详情",
        "description": "获取指定ID的兑换记录详情。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "兑换记录ID" } ],
        "responses": {
          "200": { "description": "成功获取兑换详情", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeTransactionResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "记录不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/products": {
      "get": {
        "tags": ["Product"],
        "summary": "获取产品列表",
        "description": "获取可兑换产品列表，支持搜索与分页。",
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } },
          { "name": "search", "in": "query", "schema": { "type": "string" } },
          { "name": "category", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "成功获取产品列表", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductsResponse" } } } }
        }
      },
      "post": {
        "tags": ["Product"],
        "summary": "创建产品",
        "description": "创建新产品（如果后端允许公共POST则保留；否则仅管理员，已在 /admin/products 记录）。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateProductRequest" } } } },
        "responses": { "201": { "description": "创建成功", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductResponse" } } } } }
      }
    },
    "/products/{id}": {
      "get": {
        "tags": ["Product"],
        "summary": "获取产品详情",
        "description": "获取指定ID的产品详情。",
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "responses": { "200": { "description": "成功获取产品详情", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductResponse" } } } }, "404": { "description": "产品不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } }
      },
      "put": {
        "tags": ["Product"],
        "summary": "更新产品",
        "description": "更新指定ID产品（如果允许普通用户；否则仅管理员路径生效）。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateProductRequest" } } } },
        "responses": { "200": { "description": "更新成功", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductResponse" } } } }, "404": { "description": "产品不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } }
      },
      "delete": {
        "tags": ["Product"],
        "summary": "删除产品",
        "description": "删除指定ID产品（如果允许普通用户；否则仅管理员路径生效）。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "responses": { "200": { "description": "删除成功" }, "404": { "description": "产品不存在" } }
      }
    },
    "/products/categories": {
      "get": {
        "tags": ["Product"],
        "summary": "获取产品分类",
        "description": "获取所有可用产品分类。",
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "type": "object", "properties": { "success": {"type":"boolean"}, "data": { "type": "array", "items": { "type": "string" } } } } } } } }
      }
    },
    "/schools": {
      "get": {
        "tags": ["School"],
        "summary": "获取学校列表",
        "description": "获取学校列表（公开接口）。",
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "type": "object", "properties": { "success": {"type":"boolean"}, "data": { "type": "array", "items": { "type": "object", "properties": { "id": {"type":"integer"}, "name": {"type":"string"} } } } } } } } } }
      }
    },
    "/admin/schools": {
      "post": {
        "tags": ["Admin", "School"],
        "summary": "创建学校 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "201": { "description": "创建成功" } }
      }
    },
    "/admin/schools/{id}": {
      "put": {
        "tags": ["Admin", "School"],
        "summary": "更新学校 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "更新成功" }, "404": { "description": "学校不存在" } }
      },
      "delete": {
        "tags": ["Admin", "School"],
        "summary": "删除学校 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "responses": { "200": { "description": "删除成功" }, "404": { "description": "学校不存在" } }
      }
    },
    "/admin/users": {
      "get": {
        "tags": ["Admin", "User"],
        "summary": "获取用户列表 (管理员)",
        "description": "管理员获取用户列表，支持分页筛选。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } }, { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } }, { "name": "search", "in": "query", "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "type": "object", "properties": { "success": {"type":"boolean"}, "data": { "type": "array", "items": { "$ref": "#/components/schemas/UserResponse" } } } } } } } }
      }
    },
    "/admin/users/{id}": {
      "put": {
        "tags": ["Admin", "User"],
        "summary": "更新用户 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "成功" }, "404": { "description": "用户不存在" } }
      },
      "delete": {
        "tags": ["Admin", "User"],
        "summary": "删除用户 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "responses": { "200": { "description": "成功" }, "404": { "description": "用户不存在" } }
      }
    },
    "/admin/transactions/pending": {
      "get": {
        "tags": ["Admin", "Carbon Track"],
        "summary": "获取待审核碳记录 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/stats": {
      "get": {
        "tags": ["Admin"],
        "summary": "获取后台统计 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/logs": {
      "get": {
        "tags": ["Admin"],
        "summary": "获取系统日志 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities": {
      "get": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "获取碳活动列表 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      },
      "post": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "创建碳活动 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateCarbonActivityRequest" } } } },
        "responses": { "201": { "description": "创建成功" } }
      }
    },
    "/admin/carbon-activities/statistics": {
      "get": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "获取碳活动统计 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities/sort-orders": {
      "put": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "更新活动排序 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities/{id}": {
      "put": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "更新碳活动 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateCarbonActivityRequest" } } } },
        "responses": { "200": { "description": "成功" } }
      },
      "delete": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "删除碳活动 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities/{id}/restore": {
      "post": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "恢复碳活动 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities/{id}/statistics": {
      "get": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "获取单个活动统计 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/activities": {
      "get": {
        "tags": ["Admin", "Carbon Track"],
        "summary": "获取待审核记录列表 (别名)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/activities/{id}/review": {
      "put": {
        "tags": ["Admin", "Carbon Track"],
        "summary": "审核碳记录 (别名)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "required": ["status"], "properties": { "status": { "type": "string", "enum": ["approved", "rejected"] }, "admin_notes": { "type": "string" } } } } } },
        "responses": { "200": { "description": "审核成功" }, "404": { "description": "记录不存在" } }
      }
    },
    "/": {
      "get": {
        "tags": ["System"],
        "summary": "健康检查",
        "description": "返回API运行状态。",
        "responses": { "200": { "description": "服务运行中" } }
      }
    },
    "/{routes}": {
      "get": {
        "tags": ["System"],
        "summary": "未匹配路由 (GET)",
        "description": "通配未匹配的路由，返回404。",
        "responses": { "404": { "description": "Route not found" } }
      },
      "post": {
        "tags": ["System"],
        "summary": "未匹配路由 (POST)",
        "responses": { "404": { "description": "Route not found" } }
      },
      "put": {
        "tags": ["System"],
        "summary": "未匹配路由 (PUT)",
        "responses": { "404": { "description": "Route not found" } }
      },
      "delete": {
        "tags": ["System"],
        "summary": "未匹配路由 (DELETE)",
        "responses": { "404": { "description": "Route not found" } }
      },
      "patch": {
        "tags": ["System"],
        "summary": "未匹配路由 (PATCH)",
        "responses": { "404": { "description": "Route not found" } }
      }
    },
    "/carbon-track/factors": {
      "get": {
        "tags": ["Carbon Track"],
        "summary": "获取碳因子配置",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "type": "object" } } } } }
      }
    },
    "/carbon-track/stats": {
      "get": {
        "tags": ["Carbon Track"],
        "summary": "获取用户碳统计",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserStatsResponse" } } } } }
      }
    }
  },
  "components": {
    "schemas": {
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean", "example": false },
          "message": { "type": "string", "example": "错误描述" },
          "code": { "type": "string", "example": "错误代码" }
        }
      },
      "RegisterRequest": {
        "type": "object",
        "required": ["username", "email", "password", "confirm_password", "cf_turnstile_response"],
        "properties": {
          "username": { "type": "string", "minLength": 3, "maxLength": 50, "pattern": "^[a-zA-Z0-9_]+$", "description": "用户名，只能包含字母、数字和下划线" },
          "email": { "type": "string", "format": "email", "description": "有效的邮箱地址" },
          "password": { "type": "string", "format": "password", "description": "密码，至少8个字符，包含字母和数字" },
          "confirm_password": { "type": "string", "format": "password", "description": "确认密码" },
          "cf_turnstile_response": { "type": "string", "description": "Cloudflare Turnstile验证令牌" }
        }
      },
      "RegisterSuccessResponse": {
        "type": "object",
        "properties": {
          "user_id": { "type": "integer", "description": "新注册用户的ID" },
          "username": { "type": "string", "description": "用户名" },
          "email": { "type": "string", "description": "邮箱地址" }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": ["email", "password", "cf_turnstile_response"],
        "properties": {
          "email": { "type": "string", "format": "email", "description": "用户邮箱" },
          "password": { "type": "string", "format": "password", "description": "用户密码" },
          "cf_turnstile_response": { "type": "string", "description": "Cloudflare Turnstile验证令牌" }
        }
      },
      "LoginSuccessResponse": {
        "type": "object",
        "properties": {
          "access_token": { "type": "string", "description": "JWT访问令牌" },
          "expires_in": { "type": "integer", "description": "令牌有效期（秒）" },
          "refresh_token": { "type": "string", "description": "JWT刷新令牌" }
        }
      },
      "UserResponse": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "description": "用户ID" },
          "username": { "type": "string", "description": "用户名" },
          "email": { "type": "string", "description": "邮箱地址" },
          "real_name": { "type": "string", "description": "真实姓名" },
          "avatar_url": { "type": "string", "description": "头像URL" },
          "role": { "type": "string", "enum": ["user", "admin"], "description": "用户角色" },
          "status": { "type": "string", "enum": ["active", "inactive", "suspended"], "description": "用户状态" },
          "created_at": { "type": "string", "format": "date-time", "description": "账户创建时间" },
          "updated_at": { "type": "string", "format": "date-time", "description": "账户更新时间" }
        }
      },
      "UpdateProfileRequest": {
        "type": "object",
        "properties": {
          "real_name": { "type": "string", "maxLength": 100, "description": "真实姓名" },
          "school_id": { "type": "integer", "minimum": 1, "description": "学校ID" },
          "class_name": { "type": "string", "maxLength": 50, "description": "班级名称" },
          "avatar_id": { "type": "integer", "description": "头像ID" }
        }
      },
      "CalculateRequest": {
        "type": "object",
        "properties": {
          "activity_id": { "type": "string", "description": "活动ID" },
          "parameters": { 
            "type": "object",
            "additionalProperties": { "type": "string" }
          }
        }
      },
      "CalculateResponse": {
        "type": "object",
        "properties": {
          "carbon_saved": { "type": "number", "description": "计算的碳减排量" },
          "points_awarded": { "type": "integer", "description": "计算的积分" }
        }
      },
      "SubmitRecordRequest": {
        "type": "object",
        "required": ["activity_id", "parameters"],
        "properties": {
          "activity_id": { "type": "string", "description": "活动ID" },
          "parameters": { 
            "type": "object",
            "additionalProperties": { "type": "string" }
          }
        }
      },
      "SubmitRecordResponse": {
        "type": "object",
        "properties": {
          "record_id": { "type": "string", "description": "提交的记录ID" },
          "status": { "type": "string", "enum": ["pending", "approved", "rejected"], "description": "记录状态" }
        }
      },
      "PointsHistoryResponse": {
        "type": "object",
        "properties": {
          "page": { "type": "integer", "description": "当前页码" },
          "limit": { "type": "integer", "description": "每页数量" },
          "total": { "type": "integer", "description": "总记录数" },
          "records": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "string", "description": "记录ID" },
                "user_id": { "type": "integer", "description": "用户ID" },
                "activity_id": { "type": "string", "description": "活动ID" },
                "carbon_saved": { "type": "number", "description": "碳减排量" },
                "points_awarded": { "type": "integer", "description": "奖励积分" },
                "status": { "type": "string", "enum": ["pending", "approved", "rejected"], "description": "记录状态" },
                "created_at": { "type": "string", "format": "date-time", "description": "记录创建时间" },
                "updated_at": { "type": "string", "format": "date-time", "description": "记录更新时间" }
              }
            }
          }
        }
      },
      "UserStatsResponse": {
        "type": "object",
        "properties": {
          "total_carbon_saved": { "type": "number", "description": "总碳减排量" },
          "total_points_awarded": { "type": "integer", "description": "总奖励积分" },
          "activity_count": { "type": "integer", "description": "参与活动总数" },
          "transaction_count": { "type": "integer", "description": "碳记录总数" }
        }
      },
      "ChartDataResponse": {
        "type": "object",
        "properties": {
          "labels": { "type": "array", "items": { "type": "string" }, "description": "X轴标签（日期）" },
          "datasets": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "label": { "type": "string", "description": "数据集标签" },
                "data": { "type": "array", "items": { "type": "number" }, "description": "Y轴数据（碳减排量或积分）" },
                "backgroundColor": { "type": "string", "description": "背景色" },
                "borderColor": { "type": "string", "description": "边框色" },
                "borderWidth": { "type": "integer", "description": "边框宽度" }
              }
            }
          }
        }
      },
      "RecentActivitiesResponse": {
        "type": "object",
        "properties": {
          "activities": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "string", "description": "活动ID" },
                "type": { "type": "string", "description": "活动类型" },
                "description": { "type": "string", "description": "活动描述" },
                "carbon_saved": { "type": "number", "description": "碳减排量" },
                "points_awarded": { "type": "integer", "description": "奖励积分" },
                "date": { "type": "string", "format": "date-time", "description": "活动日期" }
              }
            }
          }
        }
      },
      "AvatarsResponse": {
        "type": "object",
        "properties": {
          "avatars": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "integer", "description": "头像ID" },
                "url": { "type": "string", "description": "头像URL" },
                "name": { "type": "string", "description": "头像名称" },
                "category": { "type": "string", "description": "头像类别" },
                "is_active": { "type": "boolean", "description": "是否可用" }
              }
            }
          }
        }
      },
      "AvatarCategoriesResponse": {
        "type": "object",
        "properties": {
          "categories": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "integer", "description": "类别ID" },
                "name": { "type": "string", "description": "类别名称" },
                "description": { "type": "string", "description": "类别描述" },
                "avatar_count": { "type": "integer", "description": "包含的头像数量" }
              }
            }
          }
        }
      },
      "CarbonActivitiesResponse": {
        "type": "object",
        "properties": {
          "activities": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "string", "description": "活动ID" },
                "name": { "type": "string", "description": "活动名称" },
                "description": { "type": "string", "description": "活动描述" },
                "category": { "type": "string", "description": "活动类别" },
                "carbon_saved": { "type": "number", "description": "碳减排量" },
                "points_awarded": { "type": "integer", "description": "奖励积分" },
                "status": { "type": "string", "enum": ["active", "inactive"], "description": "活动状态" },
                "created_at": { "type": "string", "format": "date-time", "description": "活动创建时间" },
                "updated_at": { "type": "string", "format": "date-time", "description": "活动更新时间" }
              }
            }
          }
        }
      },
      "CarbonActivityResponse": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "description": "活动ID" },
          "name": { "type": "string", "description": "活动名称" },
          "description": { "type": "string", "description": "活动描述" },
          "category": { "type": "string", "description": "活动类别" },
          "carbon_saved": { "type": "number", "description": "碳减排量" },
          "points_awarded": { "type": "integer", "description": "奖励积分" },
          "status": { "type": "string", "enum": ["active", "inactive"], "description": "活动状态" },
          "created_at": { "type": "string", "format": "date-time", "description": "活动创建时间" },
          "updated_at": { "type": "string", "format": "date-time", "description": "活动更新时间" }
        }
      },
      "ProductsResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "properties": {
              "products": {
                "type": "array",
                "items": { "$ref": "#/components/schemas/Product" }
              },
              "pagination": {
                "type": "object",
                "properties": {
                  "page": { "type": "integer" },
                  "limit": { "type": "integer" },
                  "total": { "type": "integer" },
                  "pages": { "type": "integer" }
                }
              }
            }
          }
        }
      },
      "ProductResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": { "$ref": "#/components/schemas/Product" }
        }
      },
      "Product": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "points_cost": { "type": "integer" },
          "stock": { "type": "integer" },
          "category": { "type": "string" },
          "image_url": { "type": "string" },
          "is_active": { "type": "boolean" },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" }
        }
      },
      "CreateProductRequest": {
        "type": "object",
        "required": ["name", "description", "points_cost", "stock", "category"],
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "points_cost": { "type": "integer", "minimum": 0 },
          "stock": { "type": "integer", "minimum": 0 },
          "category": { "type": "string" },
          "image_url": { "type": "string" }
        }
      },
      "UpdateProductRequest": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "points_cost": { "type": "integer", "minimum": 0 },
          "stock": { "type": "integer", "minimum": 0 },
          "category": { "type": "string" },
          "image_url": { "type": "string" },
          "is_active": { "type": "boolean" }
        }
      },
      "ExchangeRequest": {
        "type": "object",
        "required": ["product_id", "quantity"],
        "properties": {
          "product_id": { "type": "integer", "description": "产品ID" },
          "quantity": { "type": "integer", "minimum": 1, "description": "兑换数量" }
        }
      },
      "ExchangeResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" },
          "data": {
            "type": "object",
            "properties": {
              "exchange_id": { "type": "integer" },
              "product_name": { "type": "string" },
              "points_deducted": { "type": "integer" }
            }
          }
        }
      },
      "ExchangeTransactionsResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "string", "format": "uuid" },
                "user_id": { "type": "integer" },
                "username": { "type": "string" },
                "product_id": { "type": "integer" },
                "product_name": { "type": "string" },
                "quantity": { "type": "integer" },
                "points_used": { "type": "integer" },
                "status": { "type": "string" },
                "created_at": { "type": "string", "format": "date-time" }
              }
            }
          },
          "pagination": {
            "type": "object",
            "properties": {
              "page": { "type": "integer" },
              "limit": { "type": "integer" },
              "total": { "type": "integer" },
              "pages": { "type": "integer" }
            }
          }
        }
      },
      "ExchangeTransactionResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "properties": {
              "id": { "type": "string", "format": "uuid" },
              "user_id": { "type": "integer" },
              "username": { "type": "string" },
              "product_id": { "type": "integer" },
              "product_name": { "type": "string" },
              "quantity": { "type": "integer" },
              "points_used": { "type": "integer" },
              "status": { "type": "string" },
              "created_at": { "type": "string", "format": "date-time" },
              "updated_at": { "type": "string", "format": "date-time" }
            }
          }
        }
      },
      "CreateCarbonActivityRequest": {
        "type": "object",
        "required": ["name_zh", "name_en", "category", "carbon_factor", "unit"],
        "properties": {
          "name_zh": { "type": "string" },
          "name_en": { "type": "string" },
          "category": { "type": "string" },
          "carbon_factor": { "type": "number" },
          "unit": { "type": "string" },
          "description_zh": { "type": "string" },
          "description_en": { "type": "string" },
          "icon": { "type": "string" },
          "is_active": { "type": "boolean" },
          "sort_order": { "type": "integer" }
        }
      },
      "UpdateCarbonActivityRequest": {
        "type": "object",
        "properties": {
          "name_zh": { "type": "string" },
          "name_en": { "type": "string" },
          "category": { "type": "string" },
          "carbon_factor": { "type": "number" },
          "unit": { "type": "string" },
          "description_zh": { "type": "string" },
          "description_en": { "type": "string" },
          "icon": { "type": "string" },
          "is_active": { "type": "boolean" },
          "sort_order": { "type": "integer" }
        }
      },
      "CreateAvatarRequest": {
        "type": "object",
        "required": ["name", "file_path", "thumbnail_path", "category"],
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "file_path": { "type": "string" },
          "thumbnail_path": { "type": "string" },
          "category": { "type": "string" },
          "sort_order": { "type": "integer" },
          "is_active": { "type": "boolean" },
          "is_default": { "type": "boolean" }
        }
      },
      "AvatarResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "properties": {
              "id": { "type": "integer" },
              "name": { "type": "string" },
              "description": { "type": "string" },
              "file_path": { "type": "string" },
              "thumbnail_path": { "type": "string" },
              "category": { "type": "string" },
              "sort_order": { "type": "integer" },
              "is_active": { "type": "boolean" },
              "is_default": { "type": "boolean" }
            }
          }
        }
      },
      "UpdateAvatarRequest": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "file_path": { "type": "string" },
          "thumbnail_path": { "type": "string" },
          "category": { "type": "string" },
          "sort_order": { "type": "integer" },
          "is_active": { "type": "boolean" },
          "is_default": { "type": "boolean" }
        }
      },
      "securitySchemes": {
        "bearerAuth": {
          "type": "http",
          "scheme": "bearer",
          "bearerFormat": "JWT",
          "description": "JWT认证，格式为'Bearer {token}'"
        }
      }
    }
    ,
    "/messages": {
      "get": {
        "tags": ["Message"],
        "summary": "获取用户消息列表",
        "description": "获取当前认证用户的消息列表。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } },
          { "name": "is_read", "in": "query", "schema": { "type": "boolean" } }
        ],
        "responses": {
          "200": {
            "description": "成功获取消息列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer" },
                          "title": { "type": "string" },
                          "content": { "type": "string" },
                          "is_read": { "type": "boolean" },
                          "created_at": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/messages/{id}": {
      "get": {
        "tags": ["Message"],
        "summary": "获取消息详情",
        "description": "获取指定ID的消息详情。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "消息ID" }
        ],
        "responses": {
          "200": {
            "description": "成功获取消息详情",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "integer" },
                        "title": { "type": "string" },
                        "content": { "type": "string" },
                        "is_read": { "type": "boolean" },
                        "created_at": { "type": "string", "format": "date-time" }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "消息不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      },
      "delete": {
        "tags": ["Message"],
        "summary": "删除消息",
        "description": "删除指定ID的消息。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "消息ID" }
        ],
        "responses": {
          "200": {
            "description": "消息删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "消息不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/messages/{id}/read": {
      "put": {
        "tags": ["Message"],
        "summary": "标记消息为已读",
        "description": "将指定ID的消息标记为已读。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "消息ID" }
        ],
        "responses": {
          "200": {
            "description": "标记成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "消息不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/messages/unread-count": {
      "get": {
        "tags": ["Message"],
        "summary": "获取未读消息数量",
        "description": "获取当前用户的未读消息数量。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功获取未读数量",
            "content": { "application/json": { "schema": { "type": "object", "properties": { "success": {"type":"boolean"}, "data": {"type":"object", "properties": { "unread_count": {"type":"integer"} } } } } } }
          },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "500": { "description": "内部服务器错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/exchange": {
      "post": {
        "tags": ["Exchange"],
        "summary": "兑换产品",
        "description": "提交兑换请求，从用户积分中扣除，创建兑换记录。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeRequest" } } } },
        "responses": {
          "200": { "description": "兑换成功", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeResponse" } } } },
          "400": { "description": "请求参数错误", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "409": { "description": "库存不足或积分不足", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/exchange/transactions": {
      "get": {
        "tags": ["Exchange"],
        "summary": "获取用户兑换记录",
        "description": "获取当前认证用户的兑换记录列表。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } }
        ],
        "responses": {
          "200": { "description": "成功获取兑换记录", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeTransactionsResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/exchange/transactions/{id}": {
      "get": {
        "tags": ["Exchange"],
        "summary": "获取兑换记录详情",
        "description": "获取指定ID的兑换记录详情。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "兑换记录ID" } ],
        "responses": {
          "200": { "description": "成功获取兑换详情", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExchangeTransactionResponse" } } } },
          "401": { "description": "未授权", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "404": { "description": "记录不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/products": {
      "get": {
        "tags": ["Product"],
        "summary": "获取产品列表",
        "description": "获取可兑换产品列表，支持搜索与分页。",
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } },
          { "name": "search", "in": "query", "schema": { "type": "string" } },
          { "name": "category", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "成功获取产品列表", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductsResponse" } } } }
        }
      },
      "post": {
        "tags": ["Product"],
        "summary": "创建产品",
        "description": "创建新产品（如果后端允许公共POST则保留；否则仅管理员，已在 /admin/products 记录）。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateProductRequest" } } } },
        "responses": { "201": { "description": "创建成功", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductResponse" } } } } }
      }
    },
    "/products/{id}": {
      "get": {
        "tags": ["Product"],
        "summary": "获取产品详情",
        "description": "获取指定ID的产品详情。",
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "responses": { "200": { "description": "成功获取产品详情", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductResponse" } } } }, "404": { "description": "产品不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } }
      },
      "put": {
        "tags": ["Product"],
        "summary": "更新产品",
        "description": "更新指定ID产品（如果允许普通用户；否则仅管理员路径生效）。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateProductRequest" } } } },
        "responses": { "200": { "description": "更新成功", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductResponse" } } } }, "404": { "description": "产品不存在", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } }
      },
      "delete": {
        "tags": ["Product"],
        "summary": "删除产品",
        "description": "删除指定ID产品（如果允许普通用户；否则仅管理员路径生效）。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "responses": { "200": { "description": "删除成功" }, "404": { "description": "产品不存在" } }
      }
    },
    "/products/categories": {
      "get": {
        "tags": ["Product"],
        "summary": "获取产品分类",
        "description": "获取所有可用产品分类。",
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "type": "object", "properties": { "success": {"type":"boolean"}, "data": { "type": "array", "items": { "type": "string" } } } } } } } }
      }
    },
    "/schools": {
      "get": {
        "tags": ["School"],
        "summary": "获取学校列表",
        "description": "获取学校列表（公开接口）。",
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "type": "object", "properties": { "success": {"type":"boolean"}, "data": { "type": "array", "items": { "type": "object", "properties": { "id": {"type":"integer"}, "name": {"type":"string"} } } } } } } } } }
      }
    },
    "/admin/users": {
      "get": {
        "tags": ["Admin", "User"],
        "summary": "获取用户列表 (管理员)",
        "description": "管理员获取用户列表，支持分页筛选。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } }, { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 20 } }, { "name": "search", "in": "query", "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "type": "object", "properties": { "success": {"type":"boolean"}, "data": { "type": "array", "items": { "$ref": "#/components/schemas/UserResponse" } } } } } } } }
      }
    },
    "/admin/users/{id}": {
      "put": {
        "tags": ["Admin", "User"],
        "summary": "更新用户 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "成功" }, "404": { "description": "用户不存在" } }
      },
      "delete": {
        "tags": ["Admin", "User"],
        "summary": "删除用户 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
        "responses": { "200": { "description": "成功" }, "404": { "description": "用户不存在" } }
      }
    },
    "/admin/transactions/pending": {
      "get": {
        "tags": ["Admin", "Carbon Track"],
        "summary": "获取待审核碳记录 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/stats": {
      "get": {
        "tags": ["Admin"],
        "summary": "获取后台统计 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/logs": {
      "get": {
        "tags": ["Admin"],
        "summary": "获取系统日志 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities": {
      "get": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "获取碳活动列表 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      },
      "post": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "创建碳活动 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateCarbonActivityRequest" } } } },
        "responses": { "201": { "description": "创建成功" } }
      }
    },
    "/admin/carbon-activities/statistics": {
      "get": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "获取碳活动统计 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities/sort-orders": {
      "put": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "更新活动排序 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities/{id}": {
      "put": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "更新碳活动 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateCarbonActivityRequest" } } } },
        "responses": { "200": { "description": "成功" } }
      },
      "delete": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "删除碳活动 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities/{id}/restore": {
      "post": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "恢复碳活动 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/admin/carbon-activities/{id}/statistics": {
      "get": {
        "tags": ["Admin", "Carbon Activity"],
        "summary": "获取单个活动统计 (管理员)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/carbon-track/factors": {
      "get": {
        "tags": ["Carbon Track"],
        "summary": "获取碳因子配置",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "type": "object" } } } } }
      }
    },
    "/carbon-track/stats": {
      "get": {
        "tags": ["Carbon Track"],
        "summary": "获取用户碳统计",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "成功", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserStatsResponse" } } } } }
      }
    }
  }
}