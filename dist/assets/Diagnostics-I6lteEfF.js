import{c as X,aj as Ie,r as d,au as xe,j as e,aQ as ke,ac as H,al as Ee,ax as ls,ah as Oe,b0 as os,R as P,b1 as cs,aY as ds,a as Z,u as _e,E as ms,B,w as de,ab as us,y as xs,I as V,F as O}from"./index-9oiziVwF.js";import{C as Y,a as ne,b as re,c as ie,d as me}from"./Card-DiZzX4G1.js";import{A as qe,b as De,a as Me}from"./Alert-DMTWhZOi.js";import{T as le}from"./textarea-BakiDkNo.js";import{S as ps,a as hs,b as gs,c as fs,d as Ae}from"./select-L0i8fx-o.js";import{C as bs}from"./chevron-down-ChSselTD.js";import{S as js}from"./switch-BM59ftG1.js";import{D as vs}from"./download-DHJ68Pfg.js";import{R as Le}from"./refresh-cw-BMcL1E4q.js";import{S as ys}from"./shield-tmlCKQ9k.js";import"./index-BdQq_4o_.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]],Cs=X("code",Ns);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17",key:"1tzkfa"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"14pb5j"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],As=X("earth",ws);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ts=X("layers",Ss);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]],Rs=X("list-checks",Ps);var ee="Collapsible",[Is,$e]=Ie(ee),[ks,pe]=Is(ee),Ue=d.forwardRef((s,t)=>{const{__scopeCollapsible:a,open:l,defaultOpen:i,disabled:o,onOpenChange:c,...m}=s,[p,b]=xe({prop:l,defaultProp:i??!1,onChange:c,caller:ee});return e.jsx(ks,{scope:a,disabled:o,contentId:ke(),open:p,onOpenToggle:d.useCallback(()=>b(h=>!h),[b]),children:e.jsx(H.div,{"data-state":ge(p),"data-disabled":o?"":void 0,...m,ref:t})})});Ue.displayName=ee;var Fe="CollapsibleTrigger",Ve=d.forwardRef((s,t)=>{const{__scopeCollapsible:a,...l}=s,i=pe(Fe,a);return e.jsx(H.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":ge(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...l,ref:t,onClick:Ee(s.onClick,i.onOpenToggle)})});Ve.displayName=Fe;var he="CollapsibleContent",Be=d.forwardRef((s,t)=>{const{forceMount:a,...l}=s,i=pe(he,s.__scopeCollapsible);return e.jsx(ls,{present:a||i.open,children:({present:o})=>e.jsx(Es,{...l,ref:t,present:o})})});Be.displayName=he;var Es=d.forwardRef((s,t)=>{const{__scopeCollapsible:a,present:l,children:i,...o}=s,c=pe(he,a),[m,p]=d.useState(l),b=d.useRef(null),h=Oe(t,b),j=d.useRef(0),f=j.current,g=d.useRef(0),u=g.current,A=c.open||m,N=d.useRef(A),S=d.useRef(void 0);return d.useEffect(()=>{const x=requestAnimationFrame(()=>N.current=!1);return()=>cancelAnimationFrame(x)},[]),os(()=>{const x=b.current;if(x){S.current=S.current||{transitionDuration:x.style.transitionDuration,animationName:x.style.animationName},x.style.transitionDuration="0s",x.style.animationName="none";const w=x.getBoundingClientRect();j.current=w.height,g.current=w.width,N.current||(x.style.transitionDuration=S.current.transitionDuration,x.style.animationName=S.current.animationName),p(l)}},[c.open,l]),e.jsx(H.div,{"data-state":ge(c.open),"data-disabled":c.disabled?"":void 0,id:c.contentId,hidden:!A,...o,ref:h,style:{"--radix-collapsible-content-height":f?`${f}px`:void 0,"--radix-collapsible-content-width":u?`${u}px`:void 0,...s.style},children:A&&i})});function ge(s){return s?"open":"closed"}var Os=Ue,_s=Ve,qs=Be,k="Accordion",Ds=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[fe,Ms,Ls]=cs(k),[se]=Ie(k,[Ls,$e]),be=$e(),He=P.forwardRef((s,t)=>{const{type:a,...l}=s,i=l,o=l;return e.jsx(fe.Provider,{scope:s.__scopeAccordion,children:a==="multiple"?e.jsx(Vs,{...o,ref:t}):e.jsx(Fs,{...i,ref:t})})});He.displayName=k;var[Je,$s]=se(k),[ze,Us]=se(k,{collapsible:!1}),Fs=P.forwardRef((s,t)=>{const{value:a,defaultValue:l,onValueChange:i=()=>{},collapsible:o=!1,...c}=s,[m,p]=xe({prop:a,defaultProp:l??"",onChange:i,caller:k});return e.jsx(Je,{scope:s.__scopeAccordion,value:P.useMemo(()=>m?[m]:[],[m]),onItemOpen:p,onItemClose:P.useCallback(()=>o&&p(""),[o,p]),children:e.jsx(ze,{scope:s.__scopeAccordion,collapsible:o,children:e.jsx(Ge,{...c,ref:t})})})}),Vs=P.forwardRef((s,t)=>{const{value:a,defaultValue:l,onValueChange:i=()=>{},...o}=s,[c,m]=xe({prop:a,defaultProp:l??[],onChange:i,caller:k}),p=P.useCallback(h=>m((j=[])=>[...j,h]),[m]),b=P.useCallback(h=>m((j=[])=>j.filter(f=>f!==h)),[m]);return e.jsx(Je,{scope:s.__scopeAccordion,value:c,onItemOpen:p,onItemClose:b,children:e.jsx(ze,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(Ge,{...o,ref:t})})})}),[Bs,te]=se(k),Ge=P.forwardRef((s,t)=>{const{__scopeAccordion:a,disabled:l,dir:i,orientation:o="vertical",...c}=s,m=P.useRef(null),p=Oe(m,t),b=Ms(a),j=ds(i)==="ltr",f=Ee(s.onKeyDown,g=>{var q;if(!Ds.includes(g.key))return;const u=g.target,A=b().filter(I=>{var M;return!((M=I.ref.current)!=null&&M.disabled)}),N=A.findIndex(I=>I.ref.current===u),S=A.length;if(N===-1)return;g.preventDefault();let x=N;const w=0,C=S-1,v=()=>{x=N+1,x>C&&(x=w)},E=()=>{x=N-1,x<w&&(x=C)};switch(g.key){case"Home":x=w;break;case"End":x=C;break;case"ArrowRight":o==="horizontal"&&(j?v():E());break;case"ArrowDown":o==="vertical"&&v();break;case"ArrowLeft":o==="horizontal"&&(j?E():v());break;case"ArrowUp":o==="vertical"&&E();break}const _=x%S;(q=A[_].ref.current)==null||q.focus()});return e.jsx(Bs,{scope:a,disabled:l,direction:i,orientation:o,children:e.jsx(fe.Slot,{scope:a,children:e.jsx(H.div,{...c,"data-orientation":o,ref:p,onKeyDown:l?void 0:f})})})}),W="AccordionItem",[Hs,je]=se(W),Ke=P.forwardRef((s,t)=>{const{__scopeAccordion:a,value:l,...i}=s,o=te(W,a),c=$s(W,a),m=be(a),p=ke(),b=l&&c.value.includes(l)||!1,h=o.disabled||s.disabled;return e.jsx(Hs,{scope:a,open:b,disabled:h,triggerId:p,children:e.jsx(Os,{"data-orientation":o.orientation,"data-state":es(b),...m,...i,ref:t,disabled:h,open:b,onOpenChange:j=>{j?c.onItemOpen(l):c.onItemClose(l)}})})});Ke.displayName=W;var Qe="AccordionHeader",Ye=P.forwardRef((s,t)=>{const{__scopeAccordion:a,...l}=s,i=te(k,a),o=je(Qe,a);return e.jsx(H.h3,{"data-orientation":i.orientation,"data-state":es(o.open),"data-disabled":o.disabled?"":void 0,...l,ref:t})});Ye.displayName=Qe;var ue="AccordionTrigger",We=P.forwardRef((s,t)=>{const{__scopeAccordion:a,...l}=s,i=te(k,a),o=je(ue,a),c=Us(ue,a),m=be(a);return e.jsx(fe.ItemSlot,{scope:a,children:e.jsx(_s,{"aria-disabled":o.open&&!c.collapsible||void 0,"data-orientation":i.orientation,id:o.triggerId,...m,...l,ref:t})})});We.displayName=ue;var Xe="AccordionContent",Ze=P.forwardRef((s,t)=>{const{__scopeAccordion:a,...l}=s,i=te(k,a),o=je(Xe,a),c=be(a);return e.jsx(qs,{role:"region","aria-labelledby":o.triggerId,"data-orientation":i.orientation,...c,...l,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});Ze.displayName=Xe;function es(s){return s?"open":"closed"}var Js=He,zs=Ke,Gs=Ye,Ks=We,Qs=Ze;function Ys({...s}){return e.jsx(Js,{"data-slot":"accordion",...s})}function Ws({className:s,...t}){return e.jsx(zs,{"data-slot":"accordion-item",className:Z("border-b last:border-b-0",s),...t})}function Xs({className:s,children:t,...a}){return e.jsx(Gs,{className:"flex",children:e.jsxs(Ks,{"data-slot":"accordion-trigger",className:Z("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",s),...a,children:[t,e.jsx(bs,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function Zs({className:s,children:t,...a}){return e.jsx(Qs,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...a,children:e.jsx("div",{className:Z("pt-0 pb-4",s),children:t})})}const oe={},et=["get","post","put","patch","delete","options","head"],ss="__untagged__",st="https://raw.githubusercontent.com/carbon-track/carbontrack-rev/refs/heads/main/backend/openapi.json",tt="https://dev-api.carbontrackapp.com/api/v1",at=new Set(["POST","PUT","PATCH","DELETE"]),ce={GET:"border-emerald-200 bg-emerald-50 text-emerald-700",POST:"border-sky-200 bg-sky-50 text-sky-700",PUT:"border-amber-200 bg-amber-50 text-amber-700",PATCH:"border-indigo-200 bg-indigo-50 text-indigo-700",DELETE:"border-rose-200 bg-rose-50 text-rose-700",OPTIONS:"border-slate-200 bg-slate-50 text-slate-600",HEAD:"border-slate-200 bg-slate-50 text-slate-600",DEFAULT:"border-slate-200 bg-slate-100 text-slate-700"};function nt(){const s=oe==null?void 0:oe.VITE_OPENAPI_SPEC_URL;return s||st}const ts=nt();async function rt({signal:s}){const t=await fetch(ts,{method:"GET",headers:{Accept:"application/json"},cache:"no-store",signal:s});if(!t.ok)throw new Error(`Failed to load OpenAPI spec (${t.status})`);const a=await t.json();if(!a||typeof a!="object"||!a.paths)throw new Error("OpenAPI document is missing path definitions");return a}function it(s){if(!(s!=null&&s.paths))return[];const t=Array.isArray(s.security)?s.security:[],a=[];return Object.entries(s.paths).forEach(([l,i])=>{!i||typeof i!="object"||Object.entries(i).forEach(([o,c])=>{if(!et.includes(o.toLowerCase())||!c||typeof c!="object")return;const m=c.requestBody||null,p=c.responses||{},b=Object.keys(p),h=Array.isArray(c.security)?c.security:t,j=Array.isArray(h)&&h.length>0,f=[...Array.isArray(i.parameters)?i.parameters:[],...Array.isArray(c.parameters)?c.parameters:[]],g=Array.isArray(h)?[...new Set(h.flatMap(u=>Object.keys(u||{})))]:[];a.push({id:`${o.toUpperCase()} ${l}`,path:l,method:o.toUpperCase(),summary:c.summary||"",description:c.description||"",tags:c.tags&&c.tags.length?c.tags:[ss],deprecated:!!c.deprecated,servers:c.servers||s.servers||[],requestBody:m,responses:p,responseCodes:b,parameters:f,security:h,securitySchemes:g,requiresAuth:j,requestContentTypes:m!=null&&m.content?Object.keys(m.content):[],responseContentTypes:Object.entries(p).reduce((u,[A,N])=>(u[A]=N!=null&&N.content?Object.keys(N.content):[],u),{})})})}),a.sort((l,i)=>l.path===i.path?l.method.localeCompare(i.method):l.path.localeCompare(i.path))}function as(s){if(!s)return"";if(s.$ref)return s.$ref.split("/").pop();if(s.type==="array"){const t=as(s.items);return t?`array<${t}>`:"array"}return s.type||""}function Se(s){return[...s].sort((t,a)=>{const l=/^\d+$/.test(t),i=/^\d+$/.test(a);return l&&i?Number(t)-Number(a):l?-1:i?1:t.localeCompare(a)})}function wt(){var M,$,J;const{t:s,currentLanguage:t}=_e(),[a,l]=d.useState(""),[i,o]=d.useState("all"),[c,m]=d.useState("all"),[p,b]=d.useState("all"),[h,j]=d.useState("all"),f=ms(["openapi-spec"],rt,{staleTime:300*1e3,cacheTime:900*1e3}),g=f.data,u=d.useMemo(()=>it(g),[g]),A=d.useMemo(()=>[...new Set(u.map(n=>n.method))],[u]),N=d.useMemo(()=>{const n=new Set;return u.forEach(r=>r.tags.forEach(y=>n.add(y))),[...n]},[u]),S=d.useMemo(()=>{const n=new Set;return u.forEach(r=>r.responseCodes.forEach(y=>n.add(y))),Se([...n])},[u]),x=d.useMemo(()=>{if(!u.length)return[];const n=a.trim().toLowerCase();return u.filter(r=>i!=="all"&&r.method!==i||c!=="all"&&!r.tags.includes(c)||p==="secured"&&!r.requiresAuth||p==="public"&&r.requiresAuth||h!=="all"&&!r.responseCodes.includes(h)?!1:n?[r.path,r.summary,r.description].filter(Boolean).some(y=>y.toLowerCase().includes(n)):!0)},[u,i,c,p,h,a]),w=d.useMemo(()=>{if(!u.length)return{total:0,secured:0,publicCount:0,tags:0,methods:0};const n=u.filter(T=>T.requiresAuth).length,r=new Set(u.flatMap(T=>T.tags)).size,y=new Set(u.map(T=>T.method)).size;return{total:u.length,secured:n,publicCount:u.length-n,tags:r,methods:y}},[u]),C=n=>n!==ss?n:s("admin.diagnostics.labels.untagged","Untagged"),v=d.useMemo(()=>({secured:s("admin.diagnostics.labels.authRequired","Requires auth"),public:s("admin.diagnostics.labels.publicEndpoint","Public endpoint")}),[s]),E=d.useMemo(()=>{if(!f.dataUpdatedAt)return null;try{return new Intl.DateTimeFormat(t||void 0,{dateStyle:"medium",timeStyle:"medium"}).format(new Date(f.dataUpdatedAt))}catch{return new Date(f.dataUpdatedAt).toLocaleString()}},[t,f.dataUpdatedAt]),_=(M=g==null?void 0:g.info)==null?void 0:M.version,q=($=g==null?void 0:g.info)==null?void 0:$.title,I=Array.isArray(g==null?void 0:g.servers)?g.servers:[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{className:"border-slate-200/70 bg-white/90",children:e.jsxs(ne,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx(re,{children:s("admin.diagnostics.title","API diagnostics")}),e.jsx(ie,{children:s("admin.diagnostics.description","Visualize the published OpenAPI contract, inspect endpoints, and verify request/response coverage.")}),e.jsxs("dl",{className:"mt-3 flex flex-wrap gap-4 text-xs text-muted-foreground",children:[q&&e.jsxs("div",{children:[e.jsx("dt",{className:"font-semibold uppercase tracking-wide",children:s("admin.diagnostics.spec.title","API")}),e.jsx("dd",{children:q})]}),_&&e.jsxs("div",{children:[e.jsx("dt",{className:"font-semibold uppercase tracking-wide",children:s("admin.diagnostics.spec.version","Spec version")}),e.jsx("dd",{children:_})]}),E&&e.jsxs("div",{children:[e.jsx("dt",{className:"font-semibold uppercase tracking-wide",children:s("admin.diagnostics.spec.fetchedAt","Fetched")}),e.jsx("dd",{children:E})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(B,{type:"button",variant:"outline",size:"sm",onClick:()=>window.open(ts,"_blank","noopener,noreferrer"),children:[e.jsx(vs,{className:"mr-2 h-4 w-4"}),s("admin.diagnostics.spec.download","Download spec")]}),e.jsxs(B,{type:"button",size:"sm",onClick:()=>f.refetch(),disabled:f.isFetching,children:[f.isFetching?e.jsx(de,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Le,{className:"mr-2 h-4 w-4"}),s("admin.diagnostics.actions.refresh","Reload spec")]})]})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-5",children:[e.jsx(F,{icon:Rs,label:s("admin.diagnostics.stats.endpoints","Endpoints"),value:w.total}),e.jsx(F,{icon:us,label:s("admin.diagnostics.stats.secured","Secured"),value:w.secured}),e.jsx(F,{icon:ys,label:s("admin.diagnostics.stats.public","Public"),value:w.publicCount}),e.jsx(F,{icon:Ts,label:s("admin.diagnostics.stats.tags","Tags"),value:w.tags}),e.jsx(F,{icon:Cs,label:s("admin.diagnostics.stats.methods","HTTP methods"),value:w.methods})]}),e.jsxs(Y,{className:"border-slate-200/70 bg-white/90",children:[e.jsxs(ne,{className:"pb-2",children:[e.jsx(re,{className:"text-base",children:s("admin.diagnostics.filters.title","Filters")}),e.jsx(ie,{children:s("admin.diagnostics.filters.description","Search and narrow down endpoints by method, tag, security requirements, or response codes.")})]}),e.jsxs(me,{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:s("admin.diagnostics.filters.search","Search")}),e.jsxs("div",{className:"relative",children:[e.jsx(xs,{className:"text-muted-foreground pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2"}),e.jsx(V,{value:a,onChange:n=>l(n.target.value),placeholder:s("admin.diagnostics.filters.searchPlaceholder","Search path, summary, or description"),className:"pl-9"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(K,{label:s("admin.diagnostics.filters.method","HTTP method"),value:i,onValueChange:o,placeholder:s("admin.diagnostics.filters.methodAll","All methods"),options:A.map(n=>({label:n,value:n}))}),e.jsx(K,{label:s("admin.diagnostics.filters.tag","Tag"),value:c,onValueChange:m,placeholder:s("admin.diagnostics.filters.tagAll","All tags"),options:N.map(n=>({label:C(n),value:n}))}),e.jsx(K,{label:s("admin.diagnostics.filters.security","Security"),value:p,onValueChange:b,placeholder:s("admin.diagnostics.filters.securityAll","All endpoints"),options:[{value:"secured",label:s("admin.diagnostics.filters.securitySecured","Requires auth")},{value:"public",label:s("admin.diagnostics.filters.securityPublic","Public")}]}),e.jsx(K,{label:s("admin.diagnostics.filters.status","Response code"),value:h,onValueChange:j,placeholder:s("admin.diagnostics.filters.statusAll","All status codes"),options:S.map(n=>({label:n,value:n}))})]})]})]}),f.isError&&e.jsxs(qe,{variant:"destructive",children:[e.jsx(De,{children:s("admin.diagnostics.status.errorTitle","Unable to load API spec")}),e.jsx(Me,{children:((J=f.error)==null?void 0:J.message)||s("admin.diagnostics.status.errorDescription","The OpenAPI document could not be loaded. Check the configured URL or try again.")})]}),e.jsxs(Y,{className:"border-slate-200/70 bg-white/90",children:[e.jsx(ne,{className:"flex flex-col gap-2 border-b border-slate-100/80 pb-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-base",children:s("admin.diagnostics.results.title","Endpoint catalog")}),e.jsx(ie,{children:s("admin.diagnostics.results.count",{defaultValue:"{{count}} endpoints match the current filters",count:x.length})})]}),I.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(As,{className:"h-4 w-4"}),e.jsxs("span",{children:[s("admin.diagnostics.spec.servers","Servers"),": ",I.length]})]})]})}),e.jsx(me,{className:"p-0",children:f.isLoading?e.jsxs("div",{className:"flex items-center gap-3 p-6 text-sm text-muted-foreground",children:[e.jsx(de,{className:"h-4 w-4 animate-spin"}),s("admin.diagnostics.status.loading","Loading OpenAPI specification...")]}):x.length===0?e.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:s("admin.diagnostics.status.empty","No endpoints match the selected filters.")}):e.jsx(Ys,{type:"single",collapsible:!0,children:x.map(n=>e.jsxs(Ws,{value:n.id,children:[e.jsx(Xs,{className:"px-4",children:e.jsxs("div",{className:"flex w-full flex-col gap-3 text-left md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(lt,{method:n.method}),e.jsx("p",{className:"font-mono text-sm text-slate-900",children:n.path}),n.deprecated&&e.jsx(O,{variant:"destructive",className:"border-rose-200 bg-rose-50 text-xs uppercase tracking-wide text-rose-700",children:s("admin.diagnostics.labels.deprecated","Deprecated")})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:n.summary||n.description||s("admin.diagnostics.labels.noSummary","No summary provided")})]}),e.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[e.jsx(ot,{secured:n.requiresAuth,labels:v}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[n.tags.slice(0,3).map(r=>e.jsx(O,{variant:"outline",children:C(r)},`${n.id}-${r}`)),n.tags.length>3&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",n.tags.length-3]})]})]})]})}),e.jsx(Zs,{className:"bg-slate-50/60 px-4",children:e.jsxs("div",{className:"space-y-6 rounded-lg border border-slate-200/80 bg-white p-6",children:[n.description&&e.jsx("p",{className:"text-sm text-slate-600",children:n.description}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(Te,{title:s("admin.diagnostics.labels.tags","Tags"),value:e.jsx("div",{className:"flex flex-wrap gap-2",children:n.tags.map(r=>e.jsx(O,{variant:"secondary",children:C(r)},`${n.id}-${r}-detail`))})}),e.jsx(Te,{title:s("admin.diagnostics.labels.security","Security"),value:n.requiresAuth?e.jsxs("div",{className:"space-y-1 text-sm text-slate-700",children:[e.jsx("p",{children:v.secured}),n.securitySchemes.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:n.securitySchemes.join(", ")})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:v.public})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(Q,{title:s("admin.diagnostics.labels.parameters","Parameters"),children:n.parameters.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.diagnostics.labels.noParameters","No parameters documented")}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-200",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs uppercase text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 font-semibold",children:s("admin.diagnostics.table.name","Name")}),e.jsx("th",{className:"px-3 py-2 font-semibold",children:s("admin.diagnostics.table.in","In")}),e.jsx("th",{className:"px-3 py-2 font-semibold",children:s("admin.diagnostics.table.required","Required")}),e.jsx("th",{className:"px-3 py-2 font-semibold",children:s("admin.diagnostics.table.type","Type")})]})}),e.jsx("tbody",{children:n.parameters.map((r,y)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border-t px-3 py-2 font-mono text-xs",children:r.name||"—"}),e.jsx("td",{className:"border-t px-3 py-2 text-xs uppercase text-slate-500",children:r.in||"—"}),e.jsx("td",{className:"border-t px-3 py-2 text-xs",children:r.required?s("admin.diagnostics.labels.yes","Yes"):s("admin.diagnostics.labels.no","No")}),e.jsx("td",{className:"border-t px-3 py-2 text-xs",children:as(r.schema)||"—"})]},`${n.id}-${r.name||y}`))})]})})}),e.jsx(Q,{title:s("admin.diagnostics.labels.requestBody","Request body"),children:n.requestBody?e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{className:"text-slate-600",children:n.requestBody.description||s("admin.diagnostics.labels.requestBodyDescription","Request payload")}),n.requestContentTypes.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:n.requestContentTypes.map(r=>e.jsx(O,{variant:"outline",children:r},`${n.id}-${r}`))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.diagnostics.labels.noRequestBody","No request body")})})]}),e.jsx(Q,{title:s("admin.diagnostics.labels.responses","Responses"),children:n.responseCodes.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.diagnostics.labels.noResponses","No responses documented")}):e.jsx("div",{className:"space-y-3",children:Se(n.responseCodes).map(r=>{var T;const y=n.responses[r];return e.jsxs("div",{className:"rounded-xl border border-slate-200/80 bg-slate-50/80 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(O,{variant:"outline",className:"border-slate-300 bg-white font-mono text-xs",children:r.toUpperCase()}),e.jsx("p",{className:"text-sm font-medium text-slate-800",children:(y==null?void 0:y.description)||s("admin.diagnostics.labels.noResponseDescription","No description provided")})]}),((T=n.responseContentTypes[r])==null?void 0:T.length)>0&&e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:[s("admin.diagnostics.labels.responseContent","Content types"),":"," ",n.responseContentTypes[r].join(", ")]})]},`${n.id}-${r}`)})})}),e.jsx(Q,{title:s("admin.diagnostics.tester.title","Live request tester"),children:e.jsx(ct,{operation:n})})]})})]},n.id))})})]})]})}function F({icon:s,label:t,value:a}){return e.jsx(Y,{className:"border-slate-200/70 bg-white/90",children:e.jsxs(me,{className:"flex items-center gap-3 p-4",children:[e.jsx("div",{className:"rounded-full bg-slate-100 p-2 text-slate-700",children:e.jsx(s,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:t}),e.jsx("p",{className:"text-xl font-semibold text-slate-900",children:a})]})]})})}function K({label:s,value:t,onValueChange:a,placeholder:l,options:i=[]}){return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:s}),e.jsxs(ps,{value:t,onValueChange:o=>a(o),children:[e.jsx(hs,{className:"w-full",children:e.jsx(gs,{placeholder:l})}),e.jsxs(fs,{children:[e.jsx(Ae,{value:"all",children:l}),i.map(o=>e.jsx(Ae,{value:o.value,children:o.label},o.value))]})]})]})}function lt({method:s}){const t=ce[s]||ce[s.toUpperCase()]||ce.DEFAULT;return e.jsx(O,{variant:"outline",className:Z("font-mono text-xs uppercase",t),children:s})}function ot({secured:s,labels:t}){return s?e.jsx(O,{variant:"outline",className:"border-amber-200 bg-amber-50 text-xs font-medium uppercase tracking-wide text-amber-700",children:t.secured}):e.jsx(O,{variant:"outline",className:"border-emerald-200 bg-emerald-50 text-xs font-medium uppercase tracking-wide text-emerald-700",children:t.public})}function Q({title:s,children:t}){return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:s}),e.jsx("div",{className:"text-sm text-slate-700",children:t})]})}function Te({title:s,value:t}){return e.jsxs("div",{className:"space-y-2 rounded-xl border border-slate-200/80 bg-slate-50/60 p-4",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:s}),typeof t=="string"||typeof t=="number"?e.jsx("p",{className:"text-sm text-slate-800",children:t}):t]})}function ct({operation:s}){const{t}=_e(),a=d.useMemo(()=>(s.parameters||[]).filter(r=>r.in==="path"),[s.parameters]),[l,i]=d.useState(!1),[o,c]=d.useState(tt),[m,p]=d.useState(()=>Pe(a)),[b,h]=d.useState(""),[j,f]=d.useState(""),[g,u]=d.useState(""),[A,N]=d.useState(s.requiresAuth),[S,x]=d.useState(!1),[w,C]=d.useState(null),[v,E]=d.useState(null),[_,q]=d.useState("");d.useEffect(()=>{p(Pe(a))},[a]);const I=d.useMemo(()=>dt(s.path,m),[s.path,m]),M=d.useMemo(()=>ns(o,I),[o,I]),$=at.has(s.method),J=async()=>{var ye;C(null),E(null);const r=a.find(R=>R.required&&!m[R.name]);if(r){C(t("admin.diagnostics.tester.messages.pathParamRequired",{name:r.name}));return}let y={},T={},L=null;try{y=Re(b)}catch{C(t("admin.diagnostics.tester.messages.invalidJsonObject",{field:t("admin.diagnostics.tester.fields.query","Query parameters (JSON object)")}));return}try{T=Re(j)}catch{C(t("admin.diagnostics.tester.messages.invalidJsonObject",{field:t("admin.diagnostics.tester.fields.headers","Headers (JSON object)")}));return}try{L=ut(g)}catch{C(t("admin.diagnostics.tester.messages.invalidJsonValue",{field:t("admin.diagnostics.tester.fields.body","Request body (JSON)")}));return}if(L!==null&&!$){C(t("admin.diagnostics.tester.messages.bodyNotAllowed","This HTTP method does not accept a request body."));return}const ve=mt(o,I,y);x(!0);try{const R=Object.entries(T).reduce((D,[G,we])=>(G&&(D[G]=we==null?"":String(we)),D),{});if(A&&typeof window<"u"){const D=(ye=window.localStorage)==null?void 0:ye.getItem("auth_token");D&&(R.Authorization=`Bearer ${D}`)}let Ne;L!==null&&(Ne=typeof L=="string"?L:JSON.stringify(L),typeof L!="string"&&!R["Content-Type"]&&!R["content-type"]&&(R["Content-Type"]="application/json"));const rs=performance.now(),U=await fetch(ve,{method:s.method,headers:R,body:Ne}),is=performance.now()-rs,ae=await U.text();let z=null;try{z=ae?JSON.parse(ae):null}catch{z=null}const Ce=[];U.headers.forEach((D,G)=>{Ce.push({key:G,value:D})}),E({ok:U.ok,status:U.status,statusText:U.statusText||"",duration:is,headers:Ce,body:z??ae,isJson:z!==null}),q(ve)}catch(R){C((R==null?void 0:R.message)||t("admin.diagnostics.tester.messages.requestFailed","Request failed"))}finally{x(!1)}},n=()=>{h(""),f(""),u(""),E(null),C(null),q("")};return e.jsxs("div",{className:"space-y-4 rounded-xl border border-slate-200/80 bg-white p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:t("admin.diagnostics.tester.title","Live request tester")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.diagnostics.tester.description","Send a live request to confirm endpoint status and payloads.")})]}),e.jsx(B,{variant:"outline",size:"sm",type:"button",onClick:()=>i(r=>!r),children:l?t("admin.diagnostics.tester.actions.close","Hide tester"):t("admin.diagnostics.tester.actions.open","Open tester")})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:t("admin.diagnostics.tester.fields.baseUrl","Base URL")}),e.jsx(V,{value:o,onChange:r=>c(r.target.value),placeholder:"https://api.example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:t("admin.diagnostics.tester.fields.resolvedPath","Resolved path")}),e.jsx(V,{value:I,readOnly:!0,className:"font-mono text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:t("admin.diagnostics.tester.fields.finalUrl","Final request URL")}),e.jsx(V,{value:_||M,readOnly:!0,className:"font-mono text-xs"})]}),a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-slate-700",children:t("admin.diagnostics.tester.fields.pathParams","Path parameters")}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:a.map(r=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-muted-foreground",children:t("admin.diagnostics.tester.messages.pathParam",{name:r.name})}),e.jsx(V,{value:m[r.name]??"",placeholder:r.description||r.name,onChange:y=>p(T=>({...T,[r.name]:y.target.value}))})]},r.name))})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:t("admin.diagnostics.tester.fields.query","Query parameters (JSON object)")}),e.jsx(le,{value:b,onChange:r=>h(r.target.value),placeholder:t("admin.diagnostics.tester.placeholders.query",'{"status":"pending"}'),className:"font-mono text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:t("admin.diagnostics.tester.fields.headers","Headers (JSON object)")}),e.jsx(le,{value:j,onChange:r=>f(r.target.value),placeholder:t("admin.diagnostics.tester.placeholders.headers",'{"X-Debug":true}'),className:"font-mono text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:t("admin.diagnostics.tester.fields.body","Request body (JSON)")}),e.jsx(le,{value:g,onChange:r=>u(r.target.value),placeholder:t("admin.diagnostics.tester.placeholders.body",`{
  "example": true
}`),className:"font-mono text-xs",disabled:!$}),!$&&e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:t("admin.diagnostics.tester.messages.bodyNotAllowed","This HTTP method does not accept a request body.")})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-slate-200/80 bg-slate-50/80 p-3",children:[e.jsx(js,{id:`tester-auth-${s.id}`,checked:A,onCheckedChange:N}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",htmlFor:`tester-auth-${s.id}`,children:t("admin.diagnostics.tester.fields.auth","Include auth token")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.diagnostics.tester.fields.authDescription","Attach the stored bearer token when available.")})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(B,{type:"button",onClick:J,disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"mr-2 h-4 w-4 animate-spin"}),t("admin.diagnostics.tester.actions.sending","Sending request...")]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),t("admin.diagnostics.tester.actions.send","Send request")]})}),e.jsx(B,{type:"button",variant:"outline",onClick:n,disabled:S,children:t("admin.diagnostics.tester.actions.reset","Reset fields")})]}),w&&e.jsxs(qe,{variant:"destructive",children:[e.jsx(De,{children:t("admin.diagnostics.tester.messages.requestFailed","Request failed")}),e.jsx(Me,{children:w})]}),v&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-slate-200/80 bg-slate-50/80 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(O,{variant:v.ok?"secondary":"destructive",className:"font-mono text-xs",children:[v.status," ",v.statusText]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("admin.diagnostics.tester.messages.duration",{value:v.duration.toFixed(1)})}),_&&e.jsx("span",{className:"font-mono text-[11px] text-slate-600 break-all",children:_})]}),v.headers.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:t("admin.diagnostics.tester.results.headers","Response headers")}),e.jsx("ul",{className:"mt-2 space-y-1 text-xs font-mono text-slate-700",children:v.headers.map(r=>e.jsxs("li",{children:[e.jsxs("span",{className:"text-slate-500",children:[r.key,":"]})," ",r.value]},`${r.key}-${r.value}`))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:t("admin.diagnostics.tester.results.body","Response body")}),e.jsx("pre",{className:"mt-2 max-h-72 overflow-auto rounded-lg bg-slate-900/95 p-3 text-xs leading-relaxed text-emerald-100",children:v.isJson?JSON.stringify(v.body,null,2):String(v.body??"")})]})]})]})]})}function Pe(s){return s.reduce((t,a)=>(t[a.name]="",t),{})}function dt(s,t){return s.replace(/{([^}]+)}/g,(a,l)=>{const i=t[l];return i!==void 0&&i!==""?encodeURIComponent(i):a})}function ns(s,t){if(!s)return t;const a=s.replace(/\/+$/,""),l=t.startsWith("/")?t:`/${t}`;return`${a}${l}`}function mt(s,t,a){const l=ns(s,t),i=new URLSearchParams;Object.entries(a||{}).forEach(([c,m])=>{c&&i.append(c,m==null?"":String(m))});const o=i.toString();return o?`${l}${l.includes("?")?"&":"?"}${o}`:l}function Re(s){if(!s||!s.trim())return{};try{const t=JSON.parse(s);if(t&&typeof t=="object"&&!Array.isArray(t))return t}catch{}throw new Error("INVALID_JSON_OBJECT")}function ut(s){if(!s||!s.trim())return null;try{return JSON.parse(s)}catch{throw new Error("INVALID_JSON_VALUE")}}export{wt as default};
