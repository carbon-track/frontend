import{c as z,u as y,j as e,M as w,B as x,X as b,y as $,I as V,F as f,D as F,J as a,K as Z,N as J,O as K,Q as W,T as X,k as Y,V as G,W as U,Y as ee,r as A,E as se,n as u,w as ae,C as te,Z as j}from"./index-9oiziVwF.js";import{u as v}from"./useMutation-BrmGtd8z.js";import{F as D}from"./funnel-Ddr942iJ.js";import{E as re}from"./eye-QkcRAVlH.js";import{T}from"./trash-2-B-HyTeNA.js";import{P as le}from"./Pagination-DogK4uhw.js";import{A as ne,b as ie,a as ce}from"./Alert-DMTWhZOi.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]],h=z("mail-open",de);function oe({filters:s,onFiltersChange:o,isLoading:c=!1}){const{t:l}=y(),t=(i,N)=>{o({...s,[i]:N,page:1})},m=()=>{o({search:"",status:"",sort:"created_at_desc",page:1})},d=!!(s.search||s.status),r=[{value:"unread",label:l("messages.unread"),icon:e.jsx(w,{className:"h-4 w-4 text-blue-500"})},{value:"read",label:l("messages.read"),icon:e.jsx(h,{className:"h-4 w-4 text-gray-500"})}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:l("messages.filters.title")})]}),d&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:m,className:"text-gray-500 hover:text-gray-700",children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),l("common.clear")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:l("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(V,{type:"text",value:s.search,onChange:i=>t("search",i.target.value),placeholder:l("messages.filters.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:l("messages.filters.status")}),e.jsxs("select",{value:s.status,onChange:i=>t("status",i.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:c,children:[e.jsx("option",{value:"",children:l("messages.filters.allStatus")}),r.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:l("common.sort.sortBy")}),e.jsxs("select",{value:s.sort,onChange:i=>t("sort",i.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:c,children:[e.jsx("option",{value:"created_at_desc",children:l("common.sort.newest")}),e.jsx("option",{value:"created_at_asc",children:l("common.sort.oldest")}),e.jsx("option",{value:"priority_desc",children:l("messages.filters.priorityHighToLow")}),e.jsx("option",{value:"priority_asc",children:l("messages.filters.priorityLowToHigh")})]})]}),d&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-blue-700",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsxs("span",{children:[l("messages.filters.activeFilters"),":"]})]})}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[s.search&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[l("common.search"),': "',s.search,'"',e.jsx("button",{onClick:()=>t("search",""),className:"ml-1 hover:text-blue-600",children:e.jsx(b,{className:"h-3 w-3"})})]}),s.status&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[l(`messages.${s.status}`),e.jsx("button",{onClick:()=>t("status",""),className:"ml-1 hover:text-blue-600",children:e.jsx(b,{className:"h-3 w-3"})})]})]})]})]})}function S({messages:s,onRowClick:o,onMarkRead:c,onDelete:l}){const{t}=y(),m=r=>r?e.jsx(h,{className:"h-4 w-4 text-gray-500"}):e.jsx(w,{className:"h-4 w-4 text-blue-500"}),d=r=>{if(r.type==="system")return!0;if(r.sender_id!==null)return!1;const i=(r.title||"").toLowerCase();return/\b(公告|announcement|system|系统|broadcast|boardcast)\b/i.test(i)};return e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow-sm border",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("messages.subject")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("messages.content")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("messages.status")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("messages.date")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("common.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(r=>{var i;return e.jsxs("tr",{className:`hover:bg-gray-50 ${r.is_read?"":"bg-blue-50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[m(r.is_read),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-900 line-clamp-1",children:r.title}),r.priority&&e.jsx(f,{variant:r.sender_id===null?"secondary":"default",className:"ml-3",children:t(`messages.priority.${r.priority}`)}),d(r)&&e.jsx(f,{variant:"outline",className:"ml-2",children:t("messages.labels.announcement")})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 line-clamp-1",children:(i=r.content)==null?void 0:i.slice(0,120)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.is_read?t("messages.read"):t("messages.unread")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:F(r.created_at,"yyyy-MM-dd HH:mm")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>o(r),className:"mr-2",children:[e.jsx(re,{className:"h-4 w-4 mr-1"})," ",t("common.view")]}),!r.is_read&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>c(r.id),className:"mr-2",children:[e.jsx(h,{className:"h-4 w-4 mr-1"})," ",t("messages.markRead")]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>l(r.id),className:"text-red-600 hover:text-red-800",children:[e.jsx(T,{className:"h-4 w-4 mr-1"})," ",t("common.delete")]})]})]},r.id)})})]})})}S.propTypes={messages:a.arrayOf(a.shape({id:a.oneOfType([a.string,a.number]).isRequired,is_read:a.bool,title:a.string,content:a.string,created_at:a.oneOfType([a.string,a.number,a.instanceOf(Date)]),priority:a.string,sender_id:a.oneOfType([a.string,a.number])})).isRequired,onRowClick:a.func.isRequired,onMarkRead:a.func.isRequired,onDelete:a.func.isRequired};function q({message:s,isOpen:o,onClose:c,onMarkRead:l}){const{t}=y();if(!o||!s)return null;const m=r=>r?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(h,{className:"h-3 w-3 mr-1"})," ",t("messages.read")]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(w,{className:"h-3 w-3 mr-1"})," ",t("messages.unread")]}),d=r=>{if(!r)return!1;if(r.type==="system")return!0;if(r.sender_id!==null)return!1;const i=(r.title||"").toLowerCase();return/\b(公告|announcement|system|系统|broadcast|boardcast)\b/i.test(i)};return e.jsx(Z,{open:o,onOpenChange:r=>{r||c==null||c()},children:e.jsxs(J,{className:"max-w-2xl",children:[e.jsxs(K,{children:[e.jsx(W,{className:"text-xl",children:t("messages.detail.title")}),e.jsx(X,{children:t("messages.detail.subtitle")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.priority&&e.jsx(f,{variant:s.priority,children:t(`messages.priority.${s.priority}`)}),d(s)&&e.jsx(f,{variant:"outline",children:t("messages.labels.announcement")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:t("messages.status")}),m(s.is_read)]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:t("messages.date")}),e.jsx("p",{className:"text-gray-900",children:F(s.created_at,"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-700 mb-2 flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),t("messages.subject")]}),e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-md",children:s.title})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-700 mb-2 flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),t("messages.content")]}),e.jsx("div",{className:"text-gray-700 bg-gray-50 p-3 rounded-md",dangerouslySetInnerHTML:{__html:s.content}})]}),e.jsxs(U,{className:"pt-2",children:[!s.is_read&&e.jsxs(x,{variant:"outline",onClick:()=>l(s.id),className:"mr-2",children:[e.jsx(h,{className:"h-4 w-4 mr-1"})," ",t("messages.markRead")]}),e.jsx(x,{onClick:c,children:t("common.close")})]})]})]})})}q.propTypes={isOpen:a.bool.isRequired,onClose:a.func.isRequired,onMarkRead:a.func.isRequired,message:a.shape({id:a.oneOfType([a.string,a.number]).isRequired,is_read:a.bool.isRequired,title:a.string,created_at:a.oneOfType([a.string,a.number,a.instanceOf(Date)]).isRequired,content:a.string,priority:a.string,sender_id:a.oneOfType([a.string,a.number]),type:a.string})};function fe(){var M,C;const{t:s}=y(),o=ee(),[c,l]=A.useState({search:"",type:"",status:"",priority:"",sort:"created_at_desc",page:1,limit:10}),[t,m]=A.useState(null),{data:d,isLoading:r,error:i,isFetching:N}=se(["messages",c],()=>j.getMessages(c),{keepPreviousData:!0}),k=v(n=>j.markAsRead(n),{onSuccess:()=>{o.invalidateQueries("messages"),u.success(s("messages.markReadSuccess")),t&&m(n=>n&&{...n,is_read:!0})},onError:()=>{u.error(s("messages.markReadFailed"))}}),O=v(n=>j.deleteMessage(n),{onSuccess:()=>{o.invalidateQueries("messages"),u.success(s("messages.deleteSuccess")),m(null)},onError:()=>{u.error(s("messages.deleteFailed"))}}),_=v(()=>j.markAllAsRead(),{onSuccess:()=>{o.invalidateQueries("messages"),u.success(s("messages.markAllReadSuccess"))},onError:()=>{u.error(s("messages.markAllReadFailed"))}}),P=n=>{l(n)},L=n=>{l(B=>({...B,page:n}))},H=n=>{m(n),n.is_read||k.mutate(n.id)},I=()=>{m(null)},R=n=>{k.mutate(n)},E=n=>{window.confirm(s("messages.confirmDelete"))&&O.mutate(n)},Q=()=>{window.confirm(s("messages.confirmMarkAllRead"))&&_.mutate()},g=((M=d==null?void 0:d.data)==null?void 0:M.data)||[],p=((C=d==null?void 0:d.data)==null?void 0:C.pagination)||{};return e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:s("messages.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("messages.subtitle")})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(x,{variant:"outline",onClick:Q,disabled:_.isLoading||g.filter(n=>!n.is_read).length===0,children:[e.jsx(h,{className:"h-4 w-4 mr-2"})," ",s("messages.markAllRead")]}),e.jsxs(x,{variant:"destructive",onClick:()=>{window.confirm(s("messages.confirmDeleteAll"))&&u.error(s("messages.deleteAllNotImplemented"))},disabled:g.length===0,children:[e.jsx(T,{className:"h-4 w-4 mr-2"})," ",s("messages.deleteAll")]})]})]}),e.jsx(oe,{filters:c,onFiltersChange:P,isLoading:N}),r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ae,{className:"h-8 w-8 animate-spin text-green-500"})}):i?e.jsxs(ne,{variant:"destructive",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(ie,{children:s("common.error")}),e.jsx(ce,{children:s("errors.loadFailed")})]}):g.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-xl font-semibold",children:s("messages.noMessagesFound")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("messages.tryDifferentFilters")})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{messages:g,onRowClick:H,onMarkRead:R,onDelete:E}),e.jsx(le,{currentPage:p.current_page,totalPages:p.total_pages,onPageChange:L,itemsPerPage:p.per_page,totalItems:p.total_items})]}),e.jsx(q,{message:t,isOpen:!!t,onClose:I,onMarkRead:R})]})}export{fe as default};
