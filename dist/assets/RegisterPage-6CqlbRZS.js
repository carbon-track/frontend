import{u as z,e as G,r,j as e,L as u,I as h,g as J,B as K,s as Q,f as W,n as X}from"./index-CUFwAzZ6.js";import{u as Y}from"./index.esm-BHxcGwkd.js";import{R as Z}from"./RegionSelector-DjInOKde.js";import{C as ee,a as se,b as te,c as ae,d as re}from"./Card-r7cmfhD9.js";import{A as E,a as F}from"./Alert-DK8cqnXb.js";import{T as oe}from"./Turnstile-WJZ4WarD.js";import{U as ie}from"./user-plus-Cuq-iLT6.js";import{E as q}from"./eye-off-bWwfeIQd.js";import{E as T}from"./eye-DR0dTY3l.js";function le(){const{t:s}=z(),A=G(),[x,U]=r.useState(!1),[p,V]=r.useState(!1),[w,f]=r.useState(""),[N,b]=r.useState(""),[g,_]=r.useState(!1),[L,D]=r.useState([]),[j,S]=r.useState(""),C=r.useRef(null),[P,y]=r.useState(""),{register:o,handleSubmit:O,watch:d,setValue:I,formState:{errors:a}}=Y(),v=J(),B=d("password"),H=d("country_code"),M=d("state_code");r.useEffect(()=>{o("country_code",{required:s("auth.countryRequired","Country is required")}),o("state_code",{required:s("auth.stateRequired","State is required")})},[o,s]),r.useEffect(()=>{(async()=>{var n,m,i;try{const l=await Q.getSchools({limit:100,page:1});if((n=l.data)!=null&&n.success){const c=((i=(m=l.data)==null?void 0:m.data)==null?void 0:i.schools)||[];D(c)}}catch(l){console.error("Failed to fetch schools:",l)}})()},[]);const $=async t=>{var n,m;_(!0),f(""),b("");try{const i={username:t.username,email:t.email,password:t.password,confirm_password:t.confirmPassword,country_code:t.country_code,state_code:t.state_code,cf_turnstile_response:P||void 0};if(t.schoolId){const c=parseInt(t.schoolId,10);Number.isNaN(c)||(i.school_id=c)}else j.trim()&&(i.new_school_name=j.trim());const l=await W.register(i);if(l.success){const c=t.email,R=l.data??{};sessionStorage.setItem("pending_verification_email",c),R.verification_resend_available_at?sessionStorage.setItem("verification_resend_available_at",R.verification_resend_available_at):sessionStorage.removeItem("verification_resend_available_at"),sessionStorage.setItem("verification_return_path","/dashboard");const k=s("auth.verification.checkInbox",{email:c});b(k),X.success(k),A(`/auth/verify-email?email=${encodeURIComponent(c)}`,{replace:!0})}else f(l.message||s("auth.registerFailed"))}catch(i){f(i.message||s("auth.registerFailed")),(m=(n=C.current)==null?void 0:n.reset)==null||m.call(n)}finally{_(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-100",children:e.jsx(ie,{className:"h-6 w-6 text-green-600"})}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:s("auth.createAccount")}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[s("auth.orSignInPrompt")," ",e.jsx(u,{to:"/auth/login",className:"font-medium text-green-600 hover:text-green-500",children:s("auth.signIn")})]})]}),e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsx(te,{children:s("auth.signUp")}),e.jsx(ae,{children:s("auth.fillInformation")})]}),e.jsx(re,{children:e.jsxs("form",{onSubmit:O($),className:"space-y-6",children:[w&&e.jsx(E,{variant:"destructive",children:e.jsx(F,{children:w})}),N&&e.jsx(E,{variant:"success",children:e.jsx(F,{children:N})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:s("auth.username")}),e.jsxs("div",{className:"mt-1",children:[e.jsx(h,{id:"username",type:"text",autoComplete:"username",placeholder:s("auth.usernamePlaceholder"),error:a.username,...o("username",v.username)}),a.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.username.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:s("auth.email")}),e.jsxs("div",{className:"mt-1",children:[e.jsx(h,{id:"email",type:"email",autoComplete:"email",placeholder:s("auth.emailPlaceholder"),error:a.email,...o("email",v.email)}),a.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.email.message})]})]}),e.jsx(Z,{countryCode:H,stateCode:M,onCountryChange:t=>I("country_code",t,{shouldValidate:!0}),onStateChange:t=>I("state_code",t,{shouldValidate:!0}),errors:{country:a.country_code,state:a.state_code}}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"schoolId",className:"block text-sm font-medium text-gray-700",children:[s("auth.school"),"（",s("common.optional")||"可选","）"]}),e.jsxs("div",{className:"mt-1 space-y-2",children:[e.jsxs("select",{id:"schoolId",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500",...o("schoolId"),onChange:t=>{t.target.value&&S("")},children:[e.jsx("option",{value:"",children:s("auth.selectSchool")}),L.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:"text",placeholder:s("auth.schoolPlaceholder","输入以创建新学校 (可选)"),value:j,onChange:t=>{S(t.target.value),t.target.value},disabled:!!d("schoolId")}),d("schoolId")&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500",children:s("common.selected","Selected")})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:s("auth.schoolOptionalHint")}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:s("auth.newSchoolNote")})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:s("auth.password")}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(h,{id:"password",type:x?"text":"password",autoComplete:"new-password",placeholder:s("auth.passwordPlaceholder"),error:a.password,...o("password",v.password)}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>U(!x),children:x?e.jsx(q,{className:"h-4 w-4 text-gray-400"}):e.jsx(T,{className:"h-4 w-4 text-gray-400"})}),a.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.password.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:s("auth.confirmPassword")}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(h,{id:"confirmPassword",type:p?"text":"password",autoComplete:"new-password",placeholder:s("auth.confirmPasswordPlaceholder"),error:a.confirmPassword,...o("confirmPassword",{required:s("auth.confirmPasswordRequired"),validate:t=>t===B||s("auth.passwordMismatch")})}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>V(!p),children:p?e.jsx(q,{className:"h-4 w-4 text-gray-400"}):e.jsx(T,{className:"h-4 w-4 text-gray-400"})}),a.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.confirmPassword.message})]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(oe,{ref:C,className:"mt-2",onVerify:t=>y(t),onExpire:()=>y(""),onError:()=>y("")})}),e.jsx("div",{children:e.jsx(K,{type:"submit",className:"w-full",loading:g,disabled:g||!P,children:s(g?"auth.registering":"auth.signUp")})}),e.jsx("div",{className:"text-sm text-gray-600",children:e.jsxs("p",{children:[s("auth.agreementText")," ",e.jsx(u,{to:"/terms",className:"text-green-600 hover:text-green-500",children:s("auth.termsOfService")})," ",s("auth.and")," ",e.jsx(u,{to:"/privacy",className:"text-green-600 hover:text-green-500",children:s("auth.privacyPolicy")})]})})]})})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[s("auth.haveAccount")," ",e.jsx(u,{to:"/auth/login",className:"font-medium text-green-600 hover:text-green-500",children:s("auth.signInNow")})]})})]})})}function ge(){return e.jsx(le,{})}export{ge as default};
