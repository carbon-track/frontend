import{c as Et,aN as Ft,r as p,aO as At,F as at,j as t,K as F,B as A,aB as ot,aC as Dt,aD as $t,ar as zt,aV as Mt,ap as nt,aF as it,at as ue,aE as lt,aG as ct,aH as qt,aW as Ut,aX as Wt,aY as Ht,aZ as Bt,a_ as Kt,aI as Vt,aJ as Jt,aK as Gt,a as he,u as Qt,I as R,w as Yt,N as Xt,O as Zt,Q as es,T as ts,V as ss,G as Se,X as rs}from"./index-D2v4yG6T.js";import{f as as,s as os,a as ns,e as is,R as ls,A as cs,J as dt}from"./RequestIdRelatedDrawer-CyaqIrwB.js";import{C as Y,a as me,b as pe,c as Re,d as X,e as ds}from"./Card-DCtTO9ti.js";import{S as us}from"./scroll-area-9nZPTXTb.js";import{S as ms}from"./switch-DRoi93dX.js";import{L as ut}from"./label-Dy1InYnx.js";import{T as Qe,a as Q}from"./toggle-group-BqVvx7pJ.js";import{A as ps,b as hs,a as xs}from"./Alert-Dt08zODj.js";import{R as fs}from"./refresh-cw-BAbILZ5T.js";import{D as Ye}from"./download-KcOaB87k.js";import"./chevron-down-L6Uv8N57.js";import"./chevron-right-C7zHSOLe.js";import"./index-BdQq_4o_.js";import"./index-ta97Wrgg.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],ys=Et("columns-2",gs);function Xe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Ze=Number.isNaN||function(s){return typeof s=="number"&&s!==s};function vs(e,s){return!!(e===s||Ze(e)&&Ze(s))}function js(e,s){if(e.length!==s.length)return!1;for(var r=0;r<e.length;r++)if(!vs(e[r],s[r]))return!1;return!0}function ke(e,s){s===void 0&&(s=js);var r,o=[],i,c=!1;function m(){for(var a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];return c&&r===this&&s(a,o)||(i=e.apply(this,a),c=!0,r=this,o=a),i}return m}var _s=typeof performance=="object"&&typeof performance.now=="function",et=_s?function(){return performance.now()}:function(){return Date.now()};function tt(e){cancelAnimationFrame(e.id)}function bs(e,s){var r=et();function o(){et()-r>=s?e.call(null):i.id=requestAnimationFrame(o)}var i={id:requestAnimationFrame(o)};return i}var Ee=-1;function st(e){if(e===void 0&&(e=!1),Ee===-1||e){var s=document.createElement("div"),r=s.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(s),Ee=s.offsetWidth-s.clientWidth,document.body.removeChild(s)}return Ee}var ae=null;function rt(e){if(e===void 0&&(e=!1),ae===null||e){var s=document.createElement("div"),r=s.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var o=document.createElement("div"),i=o.style;return i.width="100px",i.height="100px",s.appendChild(o),document.body.appendChild(s),s.scrollLeft>0?ae="positive-descending":(s.scrollLeft=1,s.scrollLeft===0?ae="negative":ae="positive-ascending"),document.body.removeChild(s),ae}return ae}var Ns=150,Cs=function(s,r){return s};function Ss(e){var s,r=e.getItemOffset,o=e.getEstimatedTotalSize,i=e.getItemSize,c=e.getOffsetForIndexAndAlignment,m=e.getStartIndexForOffset,a=e.getStopIndexForStartIndex,u=e.initInstanceProps,h=e.shouldResetStyleCacheOnItemSizeChange,j=e.validateProps;return s=(function(y){Ft(_,y);function _(I){var l;return l=y.call(this,I)||this,l._instanceProps=u(l.props,Xe(l)),l._outerRef=void 0,l._resetIsScrollingTimeoutId=null,l.state={instance:Xe(l),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof l.props.initialScrollOffset=="number"?l.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},l._callOnItemsRendered=void 0,l._callOnItemsRendered=ke(function(f,x,b,S){return l.props.onItemsRendered({overscanStartIndex:f,overscanStopIndex:x,visibleStartIndex:b,visibleStopIndex:S})}),l._callOnScroll=void 0,l._callOnScroll=ke(function(f,x,b){return l.props.onScroll({scrollDirection:f,scrollOffset:x,scrollUpdateWasRequested:b})}),l._getItemStyle=void 0,l._getItemStyle=function(f){var x=l.props,b=x.direction,S=x.itemSize,O=x.layout,N=l._getItemStyleCache(h&&S,h&&O,h&&b),w;if(N.hasOwnProperty(f))w=N[f];else{var T=r(l.props,f,l._instanceProps),$=i(l.props,f,l._instanceProps),z=b==="horizontal"||O==="horizontal",te=b==="rtl",se=z?T:0;N[f]=w={position:"absolute",left:te?void 0:se,right:te?se:void 0,top:z?0:T,height:z?"100%":$,width:z?$:"100%"}}return w},l._getItemStyleCache=void 0,l._getItemStyleCache=ke(function(f,x,b){return{}}),l._onScrollHorizontal=function(f){var x=f.currentTarget,b=x.clientWidth,S=x.scrollLeft,O=x.scrollWidth;l.setState(function(N){if(N.scrollOffset===S)return null;var w=l.props.direction,T=S;if(w==="rtl")switch(rt()){case"negative":T=-S;break;case"positive-descending":T=O-b-S;break}return T=Math.max(0,Math.min(T,O-b)),{isScrolling:!0,scrollDirection:N.scrollOffset<T?"forward":"backward",scrollOffset:T,scrollUpdateWasRequested:!1}},l._resetIsScrollingDebounced)},l._onScrollVertical=function(f){var x=f.currentTarget,b=x.clientHeight,S=x.scrollHeight,O=x.scrollTop;l.setState(function(N){if(N.scrollOffset===O)return null;var w=Math.max(0,Math.min(O,S-b));return{isScrolling:!0,scrollDirection:N.scrollOffset<w?"forward":"backward",scrollOffset:w,scrollUpdateWasRequested:!1}},l._resetIsScrollingDebounced)},l._outerRefSetter=function(f){var x=l.props.outerRef;l._outerRef=f,typeof x=="function"?x(f):x!=null&&typeof x=="object"&&x.hasOwnProperty("current")&&(x.current=f)},l._resetIsScrollingDebounced=function(){l._resetIsScrollingTimeoutId!==null&&tt(l._resetIsScrollingTimeoutId),l._resetIsScrollingTimeoutId=bs(l._resetIsScrolling,Ns)},l._resetIsScrolling=function(){l._resetIsScrollingTimeoutId=null,l.setState({isScrolling:!1},function(){l._getItemStyleCache(-1,null)})},l}_.getDerivedStateFromProps=function(l,f){return ws(l,f),j(l),null};var v=_.prototype;return v.scrollTo=function(l){l=Math.max(0,l),this.setState(function(f){return f.scrollOffset===l?null:{scrollDirection:f.scrollOffset<l?"forward":"backward",scrollOffset:l,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},v.scrollToItem=function(l,f){f===void 0&&(f="auto");var x=this.props,b=x.itemCount,S=x.layout,O=this.state.scrollOffset;l=Math.max(0,Math.min(l,b-1));var N=0;if(this._outerRef){var w=this._outerRef;S==="vertical"?N=w.scrollWidth>w.clientWidth?st():0:N=w.scrollHeight>w.clientHeight?st():0}this.scrollTo(c(this.props,l,f,O,this._instanceProps,N))},v.componentDidMount=function(){var l=this.props,f=l.direction,x=l.initialScrollOffset,b=l.layout;if(typeof x=="number"&&this._outerRef!=null){var S=this._outerRef;f==="horizontal"||b==="horizontal"?S.scrollLeft=x:S.scrollTop=x}this._callPropsCallbacks()},v.componentDidUpdate=function(){var l=this.props,f=l.direction,x=l.layout,b=this.state,S=b.scrollOffset,O=b.scrollUpdateWasRequested;if(O&&this._outerRef!=null){var N=this._outerRef;if(f==="horizontal"||x==="horizontal")if(f==="rtl")switch(rt()){case"negative":N.scrollLeft=-S;break;case"positive-ascending":N.scrollLeft=S;break;default:var w=N.clientWidth,T=N.scrollWidth;N.scrollLeft=T-w-S;break}else N.scrollLeft=S;else N.scrollTop=S}this._callPropsCallbacks()},v.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&tt(this._resetIsScrollingTimeoutId)},v.render=function(){var l=this.props,f=l.children,x=l.className,b=l.direction,S=l.height,O=l.innerRef,N=l.innerElementType,w=l.innerTagName,T=l.itemCount,$=l.itemData,z=l.itemKey,te=z===void 0?Cs:z,se=l.layout,Le=l.outerElementType,Ie=l.outerTagName,Oe=l.style,ie=l.useIsScrolling,Te=l.width,W=this.state.isScrolling,le=b==="horizontal"||se==="horizontal",fe=le?this._onScrollHorizontal:this._onScrollVertical,q=this._getRangeToRender(),P=q[0],D=q[1],ce=[];if(T>0)for(var H=P;H<=D;H++)ce.push(p.createElement(f,{data:$,key:te(H,$),index:H,isScrolling:ie?W:void 0,style:this._getItemStyle(H)}));var re=o(this.props,this._instanceProps);return p.createElement(Le||Ie||"div",{className:x,onScroll:fe,ref:this._outerRefSetter,style:At({position:"relative",height:S,width:Te,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:b},Oe)},p.createElement(N||w||"div",{children:ce,ref:O,style:{height:le?"100%":re,pointerEvents:W?"none":void 0,width:le?re:"100%"}}))},v._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var l=this.props.itemCount;if(l>0){var f=this._getRangeToRender(),x=f[0],b=f[1],S=f[2],O=f[3];this._callOnItemsRendered(x,b,S,O)}}if(typeof this.props.onScroll=="function"){var N=this.state,w=N.scrollDirection,T=N.scrollOffset,$=N.scrollUpdateWasRequested;this._callOnScroll(w,T,$)}},v._getRangeToRender=function(){var l=this.props,f=l.itemCount,x=l.overscanCount,b=this.state,S=b.isScrolling,O=b.scrollDirection,N=b.scrollOffset;if(f===0)return[0,0,0,0];var w=m(this.props,N,this._instanceProps),T=a(this.props,w,N,this._instanceProps),$=!S||O==="backward"?Math.max(1,x):1,z=!S||O==="forward"?Math.max(1,x):1;return[Math.max(0,w-$),Math.max(0,Math.min(f-1,T+z)),w,T]},_})(p.PureComponent),s.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},s}var ws=function(s,r){s.children,s.direction,s.height,s.layout,s.innerTagName,s.outerTagName,s.width,r.instance},Ls=Ss({getItemOffset:function(s,r){var o=s.itemSize;return r*o},getItemSize:function(s,r){var o=s.itemSize;return o},getEstimatedTotalSize:function(s){var r=s.itemCount,o=s.itemSize;return o*r},getOffsetForIndexAndAlignment:function(s,r,o,i,c,m){var a=s.direction,u=s.height,h=s.itemCount,j=s.itemSize,y=s.layout,_=s.width,v=a==="horizontal"||y==="horizontal",I=v?_:u,l=Math.max(0,h*j-I),f=Math.min(l,r*j),x=Math.max(0,r*j-I+j+m);switch(o==="smart"&&(i>=x-I&&i<=f+I?o="auto":o="center"),o){case"start":return f;case"end":return x;case"center":{var b=Math.round(x+(f-x)/2);return b<Math.ceil(I/2)?0:b>l+Math.floor(I/2)?l:b}case"auto":default:return i>=x&&i<=f?i:i<x?x:f}},getStartIndexForOffset:function(s,r){var o=s.itemCount,i=s.itemSize;return Math.max(0,Math.min(o-1,Math.floor(r/i)))},getStopIndexForStartIndex:function(s,r,o){var i=s.direction,c=s.height,m=s.itemCount,a=s.itemSize,u=s.layout,h=s.width,j=i==="horizontal"||u==="horizontal",y=r*a,_=j?h:c,v=Math.ceil((_+o-y)/a);return Math.max(0,Math.min(m-1,r+v-1))},initInstanceProps:function(s){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(s){s.itemSize}});function Is(e){return at(["systemLog",e],()=>as(e),{enabled:!!e})}function Os(e,s=400){const[r,o]=p.useState(e);return p.useEffect(()=>{const i=setTimeout(()=>o(e),s);return()=>clearTimeout(i)},[e,s]),r}function Ts(e){const s=Os(e.q||""),r={...e,q:s};return at(["logSearch",r],()=>os(r),{keepPreviousData:!0})}const Ps={req:"request_id",rid:"request_id",request_id:"request_id",user:"user_id",uid:"user_id",user_id:"user_id",dur:"duration_ms",time:"duration_ms",duration:"duration_ms",status:"status_code",code:"status_code",status_code:"status_code",path:"path",url:"path",method:"method",action:"action",astatus:"audit_status",audit_status:"audit_status",etype:"error_type",error_type:"error_type",model:"model",source:"source",actor:"actor_type",atype:"actor_type",actor_type:"actor_type",actor_id:"actor_id",aid:"actor_id",lstatus:"llm_status",llm_status:"llm_status"},Rs=new Set(["duration_ms","status_code"]);function Z(e){const s={},r={},o=[],i=/("[^"]+"|\S+)/g,c=(e||"").match(i)||[];for(const m of c){const a=m.trim();if(!a)continue;const u=a.match(/^([^:!<>=]+)(!?=|>=|<=|>|<|:)(.+)$/);if(u){let[,h,j,y]=u;h=h.trim(),y=y.trim(),y.startsWith('"')&&y.endsWith('"')&&(y=y.slice(1,-1));const _=Ps[h]||h;if(Rs.has(_)&&/^(>=|<=|>|<)$/.test(j)){r[_]=r[_]||{},r[_][j]=y;continue}if(j==="!="){s[_]={value:y,negate:!0};continue}s[_]=y}else o.push(a.replace(/^"|"$/g,""))}return{tokens:s,free:o.join(" "),ranges:r,raw:e}}function mt({system:e=[],audit:s=[],error:r=[],llm:o=[],onSelectRequest:i,emptyLabel:c="No events"}){const m=p.useMemo(()=>{const a=(u,h)=>{let j=u.created_at||u.error_time||u.time||u.timestamp;return{...u,__type:h,__ts:j&&Date.parse(j)||0}};return[...e.map(u=>a(u,"system")),...s.map(u=>a(u,"audit")),...r.map(u=>a(u,"error")),...o.map(u=>a(u,"llm"))].sort((u,h)=>h.__ts-u.__ts).slice(0,500)},[e,s,r,o]);return t.jsxs("div",{className:"space-y-3",children:[m.map(a=>t.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[t.jsx("div",{className:`w-20 text-right pr-2 font-mono ${Fs(a.__type)}`,children:a.__type}),t.jsxs("div",{className:"flex-1 border-l pl-3 pb-3 relative",children:[t.jsx("div",{className:"absolute -left-[5px] top-1 w-2 h-2 rounded-full bg-green-500"}),t.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1",children:[a.request_id&&t.jsx(U,{asButton:!0,onClick:()=>i==null?void 0:i(a.request_id),children:As(a.request_id)}),a.method&&t.jsx(U,{children:a.method}),a.status_code&&t.jsx(U,{tone:ks(a.status_code),children:a.status_code}),a.duration_ms!==void 0&&t.jsxs(U,{tone:Es(a.duration_ms),children:[a.duration_ms,"ms"]}),a.error_type&&t.jsx(U,{tone:"red",children:a.error_type}),a.action&&t.jsx(U,{children:a.action}),a.model&&t.jsx(U,{tone:"blue",children:a.model}),a.status&&a.__type==="llm"&&t.jsx(U,{tone:a.status==="failed"?"red":"green",children:a.status}),a.total_tokens!==void 0&&a.__type==="llm"&&t.jsx(U,{tone:"orange",children:a.total_tokens})]}),a.path&&t.jsx("div",{className:"font-mono text-[10px] mt-1 break-all text-gray-600",children:a.path}),a.error_message&&t.jsx("div",{className:"font-mono text-[10px] mt-1 text-rose-600 break-all",title:a.error_message,children:a.error_message.slice(0,180)}),a.prompt&&a.__type==="llm"&&t.jsx("div",{className:"font-mono text-[10px] mt-1 text-gray-600 break-all",title:a.prompt,children:String(a.prompt).slice(0,180)}),t.jsx("div",{className:"text-[10px] text-gray-400 mt-1",children:a.created_at||a.error_time})]})]},`${a.__type}-${a.id||a.request_id||a.__ts}`)),m.length===0&&t.jsx("div",{className:"text-xs text-gray-400",children:c})]})}function U({children:e,tone:s="gray",onClick:r,asButton:o=!1}){const i={gray:"bg-gray-200 text-gray-700",green:"bg-green-200 text-green-800",yellow:"bg-yellow-200 text-yellow-800",red:"bg-red-200 text-red-800",blue:"bg-blue-200 text-blue-800",orange:"bg-orange-200 text-orange-800"},c=`px-1.5 py-0.5 rounded ${r?"cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400":"cursor-default"} ${i[s]||i.gray} text-[10px] inline-flex items-center`;return o||r?t.jsx("button",{type:"button",className:c,onClick:r,children:e}):t.jsx("span",{className:c,children:e})}U.propTypes={children:F.node,tone:F.string,onClick:F.func,asButton:F.bool};function ks(e){return e>=500?"red":e>=400?"orange":e>=300?"yellow":e>=200?"green":"gray"}function Es(e){return e>=1500?"red":e>=1e3?"orange":e>=500?"yellow":"green"}function Fs(e){switch(e){case"system":return"text-green-600";case"audit":return"text-blue-600";case"error":return"text-red-600";case"llm":return"text-indigo-600";default:return"text-gray-500"}}function As(e){return e&&e.length>10?e.slice(0,6)+"â€¦"+e.slice(-4):e}mt.propTypes={system:F.array,audit:F.array,error:F.array,llm:F.array,onSelectRequest:F.func,emptyLabel:F.string};const Ds={copy:"Copy NDJSON",exportNdjson:"Export NDJSON",exportCsv:"Export CSV",records:"records",maxHint:"(max 1000)"};function pt({system:e=[],audit:s=[],error:r=[],llm:o=[],onExportCsv:i,onExportNdjson:c,labels:m={}}){const a=p.useMemo(()=>[...e.map(y=>({...y,__type:"system"})),...s.map(y=>({...y,__type:"audit"})),...r.map(y=>({...y,__type:"error"})),...o.map(y=>({...y,__type:"llm"}))].sort((y,_)=>{const v=Date.parse(y.created_at||y.error_time||y.time||y.timestamp||0)||0;return(Date.parse(_.created_at||_.error_time||_.time||_.timestamp||0)||0)-v}).slice(0,1e3),[e,s,r,o]),u={...Ds,...m},h=p.useMemo(()=>a.map(y=>JSON.stringify(y)).join(`
`),[a]),j=()=>{h&&navigator.clipboard.writeText(h).catch(()=>{})};return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[t.jsx(A,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:j,children:u.copy}),t.jsx(A,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:c,children:u.exportNdjson}),t.jsx(A,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:i,children:u.exportCsv}),t.jsxs("div",{className:"text-muted-foreground",children:[a.length," ",u.records," ",u.maxHint]})]}),t.jsx("pre",{className:"max-h-[60vh] overflow-auto whitespace-pre rounded bg-black p-3 text-[10px] leading-tight text-green-300",children:h})]})}pt.propTypes={system:F.array,audit:F.array,error:F.array,llm:F.array,onExportCsv:F.func,onExportNdjson:F.func,labels:F.object};var we="Popover",[ht]=zt(we,[ot]),xe=ot(),[$s,J]=ht(we),xt=e=>{const{__scopePopover:s,children:r,open:o,defaultOpen:i,onOpenChange:c,modal:m=!1}=e,a=xe(s),u=p.useRef(null),[h,j]=p.useState(!1),[y,_]=Dt({prop:o,defaultProp:i??!1,onChange:c,caller:we});return t.jsx($t,{...a,children:t.jsx($s,{scope:s,contentId:Mt(),triggerRef:u,open:y,onOpenChange:_,onOpenToggle:p.useCallback(()=>_(v=>!v),[_]),hasCustomAnchor:h,onCustomAnchorAdd:p.useCallback(()=>j(!0),[]),onCustomAnchorRemove:p.useCallback(()=>j(!1),[]),modal:m,children:r})})};xt.displayName=we;var ft="PopoverAnchor",zs=p.forwardRef((e,s)=>{const{__scopePopover:r,...o}=e,i=J(ft,r),c=xe(r),{onCustomAnchorAdd:m,onCustomAnchorRemove:a}=i;return p.useEffect(()=>(m(),()=>a()),[m,a]),t.jsx(lt,{...c,...o,ref:s})});zs.displayName=ft;var gt="PopoverTrigger",yt=p.forwardRef((e,s)=>{const{__scopePopover:r,...o}=e,i=J(gt,r),c=xe(r),m=nt(s,i.triggerRef),a=t.jsx(it.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":Nt(i.open),...o,ref:m,onClick:ue(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?a:t.jsx(lt,{asChild:!0,...c,children:a})});yt.displayName=gt;var $e="PopoverPortal",[Ms,qs]=ht($e,{forceMount:void 0}),vt=e=>{const{__scopePopover:s,forceMount:r,children:o,container:i}=e,c=J($e,s);return t.jsx(Ms,{scope:s,forceMount:r,children:t.jsx(ct,{present:r||c.open,children:t.jsx(qt,{asChild:!0,container:i,children:o})})})};vt.displayName=$e;var oe="PopoverContent",jt=p.forwardRef((e,s)=>{const r=qs(oe,e.__scopePopover),{forceMount:o=r.forceMount,...i}=e,c=J(oe,e.__scopePopover);return t.jsx(ct,{present:o||c.open,children:c.modal?t.jsx(Ws,{...i,ref:s}):t.jsx(Hs,{...i,ref:s})})});jt.displayName=oe;var Us=Ht("PopoverContent.RemoveScroll"),Ws=p.forwardRef((e,s)=>{const r=J(oe,e.__scopePopover),o=p.useRef(null),i=nt(s,o),c=p.useRef(!1);return p.useEffect(()=>{const m=o.current;if(m)return Ut(m)},[]),t.jsx(Wt,{as:Us,allowPinchZoom:!0,children:t.jsx(_t,{...e,ref:i,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ue(e.onCloseAutoFocus,m=>{var a;m.preventDefault(),c.current||(a=r.triggerRef.current)==null||a.focus()}),onPointerDownOutside:ue(e.onPointerDownOutside,m=>{const a=m.detail.originalEvent,u=a.button===0&&a.ctrlKey===!0,h=a.button===2||u;c.current=h},{checkForDefaultPrevented:!1}),onFocusOutside:ue(e.onFocusOutside,m=>m.preventDefault(),{checkForDefaultPrevented:!1})})})}),Hs=p.forwardRef((e,s)=>{const r=J(oe,e.__scopePopover),o=p.useRef(!1),i=p.useRef(!1);return t.jsx(_t,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:c=>{var m,a;(m=e.onCloseAutoFocus)==null||m.call(e,c),c.defaultPrevented||(o.current||(a=r.triggerRef.current)==null||a.focus(),c.preventDefault()),o.current=!1,i.current=!1},onInteractOutside:c=>{var u,h;(u=e.onInteractOutside)==null||u.call(e,c),c.defaultPrevented||(o.current=!0,c.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const m=c.target;((h=r.triggerRef.current)==null?void 0:h.contains(m))&&c.preventDefault(),c.detail.originalEvent.type==="focusin"&&i.current&&c.preventDefault()}})}),_t=p.forwardRef((e,s)=>{const{__scopePopover:r,trapFocus:o,onOpenAutoFocus:i,onCloseAutoFocus:c,disableOutsidePointerEvents:m,onEscapeKeyDown:a,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:j,...y}=e,_=J(oe,r),v=xe(r);return Bt(),t.jsx(Kt,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:i,onUnmountAutoFocus:c,children:t.jsx(Vt,{asChild:!0,disableOutsidePointerEvents:m,onInteractOutside:j,onEscapeKeyDown:a,onPointerDownOutside:u,onFocusOutside:h,onDismiss:()=>_.onOpenChange(!1),children:t.jsx(Jt,{"data-state":Nt(_.open),role:"dialog",id:_.contentId,...v,...y,ref:s,style:{...y.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),bt="PopoverClose",Bs=p.forwardRef((e,s)=>{const{__scopePopover:r,...o}=e,i=J(bt,r);return t.jsx(it.button,{type:"button",...o,ref:s,onClick:ue(e.onClick,()=>i.onOpenChange(!1))})});Bs.displayName=bt;var Ks="PopoverArrow",Vs=p.forwardRef((e,s)=>{const{__scopePopover:r,...o}=e,i=xe(r);return t.jsx(Gt,{...i,...o,ref:s})});Vs.displayName=Ks;function Nt(e){return e?"open":"closed"}var Js=xt,Gs=yt,Qs=vt,Ys=jt;function Xs({...e}){return t.jsx(Js,{"data-slot":"popover",...e})}function Zs({...e}){return t.jsx(Gs,{"data-slot":"popover-trigger",...e})}function er({className:e,align:s="center",sideOffset:r=4,...o}){return t.jsx(Qs,{children:t.jsx(Ys,{"data-slot":"popover-content",align:s,sideOffset:r,className:he("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...o})})}const Ct=["id","method","path","status_code","user_id","duration_ms","created_at","ops"],St=["id","actor_type","action","operation_category","status","user_id","ip_address","created_at","ops"],wt=["id","error_type","error_message","error_file","error_line","error_time","ops"],Lt=["id","actor_type","actor_id","source","model","llm_status","total_tokens","latency_ms","created_at","ops"],V={system:"logCols_system",audit:"logCols_audit",error:"logCols_error",llm:"logCols_llm"};function Ne(e,s){try{const r=localStorage.getItem(e),o=r?JSON.parse(r):null;return Array.isArray(o)&&o.length?o:s}catch(r){return console.warn("Failed to load stored columns",r),s}}function Sr(){var qe,Ue,We,He,Be,Ke,Ve,Je,Ge;const{t:e}=Qt(),[s,r]=p.useState(""),[o,i]=p.useState(""),[c,m]=p.useState(""),[a,u]=p.useState(["system","audit","error","llm"]),[h,j]=p.useState(50),[y,_]=p.useState(null),[v,I]=p.useState("table"),[l,f]=p.useState(!1),[x,b]=p.useState(null),[S,O]=p.useState({system:[],audit:[],error:[],llm:[]}),[N,w]=p.useState(!1),[T,$]=p.useState(!1),[z,te]=p.useState(()=>Ne(V.system,Ct)),[se,Le]=p.useState(()=>Ne(V.audit,St)),[Ie,Oe]=p.useState(()=>Ne(V.error,wt)),[ie,Te]=p.useState(()=>Ne(V.llm,Lt)),W=p.useRef(0),[le,fe]=p.useState(new Set),q=p.useMemo(()=>Z(s||""),[s]),P=p.useMemo(()=>{var g;const n={},d=q.tokens||{};if(["method","status_code","user_id","request_id","path","action","audit_status","error_type","model","source","actor_type","actor_id","llm_status"].forEach(C=>{d[C]&&(n[C]=d[C])}),(g=q.ranges)!=null&&g.duration_ms){const C=q.ranges.duration_ms;(C[">"]||C[">="])&&(n.min_duration=C[">"]||C[">="]),(C["<"]||C["<="])&&(n.max_duration=C["<"]||C["<="])}return n},[q]),{data:D,isLoading:ce,isError:H,error:re,refetch:Pe,isFetching:ze}=Ts({q:q.free||s,date_from:o,date_to:c,types:a,limit_per_type:h,...P}),{data:k,isLoading:Ot}=Is(y);p.useEffect(()=>{if(!l)return;const n=setInterval(()=>{Pe()},8e3);return()=>clearInterval(n)},[l,Pe]);const ge=p.useCallback(n=>{if(n!=null)try{const d=typeof n=="string"?n:JSON.stringify(n,null,2);navigator.clipboard.writeText(d)}catch(d){console.warn("Failed to copy content",d)}},[]),B=((Ue=(qe=D==null?void 0:D.data)==null?void 0:qe.system)==null?void 0:Ue.items)||[],ye=((He=(We=D==null?void 0:D.data)==null?void 0:We.audit)==null?void 0:He.items)||[],ve=((Ke=(Be=D==null?void 0:D.data)==null?void 0:Be.error)==null?void 0:Ke.items)||[],je=((Je=(Ve=D==null?void 0:D.data)==null?void 0:Ve.llm)==null?void 0:Je.items)||[];p.useEffect(()=>{if(!B.length)return;const n=Math.max(...B.map(d=>d.id));if(W.current===0){W.current=n;return}if(n>W.current){const d=B.filter(C=>C.id>W.current).map(C=>C.id);fe(new Set(d)),W.current=n;const g=setTimeout(()=>fe(new Set),4e3);return()=>clearTimeout(g)}},[B]);const Tt=p.useCallback(n=>{n&&u(n)},[]),de=p.useCallback((n,d)=>{try{localStorage.setItem(n,JSON.stringify(d))}catch(g){console.warn("Failed to persist selected columns",g)}},[]),Pt=p.useCallback((n,d)=>{d==="id"||d==="ops"||(n==="system"?te(g=>{const C=g.includes(d)?g.filter(G=>G!==d):[...g,d];return de(V.system,C),C}):n==="audit"?Le(g=>{const C=g.includes(d)?g.filter(G=>G!==d):[...g,d];return de(V.audit,C),C}):n==="error"?Oe(g=>{const C=g.includes(d)?g.filter(G=>G!==d):[...g,d];return de(V.error,C),C}):n==="llm"&&Te(g=>{const C=g.includes(d)?g.filter(G=>G!==d):[...g,d];return de(V.llm,C),C}))},[de]),_e=p.useCallback(async n=>{b(n),w(!0);try{const d=await ns(n);O((d==null?void 0:d.data)||d||{system:[],audit:[],error:[],llm:[]})}finally{w(!1)}},[]),be=p.useCallback(async n=>{$(!0);try{const d=await is({q:s,date_from:o,date_to:c,types:a,limit_per_type:h,...P},n),g=URL.createObjectURL(d),C=document.createElement("a");C.href=g,C.download=`logs_${Date.now()}.${n==="csv"?"csv":"ndjson"}`,C.click(),setTimeout(()=>URL.revokeObjectURL(g),2e3)}finally{$(!1)}},[s,o,c,a,h,P]),Rt=B.length+ye.length+ve.length+je.length>0,kt=Object.entries(q.tokens||{}).filter(([,n])=>n&&typeof n!="object").length>0||!!q.free,K=p.useCallback(n=>e(`admin.systemLogs.columns.${n}`,{defaultValue:n}),[e]),Me=p.useMemo(()=>ie.filter(n=>n!=="ops"),[ie]);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs(Y,{children:[t.jsxs(me,{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(pe,{children:e("admin.systemLogs.title")}),t.jsx(Re,{children:e("admin.systemLogs.subtitle")})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs(Qe,{type:"single",value:v,onValueChange:n=>n&&I(n),variant:"outline",size:"sm",children:[t.jsx(Q,{value:"table",children:e("admin.systemLogs.views.table")}),t.jsx(Q,{value:"timeline",children:e("admin.systemLogs.views.timeline")}),t.jsx(Q,{value:"raw",children:e("admin.systemLogs.views.raw")})]}),t.jsxs(A,{size:"sm",variant:"outline",onClick:()=>Pe(),disabled:ze,children:[t.jsx(fs,{className:he("mr-2 h-4 w-4",ze&&"animate-spin")}),e("admin.systemLogs.refresh")]}),t.jsxs(A,{size:"sm",variant:"outline",onClick:()=>be("csv"),disabled:T,children:[t.jsx(Ye,{className:"mr-2 h-4 w-4"}),e("admin.systemLogs.exportCsv")]}),t.jsxs(A,{size:"sm",variant:"outline",onClick:()=>be("ndjson"),disabled:T,children:[t.jsx(Ye,{className:"mr-2 h-4 w-4"}),e("admin.systemLogs.exportNdjson")]}),t.jsx(tr,{systemCols:z,auditCols:se,errorCols:Ie,llmCols:ie,onToggle:Pt,columnLabel:K,t:e})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ms,{id:"logs-auto-refresh",checked:l,onCheckedChange:f}),t.jsx(ut,{htmlFor:"logs-auto-refresh",className:"text-sm text-muted-foreground",children:e("admin.systemLogs.autoRefresh")})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-muted-foreground",children:[t.jsx("span",{children:e("admin.systemLogs.perTypeLimit")}),t.jsx(R,{id:"limit-per-type",type:"number",min:1,max:200,value:h,onChange:n=>{const d=Number(n.target.value);j(Number.isNaN(d)?50:d)},className:"h-9 w-24"})]}),t.jsxs(Qe,{type:"multiple",value:a,onValueChange:Tt,variant:"outline",size:"sm",className:"flex-wrap",children:[t.jsx(Q,{value:"system",children:e("admin.systemLogs.types.system")}),t.jsx(Q,{value:"audit",children:e("admin.systemLogs.types.audit")}),t.jsx(Q,{value:"error",children:e("admin.systemLogs.types.error")}),t.jsx(Q,{value:"llm",children:e("admin.systemLogs.types.llm")})]})]})]}),t.jsx(X,{className:"pt-0",children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4",children:[t.jsx(E,{label:e("admin.systemLogs.filters.keyword"),htmlFor:"log-search",children:t.jsx(R,{id:"log-search",value:s,onChange:n=>r(n.target.value),placeholder:e("admin.systemLogs.searchPlaceholder"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.method"),htmlFor:"log-method",children:t.jsx(R,{id:"log-method",value:P.method||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"method",d))},placeholder:e("admin.systemLogs.placeholders.method"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.status"),htmlFor:"log-status",children:t.jsx(R,{id:"log-status",value:P.status_code||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"status",d))},placeholder:e("admin.systemLogs.placeholders.status"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.userId"),htmlFor:"log-user-id",children:t.jsx(R,{id:"log-user-id",value:P.user_id||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"user",d))},placeholder:e("admin.systemLogs.placeholders.userId"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.requestId"),htmlFor:"log-request-id",children:t.jsx(R,{id:"log-request-id",value:P.request_id||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"rid",d))},placeholder:e("admin.systemLogs.placeholders.requestId"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.path"),htmlFor:"log-path",children:t.jsx(R,{id:"log-path",value:P.path||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"path",d))},placeholder:e("admin.systemLogs.placeholders.path"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.durationMin"),htmlFor:"log-duration-min",children:t.jsx(R,{id:"log-duration-min",value:P.min_duration||"",onChange:n=>r(d=>It(d,"dur",">=",n.target.value)),placeholder:e("admin.systemLogs.placeholders.duration"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.durationMax"),htmlFor:"log-duration-max",children:t.jsx(R,{id:"log-duration-max",value:P.max_duration||"",onChange:n=>r(d=>lr(d,n.target.value)),placeholder:e("admin.systemLogs.placeholders.duration"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.auditAction"),htmlFor:"log-audit-action",children:t.jsx(R,{id:"log-audit-action",value:P.action||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"action",d))},placeholder:e("admin.systemLogs.placeholders.auditAction"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.auditStatus"),htmlFor:"log-audit-status",children:t.jsx(R,{id:"log-audit-status",value:P.audit_status||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"astatus",d))},placeholder:e("admin.systemLogs.placeholders.auditStatus"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.errorType"),htmlFor:"log-error-type",children:t.jsx(R,{id:"log-error-type",value:P.error_type||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"etype",d))},placeholder:e("admin.systemLogs.placeholders.errorType"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.model"),htmlFor:"log-model",children:t.jsx(R,{id:"log-model",value:P.model||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"model",d))},placeholder:e("admin.systemLogs.placeholders.model"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.source"),htmlFor:"log-source",children:t.jsx(R,{id:"log-source",value:P.source||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"source",d))},placeholder:e("admin.systemLogs.placeholders.source"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.actorType"),htmlFor:"log-actor-type",children:t.jsx(R,{id:"log-actor-type",value:P.actor_type||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"actor",d))},placeholder:e("admin.systemLogs.placeholders.actorType"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.llmStatus"),htmlFor:"log-llm-status",children:t.jsx(R,{id:"log-llm-status",value:P.llm_status||"",onChange:n=>{const d=n.target.value;r(g=>M(g,"lstatus",d))},placeholder:e("admin.systemLogs.placeholders.llmStatus"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.dateFrom"),htmlFor:"log-date-from",children:t.jsx(R,{id:"log-date-from",type:"date",value:o,onChange:n=>i(n.target.value)})}),t.jsx(E,{label:e("admin.systemLogs.dateTo"),htmlFor:"log-date-to",children:t.jsx(R,{id:"log-date-to",type:"date",value:c,onChange:n=>m(n.target.value)})})]})}),kt&&t.jsx(ds,{className:"pt-0",children:t.jsx(sr,{parsed:q,onRemove:n=>r(d=>cr(d,n)),t:e})})]}),ce&&t.jsx(Y,{children:t.jsxs(X,{className:"flex items-center gap-2 py-8 text-sm text-muted-foreground",children:[t.jsx(Yt,{className:"h-4 w-4 animate-spin"}),e("common.loading")]})}),H&&t.jsxs(ps,{variant:"destructive",children:[t.jsx(hs,{children:e("common.error")}),t.jsx(xs,{children:(re==null?void 0:re.message)||e("errors.loadFailed")})]}),!ce&&!H&&t.jsxs(t.Fragment,{children:[v==="table"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx(rr,{title:e("admin.systemLogs.sections.system"),items:B,emptyText:e("admin.systemLogs.empty.system"),columns:z,highlightIds:le,onDetail:_,onCopyReq:ge,onRelated:_e,columnLabel:K,t:e}),t.jsx(Fe,{title:e("admin.systemLogs.sections.llm"),items:je,emptyText:e("admin.systemLogs.empty.llm"),headers:Me,columnLabel:K,renderItem:n=>t.jsx(Ae,{summaryCells:Me.map(d=>ir(n,d)),detail:t.jsx(nr,{log:n,columnLabel:K,onRelated:_e,t:e}),t:e},`llm-${n.id}`)}),t.jsx(Fe,{title:e("admin.systemLogs.sections.audit"),items:ye,emptyText:e("admin.systemLogs.empty.audit"),headers:["id","actor_type","action","operation_category","status","user_id","ip_address","created_at"],columnLabel:K,renderItem:n=>t.jsx(Ae,{summaryCells:[n.id,n.actor_type,n.action,n.operation_category||"- ",n.status,n.user_id||"-",n.ip_address||"-",n.created_at],detail:t.jsx(ar,{log:n,columnLabel:K}),t:e},`audit-${n.id}`)}),t.jsx(Fe,{title:e("admin.systemLogs.sections.error"),items:ve,emptyText:e("admin.systemLogs.empty.error"),headers:["id","error_type","error_message","error_file","error_line","error_time"],columnLabel:K,renderItem:n=>{var d;return t.jsx(Ae,{summaryCells:[n.id,n.error_type,t.jsx("span",{className:"font-mono text-[11px] max-w-[240px] truncate",title:n.error_message,children:n.error_message},"message"),((d=n.error_file)==null?void 0:d.split("/").pop())||"-",n.error_line,n.error_time],detail:t.jsx(or,{log:n,columnLabel:K}),t:e},`error-${n.id}`)}}),!Rt&&t.jsx(Y,{children:t.jsx(X,{className:"py-12 text-center text-sm text-muted-foreground",children:e("admin.systemLogs.noEvents")})})]}),v==="timeline"&&t.jsxs(Y,{children:[t.jsxs(me,{children:[t.jsx(pe,{className:"text-lg",children:e("admin.systemLogs.views.timeline")}),t.jsx(Re,{children:e("admin.systemLogs.timelineDescription")})]}),t.jsx(X,{children:t.jsx(mt,{system:B,audit:ye,error:ve,llm:je,onSelectRequest:_e,emptyLabel:e("admin.systemLogs.noEvents")})})]}),v==="raw"&&t.jsxs(Y,{children:[t.jsxs(me,{children:[t.jsx(pe,{className:"text-lg",children:e("admin.systemLogs.views.raw")}),t.jsx(Re,{children:e("admin.systemLogs.rawDescription")})]}),t.jsx(X,{children:t.jsx(pt,{system:B,audit:ye,error:ve,llm:je,onExportCsv:()=>be("csv"),onExportNdjson:()=>be("ndjson"),labels:{copy:e("admin.systemLogs.copyNdjson"),exportNdjson:e("admin.systemLogs.exportNdjson"),exportCsv:e("admin.systemLogs.exportCsv"),records:e("admin.systemLogs.records"),maxHint:e("admin.systemLogs.maxRecords")}})})]})]}),t.jsx(Xt,{open:!!y,onOpenChange:n=>!n&&_(null),children:t.jsxs(Zt,{className:"max-w-4xl",children:[t.jsxs(es,{children:[t.jsx(ts,{children:y?e("admin.systemLogs.dialog.titleWithId",{id:y}):e("admin.systemLogs.dialog.title")}),t.jsx(ss,{children:e("admin.systemLogs.dialog.requestId",{id:((Ge=k==null?void 0:k.data)==null?void 0:Ge.request_id)||e("common.none")})})]}),Ot&&t.jsx("div",{className:"py-4 text-sm text-muted-foreground",children:e("admin.systemLogs.dialog.loading")}),(k==null?void 0:k.data)&&t.jsx(us,{className:"max-h-[70vh] pr-2",children:t.jsxs("div",{className:"space-y-6 text-sm",children:[t.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[t.jsx(L,{label:e("admin.systemLogs.columns.request_id"),value:k.data.request_id}),t.jsx(L,{label:e("admin.systemLogs.columns.method"),value:k.data.method}),t.jsx(L,{label:e("admin.systemLogs.columns.path"),value:k.data.path,className:"md:col-span-2"}),t.jsx(L,{label:e("admin.systemLogs.columns.status_code"),value:k.data.status_code}),t.jsx(L,{label:e("admin.systemLogs.columns.user_id"),value:k.data.user_id||e("common.none")}),t.jsx(L,{label:e("admin.systemLogs.columns.duration_ms"),value:`${k.data.duration_ms} ms`}),t.jsx(L,{label:e("admin.systemLogs.columns.created_at"),value:k.data.created_at,className:"md:col-span-2"})]}),t.jsx(De,{title:e("admin.systemLogs.requestBody"),value:k.data.request_body,onCopy:ge,copyLabel:e("common.copy")}),t.jsx(De,{title:e("admin.systemLogs.responseBody"),value:k.data.response_body,onCopy:ge,copyLabel:e("common.copy")}),k.data.server_meta&&t.jsx(De,{title:e("admin.systemLogs.serverMeta"),value:k.data.server_meta,onCopy:ge,copyLabel:e("common.copy")})]})})]})}),t.jsx(ls,{open:!!x,requestId:x,onClose:()=>b(null),loading:N,data:S,onRefresh:()=>x&&_e(x)})]})}function E({label:e,htmlFor:s,children:r}){return t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(ut,{htmlFor:s,className:"text-xs font-medium uppercase tracking-wide text-muted-foreground",children:e}),r]})}function tr({systemCols:e,auditCols:s,errorCols:r,llmCols:o,onToggle:i,columnLabel:c,t:m}){return t.jsxs(Xs,{children:[t.jsx(Zs,{asChild:!0,children:t.jsxs(A,{size:"sm",variant:"outline",children:[t.jsx(ys,{className:"mr-2 h-4 w-4"}),m("admin.systemLogs.columnSettings")]})}),t.jsxs(er,{className:"w-64 space-y-4",align:"end",children:[t.jsx(Ce,{title:m("admin.systemLogs.types.system"),columns:Ct,active:e,onToggle:a=>i("system",a),columnLabel:c}),t.jsx(Ce,{title:m("admin.systemLogs.types.audit"),columns:St,active:s,onToggle:a=>i("audit",a),columnLabel:c}),t.jsx(Ce,{title:m("admin.systemLogs.types.error"),columns:wt,active:r,onToggle:a=>i("error",a),columnLabel:c}),t.jsx(Ce,{title:m("admin.systemLogs.types.llm"),columns:Lt,active:o,onToggle:a=>i("llm",a),columnLabel:c})]})]})}function Ce({title:e,columns:s,active:r,onToggle:o,columnLabel:i}){return t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-[11px] font-semibold uppercase text-muted-foreground",children:e}),t.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(c=>t.jsx(A,{size:"sm",variant:r.includes(c)?"default":"outline",onClick:()=>o(c),className:"h-8 text-xs",children:i(c)},c))})]})}function sr({parsed:e,onRemove:s,t:r}){const o=Object.entries(e.tokens||{}).filter(([,i])=>i&&typeof i!="object");return o.length===0&&!e.free?null:t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[o.map(([i,c])=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(Se,{variant:"secondary",className:"font-mono",children:[i,":",String(c)]}),t.jsx(A,{type:"button",size:"icon",variant:"ghost",className:"h-6 w-6 text-muted-foreground",onClick:()=>s(i),"aria-label":r("admin.systemLogs.activeFilters.remove",{key:i}),children:t.jsx(rs,{className:"h-3 w-3"})})]},i)),e.free&&t.jsx(Se,{variant:"outline",className:"font-mono",children:e.free})]})}function rr({title:e,items:s,emptyText:r,columns:o,highlightIds:i,onDetail:c,onCopyReq:m,onRelated:a,columnLabel:u,t:h}){const j=s.length>120,y=t.jsx("thead",{className:"bg-muted/60",children:t.jsxs("tr",{children:[o.includes("id")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("id")}),o.includes("method")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("method")}),o.includes("path")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("path")}),o.includes("status_code")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("status_code")}),o.includes("user_id")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("user_id")}),o.includes("duration_ms")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("duration_ms")}),o.includes("created_at")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("created_at")}),o.includes("ops")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("ops")})]})}),_=v=>{const I=i.has(v.id);return t.jsxs("tr",{className:he("border-b text-xs transition-colors hover:bg-muted/30",I&&"bg-amber-50"),children:[o.includes("id")&&t.jsx("td",{className:"px-3 py-2 font-medium",children:v.id}),o.includes("method")&&t.jsx("td",{className:"px-3 py-2 uppercase",children:v.method}),o.includes("path")&&t.jsx("td",{className:"px-3 py-2",children:t.jsx("span",{className:"font-mono text-[11px]",title:v.path,children:v.path})}),o.includes("status_code")&&t.jsx("td",{className:"px-3 py-2",children:v.status_code}),o.includes("user_id")&&t.jsx("td",{className:"px-3 py-2",children:v.user_id||"-"}),o.includes("duration_ms")&&t.jsx("td",{className:"px-3 py-2",children:v.duration_ms}),o.includes("created_at")&&t.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:v.created_at}),o.includes("ops")&&t.jsx("td",{className:"px-3 py-2",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[t.jsx(A,{variant:"link",className:"h-auto p-0",onClick:()=>c(v.id),children:h("admin.systemLogs.details")}),t.jsx(A,{variant:"link",className:"h-auto p-0 text-muted-foreground",onClick:()=>m(v.request_id),children:h("admin.systemLogs.copyReqId")}),v.request_id&&t.jsx(A,{variant:"link",className:"h-auto p-0 text-indigo-600",onClick:()=>a(v.request_id),children:h("admin.systemLogs.related")})]})})]},v.id)};return t.jsxs(Y,{children:[t.jsx(me,{className:"flex flex-row items-center justify-between space-y-0",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(pe,{className:"text-lg",children:e}),t.jsx(Se,{variant:"outline",className:"text-xs",children:h("admin.systemLogs.recordCount",{count:s.length})})]})}),t.jsx(X,{className:"p-0",children:t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full border-t text-xs",children:[y,!j&&t.jsxs("tbody",{children:[s.map(v=>_(v)),s.length===0&&t.jsx("tr",{children:t.jsx("td",{className:"px-4 py-6 text-center text-muted-foreground",colSpan:o.length,children:r})})]})]}),j&&t.jsx(Ls,{height:480,itemCount:s.length,itemSize:44,width:"100%",children:({index:v,style:I})=>t.jsx("table",{style:{...I,width:"100%"},className:"table-fixed text-xs",children:t.jsx("tbody",{children:_(s[v])})},s[v].id)})]})})]})}function Fe({title:e,items:s,emptyText:r,renderItem:o,headers:i,columnLabel:c}){return t.jsxs(Y,{children:[t.jsx(me,{className:"flex flex-row items-center justify-between space-y-0",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(pe,{className:"text-lg",children:e}),t.jsx(Se,{variant:"outline",className:"text-xs",children:s.length})]})}),t.jsx(X,{className:"p-0",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full border-t text-xs",children:[t.jsx("thead",{className:"bg-muted/60",children:t.jsxs("tr",{children:[i.map(m=>t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:c(m)},m)),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-semibold uppercase text-muted-foreground",children:c("ops")})]})}),t.jsxs("tbody",{children:[s.map(o),s.length===0&&t.jsx("tr",{children:t.jsx("td",{className:"px-4 py-6 text-center text-muted-foreground",colSpan:i.length+1,children:r})})]})]})})})]})}function Ae({summaryCells:e,detail:s,t:r}){const[o,i]=p.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsxs("tr",{className:he("border-b",o&&"bg-muted/40"),children:[e.map((c,m)=>t.jsx("td",{className:"px-3 py-2 align-top",children:c},m)),t.jsx("td",{className:"px-3 py-2 text-right",children:t.jsx(A,{variant:"link",className:"h-auto p-0 text-xs",onClick:()=>i(c=>!c),children:r(o?"admin.systemLogs.actions.collapse":"admin.systemLogs.actions.expand")})})]}),o&&t.jsx("tr",{className:"border-b bg-muted/30",children:t.jsx("td",{colSpan:e.length+1,className:"px-3 py-3",children:s})})]})}function ar({log:e,columnLabel:s}){return t.jsxs("div",{className:"space-y-2 text-xs",children:[t.jsx(L,{label:s("id"),value:e.id}),t.jsx(L,{label:s("action"),value:e.action}),t.jsx(L,{label:s("operation_category"),value:e.operation_category||"-"}),t.jsx(L,{label:s("actor_type"),value:e.actor_type}),t.jsx(L,{label:s("status"),value:e.status}),e.details_raw&&t.jsx(ne,{title:"details_raw",value:ee(e.details_raw)}),e.summary&&t.jsx(ne,{title:"summary",value:ee(e.summary)}),(e.old_data||e.new_data)&&t.jsx("div",{className:"space-y-1",children:t.jsx(cs,{oldData:e.old_data,newData:e.new_data})})]})}function or({log:e,columnLabel:s}){return t.jsxs("div",{className:"space-y-2 text-xs",children:[t.jsx(L,{label:s("id"),value:e.id}),t.jsx(L,{label:s("error_type"),value:e.error_type}),t.jsx(L,{label:s("error_file"),value:e.error_file}),t.jsx(L,{label:s("error_line"),value:e.error_line}),t.jsx(ne,{title:"message",value:ee(e.error_message)}),e.stack_trace&&t.jsx("pre",{className:"max-h-64 overflow-auto whitespace-pre-wrap rounded bg-slate-900 p-3 font-mono text-[11px] text-green-300",children:e.stack_trace}),e.context_json&&t.jsx(ne,{title:"context",value:ee(e.context_json)})]})}function nr({log:e,columnLabel:s,onRelated:r,t:o}){return t.jsxs("div",{className:"space-y-2 text-xs",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(L,{label:s("request_id"),value:e.request_id||"-"}),e.request_id&&t.jsx(A,{variant:"link",className:"h-auto p-0 text-xs",onClick:()=>r==null?void 0:r(e.request_id),children:o("admin.systemLogs.related")})]}),t.jsx(L,{label:s("actor_type"),value:e.actor_type}),t.jsx(L,{label:s("actor_id"),value:e.actor_id||"-"}),t.jsx(L,{label:s("source"),value:e.source||"-"}),t.jsx(L,{label:s("model"),value:e.model||"-"}),t.jsx(L,{label:s("llm_status"),value:e.status||"-"}),t.jsx(L,{label:s("response_id"),value:e.response_id||"-"}),t.jsx(L,{label:s("total_tokens"),value:e.total_tokens??"-"}),t.jsx(L,{label:s("latency_ms"),value:e.latency_ms??"-"}),e.prompt&&t.jsx(ne,{title:"prompt",value:ee(e.prompt)}),e.error_message&&t.jsx(ne,{title:"error_message",value:ee(e.error_message)})]})}function De({title:e,value:s,onCopy:r,copyLabel:o}){return s?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-sm font-semibold",children:e}),t.jsx(A,{variant:"link",className:"h-auto p-0 text-xs",onClick:()=>r(s),children:o})]}),t.jsx(dt,{value:ee(s)})]}):null}function ne({title:e,value:s}){return s?t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:e}),t.jsx(dt,{value:s})]}):null}function L({label:e,value:s,className:r}){return t.jsxs("div",{className:he("space-x-2",r),children:[t.jsxs("span",{className:"font-semibold",children:[e,":"]}),t.jsx("span",{className:"font-mono break-all text-xs",children:String(s??"-")})]})}function ee(e){if(e==null)return null;if(typeof e=="object")return e;try{return JSON.parse(e)}catch{return e}}function ir(e,s){switch(s){case"id":return e.id;case"actor_type":return e.actor_type;case"actor_id":return e.actor_id??"-";case"source":return e.source||"-";case"model":return e.model||"-";case"llm_status":return e.status||"-";case"total_tokens":return e.total_tokens??"-";case"latency_ms":return e.latency_ms??"-";case"created_at":return e.created_at;default:return e[s]??"-"}}function M(e,s,r){const o=Z(e||""),c=Z(`${s}:${r!==void 0&&r!==""?r:"__probe__"}`),m=Object.keys(c.tokens||{})[0]||s;r?(o.tokens=o.tokens||{},o.tokens[m]=r):o.tokens&&delete o.tokens[m];const a=[];return Object.entries(o.tokens||{}).forEach(([u,h])=>{h&&typeof h=="object"?h.negate?a.push(`${u}!=${h.value}`):a.push(`${u}:${h.value}`):a.push(`${u}:${h}`)}),Object.entries(o.ranges||{}).forEach(([u,h])=>{Object.entries(h).forEach(([j,y])=>{a.push(`${u}${j}${y}`)})}),o.free&&a.push(o.free),a.join(" ").trim()}function It(e,s,r,o){const i=Z(e||""),m=Z(`${s}${r}${o!==void 0&&o!==""?o:"__probe__"}`),a=Object.keys(m.ranges||{})[0]||Object.keys(m.tokens||{})[0]||s;i.ranges=i.ranges||{},o?(i.ranges[a]=i.ranges[a]||{},i.ranges[a][r]=o):i.ranges[a]&&(delete i.ranges[a][r],Object.keys(i.ranges[a]).length===0&&delete i.ranges[a]);const u=[];return Object.entries(i.tokens||{}).forEach(([h,j])=>{j&&typeof j=="object"?j.negate?u.push(`${h}!=${j.value}`):u.push(`${h}:${j.value}`):u.push(`${h}:${j}`)}),Object.entries(i.ranges||{}).forEach(([h,j])=>{Object.entries(j).forEach(([y,_])=>{u.push(`${h}${y}${_}`)})}),i.free&&u.push(i.free),u.join(" ").trim()}function lr(e,s){return It(e,"dur","<=",s)}function cr(e,s){const r=Z(e||""),o=Z(`${s}:__probe__`),i=Object.keys(o.tokens||{})[0]||s;r.tokens&&delete r.tokens[i];const c=[];return Object.entries(r.tokens||{}).forEach(([m,a])=>{a&&typeof a=="object"?a.negate?c.push(`${m}!=${a.value}`):c.push(`${m}:${a.value}`):c.push(`${m}:${a}`)}),Object.entries(r.ranges||{}).forEach(([m,a])=>{Object.entries(a).forEach(([u,h])=>{c.push(`${m}${u}${h}`)})}),r.free&&c.push(r.free),c.join(" ").trim()}export{Sr as default};
