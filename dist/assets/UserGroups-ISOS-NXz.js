import{j as e}from"./motion-vendor-C11-9Hm-.js";import{r as d}from"./react-vendor-CFnAvB5y.js";import{u as F,a8 as O,Z as w,B as x,P as T,a1 as M,a2 as U,a3 as L,a4 as Q,I as j,a7 as P,n as g,aj as m}from"./index-R2AZuhYm.js";import{u as y}from"./useMutation-BizCFaz9.js";import{L as o}from"./label-y10Uj9pm.js";import{T as E}from"./textarea-LvdKOQse.js";import{C as I}from"./checkbox-Bn5VXDJn.js";import{A as z,a as B,b as G,c as H,d as K,e as R,f as W,g as Z}from"./alert-dialog-DPuSLFj7.js";import{C as $}from"./circle-plus-DDNYltvk.js";import{S as J}from"./square-pen-BJekxGDP.js";import{T as V}from"./trash-2-CepzdiQb.js";import"./i18n-vendor-DK0x1_bH.js";import"./charts-vendor-DJkHj7pX.js";import"./index-YbUg3LVs.js";function X(){const{t}=F(),p=O(),[a,i]=d.useState(null),[D,l]=d.useState(!1),[v,h]=d.useState({open:!1,group:null}),{data:n,isLoading:q}=w("userGroups",()=>m.getUserGroups().then(s=>s.data.data)),{data:u}=w("userGroupMeta",()=>m.getUserGroupMeta().then(s=>s.data.data)),f=d.useMemo(()=>{const s=u==null?void 0:u.quota_definitions;if(Array.isArray(s)&&s.length>0)return s;if(Array.isArray(n)&&n.length>0){const r=n.find(c=>c==null?void 0:c.quota_flat)||n[0];return Object.keys((r==null?void 0:r.quota_flat)||{})}return[]},[u,n]),N=d.useMemo(()=>f.length===0?{}:f.reduce((s,r)=>(s[r]=null,s),{}),[f]),b=y(m.createUserGroup,{onSuccess:()=>{p.invalidateQueries("userGroups"),l(!1),g.success(t("admin.groups.createSuccess","创建成功"))}}),C=y(({id:s,data:r})=>m.updateUserGroup(s,r),{onSuccess:()=>{p.invalidateQueries("userGroups"),l(!1),g.success(t("admin.groups.updateSuccess","更新成功"))}}),A=y(m.deleteUserGroup,{onSuccess:()=>{p.invalidateQueries("userGroups"),h({open:!1,group:null}),g.success(t("admin.groups.deleteSuccess","删除成功"))}}),S=s=>{i({...s,quotaFlat:s.quota_flat||{...N}}),l(!0)},k=()=>{i({name:"",code:"",is_default:!1,notes:"",quotaFlat:{...N}}),l(!0)},_=s=>{s.preventDefault();const r={name:a.name,code:a.code,is_default:a.is_default,notes:a.notes,quota_flat:a.quotaFlat||{}};a.id?C.mutate({id:a.id,data:r}):b.mutate(r)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:t("admin.groups.title","用户组管理")}),e.jsx("p",{className:"text-muted-foreground",children:t("admin.groups.description","管理用户组及配额设置")})]}),e.jsxs(x,{onClick:k,children:[e.jsx($,{className:"mr-2 h-4 w-4"}),t("admin.groups.create","创建用户组")]})]}),q?e.jsx(T,{className:"h-8 w-8 animate-spin mx-auto"}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.groups.name","名称")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.groups.code","代码")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.groups.isDefault","默认")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.groups.actions","操作")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n==null?void 0:n.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.is_default?t("common.yes","是"):t("common.no","否")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>S(s),children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>h({open:!0,group:s}),className:"text-red-600 hover:text-red-800",children:e.jsx(V,{className:"h-4 w-4"})})]})]},s.id))})]})}),e.jsx(M,{open:D,onOpenChange:l,children:e.jsxs(U,{className:"max-w-lg",children:[e.jsx(L,{children:e.jsx(Q,{children:a!=null&&a.id?t("admin.groups.edit","编辑用户组"):t("admin.groups.create","创建用户组")})}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:t("admin.groups.name","名称")}),e.jsx(j,{value:(a==null?void 0:a.name)||"",onChange:s=>i({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:t("admin.groups.code","代码")}),e.jsx(j,{value:(a==null?void 0:a.code)||"",onChange:s=>i({...a,code:s.target.value}),required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{checked:a==null?void 0:a.is_default,onCheckedChange:s=>i({...a,is_default:s})}),e.jsx(o,{children:t("admin.groups.setAsDefault","设为默认用户组")})]}),e.jsxs("div",{className:"space-y-3 border-t pt-3 border-b pb-3",children:[e.jsx(o,{className:"text-base font-semibold",children:t("admin.groups.quotaOverride","配额单独设置")}),Object.keys((a==null?void 0:a.quotaFlat)||{}).length>0?Object.entries(a.quotaFlat||{}).map(([s,r])=>e.jsxs("div",{children:[e.jsx(o,{className:"capitalize",children:t(`admin.quotas.${s}`,s.replace("."," "))}),e.jsx(j,{type:"number",value:r??"",onChange:c=>i({...a,quotaFlat:{...a.quotaFlat,[s]:c.target.value}}),placeholder:t("common.default","默认")})]},s)):e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.groups.noQuotasAvailable","暂无可配置的配额项目")})]}),e.jsxs("div",{children:[e.jsx(o,{children:t("admin.groups.notes","备注")}),e.jsx(E,{value:(a==null?void 0:a.notes)||"",onChange:s=>i({...a,notes:s.target.value})})]}),e.jsx(P,{children:e.jsx(x,{type:"submit",disabled:b.isLoading||C.isLoading,children:t("common.save","保存")})})]})]})}),e.jsx(z,{open:v.open,onOpenChange:s=>!s&&h({open:!1,group:null}),children:e.jsxs(B,{children:[e.jsxs(G,{children:[e.jsx(H,{children:t("admin.groups.confirmDelete","确认删除？")}),e.jsx(K,{children:t("admin.groups.deleteWarning","此操作无法撤销。该组下的用户将不再属于任何组（或回退到默认组）。")})]}),e.jsxs(R,{children:[e.jsx(W,{children:t("common.cancel","取消")}),e.jsx(Z,{onClick:()=>A.mutate(v.group.id),children:t("common.confirm","确认")})]})]})})]})}function xe(){return e.jsx(X,{})}export{xe as default};
