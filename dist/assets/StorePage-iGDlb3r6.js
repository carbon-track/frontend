import{j as e}from"./motion-vendor-C11-9Hm-.js";import{r as m}from"./react-vendor-CFnAvB5y.js";import{c as X,u as G,R as ae,J as re,o as R,B as f,X as U,I as Q,_ as ce,$ as ie,p as oe,a0 as J,T as me,P as xe,S as de,C as he,b as ge}from"./index-DTb_MiA2.js";import{C as O,a as Z,b as K,c as W,d as V}from"./Card-COwhRA1q.js";import{S as le}from"./star-DUSX8IaY.js";import{P as Y}from"./package-DkwMJtSZ.js";import{C as ue}from"./clock-D6XRiE4e.js";import{F as ee}from"./funnel-CH9oGJX7.js";import{A as se}from"./Alert-CAcIl8e7.js";import{C as pe}from"./circle-check-big-DY8MNPjT.js";import"./i18n-vendor-DK0x1_bH.js";import"./charts-vendor-DJkHj7pX.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],te=X("coins",fe);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],ye=X("history",je);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],ne=X("shopping-cart",Ne);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ve=X("tag",be);function we({product:s,onExchange:g,userPoints:C=0}){const{t:i}=G(),n=C>=s.points_required,w=s.is_available,b=s.stock>0||s.stock===-1,r=()=>s.stock===-1?i("store.unlimited"):s.stock===0?i("store.outOfStock"):s.stock<=5?i("store.lowStock",{count:s.stock}):i("store.inStock",{count:s.stock}),A=()=>s.stock===-1?"text-green-600":s.stock===0?"text-red-600":s.stock<=5?"text-orange-600":"text-green-600",T=()=>{const l={electronics:"ðŸ“±",books:"ðŸ“š",lifestyle:"ðŸŽ",food:"ðŸŽ",sports:"âš½",travel:"âœˆï¸",eco:"ðŸŒ±",default:"ðŸŽ"};return l[s.category]||l.default},N=l=>typeof l=="string"&&/^https?:\/\//.test(l),z=l=>{if(!l)return{src:null,path:null};if(typeof l=="string")return N(l)?{src:l,path:null}:{src:null,path:l};if(Array.isArray(l)&&l.length)return z(l[0]);if(typeof l=="object"){const S=typeof l.url=="string"&&l.url?l.url:typeof l.public_url=="string"?l.public_url:null,t=typeof l.presigned_url=="string"&&l.presigned_url?l.presigned_url:null;let c=(S&&N(S)?S:null)||t,o=typeof l.file_path=="string"&&l.file_path!==""?l.file_path:null;return!o&&S&&!N(S)&&(o=S),!o&&typeof l.path=="string"&&l.path!==""&&(o=l.path),{src:c,path:o}}return{src:null,path:null}},j=Array.isArray(s.images)&&s.images.length>0?s.images[0]:s.images,u=z(j),F=z(s.image_url||s.image_presigned_url||s.image_path),_=u.src||F.src,q=u.path||F.path,p=!!(_||q);return e.jsxs(O,{className:`h-full transition-all duration-200 hover:shadow-lg ${!w||!n?"opacity-75":"hover:scale-105"}`,children:[e.jsx(Z,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:T()}),e.jsxs("div",{children:[e.jsx(K,{className:"text-lg line-clamp-2",children:s.name}),e.jsx(W,{className:"text-sm text-gray-500",children:i(`store.categories.${s.category}`,s.category)})]})]}),s.is_featured&&e.jsxs("div",{className:"flex items-center space-x-1 bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs",children:[e.jsx(le,{className:"h-3 w-3 fill-current"}),e.jsx("span",{children:i("store.featured")})]})]})}),e.jsxs(V,{className:"space-y-4",children:[p&&e.jsx("div",{className:"aspect-video bg-gray-100 rounded-lg overflow-hidden",children:e.jsx(ae,{src:_||void 0,filePath:q||void 0,alt:s.name,className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:s.description}),Array.isArray(s.tags)&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tags.map((l,S)=>e.jsx(re,{variant:"secondary",className:"text-xs uppercase",children:l.name},`product-tag-${s.id}-${l.id??l.slug??S}`))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl font-bold text-green-600",children:R(s.points_required)}),e.jsx("span",{className:"text-sm text-gray-500",children:i("common.points")})]}),e.jsxs("div",{className:`flex items-center space-x-1 text-sm ${A()}`,children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:r()})]})]}),s.total_exchanged>0&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:i("store.exchangedCount",{count:s.total_exchanged})})]})]}),e.jsx("div",{className:"pt-2",children:w?b?n?e.jsxs(f,{onClick:()=>g(s),className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),i("store.exchange.button")]}):e.jsx(f,{disabled:!0,className:"w-full",children:e.jsxs("span",{className:"flex items-center justify-center space-x-2",children:[e.jsx("span",{children:i("store.insufficientPoints")}),e.jsxs("span",{className:"text-xs",children:["(",i("store.need")," ",R(s.points_required-C),")"]})]})}):e.jsx(f,{disabled:!0,className:"w-full",children:i("store.outOfStock")}):e.jsx(f,{disabled:!0,className:"w-full",children:i("store.unavailable")})}),n&&w&&b&&e.jsxs("div",{className:"text-xs text-center text-gray-500",children:[i("store.afterExchange"),": ",R(C-s.points_required)," ",i("common.points")]})]})]})}function Ce({product:s,userPoints:g,userEmail:C,isOpen:i,onClose:n,onConfirm:w,isLoading:b}){const{t:r}=G(),A=a=>typeof a=="string"&&/^https?:\/\//.test(a),T=a=>{if(!a)return{src:null,path:null};if(typeof a=="string")return A(a)?{src:a,path:null}:{src:null,path:a};if(Array.isArray(a)&&a.length)return T(a[0]);if(typeof a=="object"){const h=typeof a.url=="string"&&a.url?a.url:typeof a.public_url=="string"?a.public_url:null,k=typeof a.presigned_url=="string"&&a.presigned_url?a.presigned_url:null;let $=(h&&A(h)?h:null)||k,H=typeof a.file_path=="string"&&a.file_path!==""?a.file_path:null;return!H&&h&&!A(h)&&(H=h),!H&&typeof a.path=="string"&&a.path!==""&&(H=a.path),{src:$,path:H}}return{src:null,path:null}},[N,z]=m.useState(1),[j,u]=m.useState(""),[F,_]=m.useState(""),[q,p]=m.useState(""),[l,S]=m.useState(""),[t,c]=m.useState({});if(m.useEffect(()=>{i&&(z(1),u(C||""),_(""),p(""),S(""),c({}))},[i,s==null?void 0:s.id,C]),!i||!s)return null;const o=Array.isArray(s.images)&&s.images.length>0?s.images[0]:s.images,M=T(o),E=T(s.image_url||s.image_presigned_url||s.image_path),B=M.src||E.src,D=M.path||E.path,L=!!(B||D),y=s.points_required*N,d=g>=y,x=s.stock===-1?10:Math.min(s.stock,Math.floor(g/s.points_required)),v=()=>{const a={};(N<1||N>x)&&(a.quantity=r("store.exchange.invalidQuantity"));const h=j.trim(),k=F.trim(),$=q.trim();return h||(a.deliveryAddress=r("store.exchange.addressRequired")),$?(k?/^\+?\d{1,5}$/.test(k)||(a.contactAreaCode=r("store.exchange.invalidAreaCode")):a.contactAreaCode=r("store.exchange.areaCodeRequired"),/^[0-9\-\s]{5,20}$/.test($)||(a.contactPhone=r("store.exchange.invalidPhone"))):k&&(a.contactPhone=r("store.exchange.phoneRequiredWhenAreaCode")),c(a),Object.keys(a).length===0},P=a=>{if(a.preventDefault(),!v())return;const h=j.trim(),k=F.trim(),$=q.trim(),H=l.trim();w({product_id:s.id,quantity:N,delivery_address:h,contact_area_code:k||void 0,contact_phone:$||void 0,notes:H||void 0})},I=a=>{const h=Math.max(1,Math.min(x,parseInt(a)||1));z(h),t.quantity&&c(k=>({...k,quantity:null}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs(O,{className:"border-0 shadow-none",children:[e.jsxs(Z,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-xl",children:r("store.exchange.title")}),e.jsx(W,{children:r("store.exchange.subtitle")})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:n,className:"h-8 w-8 p-0",children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsxs(V,{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[L&&e.jsx(ae,{src:B||void 0,filePath:D||void 0,alt:s.name,className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-lg font-bold text-green-600",children:R(s.points_required)}),e.jsx("span",{className:"text-sm text-gray-500",children:r("common.points")})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:s.stock===-1?r("store.unlimited"):r("store.stock",{count:s.stock})})]})]})]})]})}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("store.exchange.quantity")}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(f,{type:"button",variant:"outline",size:"sm",onClick:()=>I(N-1),disabled:N<=1,children:"-"}),e.jsx(Q,{type:"number",min:"1",max:x,value:N,onChange:a=>I(a.target.value),className:"w-20 text-center"}),e.jsx(f,{type:"button",variant:"outline",size:"sm",onClick:()=>I(N+1),disabled:N>=x,children:"+"}),e.jsx("span",{className:"text-sm text-gray-500",children:r("store.exchange.maxQuantity",{max:x})})]}),t.quantity&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.quantity})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ce,{className:"h-4 w-4 inline mr-1"}),r("store.exchange.deliveryAddress")]}),e.jsx(Q,{type:"text",value:j,onChange:a=>{u(a.target.value),t.deliveryAddress&&c(h=>({...h,deliveryAddress:null}))},placeholder:r("store.exchange.addressPlaceholder"),className:t.deliveryAddress?"border-red-500":""}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:r("store.exchange.addressHint")}),t.deliveryAddress&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.deliveryAddress})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"h-4 w-4 inline mr-1"}),r("store.exchange.contactPhone")," (",r("common.optional"),")"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"md:w-32",children:[e.jsx(Q,{type:"text",value:F,onChange:a=>{const h=a.target.value;_(h),t.contactAreaCode&&c(k=>({...k,contactAreaCode:null}))},placeholder:r("store.exchange.areaCodePlaceholder"),className:t.contactAreaCode?"border-red-500":""}),t.contactAreaCode&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.contactAreaCode})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Q,{type:"tel",value:q,onChange:a=>{p(a.target.value),c(h=>({...h,contactPhone:null,contactAreaCode:null}))},placeholder:r("store.exchange.phonePlaceholder"),className:t.contactPhone?"border-red-500":""}),t.contactPhone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.contactPhone})]})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:r("store.exchange.phoneOptionalHint")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"h-4 w-4 inline mr-1"}),r("store.exchange.notes")," (",r("common.optional"),")"]}),e.jsx("textarea",{value:l,onChange:a=>S(a.target.value),placeholder:r("store.exchange.notesPlaceholder"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[r("store.exchange.unitPrice"),":"]}),e.jsxs("span",{children:[R(s.points_required)," ",r("common.points")]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[r("store.exchange.quantity"),":"]}),e.jsx("span",{children:N})]}),e.jsx("hr",{className:"border-gray-300"}),e.jsxs("div",{className:"flex justify-between items-center font-semibold text-lg",children:[e.jsxs("span",{children:[r("store.exchange.totalCost"),":"]}),e.jsxs("span",{className:"text-green-600",children:[R(y)," ",r("common.points")]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:[r("store.exchange.currentPoints"),":"]}),e.jsxs("span",{children:[R(g)," ",r("common.points")]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{children:[r("store.exchange.afterExchange"),":"]}),e.jsxs("span",{className:d?"text-green-600":"text-red-600",children:[R(g-y)," ",r("common.points")]})]})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:n,className:"flex-1",disabled:b,children:r("common.cancel")}),e.jsx(f,{type:"submit",disabled:!d||b,className:"flex-1 bg-green-600 hover:bg-green-700",children:b?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:r("store.exchange.processing")})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:r("store.exchange.confirm")})]})})]})]})]})]})})})}function _e({filters:s,onFiltersChange:g,categories:C=[],isLoading:i=!1}){const{t:n}=G(),w=m.useCallback(t=>{typeof t!="string"&&(t=t!=null?String(t):"");const c=t.trim().toLowerCase();return c?c.replace(/[^a-z0-9\-\s]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"tag-"+Math.random().toString(36).slice(2,8):""},[]),[b,r]=m.useState(""),[A,T]=m.useState([]),[N,z]=m.useState(!1),j=m.useMemo(()=>Array.isArray(s.tags)?s.tags:[],[s.tags]),u=(t,c)=>{g({...s,[t]:c,page:1})},F=()=>{g({search:"",category:"",min_points:"",max_points:"",sort:"created_at",page:1,limit:s.limit??12,tags:[]})},_=!!(s.search||s.category||s.min_points||s.max_points||j.length),q=m.useCallback(async t=>{var c,o;z(!0);try{const E=(o=(c=(await J.searchTags({search:t||"",limit:12})).data)==null?void 0:c.data)==null?void 0:o.tags;T(Array.isArray(E)?E:[])}catch(M){console.error("Failed to load tag suggestions",M),T([])}finally{z(!1)}},[]);m.useEffect(()=>{q("")},[q]),m.useEffect(()=>{const t=setTimeout(()=>{q(b.trim())},250);return()=>clearTimeout(t)},[b,q]);const p=t=>{const c=(t==null?void 0:t.name)||(t==null?void 0:t.label)||(t==null?void 0:t.value)||t,o=c!=null?String(c).trim():"",M=(t==null?void 0:t.slug)||(t==null?void 0:t.value)||t,E=w(M??o);if(!o||!E)return;const B={name:o,slug:E};!B||!B.slug||j.some(L=>(L.slug||L)===B.slug)||u("tags",j.concat([{name:B.name,slug:B.slug}]))},l=t=>{const c=j.slice();c.splice(t,1),u("tags",c)},S=[{value:"created_at",label:n("store.filters.sort.newest")},{value:"points_asc",label:n("store.filters.sort.pointsLowToHigh")},{value:"points_desc",label:n("store.filters.sort.pointsHighToLow")},{value:"popular",label:n("store.filters.sort.popular")},{value:"name",label:n("store.filters.sort.name")}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:n("store.filters.title")})]}),_&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:F,className:"text-gray-500 hover:text-gray-700",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),n("store.filters.clear")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Q,{type:"text",value:s.search,onChange:t=>u("search",t.target.value),placeholder:n("store.filters.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.category")}),e.jsxs("select",{value:s.category,onChange:t=>u("category",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:i,children:[e.jsx("option",{value:"",children:n("store.filters.allCategories")}),C.map((t,c)=>{const o=(t.slug||t.category||t.name||`category-${c}`).toString(),M=t.name||t.category||o,E=t.product_count??t.count??t.total??0;return e.jsxs("option",{value:o,children:[n(`store.categories.${o}`,M)," (",E,")"]},o)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.sortBy")}),e.jsx("select",{value:s.sort,onChange:t=>u("sort",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:i,children:S.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.pointsRange")}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Q,{type:"number",value:s.min_points,onChange:t=>u("min_points",t.target.value),placeholder:n("store.filters.minPoints"),className:"w-32",min:"0"}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx(Q,{type:"number",value:s.max_points,onChange:t=>u("max_points",t.target.value),placeholder:n("store.filters.maxPoints"),className:"w-32",min:"0"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-500"}),n("store.filters.tags")]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:j.map((t,c)=>e.jsxs(re,{variant:"secondary",className:"flex items-center gap-1 uppercase",children:[e.jsx("span",{children:t.name||t.slug}),e.jsx("button",{type:"button",className:"rounded-full p-0.5 hover:bg-gray-200",onClick:()=>l(c),"aria-label":n("store.filters.removeTag"),children:e.jsx(U,{className:"h-3 w-3"})})]},`selected-tag-${t.slug}-${c}`))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{value:b,onChange:t=>r(t.target.value),onKeyDown:t=>{if(t.key==="Enter"&&(t.preventDefault(),b.trim())){const c=b.trim();p({name:c,slug:w(c)}),r("")}},placeholder:n("store.filters.tagPlaceholder"),disabled:i}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>{if(b.trim()){const t=b.trim();p({name:t,slug:w(t)}),r("")}},disabled:!b.trim()||i,children:n("store.filters.addTag")})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:n("store.filters.tagHint")}),e.jsxs("div",{className:"mt-3 rounded-md border bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-3 py-2 text-xs font-medium uppercase tracking-wide text-gray-500",children:[e.jsx("span",{children:n("store.filters.suggestions")}),N?e.jsx(xe,{className:"h-3.5 w-3.5 animate-spin text-emerald-500"}):null]}),e.jsx("div",{className:"max-h-44 overflow-y-auto",children:A.length===0&&!N?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:n("store.filters.noTagSuggestions")}):A.map((t,c)=>e.jsxs("button",{type:"button",onClick:()=>{p(t),r("")},className:"flex w-full items-center justify-between px-3 py-2 text-left text-sm hover:bg-white",children:[e.jsx("span",{children:t.name}),t.slug?e.jsx("span",{className:"text-xs uppercase text-gray-400",children:t.slug}):null]},`tag-suggestion-${t.id??t.slug??t.name??c}`))})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(f,{variant:s.category?"outline":"default",size:"sm",onClick:()=>u("category",""),className:"text-xs",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),n("store.filters.allProducts")]}),C.slice(0,5).map((t,c)=>{const o=(t.slug||t.category||t.name||`category-${c}`).toString(),M=t.name||t.category||o,E=t.product_count??t.count??t.total??0;return e.jsxs(f,{variant:s.category===o?"default":"outline",size:"sm",onClick:()=>u("category",o),className:"text-xs",children:[n(`store.categories.${o}`,M),e.jsxs("span",{className:"ml-1 text-xs opacity-75",children:["(",E,")"]})]},o)}),e.jsxs(f,{variant:s.sort==="popular"?"default":"outline",size:"sm",onClick:()=>u("sort","popular"),className:"text-xs",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),n("store.filters.popular")]})]})}),_&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-blue-700",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("span",{children:[n("store.filters.activeFilters"),":"]})]})}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[s.search&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[n("store.filters.search"),': "',s.search,'"',e.jsx("button",{onClick:()=>u("search",""),className:"ml-1 hover:text-blue-600",children:e.jsx(U,{className:"h-3 w-3"})})]}),s.category&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[n(`store.categories.${s.category}`,s.category),e.jsx("button",{onClick:()=>u("category",""),className:"ml-1 hover:text-blue-600",children:e.jsx(U,{className:"h-3 w-3"})})]}),(s.min_points||s.max_points)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[s.min_points||0," - ",s.max_points||"âˆž"," ",n("common.points"),e.jsx("button",{onClick:()=>{u("min_points",""),u("max_points","")},className:"ml-1 hover:text-blue-600",children:e.jsx(U,{className:"h-3 w-3"})})]}),j.map((t,c)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[t.name||t.slug,e.jsx("button",{onClick:()=>l(c),className:"ml-1 hover:text-blue-600",children:e.jsx(U,{className:"h-3 w-3"})})]},`active-tag-${t.slug}-${c}`))]})]})]})}const ke=s=>{if(!s)return null;if(typeof s=="string"){const A=s.trim();if(!A)return null;const T=A.trim();return{name:A,category:A,slug:T,product_count:0}}const g=s.name??s.category??"",C=typeof g=="string"?g.trim():String(g||"").trim(),i=s.slug??s.category_slug??s.category??C,w=((typeof i=="string"?i.trim():String(i||"").trim())||C||"").toString().trim(),b=w&&w.toLowerCase(),r=s.product_count??s.count??s.total??0;return{...s,name:C||w,category:s.category??C??w,slug:b||w,product_count:r}};function He(){const{t:s}=G(),[g,C]=m.useState(null),[i,n]=m.useState([]),[w,b]=m.useState([]),[r,A]=m.useState(!0),[T,N]=m.useState(!1),[z,j]=m.useState(null),[u,F]=m.useState(null),[_,q]=m.useState({search:"",category:"",min_points:"",max_points:"",sort:"created_at",page:1,limit:12,tags:[]}),[p,l]=m.useState({page:1,pages:1,total:0}),[S,t]=m.useState(null),[c,o]=m.useState(!1);m.useEffect(()=>{(async()=>{try{const d=await ge();d.isAuthenticated&&C(d.user)}catch(d){console.error("Failed to fetch user:",d)}})()},[]),m.useEffect(()=>{M()},[_]),m.useEffect(()=>{E()},[]);const M=async()=>{var y,d;try{A(!0),j(null);const x={};Object.entries(_).forEach(([k,$])=>{if(k==="tags"){Array.isArray($)&&$.length&&(x.tags=$.map(H=>H.slug||H).join(","));return}$!==""&&$!==null&&$!==void 0&&(x[k]=$)});const v=await J.getProducts(x),P=((y=v.data)==null?void 0:y.data)??v.data,I=Array.isArray(P)?P:(P==null?void 0:P.products)??[],a=(Array.isArray(P)?null:P==null?void 0:P.pagination)||{},h={page:a.page??a.current_page??x.page??_.page??1,pages:a.pages??a.total_pages??1,total:a.total??a.total_items??I.length};((d=v.data)==null?void 0:d.success)!==!1?(n(I),l({page:h.page??1,pages:h.pages??1,total:h.total??I.length})):(n([]),l({page:1,pages:1,total:0}),j(s("store.errors.loadFailed")))}catch(x){console.error("Failed to fetch products:",x),j(s("store.errors.loadFailed"))}finally{A(!1)}},E=async()=>{var y,d;try{const x=await J.getCategories(),v=(y=x.data)==null?void 0:y.data,P=Array.isArray(v==null?void 0:v.categories)?v.categories:Array.isArray(v)?v:((d=x.data)==null?void 0:d.categories)||[],I=Array.isArray(P)?P.map(a=>ke(a)).filter(Boolean):[];b(I)}catch(x){console.error("Failed to fetch categories:",x)}},B=y=>{if(!g){j(s("store.errors.loginRequired"));return}t(y),o(!0)},D=async y=>{try{N(!0),j(null);const d=await J.exchangeProduct(y),{success:x,data:v,points_used:P,remaining_points:I}=d.data||{};if(x){const a=P??(v==null?void 0:v.points_used)??0,h=I??(v==null?void 0:v.remaining_points);F(s("store.exchange.success",{product:S.name,points:a})),C(k=>({...k,points:typeof h=="number"?h:k.points})),M(),o(!1),t(null)}else j(s("store.errors.exchangeFailed"))}catch(d){console.error("Exchange failed:",d),j(s("store.errors.exchangeFailed"))}finally{N(!1)}},L=y=>{q(d=>({...d,page:y})),window.scrollTo({top:0,behavior:"smooth"})};return g?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:s("store.title")}),e.jsx("p",{className:"text-gray-600",children:s("store.subtitle")})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx(O,{className:"bg-gradient-to-r from-green-500 to-blue-500 text-white",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:s("store.yourPoints")}),e.jsxs("p",{className:"text-2xl font-bold",children:[R(g.points)," ",s("common.points")]})]})]})})})})]})}),z&&e.jsxs(se,{variant:"destructive",className:"mb-6",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:z}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>j(null),className:"ml-auto",children:"Ã—"})]}),u&&e.jsxs(se,{variant:"default",className:"mb-6 border-green-200 bg-green-50 text-green-800",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:u}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>F(null),className:"ml-auto",children:"Ã—"})]}),e.jsx(_e,{filters:_,onFiltersChange:q,categories:w,isLoading:r}),r?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Array.from({length:8}).map((y,d)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsx("div",{className:"h-48 bg-gray-200 rounded-lg mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 mb-4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]})},d))}):i.length===0?e.jsx(O,{className:"text-center py-12",children:e.jsxs(V,{children:[e.jsx(Y,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx(K,{className:"text-xl text-gray-600 mb-2",children:s("store.noProducts.title")}),e.jsx(W,{children:s("store.noProducts.description")}),(_.search||_.category||_.min_points||_.max_points)&&e.jsx(f,{variant:"outline",onClick:()=>q({search:"",category:"",min_points:"",max_points:"",sort:"created_at",page:1,limit:12,tags:[]}),className:"mt-4",children:s("store.filters.clear")})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8",children:i.map(y=>e.jsx(we,{product:y,userPoints:g.points,onExchange:B},y.id))}),p.pages>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx(f,{variant:"outline",onClick:()=>L(p.page-1),disabled:p.page<=1,children:s("common.previous")}),e.jsx("div",{className:"flex space-x-1",children:Array.from({length:Math.min(5,p.pages)},(y,d)=>{let x;return p.pages<=5||p.page<=3?x=d+1:p.page>=p.pages-2?x=p.pages-4+d:x=p.page-2+d,e.jsx(f,{variant:p.page===x?"default":"outline",onClick:()=>L(x),className:"w-10",children:x},x)})}),e.jsx(f,{variant:"outline",onClick:()=>L(p.page+1),disabled:p.page>=p.pages,children:s("common.next")})]})]}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsxs(f,{variant:"outline",onClick:()=>window.location.href="/activities",className:"mr-4",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),s("store.viewExchangeHistory")]}),e.jsxs(f,{onClick:()=>window.location.href="/calculate",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),s("store.earnMorePoints")]})]})]}),e.jsx(Ce,{product:S,userPoints:(g==null?void 0:g.points)||0,userEmail:(g==null?void 0:g.email)||"",isOpen:c,onClose:()=>{o(!1),t(null)},onConfirm:D,isLoading:T})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(O,{className:"max-w-md w-full mx-4",children:[e.jsxs(Z,{className:"text-center",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx(K,{children:s("store.loginRequired.title")}),e.jsx(W,{children:s("store.loginRequired.description")})]}),e.jsx(V,{className:"text-center",children:e.jsx(f,{onClick:()=>window.location.href="/auth/login",children:s("auth.signIn")})})]})})}export{He as default};
