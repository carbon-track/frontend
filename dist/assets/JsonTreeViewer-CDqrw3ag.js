import{c as z,a2 as B,u as G,j as e,K as y,r as h,a as A,I as W,y as X,B as I,R as ee,G as te,bb as F,bc as U,bd as H}from"./index-Bx6Hir0b.js";import{C as se}from"./chevron-down-CzX0Y-bP.js";import{C as ae}from"./chevron-right-BJ2VXb6V.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]],re=z("chevrons-down",ne);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]],ie=z("chevrons-up",oe);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Y=z("copy",le);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],de=z("file-json",ce);async function we(t={}){const{q:n,date_from:i,date_to:m,types:a,limit_per_type:c,method:f,status_code:N,user_id:b,request_id:L,path:r,min_duration:d,max_duration:l,action:_,audit_status:w,error_type:x,model:j,source:s,actor_type:C,actor_id:V,llm_status:S,system_page:v,audit_page:o,error_page:q,llm_page:O}=t,p=new URLSearchParams;return n&&p.append("q",n),i&&p.append("date_from",i),m&&p.append("date_to",m),a!=null&&a.length&&p.append("types",a.join(",")),c&&p.append("limit_per_type",c),v&&p.append("system_page",v),o&&p.append("audit_page",o),q&&p.append("error_page",q),O&&p.append("llm_page",O),f&&p.append("method",f),N&&p.append("status_code",N),b&&p.append("user_id",b),L&&p.append("request_id",L),r&&p.append("path",r),d&&p.append("min_duration",d),l&&p.append("max_duration",l),_&&p.append("action",_),w&&p.append("audit_status",w),x&&p.append("error_type",x),j&&p.append("model",j),s&&p.append("source",s),C&&p.append("actor_type",C),V&&p.append("actor_id",V),S&&p.append("llm_status",S),(await B.get(`/admin/logs/search?${p.toString()}`)).data}async function ve(t){return t?(await B.get(`/admin/logs/related?request_id=${encodeURIComponent(t)}`)).data:{system:[],audit:[],error:[],llm:[]}}async function Ne(t={},n="csv"){const{q:i,date_from:m,date_to:a,types:c,method:f,status_code:N,user_id:b,request_id:L,path:r,min_duration:d,max_duration:l,action:_,audit_status:w,error_type:x,model:j,source:s,actor_type:C,actor_id:V,llm_status:S,max:v}=t,o=new URLSearchParams;return i&&o.append("q",i),m&&o.append("date_from",m),a&&o.append("date_to",a),c!=null&&c.length&&o.append("types",c.join(",")),f&&o.append("method",f),N&&o.append("status_code",N),b&&o.append("user_id",b),L&&o.append("request_id",L),r&&o.append("path",r),d&&o.append("min_duration",d),l&&o.append("max_duration",l),_&&o.append("action",_),w&&o.append("audit_status",w),x&&o.append("error_type",x),j&&o.append("model",j),s&&o.append("source",s),C&&o.append("actor_type",C),V&&o.append("actor_id",V),S&&o.append("llm_status",S),v&&o.append("max",v),o.append("format",n),(await B.get(`/admin/logs/export?${o.toString()}`,{responseType:"blob"})).data}function pe({open:t,onClose:n,requestId:i,data:m,loading:a,onRefresh:c,system:f,audit:N,error:b,llm:L}){const{t:r}=G();if(!t)return null;const d=m??{system:f,audit:N,error:b,llm:L},l=(d==null?void 0:d.system)||[],_=(d==null?void 0:d.audit)||[],w=(d==null?void 0:d.error)||[],x=(d==null?void 0:d.llm)||[],j=()=>e.jsx("div",{className:"text-xs text-muted-foreground",children:r("common.none")});return e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"flex-1 bg-black/40",onClick:n}),e.jsxs("div",{className:"w-full max-w-3xl h-full bg-white shadow-xl flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-lg",children:r("admin.systemLogs.drawer.title",{id:i})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-sm text-blue-600",onClick:c,children:r("admin.systemLogs.drawer.refresh")}),e.jsx("button",{className:"text-gray-500",onClick:n,"aria-label":r("common.close"),children:"×"})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-6 text-sm",children:[a&&e.jsx("div",{children:r("admin.systemLogs.drawer.loading")}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs(M,{title:r("admin.systemLogs.drawer.systemTitle",{count:l.length}),children:[l.length===0&&j(),l.map(s=>e.jsx("div",{className:"border rounded p-2 mb-2 bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-[11px]",children:[e.jsx(g,{label:r("admin.systemLogs.columns.method"),value:s.method}),e.jsx(g,{label:r("admin.systemLogs.columns.path"),value:s.path}),e.jsx(g,{label:r("admin.systemLogs.columns.status_code"),value:s.status_code}),e.jsx(g,{label:r("admin.systemLogs.columns.duration_ms"),value:s.duration_ms})]})},s.id))]}),e.jsxs(M,{title:r("admin.systemLogs.drawer.auditTitle",{count:_.length}),children:[_.length===0&&j(),_.map(s=>e.jsx("div",{className:"border rounded p-2 mb-2 bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-[11px]",children:[e.jsx(g,{label:r("admin.systemLogs.columns.id"),value:s.id}),e.jsx(g,{label:r("admin.systemLogs.columns.action"),value:s.action}),e.jsx(g,{label:r("admin.systemLogs.columns.operation_category"),value:s.operation_category}),e.jsx(g,{label:r("admin.systemLogs.columns.actor_type"),value:s.actor_type}),e.jsx(g,{label:r("admin.systemLogs.columns.status"),value:s.status})]})},s.id))]}),e.jsxs(M,{title:r("admin.systemLogs.drawer.errorsTitle",{count:w.length}),children:[w.length===0&&j(),w.map(s=>e.jsxs("div",{className:"border rounded p-2 mb-2 bg-rose-50/60",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-[11px]",children:[e.jsx(g,{label:r("admin.systemLogs.columns.error_type"),value:s.error_type}),e.jsx(g,{label:r("admin.systemLogs.columns.error_file"),value:s.error_file}),e.jsx(g,{label:r("admin.systemLogs.columns.error_line"),value:s.error_line})]}),s.error_message&&e.jsx("div",{className:"font-mono text-[11px] break-all mt-1 text-muted-foreground",children:s.error_message})]},s.id))]}),e.jsxs(M,{title:r("admin.systemLogs.drawer.llmTitle",{count:x.length}),children:[x.length===0&&j(),x.map(s=>e.jsxs("div",{className:"border rounded p-2 mb-2 bg-indigo-50/60",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-[11px]",children:[e.jsx(g,{label:r("admin.systemLogs.columns.actor_type"),value:s.actor_type}),e.jsx(g,{label:r("admin.systemLogs.columns.actor_id"),value:s.actor_id}),e.jsx(g,{label:r("admin.systemLogs.columns.model"),value:s.model}),e.jsx(g,{label:r("admin.systemLogs.columns.llm_status"),value:s.status}),e.jsx(g,{label:r("admin.systemLogs.columns.total_tokens"),value:s.total_tokens}),e.jsx(g,{label:r("admin.systemLogs.columns.latency_ms"),value:s.latency_ms})]}),s.prompt&&e.jsx("div",{className:"font-mono text-[11px] break-all mt-1 text-muted-foreground",children:(typeof s.prompt=="string"?s.prompt:JSON.stringify(s.prompt)).slice(0,240)})]},s.id))]})]})]})]})]})}function M({title:t,children:n}){return e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:t}),n]})}function g({label:t,value:n}){return e.jsxs("div",{children:[e.jsxs("span",{className:"text-muted-foreground mr-1",children:[t,":"]}),e.jsx("span",{className:"font-mono",children:String(n??"-")})]})}pe.propTypes={open:y.bool,onClose:y.func,requestId:y.string,data:y.object,loading:y.bool,onRefresh:y.func,system:y.array,audit:y.array,error:y.array,llm:y.array};M.propTypes={title:y.node,children:y.node};g.propTypes={label:y.node,value:y.any};const ue=[],$="$";function R(t){return t===null?"null":Array.isArray(t)?"array":typeof t}function D(t){return t==="object"||t==="array"}function me(t,n){switch(n){case"string":return`"${t}"`;case"number":case"boolean":return String(t);case"null":return"null";case"undefined":return"undefined";default:return String(t)}}function xe(t){switch(t){case"string":return"text-emerald-600";case"number":return"text-sky-600";case"boolean":return"text-purple-600";case"null":case"undefined":return"text-muted-foreground";default:return"text-foreground"}}function J(t){return!t||t.length===0?$:`${$}${t.map(n=>typeof n=="number"?`[${n}]`:`.${n}`).join("")}`}function fe(t){return!t||t.length===0?$:t.reduce((n,i)=>typeof i=="number"?`${n}[${i}]`:`${n}.${i}`,$)}function Z(t,n=[],i=new Set){const m=R(t);return D(m)&&(i.add(J(n)),(m==="array"?t.map((c,f)=>[f,c]):Object.entries(t||{})).forEach(([c,f])=>{Z(f,n.concat(c),i)})),i}function K(t,n,i=[],m=[]){if(n==="")return m;const a=R(t);return a==="object"?Object.entries(t||{}).forEach(([c,f])=>{c.toLowerCase().includes(n)&&m.push(i.concat(c)),K(f,n,i.concat(c),m)}):a==="array"?t.forEach((c,f)=>{K(c,n,i.concat(f),m)}):String(t??"").toLowerCase().includes(n)&&m.push(i),m}function he(t){const n=[];for(let i=0;i<=t.length;i+=1)n.push(J(t.slice(0,i)));return n}function ye(t,n){return t===void 0?n:typeof t=="number"?`[${t}]`:t}const Q=ee.memo(function t({name:n,value:i,path:m,searchTerm:a,labels:c,typeLabels:f,expandedPaths:N,onToggle:b,onCopyPath:L,onCopyValue:r}){const d=R(i),l=D(d),_=J(m),w=N.has(_),x=ye(n,c.root),j=h.useMemo(()=>l?d==="array"?i.map((v,o)=>[o,v]):Object.entries(i||{}):[],[l,d,i]),s=l?"":String(i??""),C=!!(a&&(x&&x.toLowerCase().includes(a)||!l&&s.toLowerCase().includes(a))),V=f[d]||f.unknown,S=l?`${j.length}`:void 0;return e.jsxs("div",{className:A("group relative border-l border-muted-foreground/20 pl-3",C&&"bg-amber-50/60"),children:[e.jsxs("div",{className:"flex items-start gap-2 py-1",children:[e.jsx("button",{type:"button",className:A("mt-1 flex h-4 w-4 items-center justify-center rounded text-muted-foreground transition hover:bg-muted hover:text-foreground",!l&&"opacity-0"),onClick:()=>l&&b(m),"aria-label":w?c.collapse:c.expand,children:w?e.jsx(se,{className:"h-3 w-3"}):e.jsx(ae,{className:"h-3 w-3"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"font-mono text-[12px] text-foreground",children:x}),e.jsxs(te,{variant:"secondary",className:"text-[10px] uppercase tracking-wide",children:[V,S?` · ${S}`:""]})]}),!l&&e.jsx("div",{className:A("font-mono text-[11px] break-all",xe(d)),children:me(i,d)})]}),e.jsxs("div",{className:"flex items-center gap-1 pt-0.5 opacity-0 transition group-hover:opacity-100",children:[e.jsxs(F,{children:[e.jsx(U,{asChild:!0,children:e.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded text-muted-foreground hover:bg-muted hover:text-foreground",onClick:()=>L(m),"aria-label":c.copyPath,children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsx(H,{children:c.copyPath})]}),e.jsxs(F,{children:[e.jsx(U,{asChild:!0,children:e.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded text-muted-foreground hover:bg-muted hover:text-foreground",onClick:()=>r(i),"aria-label":c.copyValue,children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsx(H,{children:c.copyValue})]})]})]}),l&&w&&j.length>0&&e.jsx("div",{className:"pl-4",children:j.map(([v,o])=>e.jsx(t,{name:v,value:o,path:m.concat(v),searchTerm:a,labels:c,typeLabels:f,expandedPaths:N,onToggle:b,onCopyPath:L,onCopyValue:r},typeof v=="number"?v:String(v)))})]})});Q.displayName="JsonNode";function ge({value:t,collapsed:n=!1,maxHeight:i="20rem",className:m}){const{t:a}=G(),[c,f]=h.useState(""),[N,b]=h.useState(new Set([$])),[L,r]=h.useState(""),d=h.useRef(),l=h.useMemo(()=>t,[t]),_=c.trim().toLowerCase(),w=h.useMemo(()=>({object:a("jsonViewer.typeLabels.object"),array:a("jsonViewer.typeLabels.array"),string:a("jsonViewer.typeLabels.string"),number:a("jsonViewer.typeLabels.number"),boolean:a("jsonViewer.typeLabels.boolean"),null:a("jsonViewer.typeLabels.null"),undefined:a("jsonViewer.typeLabels.undefined"),unknown:a("jsonViewer.typeLabels.unknown")}),[a]),x=h.useMemo(()=>({root:a("jsonViewer.root"),searchPlaceholder:a("jsonViewer.searchPlaceholder"),expandAll:a("jsonViewer.expandAll"),collapseAll:a("jsonViewer.collapseAll"),copyJson:a("jsonViewer.copyJson"),copyPath:a("jsonViewer.copyPath"),copyValue:a("jsonViewer.copyValue"),expand:a("jsonViewer.expandNode"),collapse:a("jsonViewer.collapseNode"),copied:a("jsonViewer.copied"),noData:a("jsonViewer.noData")}),[a]),j=h.useMemo(()=>{const u=new Set([$]);return n||(R(l)==="array"?l.map((T,P)=>[P,l[P]]):Object.entries(l||{})).forEach(([T,P])=>{D(R(P))&&u.add(J([T]))}),u},[l,n]);h.useEffect(()=>{b(j)},[j]);const s=h.useCallback(u=>{r(u),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>r(""),1200)},[]);h.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]),h.useEffect(()=>{if(!_)return;const u=K(l,_);u.length!==0&&b(k=>{const E=new Set(k);return u.forEach(T=>{he(T).forEach(P=>E.add(P))}),E})},[l,_]);const C=h.useMemo(()=>Z(l),[l]),V=h.useCallback(u=>{const k=J(u);b(E=>{const T=new Set(E);return T.has(k)?T.delete(k):T.add(k),T})},[]),S=h.useCallback(()=>{b(new Set(C))},[C]),v=h.useCallback(()=>{b(new Set([$]))},[]),o=h.useCallback(u=>{var k;!u&&u!==""||typeof navigator<"u"&&((k=navigator.clipboard)!=null&&k.writeText)&&navigator.clipboard.writeText(u).then(()=>{s(x.copied)}).catch(()=>{})},[x.copied,s]),q=h.useCallback(()=>{try{const u=JSON.stringify(l,null,2);o(u)}catch{o(String(l))}},[o,l]),O=h.useCallback(u=>{o(fe(u))},[o]),p=h.useCallback(u=>{const k=R(u),E=D(k)?JSON.stringify(u,null,2):String(u??"");o(E)},[o]);return e.jsxs("div",{className:A("border rounded bg-background text-xs shadow-sm",m),style:{maxHeight:i,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex items-center gap-2 border-b bg-muted/30 px-2 py-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{value:c,onChange:u=>f(u.target.value),placeholder:x.searchPlaceholder,className:"h-8 w-full pl-7 text-xs"}),e.jsx("span",{className:"pointer-events-none absolute left-2 top-1/2 flex -translate-y-1/2 text-muted-foreground",children:e.jsx(X,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{size:"icon",variant:"ghost",onClick:S,className:"h-8 w-8","aria-label":x.expandAll,children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(I,{size:"icon",variant:"ghost",onClick:v,className:"h-8 w-8","aria-label":x.collapseAll,children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(I,{size:"icon",variant:"ghost",onClick:q,className:"h-8 w-8","aria-label":x.copyJson,children:e.jsx(Y,{className:"h-4 w-4"})})]}),L&&e.jsx("span",{className:"ml-2 text-[10px] text-muted-foreground",children:L})]}),e.jsx("div",{className:"flex-1 overflow-auto px-2 py-2",children:l==null?e.jsx("div",{className:"text-xs text-muted-foreground",children:x.noData}):e.jsx(Q,{name:x.root,value:l,path:ue,searchTerm:_,labels:x,typeLabels:w,expandedPaths:N,onToggle:V,onCopyPath:O,onCopyValue:p})})]})}ge.propTypes={value:y.any,collapsed:y.bool,maxHeight:y.oneOfType([y.string,y.number]),className:y.string};export{ge as J,pe as R,Ne as e,ve as f,we as s};
