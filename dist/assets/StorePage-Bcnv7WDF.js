import{j as e}from"./motion-vendor-C11-9Hm-.js";import{r as o}from"./react-vendor-CFnAvB5y.js";import{c as X,u as G,R as ae,J as re,o as H,B as f,X as Q,I as L,_ as ce,$ as ie,p as oe,a0 as J,T as me,P as xe,S as de,C as he,b as ge}from"./index-CQ91Xfn2.js";import{C as D,a as Z,b as K,c as W,d as O}from"./Card-CvB_sIzW.js";import{S as le}from"./star-D832Efi9.js";import{P as Y}from"./package-DOep28z1.js";import{C as ue}from"./clock-xsfGEZBf.js";import{F as ee}from"./funnel-Bu-95anb.js";import{A as se}from"./Alert-B9j1D3yi.js";import{C as pe}from"./circle-check-big-BEnwQz6W.js";import"./i18n-vendor-DK0x1_bH.js";import"./charts-vendor-DJkHj7pX.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],te=X("coins",fe);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],ye=X("history",je);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],ne=X("shopping-cart",be);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ve=X("tag",Ne);function we({product:s,onExchange:h,userPoints:k=0}){const{t:i}=G(),n=k>=s.points_required,w=s.is_available,N=s.stock>0||s.stock===-1,r=()=>s.stock===-1?i("store.unlimited"):s.stock===0?i("store.outOfStock"):s.stock<=5?i("store.lowStock",{count:s.stock}):i("store.inStock",{count:s.stock}),S=()=>s.stock===-1?"text-green-600":s.stock===0?"text-red-600":s.stock<=5?"text-orange-600":"text-green-600",T=()=>{const c={electronics:"ðŸ“±",books:"ðŸ“š",lifestyle:"ðŸŽ",food:"ðŸŽ",sports:"âš½",travel:"âœˆï¸",eco:"ðŸŒ±",default:"ðŸŽ"};return c[s.category]||c.default},b=c=>typeof c=="string"&&/^https?:\/\//.test(c),z=c=>{if(!c)return{src:null,path:null};if(typeof c=="string")return b(c)?{src:c,path:null}:{src:null,path:c};if(Array.isArray(c)&&c.length)return z(c[0]);if(typeof c=="object"){const P=typeof c.public_url=="string"&&c.public_url?c.public_url:typeof c.url=="string"&&c.url?c.url:null;let t=P&&b(P)?P:null,l=typeof c.file_path=="string"&&c.file_path!==""?c.file_path:null;return!l&&P&&!b(P)&&(l=P),!l&&typeof c.path=="string"&&c.path!==""&&(l=c.path),{src:t,path:l}}return{src:null,path:null}},j=Array.isArray(s.images)&&s.images.length>0?s.images[0]:s.images,u=z(j),F=z(s.image_url||s.image_path),_=u.src||F.src,M=u.path||F.path,p=!!(_||M);return e.jsxs(D,{className:`h-full transition-all duration-200 hover:shadow-lg ${!w||!n?"opacity-75":"hover:scale-105"}`,children:[e.jsx(Z,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:T()}),e.jsxs("div",{children:[e.jsx(K,{className:"text-lg line-clamp-2",children:s.name}),e.jsx(W,{className:"text-sm text-gray-500",children:i(`store.categories.${s.category}`,s.category)})]})]}),s.is_featured&&e.jsxs("div",{className:"flex items-center space-x-1 bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs",children:[e.jsx(le,{className:"h-3 w-3 fill-current"}),e.jsx("span",{children:i("store.featured")})]})]})}),e.jsxs(O,{className:"space-y-4",children:[p&&e.jsx("div",{className:"aspect-video bg-gray-100 rounded-lg overflow-hidden",children:e.jsx(ae,{src:_||void 0,filePath:M||void 0,alt:s.name,className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:s.description}),Array.isArray(s.tags)&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tags.map((c,P)=>e.jsx(re,{variant:"secondary",className:"text-xs uppercase",children:c.name},`product-tag-${s.id}-${c.id??c.slug??P}`))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl font-bold text-green-600",children:H(s.points_required)}),e.jsx("span",{className:"text-sm text-gray-500",children:i("common.points")})]}),e.jsxs("div",{className:`flex items-center space-x-1 text-sm ${S()}`,children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:r()})]})]}),s.total_exchanged>0&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:i("store.exchangedCount",{count:s.total_exchanged})})]})]}),e.jsx("div",{className:"pt-2",children:w?N?n?e.jsxs(f,{onClick:()=>h(s),className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),i("store.exchange.button")]}):e.jsx(f,{disabled:!0,className:"w-full",children:e.jsxs("span",{className:"flex items-center justify-center space-x-2",children:[e.jsx("span",{children:i("store.insufficientPoints")}),e.jsxs("span",{className:"text-xs",children:["(",i("store.need")," ",H(s.points_required-k),")"]})]})}):e.jsx(f,{disabled:!0,className:"w-full",children:i("store.outOfStock")}):e.jsx(f,{disabled:!0,className:"w-full",children:i("store.unavailable")})}),n&&w&&N&&e.jsxs("div",{className:"text-xs text-center text-gray-500",children:[i("store.afterExchange"),": ",H(k-s.points_required)," ",i("common.points")]})]})]})}function Ce({product:s,userPoints:h,userEmail:k,isOpen:i,onClose:n,onConfirm:w,isLoading:N}){const{t:r}=G(),S=a=>typeof a=="string"&&/^https?:\/\//.test(a),T=a=>{if(!a)return{src:null,path:null};if(typeof a=="string")return S(a)?{src:a,path:null}:{src:null,path:a};if(Array.isArray(a)&&a.length)return T(a[0]);if(typeof a=="object"){const d=typeof a.public_url=="string"&&a.public_url?a.public_url:typeof a.url=="string"&&a.url?a.url:null;let A=d&&S(d)?d:null,C=typeof a.file_path=="string"&&a.file_path!==""?a.file_path:null;return!C&&d&&!S(d)&&(C=d),!C&&typeof a.path=="string"&&a.path!==""&&(C=a.path),{src:A,path:C}}return{src:null,path:null}},[b,z]=o.useState(1),[j,u]=o.useState(""),[F,_]=o.useState(""),[M,p]=o.useState(""),[c,P]=o.useState(""),[t,l]=o.useState({});if(o.useEffect(()=>{i&&(z(1),u(k||""),_(""),p(""),P(""),l({}))},[i,s==null?void 0:s.id,k]),!i||!s)return null;const g=Array.isArray(s.images)&&s.images.length>0?s.images[0]:s.images,E=T(g),$=T(s.image_url||s.image_path),B=E.src||$.src,U=E.path||$.path,R=!!(B||U),y=s.points_required*b,x=h>=y,m=s.stock===-1?10:Math.min(s.stock,Math.floor(h/s.points_required)),v=()=>{const a={};(b<1||b>m)&&(a.quantity=r("store.exchange.invalidQuantity"));const d=j.trim(),A=F.trim(),C=M.trim();return d||(a.deliveryAddress=r("store.exchange.addressRequired")),C?(A?/^\+?\d{1,5}$/.test(A)||(a.contactAreaCode=r("store.exchange.invalidAreaCode")):a.contactAreaCode=r("store.exchange.areaCodeRequired"),/^[0-9\-\s]{5,20}$/.test(C)||(a.contactPhone=r("store.exchange.invalidPhone"))):A&&(a.contactPhone=r("store.exchange.phoneRequiredWhenAreaCode")),l(a),Object.keys(a).length===0},q=a=>{if(a.preventDefault(),!v())return;const d=j.trim(),A=F.trim(),C=M.trim(),V=c.trim();w({product_id:s.id,quantity:b,delivery_address:d,contact_area_code:A||void 0,contact_phone:C||void 0,notes:V||void 0})},I=a=>{const d=Math.max(1,Math.min(m,parseInt(a)||1));z(d),t.quantity&&l(A=>({...A,quantity:null}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs(D,{className:"border-0 shadow-none",children:[e.jsxs(Z,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-xl",children:r("store.exchange.title")}),e.jsx(W,{children:r("store.exchange.subtitle")})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:n,className:"h-8 w-8 p-0",children:e.jsx(Q,{className:"h-4 w-4"})})]}),e.jsxs(O,{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[R&&e.jsx(ae,{src:B||void 0,filePath:U||void 0,alt:s.name,className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-lg font-bold text-green-600",children:H(s.points_required)}),e.jsx("span",{className:"text-sm text-gray-500",children:r("common.points")})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:s.stock===-1?r("store.unlimited"):r("store.stock",{count:s.stock})})]})]})]})]})}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("store.exchange.quantity")}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(f,{type:"button",variant:"outline",size:"sm",onClick:()=>I(b-1),disabled:b<=1,children:"-"}),e.jsx(L,{type:"number",min:"1",max:m,value:b,onChange:a=>I(a.target.value),className:"w-20 text-center"}),e.jsx(f,{type:"button",variant:"outline",size:"sm",onClick:()=>I(b+1),disabled:b>=m,children:"+"}),e.jsx("span",{className:"text-sm text-gray-500",children:r("store.exchange.maxQuantity",{max:m})})]}),t.quantity&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.quantity})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ce,{className:"h-4 w-4 inline mr-1"}),r("store.exchange.deliveryAddress")]}),e.jsx(L,{type:"text",value:j,onChange:a=>{u(a.target.value),t.deliveryAddress&&l(d=>({...d,deliveryAddress:null}))},placeholder:r("store.exchange.addressPlaceholder"),className:t.deliveryAddress?"border-red-500":""}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:r("store.exchange.addressHint")}),t.deliveryAddress&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.deliveryAddress})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"h-4 w-4 inline mr-1"}),r("store.exchange.contactPhone")," (",r("common.optional"),")"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"md:w-32",children:[e.jsx(L,{type:"text",value:F,onChange:a=>{const d=a.target.value;_(d),t.contactAreaCode&&l(A=>({...A,contactAreaCode:null}))},placeholder:r("store.exchange.areaCodePlaceholder"),className:t.contactAreaCode?"border-red-500":""}),t.contactAreaCode&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.contactAreaCode})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(L,{type:"tel",value:M,onChange:a=>{p(a.target.value),l(d=>({...d,contactPhone:null,contactAreaCode:null}))},placeholder:r("store.exchange.phonePlaceholder"),className:t.contactPhone?"border-red-500":""}),t.contactPhone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.contactPhone})]})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:r("store.exchange.phoneOptionalHint")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"h-4 w-4 inline mr-1"}),r("store.exchange.notes")," (",r("common.optional"),")"]}),e.jsx("textarea",{value:c,onChange:a=>P(a.target.value),placeholder:r("store.exchange.notesPlaceholder"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[r("store.exchange.unitPrice"),":"]}),e.jsxs("span",{children:[H(s.points_required)," ",r("common.points")]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[r("store.exchange.quantity"),":"]}),e.jsx("span",{children:b})]}),e.jsx("hr",{className:"border-gray-300"}),e.jsxs("div",{className:"flex justify-between items-center font-semibold text-lg",children:[e.jsxs("span",{children:[r("store.exchange.totalCost"),":"]}),e.jsxs("span",{className:"text-green-600",children:[H(y)," ",r("common.points")]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:[r("store.exchange.currentPoints"),":"]}),e.jsxs("span",{children:[H(h)," ",r("common.points")]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{children:[r("store.exchange.afterExchange"),":"]}),e.jsxs("span",{className:x?"text-green-600":"text-red-600",children:[H(h-y)," ",r("common.points")]})]})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:n,className:"flex-1",disabled:N,children:r("common.cancel")}),e.jsx(f,{type:"submit",disabled:!x||N,className:"flex-1 bg-green-600 hover:bg-green-700",children:N?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:r("store.exchange.processing")})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:r("store.exchange.confirm")})]})})]})]})]})]})})})}function ke({filters:s,onFiltersChange:h,categories:k=[],isLoading:i=!1}){const{t:n}=G(),w=o.useCallback(t=>{typeof t!="string"&&(t=t!=null?String(t):"");const l=t.trim().toLowerCase();return l?l.replace(/[^a-z0-9\-\s]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"tag-"+Math.random().toString(36).slice(2,8):""},[]),[N,r]=o.useState(""),[S,T]=o.useState([]),[b,z]=o.useState(!1),j=o.useMemo(()=>Array.isArray(s.tags)?s.tags:[],[s.tags]),u=(t,l)=>{h({...s,[t]:l,page:1})},F=()=>{h({search:"",category:"",min_points:"",max_points:"",sort:"created_at",page:1,limit:s.limit??12,tags:[]})},_=!!(s.search||s.category||s.min_points||s.max_points||j.length),M=o.useCallback(async t=>{var l,g;z(!0);try{const $=(g=(l=(await J.searchTags({search:t||"",limit:12})).data)==null?void 0:l.data)==null?void 0:g.tags;T(Array.isArray($)?$:[])}catch(E){console.error("Failed to load tag suggestions",E),T([])}finally{z(!1)}},[]);o.useEffect(()=>{M("")},[M]),o.useEffect(()=>{const t=setTimeout(()=>{M(N.trim())},250);return()=>clearTimeout(t)},[N,M]);const p=t=>{const l=(t==null?void 0:t.name)||(t==null?void 0:t.label)||(t==null?void 0:t.value)||t,g=l!=null?String(l).trim():"",E=(t==null?void 0:t.slug)||(t==null?void 0:t.value)||t,$=w(E??g);if(!g||!$)return;const B={name:g,slug:$};!B||!B.slug||j.some(R=>(R.slug||R)===B.slug)||u("tags",j.concat([{name:B.name,slug:B.slug}]))},c=t=>{const l=j.slice();l.splice(t,1),u("tags",l)},P=[{value:"created_at",label:n("store.filters.sort.newest")},{value:"points_asc",label:n("store.filters.sort.pointsLowToHigh")},{value:"points_desc",label:n("store.filters.sort.pointsHighToLow")},{value:"popular",label:n("store.filters.sort.popular")},{value:"name",label:n("store.filters.sort.name")}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:n("store.filters.title")})]}),_&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:F,className:"text-gray-500 hover:text-gray-700",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),n("store.filters.clear")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(L,{type:"text",value:s.search,onChange:t=>u("search",t.target.value),placeholder:n("store.filters.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.category")}),e.jsxs("select",{value:s.category,onChange:t=>u("category",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:i,children:[e.jsx("option",{value:"",children:n("store.filters.allCategories")}),k.map((t,l)=>{const g=(t.slug||t.category||t.name||`category-${l}`).toString(),E=t.name||t.category||g,$=t.product_count??t.count??t.total??0;return e.jsxs("option",{value:g,children:[n(`store.categories.${g}`,E)," (",$,")"]},g)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.sortBy")}),e.jsx("select",{value:s.sort,onChange:t=>u("sort",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:i,children:P.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.pointsRange")}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{type:"number",value:s.min_points,onChange:t=>u("min_points",t.target.value),placeholder:n("store.filters.minPoints"),className:"w-32",min:"0"}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx(L,{type:"number",value:s.max_points,onChange:t=>u("max_points",t.target.value),placeholder:n("store.filters.maxPoints"),className:"w-32",min:"0"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-500"}),n("store.filters.tags")]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:j.map((t,l)=>e.jsxs(re,{variant:"secondary",className:"flex items-center gap-1 uppercase",children:[e.jsx("span",{children:t.name||t.slug}),e.jsx("button",{type:"button",className:"rounded-full p-0.5 hover:bg-gray-200",onClick:()=>c(l),"aria-label":n("store.filters.removeTag"),children:e.jsx(Q,{className:"h-3 w-3"})})]},`selected-tag-${t.slug}-${l}`))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{value:N,onChange:t=>r(t.target.value),onKeyDown:t=>{if(t.key==="Enter"&&(t.preventDefault(),N.trim())){const l=N.trim();p({name:l,slug:w(l)}),r("")}},placeholder:n("store.filters.tagPlaceholder"),disabled:i}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>{if(N.trim()){const t=N.trim();p({name:t,slug:w(t)}),r("")}},disabled:!N.trim()||i,children:n("store.filters.addTag")})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:n("store.filters.tagHint")}),e.jsxs("div",{className:"mt-3 rounded-md border bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-3 py-2 text-xs font-medium uppercase tracking-wide text-gray-500",children:[e.jsx("span",{children:n("store.filters.suggestions")}),b?e.jsx(xe,{className:"h-3.5 w-3.5 animate-spin text-emerald-500"}):null]}),e.jsx("div",{className:"max-h-44 overflow-y-auto",children:S.length===0&&!b?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:n("store.filters.noTagSuggestions")}):S.map((t,l)=>e.jsxs("button",{type:"button",onClick:()=>{p(t),r("")},className:"flex w-full items-center justify-between px-3 py-2 text-left text-sm hover:bg-white",children:[e.jsx("span",{children:t.name}),t.slug?e.jsx("span",{className:"text-xs uppercase text-gray-400",children:t.slug}):null]},`tag-suggestion-${t.id??t.slug??t.name??l}`))})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(f,{variant:s.category?"outline":"default",size:"sm",onClick:()=>u("category",""),className:"text-xs",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),n("store.filters.allProducts")]}),k.slice(0,5).map((t,l)=>{const g=(t.slug||t.category||t.name||`category-${l}`).toString(),E=t.name||t.category||g,$=t.product_count??t.count??t.total??0;return e.jsxs(f,{variant:s.category===g?"default":"outline",size:"sm",onClick:()=>u("category",g),className:"text-xs",children:[n(`store.categories.${g}`,E),e.jsxs("span",{className:"ml-1 text-xs opacity-75",children:["(",$,")"]})]},g)}),e.jsxs(f,{variant:s.sort==="popular"?"default":"outline",size:"sm",onClick:()=>u("sort","popular"),className:"text-xs",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),n("store.filters.popular")]})]})}),_&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-blue-700",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("span",{children:[n("store.filters.activeFilters"),":"]})]})}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[s.search&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[n("store.filters.search"),': "',s.search,'"',e.jsx("button",{onClick:()=>u("search",""),className:"ml-1 hover:text-blue-600",children:e.jsx(Q,{className:"h-3 w-3"})})]}),s.category&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[n(`store.categories.${s.category}`,s.category),e.jsx("button",{onClick:()=>u("category",""),className:"ml-1 hover:text-blue-600",children:e.jsx(Q,{className:"h-3 w-3"})})]}),(s.min_points||s.max_points)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[s.min_points||0," - ",s.max_points||"âˆž"," ",n("common.points"),e.jsx("button",{onClick:()=>{u("min_points",""),u("max_points","")},className:"ml-1 hover:text-blue-600",children:e.jsx(Q,{className:"h-3 w-3"})})]}),j.map((t,l)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[t.name||t.slug,e.jsx("button",{onClick:()=>c(l),className:"ml-1 hover:text-blue-600",children:e.jsx(Q,{className:"h-3 w-3"})})]},`active-tag-${t.slug}-${l}`))]})]})]})}const _e=s=>{if(!s)return null;if(typeof s=="string"){const S=s.trim();if(!S)return null;const T=S.trim();return{name:S,category:S,slug:T,product_count:0}}const h=s.name??s.category??"",k=typeof h=="string"?h.trim():String(h||"").trim(),i=s.slug??s.category_slug??s.category??k,w=((typeof i=="string"?i.trim():String(i||"").trim())||k||"").toString().trim(),N=w&&w.toLowerCase(),r=s.product_count??s.count??s.total??0;return{...s,name:k||w,category:s.category??k??w,slug:N||w,product_count:r}};function He(){const{t:s}=G(),[h,k]=o.useState(null),[i,n]=o.useState([]),[w,N]=o.useState([]),[r,S]=o.useState(!0),[T,b]=o.useState(!1),[z,j]=o.useState(null),[u,F]=o.useState(null),[_,M]=o.useState({search:"",category:"",min_points:"",max_points:"",sort:"created_at",page:1,limit:12,tags:[]}),[p,c]=o.useState({page:1,pages:1,total:0}),[P,t]=o.useState(null),[l,g]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const x=await ge();x.isAuthenticated&&k(x.user)}catch(x){console.error("Failed to fetch user:",x)}})()},[]),o.useEffect(()=>{E()},[_]),o.useEffect(()=>{$()},[]);const E=async()=>{var y,x;try{S(!0),j(null);const m={};Object.entries(_).forEach(([A,C])=>{if(A==="tags"){Array.isArray(C)&&C.length&&(m.tags=C.map(V=>V.slug||V).join(","));return}C!==""&&C!==null&&C!==void 0&&(m[A]=C)});const v=await J.getProducts(m),q=((y=v.data)==null?void 0:y.data)??v.data,I=Array.isArray(q)?q:(q==null?void 0:q.products)??[],a=(Array.isArray(q)?null:q==null?void 0:q.pagination)||{},d={page:a.page??a.current_page??m.page??_.page??1,pages:a.pages??a.total_pages??1,total:a.total??a.total_items??I.length};((x=v.data)==null?void 0:x.success)!==!1?(n(I),c({page:d.page??1,pages:d.pages??1,total:d.total??I.length})):(n([]),c({page:1,pages:1,total:0}),j(s("store.errors.loadFailed")))}catch(m){console.error("Failed to fetch products:",m),j(s("store.errors.loadFailed"))}finally{S(!1)}},$=async()=>{var y,x;try{const m=await J.getCategories(),v=(y=m.data)==null?void 0:y.data,q=Array.isArray(v==null?void 0:v.categories)?v.categories:Array.isArray(v)?v:((x=m.data)==null?void 0:x.categories)||[],I=Array.isArray(q)?q.map(a=>_e(a)).filter(Boolean):[];N(I)}catch(m){console.error("Failed to fetch categories:",m)}},B=y=>{if(!h){j(s("store.errors.loginRequired"));return}t(y),g(!0)},U=async y=>{try{b(!0),j(null);const x=await J.exchangeProduct(y),{success:m,data:v,points_used:q,remaining_points:I}=x.data||{};if(m){const a=q??(v==null?void 0:v.points_used)??0,d=I??(v==null?void 0:v.remaining_points);F(s("store.exchange.success",{product:P.name,points:a})),k(A=>({...A,points:typeof d=="number"?d:A.points})),E(),g(!1),t(null)}else j(s("store.errors.exchangeFailed"))}catch(x){console.error("Exchange failed:",x),j(s("store.errors.exchangeFailed"))}finally{b(!1)}},R=y=>{M(x=>({...x,page:y})),window.scrollTo({top:0,behavior:"smooth"})};return h?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:s("store.title")}),e.jsx("p",{className:"text-gray-600",children:s("store.subtitle")})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx(D,{className:"bg-gradient-to-r from-green-500 to-blue-500 text-white",children:e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:s("store.yourPoints")}),e.jsxs("p",{className:"text-2xl font-bold",children:[H(h.points)," ",s("common.points")]})]})]})})})})]})}),z&&e.jsxs(se,{variant:"destructive",className:"mb-6",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:z}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>j(null),className:"ml-auto",children:"Ã—"})]}),u&&e.jsxs(se,{variant:"default",className:"mb-6 border-green-200 bg-green-50 text-green-800",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:u}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>F(null),className:"ml-auto",children:"Ã—"})]}),e.jsx(ke,{filters:_,onFiltersChange:M,categories:w,isLoading:r}),r?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Array.from({length:8}).map((y,x)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsx("div",{className:"h-48 bg-gray-200 rounded-lg mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 mb-4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]})},x))}):i.length===0?e.jsx(D,{className:"text-center py-12",children:e.jsxs(O,{children:[e.jsx(Y,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx(K,{className:"text-xl text-gray-600 mb-2",children:s("store.noProducts.title")}),e.jsx(W,{children:s("store.noProducts.description")}),(_.search||_.category||_.min_points||_.max_points)&&e.jsx(f,{variant:"outline",onClick:()=>M({search:"",category:"",min_points:"",max_points:"",sort:"created_at",page:1,limit:12,tags:[]}),className:"mt-4",children:s("store.filters.clear")})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8",children:i.map(y=>e.jsx(we,{product:y,userPoints:h.points,onExchange:B},y.id))}),p.pages>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx(f,{variant:"outline",onClick:()=>R(p.page-1),disabled:p.page<=1,children:s("common.previous")}),e.jsx("div",{className:"flex space-x-1",children:Array.from({length:Math.min(5,p.pages)},(y,x)=>{let m;return p.pages<=5||p.page<=3?m=x+1:p.page>=p.pages-2?m=p.pages-4+x:m=p.page-2+x,e.jsx(f,{variant:p.page===m?"default":"outline",onClick:()=>R(m),className:"w-10",children:m},m)})}),e.jsx(f,{variant:"outline",onClick:()=>R(p.page+1),disabled:p.page>=p.pages,children:s("common.next")})]})]}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsxs(f,{variant:"outline",onClick:()=>window.location.href="/activities",className:"mr-4",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),s("store.viewExchangeHistory")]}),e.jsxs(f,{onClick:()=>window.location.href="/calculate",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),s("store.earnMorePoints")]})]})]}),e.jsx(Ce,{product:P,userPoints:(h==null?void 0:h.points)||0,userEmail:(h==null?void 0:h.email)||"",isOpen:l,onClose:()=>{g(!1),t(null)},onConfirm:U,isLoading:T})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(D,{className:"max-w-md w-full mx-4",children:[e.jsxs(Z,{className:"text-center",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx(K,{children:s("store.loginRequired.title")}),e.jsx(W,{children:s("store.loginRequired.description")})]}),e.jsx(O,{className:"text-center",children:e.jsx(f,{onClick:()=>window.location.href="/auth/login",children:s("auth.signIn")})})]})})}export{He as default};
