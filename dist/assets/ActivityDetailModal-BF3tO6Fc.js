import{u as C,r as y,j as s,o as w,X as k,J as j,B as _,D as M,i as N,k as P}from"./index-9oiziVwF.js";import{I}from"./image-DOHZLiRJ.js";import{C as $}from"./chevron-left-DJM8gMb4.js";import{C as D}from"./chevron-right-DU2F_nTX.js";import{C as S,a as T,b as U,c as B,d as R}from"./Card-DiZzX4G1.js";import{C as G}from"./circle-x-DpCTbcim.js";import{C as E}from"./circle-check-big-2jXPKRvC.js";import{C as L}from"./clock-Z-RDyq2S.js";function z({images:t,maxThumbnails:b=3,size:x="sm",className:a=""}){const{t:i}=C(),[r,o]=y.useState(-1),n=y.useMemo(()=>Array.isArray(t)?t.map(e=>{const l=typeof e=="string"?{url:e}:e||{},v=l.url??l.public_url??null,c=typeof l.file_path=="string"?l.file_path:null,f=l.presigned_url??null;return{...l,url:v,file_path:c?c.replace(/^\/+/,""):null,presigned_url:f,original_name:l.original_name||l.name||null}}).filter(e=>e&&(e.url||e.file_path||e.presigned_url)):[],[t]);if(!n.length)return s.jsxs("div",{className:`text-xs text-gray-400 italic flex items-center gap-1 ${a}`,children:[s.jsx(I,{className:"h-3 w-3"})," ",i("images.none","No images")]});const h=x==="sm"?"h-12 w-12":"h-20 w-20",d=n.slice(0,b),u=n.length-d.length,m=(e,l)=>e.file_path||e.url||`image-${l}`,p=e=>e.presigned_url?e.presigned_url:e.url&&/^https?:\/\//i.test(e.url)?e.url:void 0;return s.jsxs("div",{className:`flex items-center gap-2 ${a}`,children:[d.map((e,l)=>s.jsxs("button",{type:"button",className:`relative border rounded-md overflow-hidden bg-gray-50 hover:ring-2 hover:ring-green-500 transition ${h}`,onClick:()=>o(l),title:e.original_name||i("images.clickToPreview","Click to preview"),children:[s.jsx(w,{src:p(e),filePath:e.file_path||void 0,alt:e.original_name||`image-${l}`,className:"object-cover w-full h-full",fallback:s.jsx("div",{className:"w-full h-full bg-gray-100 text-gray-400 text-[10px] flex items-center justify-center",children:"IMG"})}),u>0&&l===d.length-1&&s.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white text-xs font-semibold",children:["+",u]})]},m(e,l))),r>=0&&s.jsxs("div",{className:"fixed inset-0 z-50 bg-black/70 flex flex-col",children:[s.jsx("div",{className:"flex justify-end p-3",children:s.jsx("button",{onClick:()=>o(-1),className:"text-white/80 hover:text-white p-2","aria-label":i("common.close","Close"),children:s.jsx(k,{className:"h-6 w-6"})})}),s.jsxs("div",{className:"flex-1 flex items-center justify-center px-4 pb-6 select-none",children:[s.jsx("button",{disabled:r===0,onClick:()=>o(e=>Math.max(0,e-1)),className:"p-3 text-white/70 hover:text-white disabled:opacity-30","aria-label":i("images.prev","Previous"),children:s.jsx($,{className:"h-10 w-10"})}),s.jsx("div",{className:"max-h-[75vh] max-w-[85vw] flex items-center justify-center",children:s.jsx(w,{src:p(n[r]),filePath:n[r].file_path||void 0,alt:n[r].original_name||`image-${r}`,className:"max-h-[75vh] max-w-[85vw] object-contain shadow-2xl rounded-md",fallback:s.jsx("div",{className:"max-h-[75vh] max-w-[85vw] bg-black/30 text-white text-xs flex items-center justify-center rounded-md",children:"IMG"})},m(n[r],r))}),s.jsx("button",{disabled:r===n.length-1,onClick:()=>o(e=>Math.min(n.length-1,e+1)),className:"p-3 text-white/70 hover:text-white disabled:opacity-30","aria-label":i("images.next","Next"),children:s.jsx(D,{className:"h-10 w-10"})})]}),s.jsx("div",{className:"pb-4 text-center text-white text-xs opacity-80",children:i("images.counter","{{current}} / {{total}}",{current:r+1,total:n.length})})]})]})}z.propTypes={images:j.any,maxThumbnails:j.number,size:j.oneOf(["sm","md"]),className:j.string};function V({activity:t,isOpen:b,onClose:x}){const{t:a}=C();if(!b||!t)return null;const i=e=>e.activity_name||e.activity_name_zh||e.activity_name_en||e.activity||"",r=e=>e.activity_category||e.category||"unknown",o=e=>e.activity_unit||e.unit||"",n=e=>e.activity_date||e.date||e.created_at,h=e=>e.description||e.notes||e.note||e.remark||e.comments||"",d=Array.isArray(t.images)?t.images:Array.isArray(t.proof_images)?t.proof_images:[],u=e=>{if(!e)return null;if(typeof e=="string"){const g=e.trim();return g?/^https?:\/\//i.test(g)?{url:g}:{file_path:g}:null}if(typeof e!="object")return null;const l=typeof e.presigned_url=="string"?e.presigned_url:null,v=typeof e.public_url=="string"?e.public_url:null,c=typeof e.url=="string"?e.url:null,f=c&&/^https?:\/\//i.test(c)?c:null,A=e.file_path||e.path||e.key||(!f&&c?c:null);return{url:l||v||f||null,presigned_url:l||null,file_path:A||null,thumbnail_path:e.thumbnail_path||e.preview_path||null,original_name:e.original_name||e.name||null}},m=d.map(u).filter(e=>e&&(e.presigned_url||e.url||e.file_path)),p=e=>{switch(e){case"pending":return s.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[s.jsx(L,{className:"h-3 w-3 mr-1"})," ",a("activities.status.pending")]});case"approved":return s.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[s.jsx(E,{className:"h-3 w-3 mr-1"})," ",a("activities.status.approved")]});case"rejected":return s.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[s.jsx(G,{className:"h-3 w-3 mr-1"})," ",a("activities.status.rejected")]});default:return null}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs(S,{className:"border-0 shadow-none",children:[s.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[s.jsxs("div",{children:[s.jsx(U,{className:"text-xl",children:a("activities.detail.title")}),s.jsx(B,{children:a("activities.detail.subtitle")})]}),s.jsx(_,{variant:"ghost",size:"sm",onClick:x,className:"h-8 w-8 p-0",children:s.jsx(k,{className:"h-4 w-4"})})]}),s.jsxs(R,{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-500",children:a("activities.table.activity")}),s.jsx("p",{className:"text-lg font-semibold text-gray-900",children:i(t)}),s.jsx("p",{className:"text-sm text-gray-600",children:a(`activities.categories.${r(t)}`,r(t))})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-500",children:a("activities.table.status")}),p(t.status)]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-500",children:a("activities.table.date")}),s.jsx("p",{className:"text-gray-900",children:M(n(t),"yyyy-MM-dd")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-500",children:a("activities.table.data")}),s.jsxs("p",{className:"text-gray-900",children:[N(t.data_value??t.amount)," ",a(`units.${o(t)}`,o(t))]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-500",children:a("activities.table.carbonSaved")}),s.jsxs("p",{className:"text-green-600 font-semibold",children:[N(t.carbon_saved)," kg CO2e"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-500",children:a("activities.table.points")}),s.jsxs("p",{className:"text-green-600 font-semibold",children:["+",N(t.points_earned)," ",a("common.points")]})]})]}),h(t)&&s.jsxs("div",{children:[s.jsxs("h4",{className:"text-md font-semibold text-gray-700 mb-2 flex items-center",children:[s.jsx(P,{className:"h-4 w-4 mr-2"}),a("activities.detail.notes")]}),s.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded-md whitespace-pre-wrap break-words",children:h(t)})]}),t.status==="rejected"&&t.admin_notes&&s.jsxs("div",{children:[s.jsxs("h4",{className:"text-md font-semibold text-red-700 mb-2 flex items-center",children:[s.jsx(AlertCircle,{className:"h-4 w-4 mr-2"}),a("activities.detail.rejectionReason")]}),s.jsx("p",{className:"text-red-700 bg-red-50 p-3 rounded-md",children:t.admin_notes})]}),m.length>0&&s.jsxs("div",{children:[s.jsxs("h4",{className:"text-md font-semibold text-gray-700 mb-2 flex items-center",children:[s.jsx(I,{className:"h-4 w-4 mr-2"}),a("activities.detail.proofImages")]}),s.jsx(z,{images:m,maxThumbnails:6,size:"md"})]}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsx(_,{onClick:x,children:a("common.close")})})]})]})})})}export{V as A,z as I};
