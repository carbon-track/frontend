import{c as fe,u as Re,Y as Ee,r as c,t as ze,E as U,a9 as N,A as ne,a4 as V,b as Oe,j as e,y as Qe,I as ie,w as k,U as He,B as p,K as de,N as le,O as oe,Q as ce,T as me,W as qe,aa as ue,o as Ve,F as K,n as f}from"./index-9oiziVwF.js";import{u as W}from"./useMutation-BrmGtd8z.js";import{A as Ke,b as We,a as Xe}from"./Alert-DMTWhZOi.js";import{P as Ye}from"./Pagination-DogK4uhw.js";import{C as xe}from"./checkbox-CilTIFml.js";import{S as $e}from"./switch-BM59ftG1.js";import{A as Ge,a as Je,b as Ze,c as es,d as ss,e as as,f as ts,g as rs}from"./alert-dialog-BwbPEfPr.js";import{L as pe}from"./label-JVilFQmY.js";import{T as ns}from"./textarea-BakiDkNo.js";import{B as is}from"./BadgeBulkAwardDialog-RjwBC8cI.js";import{C as ds}from"./calendar-days-B_7_WWfo.js";import{C as ls}from"./circle-plus-Cs0azcnx.js";import{E as os}from"./eye-QkcRAVlH.js";import{S as cs}from"./shield-tmlCKQ9k.js";import{T as ms}from"./trash-2-B-HyTeNA.js";import{C as us}from"./circle-check-big-2jXPKRvC.js";import{C as xs}from"./circle-x-DpCTbcim.js";import"./scroll-area-DbMsHkSR.js";import"./index-BdQq_4o_.js";import"./user-plus-BeF-O73P.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],gs=fe("ban",ps);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],fs=fe("clipboard-list",hs),js={search:"",role:"",status:"",page:1,limit:10,sort:"created_at_desc"},X=(a={})=>{const l=o=>{const v=Number(o);return Number.isFinite(v)?v:0};return{...a,is_admin:a.is_admin===!0||a.is_admin===1||a.is_admin==="1",points:l(a.points),total_transactions:l(a.total_transactions),earned_points:l(a.earned_points),total_carbon_saved:l(a.total_carbon_saved),badges_awarded:l(a.badges_awarded),badges_revoked:l(a.badges_revoked),active_badges:l(a.active_badges),days_since_registration:l(a.days_since_registration)}},je=(a={})=>{const l=a.badge?{...a.badge}:null,o=a.user_badge?{...a.user_badge}:{};return{badge:l,user_badge:o}},bs=(a={})=>je(a),ge=(a={})=>({total_points_earned:Number(a.total_points_earned??0),total_points_balance:Number(a.total_points_balance??0),total_carbon_saved:Number(a.total_carbon_saved??0),total_records:Number(a.total_records??0),total_approved_records:Number(a.total_approved_records??0)}),he=(a={})=>({awarded:Number(a.awarded??0),revoked:Number(a.revoked??0),total:Number(a.total??Number(a.awarded??0)+Number(a.revoked??0))});function ys(a){var j;const l=((j=a==null?void 0:a.data)==null?void 0:j.data)||(a==null?void 0:a.data)||{};if(Array.isArray(l.users))return{users:l.users.map(X),pagination:l.pagination||{}};const o=l.data||{};return{users:Array.isArray(o.users)?o.users.map(X):[],pagination:o.pagination||{}}}function Ns(){const{t:a}=Re(),l=Ee(),[o,v]=c.useState(js),[j,A]=ze(),D=c.useRef(null),[i,Y]=c.useState({open:!1,type:null,user:null,payload:null}),[g,S]=c.useState({open:!1,user:null,delta:"",reason:""}),[w,I]=c.useState(new Map),[$,M]=c.useState({open:!1,presetUsers:[]}),[m,T]=c.useState({open:!1,userId:null}),[F,_]=c.useState(!1),G=c.useMemo(()=>{const s={page:o.page,limit:o.limit,sort:o.sort},t=o.search.trim();return t&&(s.q=t),o.status&&(s.status=o.status),o.role==="admin"?s.is_admin=1:o.role==="user"&&(s.is_admin=0),s},[o]),b=U(["adminUsers",G],()=>N.getUsers(G),{keepPreviousData:!0}),C=U(["adminBadges","forAwarding"],()=>N.getBadges({limit:200}),{staleTime:6e4}),L=U(["adminUserOverview",m.userId],()=>N.getUserOverview(m.userId).then(s=>{var t;return(t=s.data)==null?void 0:t.data}),{enabled:m.open&&!!m.userId,select:s=>{if(!s)return null;const t=ge(s.metrics||{}),r=he(s.badge_summary||{}),d=Array.isArray(s.recent_badges)?s.recent_badges.map(bs):[];return{...s,metrics:t,badge_summary:r,recent_badges:d}}}),R=U(["adminUserBadges",m.userId,F],()=>N.getUserBadges(m.userId,{include_revoked:F}).then(s=>{var t;return(t=s.data)==null?void 0:t.data}),{enabled:m.open&&!!m.userId,select:s=>{if(!s)return null;const t=he(s.summary||{}),r=ge(s.metrics||{}),d=Array.isArray(s.badges)?s.badges.map(je):[];return{...s,summary:t,metrics:r,badges:d}}}),J=W(({id:s,data:t})=>N.updateUser(s,t),{onSuccess:()=>{l.invalidateQueries("adminUsers"),f.success(a("admin.users.updateSuccess"))},onError:()=>{f.error(a("admin.users.updateFailed"))}}),be=W(s=>N.deleteUser(s),{onSuccess:()=>{l.invalidateQueries("adminUsers"),f.success(a("admin.users.deleteSuccess"))},onError:()=>{f.error(a("admin.users.deleteFailed"))}}),E=W(({id:s,data:t})=>N.adjustUserPoints(s,t),{onSuccess:()=>{l.invalidateQueries("adminUsers"),f.success(a("admin.users.adjustSuccess"))},onError:()=>{f.error(a("admin.users.adjustFailed"))}});c.useEffect(()=>{j.get("focus")==="search"&&D.current&&(D.current.focus(),A(s=>{const t=new URLSearchParams(s);return t.delete("focus"),t},{replace:!0}))},[j,A]),c.useEffect(()=>{const s=j.get("userId");if(!s)return;const t=()=>{A(d=>{const re=new URLSearchParams(d);return re.delete("userId"),re},{replace:!0})},r=Number(s);if(!Number.isInteger(r)||r<=0){t();return}(!m.open||m.userId!==r)&&(T({open:!0,userId:r}),_(!1)),t()},[j,m.open,m.userId,A,_]);const{users:h,pagination:B}=c.useMemo(()=>ys(b.data),[b.data]),ye=b.isLoading&&!b.data,Ne=b.isFetching&&!!b.data,ve=c.useMemo(()=>m.userId&&h.find(s=>s.id===m.userId)||null,[m.userId,h]),u=L.data||null,x=R.data||null,Z=Array.isArray(x==null?void 0:x.badges)?x.badges:Array.isArray(x==null?void 0:x.items)?x.items:[],z=(x==null?void 0:x.summary)||(u==null?void 0:u.badge_summary)||{awarded:0,revoked:0,total:0},we=c.useMemo(()=>u!=null&&u.user?X(u.user):null,[u]),n=ve??we,_e=c.useMemo(()=>{if(!u&&!n)return[];const s=(u==null?void 0:u.metrics)||{};return[{key:"balance",label:a("admin.users.detail.pointsBalance","积分余额"),value:(n==null?void 0:n.points)??0,icon:ne},{key:"earned",label:a("admin.users.detail.pointsEarned","累计积分"),value:s.total_points_earned??0,icon:V},{key:"carbon",label:a("admin.users.detail.carbonSaved","累计碳减排 (kg)"),value:s.total_carbon_saved??0,icon:Oe},{key:"records",label:a("admin.users.detail.recordsApproved","审核通过记录"),value:s.total_approved_records??0,icon:fs},{key:"days",label:a("admin.users.detail.daysSinceRegistration","注册天数"),value:(n==null?void 0:n.days_since_registration)??s.days_since_registration??0,icon:ds}]},[u,n,a]),O=c.useMemo(()=>Array.from(w.values()),[w]),Q=c.useMemo(()=>{var t,r,d;const s=((r=(t=C.data)==null?void 0:t.data)==null?void 0:r.data)||((d=C.data)==null?void 0:d.data)||[];return Array.isArray(s)?s:[]},[C.data]),ee=h.length>0&&h.every(s=>w.has(s.id)),ke=h.some(s=>w.has(s.id))&&!ee,P=(s,t)=>{v(r=>({...r,[s]:t,page:s==="page"?t:1}))},Ae=s=>{P("page",s)},Se=(s,t)=>{I(r=>{const d=new Map(r);return t?d.set(s.id,s):d.delete(s.id),d})},Ce=s=>{I(t=>{const r=new Map(t);return s?h.forEach(d=>r.set(d.id,d)):h.forEach(d=>r.delete(d.id)),r})},Be=s=>{const t=s.status!=="active";H({type:"status",user:s,payload:{nextStatus:t?"active":"inactive"}})},Pe=s=>{const t=!s.is_admin;H({type:"role",user:s,payload:{makeAdmin:t}})},Ue=s=>{H({type:"delete",user:s,payload:null})},De=s=>{s&&(T({open:!0,userId:s.id}),_(!1))},Ie=()=>{T({open:!1,userId:null}),_(!1)},H=s=>{Y({open:!0,...s})},y=()=>{Y({open:!1,type:null,user:null,payload:null})},Me=()=>{if(!i.user||!i.type){y();return}if(i.type==="status"){const s=i.payload.nextStatus;J.mutate({id:i.user.id,data:{status:s}},{onSettled:y})}else if(i.type==="role"){const s=i.payload.makeAdmin;J.mutate({id:i.user.id,data:{is_admin:s}},{onSettled:y})}else i.type==="delete"?be.mutate(i.user.id,{onSettled:y}):y()},Te=s=>{S({open:!0,user:s,delta:"",reason:""})},q=()=>{S({open:!1,user:null,delta:"",reason:""})},Fe=()=>{if(!g.user)return;const s=Number(g.delta);if(!Number.isFinite(s)||s===0){f.error(a("admin.users.invalidDelta"));return}E.mutate({id:g.user.id,data:{delta:s,reason:g.reason}},{onSettled:q})},se=s=>{if(!s||s.length===0){f.error(a("admin.users.selectUserHint","请先选择用户"));return}M({open:!0,presetUsers:s})},Le=()=>{I(new Map)},ae=s=>!s||!s.status?e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-600",children:a("common.unknown","未知")}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",children:s.status==="active"?e.jsxs("span",{className:"bg-green-100 text-green-800 flex items-center gap-1 px-2 py-0.5 rounded-full",children:[e.jsx(us,{className:"h-3 w-3"}),a("admin.users.statusActive")]}):e.jsxs("span",{className:"bg-red-100 text-red-800 flex items-center gap-1 px-2 py-0.5 rounded-full",children:[e.jsx(xs,{className:"h-3 w-3"}),a("admin.users.statusInactive")]})}),te=s=>s?e.jsx(K,{variant:s.is_admin?"default":"outline",children:s.is_admin?a("admin.users.roleAdmin"):a("admin.users.roleUser")}):e.jsx(K,{variant:"outline",children:a("common.unknown","未知")});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:a("admin.users.title")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.users.description")})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ie,{ref:D,type:"text",value:o.search,onChange:s=>P("search",s.target.value),placeholder:a("admin.users.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("admin.users.role")}),e.jsxs("select",{value:o.role,onChange:s=>P("role",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"user",children:a("admin.users.roleUser")}),e.jsx("option",{value:"admin",children:a("admin.users.roleAdmin")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("admin.users.status")}),e.jsxs("select",{value:o.status,onChange:s=>P("status",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"active",children:a("admin.users.statusActive")}),e.jsx("option",{value:"inactive",children:a("admin.users.statusInactive")})]})]})]}),Ne&&e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs text-muted-foreground",children:[e.jsx(k,{className:"h-3.5 w-3.5 animate-spin"}),a("admin.users.refreshing")]}),O.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-md border border-dashed bg-muted/60 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:a("admin.users.selectedCount","已选择 {{count}} 位用户",{count:O.length})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>se(O),disabled:C.isLoading||Q.length===0,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),a("admin.users.bulkAwardBadges","批量授予徽章")]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:Le,children:a("common.clear","清空")})]})]})]}),ye?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-green-500"})}):b.error?e.jsxs(Ke,{variant:"destructive",children:[e.jsx(We,{children:a("common.error")}),e.jsx(Xe,{children:a("errors.loadFailed")})]}):h.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-xl font-semibold",children:a("admin.users.noUsersFound")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:a("admin.users.tryDifferentFilters")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow-sm border",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx(xe,{checked:ee?!0:ke?"indeterminate":!1,onCheckedChange:s=>Ce(s===!0||s==="indeterminate"),"aria-label":a("admin.users.selectAll","选择当前页所有用户"),className:"translate-y-0.5"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.users.table.username")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.users.table.email")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.users.table.role")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.users.table.status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.users.table.badges","徽章")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.users.table.carbon","碳减排")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.users.table.points")}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.users.table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(s=>{const t=w.has(s.id);return e.jsxs("tr",{className:t?"bg-emerald-50/40":"",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(xe,{checked:t,onCheckedChange:r=>Se(s,r===!0||r==="indeterminate"),"aria-label":a("admin.users.selectUser","选择用户 {{username}}",{username:s.username})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.username}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:te(s)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:ae(s)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a("admin.users.badgesAwardedCount","{{count}} 枚",{count:s.badges_awarded||0})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("admin.users.activeBadgesCount","激活 {{count}}",{count:s.active_badges||0})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:Number(s.total_carbon_saved||0).toLocaleString(void 0,{maximumFractionDigits:2})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.points}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-1",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>Be(s),title:a("admin.users.toggleStatusButton","切换用户状态"),children:[e.jsx(gs,{className:"h-4 w-4 mr-1"}),s.status==="active"?a("admin.users.disable"):a("admin.users.enable")]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Te(s),title:a("admin.users.promptAdjustPoints",{username:s.username}),children:e.jsx(ls,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>De(s),title:a("admin.users.viewDetailsButton","查看详情"),children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Pe(s),title:a("admin.users.toggleAdminButton","切换管理员权限"),children:e.jsx(cs,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>se([s]),title:a("admin.users.awardBadgeButton","授予徽章"),disabled:Q.length===0,children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Ue(s),className:"text-red-600 hover:text-red-800",title:a("admin.users.deleteButton","删除用户"),children:e.jsx(ms,{className:"h-4 w-4"})})]})]},s.id)})})]})}),e.jsx(Ye,{currentPage:B.current_page,totalPages:B.total_pages,onPageChange:Ae,itemsPerPage:B.per_page,totalItems:B.total_items})]}),e.jsx(Ge,{open:i.open,onOpenChange:s=>s?null:y(),children:e.jsxs(Je,{children:[e.jsxs(Ze,{children:[e.jsxs(es,{children:[i.type==="status"&&a("admin.users.confirmToggleStatusTitle","确认修改状态"),i.type==="role"&&a("admin.users.confirmToggleAdminTitle","确认切换角色"),i.type==="delete"&&a("admin.users.confirmDeleteTitle","确认删除用户")]}),e.jsxs(ss,{children:[i.type==="status"&&i.user&&a("admin.users.confirmToggleStatus",{username:i.user.username,to:i.payload.nextStatus==="active"?a("admin.users.statusActive"):a("admin.users.statusInactive")}),i.type==="role"&&i.user&&a("admin.users.confirmToggleAdmin",{username:i.user.username}),i.type==="delete"&&i.user&&a("admin.users.confirmDelete",{username:i.user.username})]})]}),e.jsxs(as,{children:[e.jsx(ts,{onClick:y,children:a("common.cancel","取消")}),e.jsx(rs,{onClick:Me,children:a("common.confirm","确认")})]})]})}),e.jsx(de,{open:g.open,onOpenChange:s=>s?null:q(),children:e.jsxs(le,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsx(ce,{children:a("admin.users.adjustPointsTitle","调整积分")}),e.jsx(me,{children:g.user?a("admin.users.adjustPointsDescription",{username:g.user.username}):""})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(pe,{htmlFor:"points-delta",children:a("admin.users.adjustPointsDelta","积分变动值")}),e.jsx(ie,{id:"points-delta",type:"number",value:g.delta,onChange:s=>S(t=>({...t,delta:s.target.value})),placeholder:"100"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("admin.users.adjustPointsHint","输入正数表示增加积分，负数表示扣减积分")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(pe,{htmlFor:"points-reason",children:a("admin.users.adjustPointsReason","调整说明")}),e.jsx(ns,{id:"points-reason",rows:3,value:g.reason,onChange:s=>S(t=>({...t,reason:s.target.value})),placeholder:a("admin.users.adjustPointsReasonPlaceholder","请输入调整原因，便于审计记录")})]})]}),e.jsxs(qe,{children:[e.jsx(p,{variant:"ghost",onClick:q,children:a("common.cancel","取消")}),e.jsxs(p,{onClick:Fe,disabled:E.isLoading,children:[E.isLoading&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),a("common.confirm","确认")]})]})]})}),e.jsx(de,{open:m.open,onOpenChange:s=>s?null:Ie(),children:e.jsxs(le,{className:"max-w-4xl",children:[e.jsxs(oe,{children:[e.jsx(ce,{children:n?a("admin.users.detailTitle","用户详情：{{username}}",{username:n.username}):a("admin.users.detailTitleFallback","用户详情")}),e.jsx(me,{children:(n==null?void 0:n.email)||""})]}),L.isLoading?e.jsxs("div",{className:"flex items-center justify-center py-8 text-sm text-muted-foreground",children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),a("common.loading","加载中...")]}):L.error?e.jsx("p",{className:"text-sm text-destructive",children:a("admin.users.detailLoadFailed","无法加载用户详情")}):u?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:a("admin.users.detail.username","用户名")}),e.jsx("p",{className:"mt-1 text-sm font-medium text-gray-900",children:n==null?void 0:n.username})]}),e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:a("admin.users.detail.role","角色")}),e.jsx("p",{className:"mt-1 text-sm font-medium text-gray-900",children:te(n)})]}),e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:a("admin.users.detail.status","状态")}),e.jsx("p",{className:"mt-1 text-sm font-medium text-gray-900",children:ae(n)})]}),e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:a("admin.users.detail.registrationDays","注册天数")}),e.jsx("p",{className:"mt-1 text-sm font-medium text-gray-900",children:(n==null?void 0:n.days_since_registration)??0})]}),(n==null?void 0:n.lastlgn)&&e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm sm:col-span-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:a("admin.users.detail.lastLogin","最近登录")}),e.jsx("p",{className:"mt-1 text-sm font-medium text-gray-900",children:ue(new Date(n.lastlgn),"yyyy-MM-dd HH:mm")})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:_e.map(s=>{const t=s.icon;return e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:s.label}),e.jsx(t,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx("p",{className:"mt-2 text-xl font-semibold",children:Number(s.value||0).toLocaleString(void 0,{maximumFractionDigits:2})})]},s.key)})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-semibold",children:a("admin.users.badgeSummary","徽章概况")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("admin.users.badgeSummaryHint","展示授予和回收的徽章统计")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($e,{checked:F,onCheckedChange:s=>_(!!s)}),e.jsx("span",{children:a("admin.users.showRevokedBadges","显示已收回的徽章")})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:a("admin.users.badgesAwarded","授予")}),e.jsx("p",{className:"mt-2 text-2xl font-semibold",children:z.awarded})]}),e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:a("admin.users.badgesRevoked","收回")}),e.jsx("p",{className:"mt-2 text-2xl font-semibold",children:z.revoked})]}),e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:a("admin.users.badgesTotal","总数")}),e.jsx("p",{className:"mt-2 text-2xl font-semibold",children:z.total})]})]}),R.isLoading?e.jsxs("div",{className:"flex items-center justify-center py-6 text-sm text-muted-foreground",children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),a("common.loading","加载中...")]}):R.error?e.jsx("p",{className:"text-sm text-destructive",children:a("admin.users.badgesLoadFailed","无法加载徽章列表")}):Z.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500",children:a("admin.users.badgeTable.badge","徽章")}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500",children:a("admin.users.badgeTable.status","状态")}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500",children:a("admin.users.badgeTable.awardedAt","授予时间")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:Z.map((s,t)=>{const r=s.badge||{},d=s.user_badge||{};return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded-full border bg-muted",children:r.icon_url||r.icon_presigned_url||r.icon_path?e.jsx(Ve,{src:r.icon_presigned_url||r.icon_url,filePath:!r.icon_presigned_url&&!r.icon_url?r.icon_path:void 0,alt:r.name_zh||r.name_en,className:"h-full w-full object-cover"}):e.jsx(ne,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.name_zh||r.name_en||"-"}),r.name_en&&e.jsx("p",{className:"text-xs text-muted-foreground",children:r.name_en})]})]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(K,{variant:d.status==="awarded"?"success":"secondary",children:d.status==="awarded"?a("admin.users.badgeStatusAwarded","已授予"):a("admin.users.badgeStatusRevoked","已收回")})}),e.jsx("td",{className:"px-4 py-2 text-sm text-muted-foreground",children:d.awarded_at?ue(new Date(d.awarded_at),"yyyy-MM-dd HH:mm"):"--"})]},t)})})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:a("admin.users.badgesEmpty","暂无徽章记录")})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:a("admin.users.detailEmpty","暂无详情数据")})]})}),e.jsx(is,{open:$.open,onOpenChange:s=>s?null:M({open:!1,presetUsers:[]}),badges:Q,defaultSelectedBadgeIds:[],presetUsers:$.presetUsers,onCompleted:()=>{M({open:!1,presetUsers:[]}),l.invalidateQueries("adminUsers")},mode:"award"})]})}function Qs(){return e.jsx(Ns,{})}export{Qs as default};
