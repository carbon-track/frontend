import{u as F,Y as G,r as w,E as K,R as U,ad as V,j as e,y as X,I as Y,w as N,i as u,D as _,B as r,K as M,N as L,O as q,Q as H,T as J,W as R,n as S,a9 as P,o as Z}from"./index-9oiziVwF.js";import{u as ee}from"./useMutation-BrmGtd8z.js";import{T as se}from"./textarea-BakiDkNo.js";import{A as te,b as ae,a as ne}from"./Alert-DMTWhZOi.js";import{P as le}from"./Pagination-DogK4uhw.js";import{C as z}from"./clock-Z-RDyq2S.js";import{C as A}from"./circle-check-big-2jXPKRvC.js";import{C}from"./circle-x-DpCTbcim.js";import{E as ie}from"./eye-QkcRAVlH.js";function re(){var D,E;const{t:s}=F(),p=G(),[a,i]=w.useState({search:"",status:"",page:1,limit:10,sort:"created_at_desc"}),[m,d]=w.useState(null),[n,h]=w.useState({open:!1,exchange:null,status:null,adminNotes:"",error:""}),{data:o,isLoading:B,error:I,isFetching:T}=K(["adminExchanges",a],()=>P.getExchanges(a),{keepPreviousData:!0}),g=ee(({id:t,status:l,admin_notes:c})=>P.updateExchangeStatus(t,{status:l,admin_notes:c}),{onSuccess:()=>{p.invalidateQueries("adminExchanges"),S.success(s("admin.exchanges.updateSuccess")),d(null)},onError:t=>{S.error(s("admin.exchanges.updateFailed")),console.error("Exchange status update failed:",t)}}),y=(t,l)=>{i(c=>({...c,[t]:l,page:1}))},O=t=>{i(l=>({...l,page:t}))},Q=t=>{d(t)},x=(t,l)=>{h({open:!0,exchange:t,status:l,adminNotes:"",error:""})},b=()=>{h({open:!1,exchange:null,status:null,adminNotes:"",error:""})},W=t=>{const l=t.target.value;h(c=>({...c,adminNotes:l,error:l.trim()?"":c.error}))},$=()=>{if(!n.exchange||!n.status)return;const t=n.status==="rejected"||n.status==="cancelled",l=n.adminNotes.trim();if(t&&!l){h(c=>({...c,error:s("admin.exchanges.notesRequired","请填写处理说明")}));return}g.mutate({id:n.exchange.id,status:n.status,admin_notes:t?l:void 0},{onSettled:()=>b()})},j=((D=o==null?void 0:o.data)==null?void 0:D.data)||[],f=((E=o==null?void 0:o.data)==null?void 0:E.pagination)||{};U.useEffect(()=>{const t=j.map(l=>l.product_image_url).filter(Boolean).filter(l=>!l.startsWith("http"));t.length&&V(t).catch(()=>{})},[j]);const v=n.status==="rejected"||n.status==="cancelled",k=n.status?s(`admin.exchanges.status.${n.status}`):"";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("admin.exchanges.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.exchanges.description")}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Y,{type:"text",value:a.search,onChange:t=>y("search",t.target.value),placeholder:s("admin.exchanges.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.exchanges.statusLabel")}),e.jsxs("select",{value:a.status,onChange:t=>y("status",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:s("common.all")}),e.jsx("option",{value:"pending",children:s("admin.exchanges.status.pending")}),e.jsx("option",{value:"processing",children:s("admin.exchanges.status.processing")}),e.jsx("option",{value:"shipped",children:s("admin.exchanges.status.shipped")}),e.jsx("option",{value:"completed",children:s("admin.exchanges.status.completed")}),e.jsx("option",{value:"rejected",children:s("admin.exchanges.status.rejected")}),e.jsx("option",{value:"cancelled",children:s("admin.exchanges.status.cancelled")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("common.sort.sortBy")}),e.jsxs("select",{value:a.sort,onChange:t=>y("sort",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"created_at_desc",children:s("common.sort.newest")}),e.jsx("option",{value:"created_at_asc",children:s("common.sort.oldest")})]})]})]})}),B||T?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-green-500"})}):I?e.jsxs(te,{variant:"destructive",children:[e.jsx(ae,{children:s("common.error")}),e.jsx(ne,{children:s("errors.loadFailed")})]}):j.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-xl font-semibold",children:s("admin.exchanges.noExchangesFound")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("admin.exchanges.tryDifferentFilters")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow-sm border",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.exchanges.table.user")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.exchanges.table.product")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.exchanges.table.quantity")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.exchanges.table.totalPoints")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.exchanges.table.status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.exchanges.table.date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("common.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.user_username}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.product_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u(t.quantity)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold",children:["-",u(t.total_points)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[t.status==="pending"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(z,{className:"h-3 w-3 mr-1"})," ",s("admin.exchanges.status.pending")]}),t.status==="processing"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(N,{className:"h-3 w-3 mr-1 animate-spin"})," ",s("admin.exchanges.status.processing")]}),t.status==="shipped"&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:s("admin.exchanges.status.shipped")}),t.status==="completed"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(A,{className:"h-3 w-3 mr-1"})," ",s("admin.exchanges.status.completed")]}),(t.status==="rejected"||t.status==="cancelled")&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(C,{className:"h-3 w-3 mr-1"})," ",s(`admin.exchanges.status.${t.status}`)]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:_(t.created_at,"yyyy-MM-dd HH:mm")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>Q(t),className:"mr-2",children:e.jsx(ie,{className:"h-4 w-4"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>x(t,"processing"),className:"mr-2 text-blue-600 hover:text-blue-800",children:s("admin.exchanges.action.process")}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>x(t,"rejected"),className:"text-red-600 hover:text-red-800",children:s("admin.exchanges.action.reject")})]}),t.status==="processing"&&e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>x(t,"shipped"),className:"mr-2 text-purple-600 hover:text-purple-800",children:s("admin.exchanges.action.ship")}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>x(t,"cancelled"),className:"text-red-600 hover:text-red-800",children:s("admin.exchanges.action.cancel")})]}),t.status==="shipped"&&e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>x(t,"completed"),className:"text-green-600 hover:text-green-800",children:s("admin.exchanges.action.complete")})]})]},t.id))})]})}),e.jsx(le,{currentPage:f.current_page,totalPages:f.total_pages,onPageChange:O,itemsPerPage:f.per_page,totalItems:f.total_items})]}),e.jsx(M,{open:n.open,onOpenChange:t=>t?null:b(),children:e.jsxs(L,{className:"sm:max-w-lg",children:[e.jsxs(q,{children:[e.jsx(H,{children:s("admin.exchanges.statusDialog.title",{status:k||n.status||""})}),e.jsx(J,{children:s("admin.exchanges.statusDialog.description",{status:k||n.status||""})})]}),n.exchange&&e.jsxs("div",{className:"space-y-2 rounded-xl border border-slate-200 bg-slate-50 p-3 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between text-slate-700",children:[e.jsx("span",{className:"font-semibold text-slate-900",children:n.exchange.user_username}),e.jsx("span",{children:_(n.exchange.created_at,"yyyy-MM-dd HH:mm","--")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-900",children:n.exchange.product_name}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",u(n.exchange.total_points)," ",s("common.points")]})]}),n.exchange.contact_phone&&e.jsx("p",{className:"text-xs text-slate-500",children:n.exchange.contact_phone}),n.exchange.shipping_address&&e.jsx("p",{className:"text-xs text-slate-500",children:n.exchange.shipping_address})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",htmlFor:"exchange-status-notes",children:s(v?"admin.exchanges.statusDialog.notesRequiredLabel":"admin.exchanges.statusDialog.notesLabel")}),e.jsx(se,{id:"exchange-status-notes",value:n.adminNotes,onChange:W,rows:v?4:3,placeholder:s("admin.exchanges.statusDialog.notesPlaceholder")}),n.error&&e.jsx("p",{className:"text-xs text-red-500",children:n.error}),!v&&e.jsx("p",{className:"text-xs text-slate-500",children:s("admin.exchanges.statusDialog.notesOptional")})]})}),e.jsxs(R,{children:[e.jsx(r,{variant:"outline",onClick:b,disabled:g.isLoading,children:s("common.cancel")}),e.jsxs(r,{onClick:$,disabled:g.isLoading,children:[g.isLoading?e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}):null,s("admin.exchanges.statusDialog.confirm")]})]})]})}),m&&e.jsx(ce,{isOpen:!!m,onClose:()=>d(null),exchange:m})]})}function ce({isOpen:s,onClose:p,exchange:a}){const{t:i}=F();if(!s||!a)return null;const m=d=>{switch(d){case"pending":return e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(z,{className:"h-3 w-3 mr-1"})," ",i("admin.exchanges.status.pending")]});case"processing":return e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(N,{className:"h-3 w-3 mr-1 animate-spin"})," ",i("admin.exchanges.status.processing")]});case"shipped":return e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:i("admin.exchanges.status.shipped")});case"completed":return e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(A,{className:"h-3 w-3 mr-1"})," ",i("admin.exchanges.status.completed")]});case"rejected":return e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(C,{className:"h-3 w-3 mr-1"})," ",i("admin.exchanges.status.rejected")]});case"cancelled":return e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(C,{className:"h-3 w-3 mr-1"})," ",i("admin.exchanges.status.cancelled")]});default:return null}};return e.jsx(M,{open:s,onOpenChange:d=>d?null:p(),children:e.jsxs(L,{className:"sm:max-w-2xl",children:[e.jsx(q,{children:e.jsx(H,{children:i("admin.exchanges.detail.title")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2 rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-slate-900",children:["#",a.id]}),e.jsx("span",{className:"text-slate-500",children:_(a.created_at,"yyyy-MM-dd HH:mm","--")})]}),e.jsxs("div",{className:"text-slate-700",children:[e.jsx("p",{className:"font-medium",children:a.user_username}),a.user_email&&e.jsx("p",{className:"text-xs text-slate-500",children:a.user_email})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a.product_image_url&&e.jsx(Z,{src:a.product_image_url.startsWith("http")?a.product_image_url:void 0,filePath:a.product_image_url.startsWith("http")?void 0:a.product_image_url,alt:a.product_name,className:"h-12 w-12 rounded-lg object-cover",fallback:e.jsx("div",{className:"h-12 w-12 rounded-lg bg-gray-100 flex items-center justify-center text-[10px] text-gray-400",children:"IMG"})}),e.jsxs("div",{className:"text-sm text-slate-700",children:[e.jsxs("p",{className:"font-medium text-slate-900",children:[a.product_name," x ",u(a.quantity)]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["-",u(a.total_points)," ",i("common.points")]})]})]})]}),e.jsxs("div",{className:"grid gap-3 text-sm text-slate-600",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:i("admin.exchanges.detail.status")}),m(a.status)]}),a.shipping_address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:i("admin.exchanges.detail.address")}),e.jsx("p",{className:"text-slate-800",children:a.shipping_address})]}),a.contact_phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:i("admin.exchanges.detail.phone")}),e.jsx("p",{className:"text-slate-800",children:a.contact_phone})]}),a.admin_notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:i("admin.exchanges.detail.adminNotes")}),e.jsx("p",{className:"rounded-lg bg-slate-50 p-3 text-slate-800",children:a.admin_notes})]})]})]}),e.jsx(R,{children:e.jsx(r,{variant:"outline",onClick:p,children:i("common.close")})})]})})}function fe(){return e.jsx(re,{})}export{fe as default};
