import{r as n,j as c}from"./index-CxlEKgNF.js";const j="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit";function k(){return new Promise((l,o)=>{if(window.turnstile){l(window.turnstile);return}const s=document.querySelector("script[data-turnstile]");if(s){s.addEventListener("load",()=>l(window.turnstile)),s.addEventListener("error",o);return}const t=document.createElement("script");t.src=j,t.async=!0,t.defer=!0,t.setAttribute("data-turnstile","true"),t.onload=()=>l(window.turnstile),t.onerror=o,document.head.appendChild(t)})}const E=n.forwardRef(function({siteKey:o="0x4AAAAAAA0wcgSIUML5Ocs3",theme:s="auto",size:t="normal",action:T,cdata:b,tabindex:g=0,className:w="",onVerify:p,onExpire:m,onError:i,onLoad:x,require:v=!1},S){const d=n.useRef(null),e=n.useRef(null),[R,A]=n.useState(!1),[a,u]=n.useState(""),f=o||"",h=!f;n.useEffect(()=>{let r=!1;if(!h)return k().then(()=>{r||(A(!0),typeof x=="function"&&x(),_())}).catch(y=>{console.error("Failed to load Turnstile script:",y),typeof i=="function"&&i("script_load_failed")}),()=>{if(r=!0,window.turnstile&&e.current!=null)try{window.turnstile.remove(e.current)}catch{}e.current=null}},[f]);const _=()=>{if(!(!window.turnstile||!d.current||e.current!=null))try{e.current=window.turnstile.render(d.current,{sitekey:f,theme:s,size:t,action:T,cData:b,tabindex:g,"refresh-expired":"auto",callback:r=>{u(r),typeof p=="function"&&p(r)},"expired-callback":()=>{u(""),typeof m=="function"&&m()},"error-callback":()=>{u(""),typeof i=="function"&&i("widget_error")}})}catch(r){console.error("Failed to render Turnstile widget:",r),typeof i=="function"&&i("render_failed")}};return n.useImperativeHandle(S,()=>({reset:()=>{if(u(""),window.turnstile&&e.current!=null)try{window.turnstile.reset(e.current)}catch{}},getToken:()=>a,remove:()=>{if(window.turnstile&&e.current!=null)try{window.turnstile.remove(e.current)}catch{}e.current=null,u("")}}),[a]),h?c.jsx("div",{className:`w-full ${w}`,children:c.jsx("div",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded p-3",children:"未配置 Turnstile 站点密钥（VITE_TURNSTILE_SITE_KEY）。在开发环境将跳过验证码，生产环境请务必配置。"})}):c.jsxs("div",{className:w,children:[c.jsx("div",{ref:d,className:"inline-block"}),v&&!a&&R&&c.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"请先完成验证码验证"})]})});export{E as T};
