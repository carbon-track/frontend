import{u as ne,ag as ge,r as m,a4 as ve,j as e,B as p,I as z,Y as C,G as Se,Q as De,a9 as je,aa as fe,ab as ye,ac as be,ad as Ne,af as _e,n as g,az as R,$ as Ie,w as ze,v as ae,a3 as Re}from"./index-CUFwAzZ6.js";import{u as Q}from"./useMutation-2MMTcq-v.js";import{T as re}from"./textarea-YUKlOJOp.js";import{S as xe}from"./switch-DX6ZXUrP.js";import{A as Pe,a as Le,b as Te,c as Fe,d as Me,e as Ee,f as Be,g as Qe}from"./alert-dialog-DVJpUkm1.js";import{P as we}from"./Pagination-CZ9bGkk4.js";import{C as qe}from"./circle-plus-CZfmVAwD.js";import{S as Oe}from"./square-pen-CjAnf8iM.js";import{R as Ue}from"./rotate-ccw-BNokg1DV.js";import{T as He}from"./trash-2-DSStjKy2.js";import{I as $e,A as Ge}from"./ActivityDetailModal-6slgRduO.js";import{C as ue}from"./checkbox-CEC9yHvV.js";import{A as Ke,b as Ve,a as We}from"./Alert-DK8cqnXb.js";import{C as K}from"./circle-check-big-mIUUzVyE.js";import{C as Z}from"./circle-x-RNts_PJh.js";import{C as Xe}from"./clock-BbJReBsc.js";import{E as Ye}from"./eye-DR0dTY3l.js";import{T as Je,a as Ze,b as pe,c as he}from"./Tabs-P9_4p45D.js";import"./index-CJRIEbcJ.js";import"./image-DZkVgmT6.js";import"./chevron-left-BeZYR5an.js";import"./chevron-right-B33-i3D1.js";import"./Card-r7cmfhD9.js";const ie={id:null,name_zh:"",name_en:"",category:"",unit:"times",carbon_factor:"",description_zh:"",description_en:"",icon:"",sort_order:0,is_active:!0},et=["times","km","kg","hours","kWh","liters","days","minutes","sheets"];function tt(){var X,f,Y,J;const{t:s}=ne(),j=ge(),[n,V]=m.useState({search:"",category:"",status:"active",page:1,limit:10}),[l,w]=m.useState(ie),[F,y]=m.useState(null),[r,h]=m.useState(""),[W,A]=m.useState(!1),[P,q]=m.useState({open:!1,activity:null}),L=ve(["adminActivitiesLibrary",n],async()=>{const a=n.status==="inactive"||n.status==="all",d=n.status==="deleted",k=n.status&&n.status!=="all"?n.status:void 0,G={page:n.page,limit:n.limit,search:n.search||void 0,category:n.category||void 0,include_inactive:a?"true":void 0,include_deleted:d?"true":void 0,status:k};return(await R.getActivities(G)).data},{keepPreviousData:!0}),T=((f=(X=L.data)==null?void 0:X.data)==null?void 0:f.activities)??[],c=((J=(Y=L.data)==null?void 0:Y.data)==null?void 0:J.pagination)??{page:n.page,limit:n.limit,total:T.length,pages:1},M=m.useMemo(()=>{var a,d;return((d=(a=L.data)==null?void 0:a.data)==null?void 0:d.categories)??[]},[L.data]),S=()=>{A(!1),h(""),w(ie),y(null)},O=()=>{y(null),w({...ie}),h(""),A(!0)},te=a=>{y(a.id),w({id:a.id,name_zh:a.name_zh||"",name_en:a.name_en||"",category:a.category||"",unit:a.unit||"times",carbon_factor:a.carbon_factor??"",description_zh:a.description_zh||"",description_en:a.description_en||"",icon:a.icon||"",sort_order:a.sort_order??0,is_active:!!a.is_active}),h(""),A(!0)},U=Q(a=>R.createActivity(a),{onSuccess:()=>{g.success(s("admin.activities.library.saveSuccess","Activity saved successfully")),j.invalidateQueries("adminActivitiesLibrary"),S()},onError:()=>g.error(s("common.error"))}),E=Q(a=>R.updateActivity(a.id,a.data),{onSuccess:(a,d)=>{j.invalidateQueries("adminActivitiesLibrary"),(d==null?void 0:d.mode)==="toggle"?g.success(s("admin.activities.library.toggleActiveSuccess","Activity status updated")):(g.success(s("admin.activities.library.saveSuccess","Activity saved successfully")),S())},onError:()=>g.error(s("common.error"))}),b=Q(a=>R.deleteActivity(a),{onSuccess:()=>{g.success(s("admin.activities.library.deleteSuccess","Activity archived")),j.invalidateQueries("adminActivitiesLibrary"),q({open:!1,activity:null})},onError:()=>g.error(s("common.error"))}),D=Q(a=>R.restoreActivity(a),{onSuccess:()=>{g.success(s("admin.activities.library.restoreSuccess","Activity restored")),j.invalidateQueries("adminActivitiesLibrary")},onError:()=>g.error(s("common.error"))}),x=(a,d)=>{V(k=>({...k,[a]:d,page:a==="page"?d:1}))},v=(a,d)=>{w(k=>({...k,[a]:d}))},N=()=>{const a={name_zh:l.name_zh.trim(),name_en:l.name_en.trim(),category:l.category.trim(),unit:l.unit.trim()||"times",carbon_factor:parseFloat(l.carbon_factor),description_zh:l.description_zh.trim()||null,description_en:l.description_en.trim()||null,icon:l.icon.trim()||null,sort_order:Number.isFinite(Number(l.sort_order))?Number(l.sort_order):0,is_active:!!l.is_active};if(!a.name_zh||!a.name_en||!a.category||!a.unit||Number.isNaN(a.carbon_factor)){h(s("admin.activities.library.validationError","Please complete all required fields."));return}h(""),F?E.mutate({id:F,data:a}):U.mutate(a)},H=(a,d)=>{E.mutate({id:a.id,data:{is_active:d},mode:"toggle"})},_=a=>{q({open:!0,activity:a})},$=()=>{P.activity&&b.mutate(P.activity.id)},B=U.isLoading||E.isLoading;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("admin.activities.library.title","Activity Library")}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.activities.library.description","Maintain the catalogue of carbon-reduction activities available to users.")})]}),e.jsxs(p,{onClick:O,className:"w-full md:w-auto",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),s("admin.activities.library.create","Create Activity")]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.filters.search","Search")}),e.jsx(z,{value:n.search,onChange:a=>x("search",a.target.value),placeholder:s("admin.activities.library.searchPlaceholder","Search by name or description...")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.filters.category","Category")}),e.jsxs("select",{value:n.category,onChange:a=>x("category",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:s("common.all")}),M.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.filters.status","Status")}),e.jsxs("select",{value:n.status,onChange:a=>x("status",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"active",children:s("admin.activities.library.status.active","Active")}),e.jsx("option",{value:"inactive",children:s("admin.activities.library.status.inactive","Inactive")}),e.jsx("option",{value:"deleted",children:s("admin.activities.library.status.deleted","Deleted")}),e.jsx("option",{value:"all",children:s("admin.activities.library.status.all","All")})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.library.table.name","Name")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.library.table.category","Category")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.library.table.unit","Unit")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.library.table.carbon_factor","Carbon factor")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.library.table.status","Status")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.library.table.updated_at","Updated")}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.library.table.actions","Actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L.isLoading?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-sm text-gray-500",children:e.jsx(C,{className:"mx-auto h-5 w-5 animate-spin"})})}):T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-sm text-gray-500",children:s("admin.activities.library.empty","No activities match the current filters.")})}):T.map(a=>{const d=a.updated_at?Se(new Date(a.updated_at),"yyyy-MM-dd HH:mm"):"—",k=a.deleted_at?s("admin.activities.library.status.deleted","Deleted"):a.is_active?s("admin.activities.library.status.active","Active"):s("admin.activities.library.status.inactive","Inactive");return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3 text-sm",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:a.name_zh}),e.jsx("div",{className:"text-gray-500 text-xs",children:a.name_en})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(De,{variant:"secondary",children:a.category||"—"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a.unit}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Number(a.carbon_factor).toFixed(4)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{disabled:!!a.deleted_at,checked:!!a.is_active,onCheckedChange:G=>H(a,G)}),e.jsx("span",{className:"text-xs text-gray-600",children:k})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:d}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!a.deleted_at&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>te(a),children:e.jsx(Oe,{className:"h-4 w-4"})}),a.deleted_at?e.jsx(p,{variant:"outline",size:"sm",onClick:()=>D.mutate(a.id),children:e.jsx(Ue,{className:"h-4 w-4"})}):e.jsx(p,{variant:"outline",size:"sm",onClick:()=>_(a),children:e.jsx(He,{className:"h-4 w-4"})})]})})]},a.id)})})]})}),e.jsx(we,{currentPage:c.page,totalPages:c.pages,onPageChange:a=>x("page",a),itemsPerPage:c.limit,totalItems:c.total})]}),e.jsx(je,{open:W,onOpenChange:a=>!a&&!B&&S(),children:e.jsxs(fe,{children:[e.jsxs(ye,{children:[e.jsx(be,{children:F?s("admin.activities.library.edit","Edit Activity"):s("admin.activities.library.create","Create Activity")}),e.jsx(Ne,{children:s("admin.activities.library.description","Maintain the catalogue of carbon-reduction activities available to users.")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.name_zh","Name (Chinese)")}),e.jsx(z,{value:l.name_zh,onChange:a=>v("name_zh",a.target.value),placeholder:"例如：公交地铁通勤"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.name_en","Name (English)")}),e.jsx(z,{value:l.name_en,onChange:a=>v("name_en",a.target.value),placeholder:"e.g. Use public transport"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.category","Category")}),e.jsx(z,{value:l.category,onChange:a=>v("category",a.target.value),placeholder:"transport",list:"activity-category-options"}),e.jsx("datalist",{id:"activity-category-options",children:M.map(a=>e.jsx("option",{value:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.unit","Unit")}),e.jsx("select",{value:l.unit,onChange:a=>v("unit",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:et.map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.carbon_factor","Carbon factor")}),e.jsx(z,{type:"number",step:"0.0001",value:l.carbon_factor,onChange:a=>v("carbon_factor",a.target.value),placeholder:"0.1234"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.sort_order","Sort order")}),e.jsx(z,{type:"number",value:l.sort_order,onChange:a=>v("sort_order",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.description_zh","Description (Chinese)")}),e.jsx(re,{value:l.description_zh,onChange:a=>v("description_zh",a.target.value),rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.description_en","Description (English)")}),e.jsx(re,{value:l.description_en,onChange:a=>v("description_en",a.target.value),rows:3})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.icon","Icon key")}),e.jsx(z,{value:l.icon,onChange:a=>v("icon",a.target.value),placeholder:"optional"})]}),e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.library.fields.is_active","Active")}),e.jsx(xe,{checked:!!l.is_active,onCheckedChange:a=>v("is_active",a)})]})})]}),r&&e.jsx("p",{className:"text-sm text-red-600",children:r})]}),e.jsxs(_e,{children:[e.jsx(p,{variant:"outline",onClick:S,disabled:B,children:s("admin.activities.library.actions.cancel","Cancel")}),e.jsxs(p,{onClick:N,disabled:B,children:[B&&e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),s("admin.activities.library.actions.save","Save")]})]})]})}),e.jsx(Pe,{open:P.open,onOpenChange:a=>!a&&q({open:!1,activity:null}),children:e.jsxs(Le,{children:[e.jsxs(Te,{children:[e.jsx(Fe,{children:s("admin.activities.library.actions.delete","Disable")}),e.jsx(Me,{children:s("admin.activities.library.confirmDelete","Disable and archive this activity?")})]}),e.jsxs(Ee,{children:[e.jsx(Be,{children:s("common.cancel")}),e.jsxs(Qe,{onClick:$,children:[b.isLoading&&e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),s("common.confirm")]})]})]})})]})}function st(){var oe,de,me;const{t:s}=ne(),j=ge(),[n,V]=m.useState({search:"",status:"pending",page:1,limit:10,sort:"created_at_asc"}),[l,w]=m.useState(null),[F,y]=m.useState([]),[r,h]=m.useState({open:!1,mode:null,activity:null,bulkIds:[],reason:"",error:""}),[W,A]=m.useState(!1),[P,q]=m.useState(!0),[ee,L]=m.useState(15e3),T=m.useRef(!1),{data:c,isLoading:M,error:S,isFetching:O,refetch:te}=ve(["adminActivities",n],()=>R.getActivityRecords(n).then(t=>t.data),{keepPreviousData:!0,refetchInterval:P&&!l?ee:!1,refetchIntervalInBackground:!0});m.useEffect(()=>{!M&&!S&&(T.current=!0)},[M,S]);const U=((oe=c==null?void 0:c.data)==null?void 0:oe.activities)||((de=c==null?void 0:c.data)==null?void 0:de.records)||(c==null?void 0:c.data)||(c==null?void 0:c.activities)||[],E=Array.isArray(U)?U:[],b=m.useMemo(()=>E.map(t=>{const i="status"in t&&("carbon_saved"in t||"points_earned"in t||"user_id"in t),o=t.user_username||t.username||t.user_name||t.user||"-",u=t.activity_name||t.activity_name_zh||t.activity_name_en||t.combined_name||t.name_zh||t.name_en||s("activities.unknownActivity"),I=t.activity_category||t.category||"unknown",se=t.activity_unit||t.unit||"",Ae=t.description||t.notes||t.note||t.remark||t.comments||"";return{id:t.id,images:t.images||[],user_username:o,activity_name:u,activity_category:I||"unknown",activity_unit:se||"-",data_value:t.data_value||t.amount||t.data||0,carbon_saved:t.carbon_saved||0,points_earned:t.points_earned||0,status:t.status||(i?"pending":t.is_active?"approved":"pending"),created_at:t.created_at||t.date||t.updated_at||null,description:Ae}}),[E,s]);m.useEffect(()=>{const t=new Set(b.filter(i=>i.status==="pending").map(i=>i.id));y(i=>{const o=i.filter(u=>t.has(u));return o.length===i.length&&o.every((u,I)=>u===i[I])?i:o})},[b]);const D=b.filter(t=>t.status==="pending").map(t=>t.id),x=F.filter(t=>D.includes(t)),v=D.length===0?!1:x.length===D.length?!0:x.length>0?"indeterminate":!1,N=((me=c==null?void 0:c.data)==null?void 0:me.pagination)||(c==null?void 0:c.pagination)||{page:n.page,limit:n.limit,total:b.length,pages:1},H=Q(({id:t,status:i,admin_notes:o})=>R.reviewActivity(t,{status:i,admin_notes:o}),{onSuccess:()=>{A(!0),setTimeout(()=>{A(!1),j.invalidateQueries("adminActivities"),j.invalidateQueries("activities"),g.success(s("admin.activities.reviewSuccess")),w(null),f()},600)},onError:t=>{g.error(s("admin.activities.reviewFailed")),console.error("Activity review failed:",t)}}),_=Q(({action:t,review_note:i,record_ids:o})=>R.reviewActivitiesBulk({action:t,review_note:i,record_ids:o}),{onSuccess:()=>{A(!0),setTimeout(()=>{A(!1),j.invalidateQueries("adminActivities"),j.invalidateQueries("activities"),g.success(s("admin.activities.reviewSuccess")),w(null),y([]),f()},600)},onError:t=>{g.error(s("admin.activities.reviewFailed")),console.error("Bulk activity review failed:",t)}}),$=(t,i)=>{V(o=>({...o,[t]:i,page:1}))},B=t=>{V(i=>({...i,page:t}))},X=t=>{w(t)},f=()=>{h({open:!1,mode:null,activity:null,bulkIds:[],reason:"",error:""})},Y=t=>{h({open:!0,mode:"approve",activity:t,bulkIds:[],reason:"",error:""})},J=t=>{h({open:!0,mode:"reject",activity:t,bulkIds:[],reason:"",error:""})},a=()=>y([]),d=(t,i,o)=>{i==="pending"&&y(u=>{const I=u.includes(t);return o&&!I?[...u,t]:!o&&I?u.filter(se=>se!==t):u})},k=t=>{y(t?i=>Array.from(new Set([...i,...D])):i=>i.filter(o=>!D.includes(o)))},G=()=>{x.length!==0&&h({open:!0,mode:"approve",activity:null,bulkIds:x,reason:"",error:""})},le=()=>{x.length!==0&&h({open:!0,mode:"reject",activity:null,bulkIds:x,reason:"",error:""})},ke=t=>{const i=t.target.value;h(o=>({...o,reason:i,error:i.trim()?"":o.error}))},Ce=()=>{const t=r.bulkIds||[];if(t.length>0){if(r.mode==="approve"){_.mutate({action:"approve",record_ids:t},{onSettled:f});return}const u=r.reason.trim();if(!u){h(I=>({...I,error:s("admin.activities.rejectReasonRequired","请填写拒绝原因")}));return}_.mutate({action:"reject",review_note:u,record_ids:t},{onSettled:f});return}if(!r.activity)return;const i={id:r.activity.id};if(r.mode==="approve"){H.mutate({...i,status:"approved"},{onSettled:f});return}const o=r.reason.trim();if(!o){h(u=>({...u,error:s("admin.activities.rejectReasonRequired","请填写拒绝原因")}));return}H.mutate({...i,status:"rejected",admin_notes:o},{onSettled:f})},ce=H.isLoading||_.isLoading;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("admin.activities.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.activities.description")}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(z,{type:"text",value:n.search,onChange:t=>$("search",t.target.value),placeholder:s("admin.activities.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.activities.status")}),e.jsxs("select",{value:n.status,onChange:t=>$("status",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:s("common.all")}),e.jsx("option",{value:"pending",children:s("activities.status.pending")}),e.jsx("option",{value:"approved",children:s("activities.status.approved")}),e.jsx("option",{value:"rejected",children:s("activities.status.rejected")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("common.sort.sortBy")}),e.jsxs("select",{value:n.sort,onChange:t=>$("sort",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"created_at_asc",children:s("common.sort.oldest")}),e.jsx("option",{value:"created_at_desc",children:s("common.sort.newest")})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:col-span-3 lg:col-span-1",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 space-x-2",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-green-600 focus:ring-green-500",checked:P,onChange:t=>q(t.target.checked)}),e.jsx("span",{children:s("common.autoRefresh")||"Auto Refresh"})]}),P&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:ee,onChange:t=>L(parseInt(t.target.value,10)),className:"w-full px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:5e3,children:"5s"}),e.jsx("option",{value:1e4,children:"10s"}),e.jsx("option",{value:15e3,children:"15s"}),e.jsx("option",{value:3e4,children:"30s"}),e.jsx("option",{value:6e4,children:"60s"})]}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>te(),disabled:O,children:O?e.jsx(C,{className:"h-3 w-3 animate-spin"}):s("common.refreshNow")||"Refresh"})]})]})]})}),!T.current&&M?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-green-500"})}):S?e.jsxs(Ke,{variant:"destructive",children:[e.jsx(Ve,{children:s("common.error")}),e.jsx(We,{children:s("errors.loadFailed")})]}):b.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-xl font-semibold",children:s("admin.activities.noActivitiesFound")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("admin.activities.tryDifferentFilters")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("div",{children:x.length>0?e.jsx("p",{className:"text-sm text-gray-600",children:s("admin.activities.selectedCount",{count:x.length})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.activities.selectionHint","选择待审核的记录后即可批量处理。")})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:a,disabled:x.length===0||_.isLoading,children:s("admin.activities.clearSelection","Clear selection")}),e.jsxs(p,{variant:"outline",size:"sm",onClick:G,disabled:x.length===0||_.isLoading,className:"group inline-flex items-center transition-transform duration-150 hover:scale-105",children:[_.isLoading&&r.bulkIds&&r.bulkIds.length>0&&r.mode==="approve"?e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(K,{className:"mr-2 h-4 w-4 transition-transform duration-200 group-hover:scale-110"}),s("admin.activities.bulkApprove","批量通过")]}),e.jsxs(p,{variant:"destructive",size:"sm",onClick:le,disabled:x.length===0||_.isLoading,children:[_.isLoading&&r.bulkIds&&r.bulkIds.length>0&&r.mode==="reject"?e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Z,{className:"mr-2 h-4 w-4"}),s("admin.activities.bulkReject","批量驳回")]})]})]}),e.jsxs("div",{className:"overflow-x-auto bg-white rounded-lg shadow-sm border relative",children:[T.current&&O&&e.jsxs("div",{className:"absolute top-2 right-2 flex items-center text-xs text-gray-500",children:[e.jsx(C,{className:"h-3 w-3 animate-spin mr-1"})," ",s("common.loading")]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsx(ue,{"aria-label":s("admin.activities.selectAll","Select all pending"),checked:v,onCheckedChange:t=>k(t===!0),disabled:D.length===0})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.table.images","Images")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.table.user")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.table.activity")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.table.data")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.table.carbonSaved")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.table.points")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.table.status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("admin.activities.table.date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("common.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsx(ue,{"aria-label":s("admin.activities.selectRecord","Select record"),checked:F.includes(t.id),disabled:t.status!=="pending",onCheckedChange:i=>d(t.id,t.status,i===!0)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap align-top",children:e.jsx($e,{images:t.images||[],maxThumbnails:1})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.user_username}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.activity_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s(`activities.categories.${t.activity_category}`,t.activity_category)}),t.description&&e.jsxs("div",{className:"mt-1 text-xs text-gray-600 flex items-start max-w-[36rem]",children:[e.jsx(ze,{className:"h-3 w-3 mr-1 mt-[2px] text-gray-500"}),e.jsx("span",{className:"truncate",title:t.description,children:t.description})]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[ae(t.data_value)," ",s(`units.${t.activity_unit}`,t.activity_unit)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[ae(t.carbon_saved)," kg CO2e"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold",children:["+",ae(t.points_earned)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[t.status==="pending"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(Xe,{className:"h-3 w-3 mr-1"})," ",s("activities.status.pending")]}),t.status==="approved"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(K,{className:"h-3 w-3 mr-1"})," ",s("activities.status.approved")]}),t.status==="rejected"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"})," ",s("activities.status.rejected")]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:Re(t.created_at,"yyyy-MM-dd")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>X(t),className:"mr-2",children:e.jsx(Ye,{className:"h-4 w-4"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Y(t),className:"mr-2 text-green-600 hover:text-green-800",children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>J(t),className:"text-red-600 hover:text-red-800",children:e.jsx(Z,{className:"h-4 w-4"})})]})]})]},t.id))})]})]}),e.jsx(we,{currentPage:N.page||N.current_page||1,totalPages:N.pages||N.total_pages||1,onPageChange:B,itemsPerPage:N.limit||N.per_page||n.limit,totalItems:N.total||N.total_items||b.length})]}),e.jsx(Ge,{activity:l,isOpen:!!l,onClose:()=>w(null)}),e.jsx(je,{open:r.open,onOpenChange:t=>t?null:f(),children:e.jsxs(fe,{className:"sm:max-w-lg",children:[e.jsxs(ye,{children:[e.jsx(be,{children:r.mode==="approve"?s("admin.activities.dialog.approveTitle","确认通过审核"):s("admin.activities.dialog.rejectTitle","拒绝该活动")}),e.jsx(Ne,{children:r.mode==="approve"?s("admin.activities.dialog.approveDescription","该活动将计入用户积分并发送通知。"):s("admin.activities.dialog.rejectDescription","请填写拒绝原因，我们会通知提交者。")})]}),r.activity&&e.jsxs("div",{className:"mb-4 rounded-xl border border-emerald-200/40 bg-emerald-50/40 px-3 py-2 text-sm text-emerald-700",children:[e.jsx("span",{className:"font-medium",children:r.activity.activity_name})," · ",r.activity.user_username]}),r.mode==="reject"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"reject-reason",children:s("admin.activities.dialog.reasonLabel","拒绝原因")}),e.jsx(re,{id:"reject-reason",rows:4,value:r.reason,onChange:ke,placeholder:s("admin.activities.dialog.reasonPlaceholder","请简要说明拒绝的原因")}),r.error&&e.jsx("p",{className:"text-xs text-red-500",children:r.error})]}),e.jsxs(_e,{children:[e.jsx(p,{variant:"outline",onClick:f,children:s("common.cancel","取消")}),e.jsxs(p,{variant:r.mode==="reject"?"destructive":"default",onClick:Ce,disabled:ce,className:"group inline-flex items-center transition-transform duration-150 hover:scale-105",children:[W?e.jsxs("span",{className:"inline-flex items-center bg-green-600 text-white px-3 py-1 rounded-md animate-pulse",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),s("admin.activities.dialog.approveAction","通过审核")]}):ce?e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}):r.mode==="approve"?e.jsx(K,{className:"mr-2 h-4 w-4 transition-transform duration-200 group-hover:scale-110"}):e.jsx(Z,{className:"mr-2 h-4 w-4"}),!W&&(r.mode==="approve"?s("admin.activities.dialog.approveAction","通过审核"):s("admin.activities.dialog.rejectAction","拒绝活动"))]})]})]})})]})}function Ct(){const{t:s}=ne(),[j,n]=m.useState("library");return e.jsxs(Je,{value:j,onValueChange:n,className:"space-y-6",children:[e.jsxs(Ze,{children:[e.jsx(pe,{value:"library",children:s("admin.activities.tab.library","Activity Library")}),e.jsx(pe,{value:"review",children:s("admin.activities.tab.review","Record Review")})]}),e.jsx(he,{value:"library",children:e.jsx(tt,{})}),e.jsx(he,{value:"review",children:e.jsx(st,{})})]})}export{Ct as default};
