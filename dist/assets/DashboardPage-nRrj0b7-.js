import{c as Y,j as e,u as D,r as g,B as k,i as ie,C as ce,S as le,k as H,l as de,A as y,m as oe,o as J,p as M,q as P,d as he,b as me,U as O,n as W}from"./index-gVjPGDSR.js";import{C as _,d as A,b as R,a as S,c as z}from"./Card-mU5PnjsJ.js";import{T as Z}from"./trending-up-BEvyoxLN.js";import{R as xe,C as X,X as G,Y as K,T as Q,L as ge,B as ue}from"./generateCategoricalChart-D8yTw8TJ.js";import{L as be,B as pe}from"./BarChart-BfK3Y57p.js";import{A as je}from"./ActivityDetailModal-BCCa1g1O.js";import{C as fe}from"./clock-DuwcRvyH.js";import{E as V}from"./eye-rPDDeESx.js";import{C as ve}from"./circle-x-Dg0jwZOu.js";import{C as Ne}from"./circle-check-big-C49i_frZ.js";import{P as we}from"./plus-DWz52CPq.js";import{R as ye}from"./refresh-cw-C8KlFKoL.js";import{L as _e}from"./lock-VvCCS9jr.js";import{A as Ae,a as ke}from"./Alert-O78fnKZl.js";import"./image-DBdPtxpN.js";import"./chevron-left-Cc7E7fFt.js";import"./chevron-right-CV5NH_0_.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M5 12h14",key:"1ays0h"}]],Se=Y("minus",Ce);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],$e=Y("trending-down",De);function L({title:s,value:d,unit:l="",change:a=null,changeType:u="neutral",icon:n,color:x="blue",loading:b=!1}){const h={blue:{bg:"bg-blue-50",icon:"text-blue-600",value:"text-blue-900"},green:{bg:"bg-green-50",icon:"text-green-600",value:"text-green-900"},orange:{bg:"bg-orange-50",icon:"text-orange-600",value:"text-orange-900"},purple:{bg:"bg-purple-50",icon:"text-purple-600",value:"text-purple-900"}},p={increase:Z,decrease:$e,neutral:Se},j={increase:"text-green-600",decrease:"text-red-600",neutral:"text-gray-600"},i=p[u],o=h[x];return b?e.jsx(_,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded"})]}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})})}):e.jsx(_,{className:"hover:shadow-md transition-shadow duration-200",children:e.jsxs(A,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(R,{className:"text-sm font-medium text-gray-600",children:s}),n&&e.jsx("div",{className:`p-2 rounded-lg ${o.bg}`,children:e.jsx(n,{className:`h-5 w-5 ${o.icon}`})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:`text-2xl font-bold ${o.value}`,children:typeof d=="number"?d.toLocaleString():d}),l&&e.jsx("span",{className:"text-sm text-gray-500",children:l})]}),a!==null&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${j[u]}`,children:[e.jsx(i,{className:"h-4 w-4"}),e.jsx("span",{children:typeof a=="number"?`${a>0?"+":""}${a.toFixed(1)}%`:a}),e.jsx("span",{className:"text-gray-500 ml-1",children:"vs ä¸Šæœˆ"})]})]})]})})}function Le({data:s=[],type:d="line",title:l,description:a,dataKey:u="value",xAxisKey:n="date",color:x="#10b981",loading:b=!1}){const{t:h}=D();if(b)return e.jsxs(_,{children:[e.jsx(S,{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})}),e.jsx(A,{children:e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"})})]});const p=(i,o)=>o==="carbon_saved"?[`${i} kg COâ‚‚`,h("activities.carbonSaved")]:o==="points"?[`${i} ${h("dashboard.points")}`,h("dashboard.points")]:o==="activities"?[`${i} ${h("dashboard.activities")}`,h("dashboard.activities")]:[i,o],j=i=>typeof i=="string"&&i.includes("-")?new Date(i).toLocaleDateString("zh-CN",{month:"short",day:"numeric"}):i;return e.jsxs(_,{children:[e.jsxs(S,{children:[e.jsx(R,{children:l}),a&&e.jsx(z,{children:a})]}),e.jsx(A,{children:s.length===0?e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“Š"}),e.jsx("p",{children:h("dashboard.noDataAvailable")}),e.jsx("p",{className:"text-sm mt-1",children:h("dashboard.startRecordingActivities")})]})}):e.jsx("div",{className:"h-64",children:e.jsx(xe,{width:"100%",height:"100%",children:d==="line"?e.jsxs(be,{data:s,children:[e.jsx(X,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(G,{dataKey:n,tickFormatter:j,stroke:"#666",fontSize:12}),e.jsx(K,{stroke:"#666",fontSize:12}),e.jsx(Q,{formatter:p,labelStyle:{color:"#666"},contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(ge,{type:"monotone",dataKey:u,stroke:x,strokeWidth:2,dot:{fill:x,strokeWidth:2,r:4},activeDot:{r:6,stroke:x,strokeWidth:2}})]}):e.jsxs(pe,{data:s,children:[e.jsx(X,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(G,{dataKey:n,tickFormatter:j,stroke:"#666",fontSize:12}),e.jsx(K,{stroke:"#666",fontSize:12}),e.jsx(Q,{formatter:p,labelStyle:{color:"#666"},contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(ue,{dataKey:u,fill:x,radius:[4,4,0,0]})]})})})})]})}function Re({activities:s=[],loading:d=!1,onViewAll:l}){const{t:a,tUnit:u}=D(),[n,x]=g.useState(null),[b,h]=g.useState(!1),p=t=>{switch(t){case"approved":return e.jsx(Ne,{className:"h-4 w-4 text-green-600"});case"rejected":return e.jsx(ve,{className:"h-4 w-4 text-red-600"});case"pending":default:return e.jsx(ce,{className:"h-4 w-4 text-orange-600"})}},j=t=>{switch(t){case"approved":return"text-green-600 bg-green-50";case"rejected":return"text-red-600 bg-red-50";case"pending":default:return"text-orange-600 bg-orange-50"}},i=t=>{const f=new Date(t),$=Math.abs(new Date-f),N=Math.ceil($/(1e3*60*60*24));return N===1?a("date.today"):N===2?a("date.yesterday"):N<=7?`${N-1} ${a("date.daysAgo")}`:f.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},o=t=>t.activity_name_zh||t.activity_name_en||t.activity_name||a("activities.unknownActivity");return d?e.jsxs(_,{children:[e.jsx(S,{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})}),e.jsx(A,{children:e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded"})]})},t))})})]}):e.jsxs(_,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-blue-600"}),a("dashboard.recentActivities")]}),e.jsx(z,{children:a("dashboard.recentActivitiesDesc")})]}),s.length>0&&e.jsxs(k,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),a("dashboard.viewAll")]})]})}),e.jsx(A,{children:s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸŒ±"}),e.jsx("p",{className:"text-gray-600 mb-2",children:a("dashboard.noRecentActivities")}),e.jsx("p",{className:"text-sm text-gray-500",children:a("dashboard.startRecordingHint")}),e.jsx(k,{className:"mt-4",onClick:()=>window.location.href="/calculate",children:a("dashboard.recordFirstActivity")})]}):e.jsxs("div",{className:"space-y-4",children:[s.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:p(t.status)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:o(t)}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${j(t.status)}`,children:a(`activities.status.${t.status}`)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsx("span",{children:i(t.created_at)}),e.jsxs("span",{children:[t.data,t.unit?` ${u(t.unit)}`:""]}),(()=>{const f=ie(t.carbon_saved,2);return f!==null?e.jsxs("span",{className:"text-green-600",children:[f," kg COâ‚‚"]}):null})(),t.points_earned&&t.status==="approved"&&e.jsxs("span",{className:"text-blue-600",children:["+",t.points_earned," ",a("dashboard.points")]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>{x(t),h(!0)},children:e.jsx(V,{className:"h-4 w-4"})})})]},t.id)),s.length>5&&e.jsx("div",{className:"text-center pt-4 border-t",children:e.jsx(k,{variant:"outline",onClick:l,children:a("dashboard.viewAllActivities",{count:s.length})})})]})}),e.jsx(je,{activity:n,isOpen:b,onClose:()=>{h(!1),x(null)}})]})}function Te({userStats:s={},onActionClick:d}){const{t:l}=D(),a=[{id:"record",title:l("dashboard.quickActions.recordActivity"),description:l("dashboard.quickActions.recordActivityDesc"),icon:we,color:"bg-green-500 hover:bg-green-600",href:"/calculate",primary:!0},{id:"store",title:l("dashboard.quickActions.browseStore"),description:l("dashboard.quickActions.browseStoreDesc"),icon:le,color:"bg-blue-500 hover:bg-blue-600",href:"/store",badge:s.available_products||null},{id:"messages",title:l("dashboard.quickActions.checkMessages"),description:l("dashboard.quickActions.checkMessagesDesc"),icon:H,color:"bg-purple-500 hover:bg-purple-600",href:"/messages",badge:s.unread_messages||null},{id:"history",title:l("dashboard.quickActions.viewHistory"),description:l("dashboard.quickActions.viewHistoryDesc"),icon:de,color:"bg-orange-500 hover:bg-orange-600",href:"/activities"},{id:"achievements",title:l("dashboard.quickActions.achievements"),description:l("dashboard.quickActions.achievementsDesc"),icon:y,color:"bg-yellow-500 hover:bg-yellow-600",href:"/achievements",badge:s.new_achievements||null},{id:"settings",title:l("dashboard.quickActions.settings"),description:l("dashboard.quickActions.settingsDesc"),icon:oe,color:"bg-gray-500 hover:bg-gray-600",href:"/profile"}],u=n=>{d?d(n):n.href&&(window.location.href=n.href)};return e.jsxs(_,{children:[e.jsxs(S,{children:[e.jsx(R,{children:l("dashboard.quickActions.title")}),e.jsx(z,{children:l("dashboard.quickActions.description")})]}),e.jsxs(A,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:a.map(n=>{const x=n.icon;return e.jsxs(k,{variant:n.primary?"default":"outline",className:`h-auto w-full p-4 flex flex-col items-start justify-start text-left gap-3 relative whitespace-normal ${n.primary?n.color:"hover:bg-gray-50"}`,onClick:()=>u(n),children:[n.badge&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center",children:n.badge>99?"99+":n.badge}),e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(x,{className:`h-6 w-6 mt-1 flex-shrink-0 ${n.primary?"text-white":"text-gray-700"}`}),e.jsx("span",{className:`text-lg font-semibold flex-1 ${n.primary?"text-white":"text-gray-800"}`,children:n.title})]}),e.jsx("p",{className:`text-sm ${n.primary?"text-gray-200":"text-gray-500"} text-wrap`,children:n.description})]},n.id)})}),s.points_balance!==void 0&&s.points_balance<100&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:l("dashboard.quickActions.pointsHint")})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:l("dashboard.quickActions.pointsHintDesc",{current:s.points_balance||0,needed:100-(s.points_balance||0)})})]}),s.pending_reviews>0&&e.jsxs("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-800",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:l("dashboard.quickActions.pendingReviews")})]}),e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:l("dashboard.quickActions.pendingReviewsDesc",{count:s.pending_reviews})})]})]})]})}function qe({badges:s=[],userBadges:d=[],loading:l=!1,onTriggerAuto:a,isAdmin:u=!1}){const{t:n}=D(),x=new Map;d.forEach(i=>{const o=(i==null?void 0:i.user_badge)||{};o.badge_id&&x.set(o.badge_id,o)});const b=x.size,h=s.length,p=h>0?Math.round(b/h*100):0,j=s.slice(0,8);return e.jsxs("div",{className:"bg-white border rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-yellow-500"}),n("dashboard.achievementBadges","æˆå°±å¾½ç« ")]}),e.jsx("p",{className:"text-sm text-gray-500",children:h>0?n("dashboard.badgeProgress","{{owned}} / {{total}} å·²è§£é”",{owned:b,total:h}):n("dashboard.noBadgesAvailable","æš‚æ—¶æ²¡æœ‰å¯ç”¨çš„æˆå°±å¾½ç« ")})]}),u&&e.jsxs(k,{variant:"outline",size:"sm",onClick:a,disabled:l,className:"flex items-center gap-2",children:[e.jsx(ye,{className:`h-4 w-4 ${l?"animate-spin":""}`}),n("dashboard.triggerBadgeAuto","è§¦å‘è‡ªåŠ¨æŽˆäºˆ")]})]}),l?e.jsx("div",{className:"grid grid-cols-4 gap-4",children:Array.from({length:8}).map((i,o)=>e.jsx("div",{className:"animate-pulse rounded-lg bg-gray-100 aspect-square"},o))}):h===0?e.jsx("div",{className:"text-sm text-gray-500 bg-gray-50 rounded-md p-4 text-center",children:n("dashboard.noBadgesHint","å®Œæˆæ›´å¤šçŽ¯ä¿è¡ŒåŠ¨åŽï¼Œå°†ä¼šå¼€æ”¾æˆå°±å¾½ç« åŠŸèƒ½ã€‚")}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-green-500 to-emerald-400",style:{width:`${p}%`}})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:j.map(i=>{const o=x.has(i.id),t=x.get(i.id);return e.jsxs("div",{className:`relative border rounded-lg p-3 flex flex-col items-center gap-3 transition ${o?"border-green-500 shadow-md":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-50 flex items-center justify-center overflow-hidden border",children:i.icon_url||i.icon_path?e.jsx(J,{src:i.icon_presigned_url||i.icon_url,filePath:!i.icon_presigned_url&&!i.icon_url?i.icon_path:void 0,alt:i.name_zh||i.name_en,className:"w-full h-full object-cover",fallback:e.jsx("div",{className:"text-gray-400 text-xs",children:"IMG"})}):e.jsx(y,{className:"h-8 w-8 text-gray-300"})}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:i.name_zh||i.name_en}),e.jsx("p",{className:"text-xs text-gray-500",children:i.name_en})]}),e.jsx("div",{className:"w-full text-center",children:o?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-green-600",children:[e.jsx(y,{className:"h-3 w-3"}),n("dashboard.badgeUnlocked","å·²è§£é”")]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(_e,{className:"h-3 w-3"}),n("dashboard.badgeLocked","å¾…è§£é”")]})}),o&&(t==null?void 0:t.awarded_at)&&e.jsxs("p",{className:"text-[11px] text-gray-400",children:[n("dashboard.badgeAwardedAt","è§£é”æ—¶é—´"),": ",new Date(t.awarded_at).toLocaleDateString()]})]},i.id)})})]})]})}function Be(){const{t:s}=D(),[d,l]=g.useState(null),[a,u]=g.useState({}),[n,x]=g.useState([]),[b,h]=g.useState([]),[p,j]=g.useState([]),[i,o]=g.useState([]),[t,f]=g.useState(!0),[T,$]=g.useState(""),N=g.useRef(!1),F=!!(d!=null&&d.is_admin),ee=r=>{if(!r)return"C";const c=String(r).trim();return c?c.charAt(0).toUpperCase():"C"},se=(r,c="h-8 w-8")=>{const m=(r==null?void 0:r.username)||(r==null?void 0:r.name)||"",w=ee(m),v=e.jsx("div",{className:`${c} rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-semibold`,children:w}),I=r==null?void 0:r.avatar_path,C=r==null?void 0:r.avatar_url;if(I||C){const E=typeof C=="string"&&/^https?:\/\//i.test(C),ne=I||(E?void 0:C);return e.jsx(J,{filePath:ne,src:E?C:void 0,alt:m||"avatar",className:`${c} rounded-full object-cover border border-white shadow-sm`,fallback:v})}return v},q=g.useCallback(async()=>{try{f(!0);const[r,c,m,w,v]=await Promise.all([M.getUserStats(),M.getChartData({period:30}),M.getRecentActivities({limit:10}),P.list(),P.myBadges()]);r.data.success&&u(r.data.data),c.data.success&&x(c.data.data),m.data.success&&h(m.data.data),w.data.success&&j(w.data.data||[]),v.data.success&&o(v.data.data||[])}catch(r){$(r.message||s("dashboard.loadError"))}finally{f(!1)}},[s]);g.useEffect(()=>{if(N.current)return;N.current=!0;const{user:r}=he();r?(l(r),q()):($(s("dashboard.notLoggedIn")),f(!1))},[s,q]);const ae=r=>{r.href&&(window.location.href=r.href)},te=()=>{window.location.href="/activities"},U=g.useMemo(()=>new Intl.DateTimeFormat(void 0,{year:"numeric",month:"long"}),[]),B=g.useMemo(()=>(Array.isArray(a.monthly_achievements)?a.monthly_achievements:[]).map(c=>{const m=(c==null?void 0:c.month)||"";let w=m;if(m){const v=new Date(`${m}-01T00:00:00`);Number.isNaN(v.getTime())||(w=U.format(v))}return{month:m,label:w,points:Number((c==null?void 0:c.points_earned)??(c==null?void 0:c.points)??0),carbon:Number((c==null?void 0:c.carbon_saved)??0),records:Number((c==null?void 0:c.records_count)??0)}}),[a.monthly_achievements,U]),re=async()=>{try{await P.triggerAuto(),W.success(s("dashboard.badgeAutoTriggered","å·²è§¦å‘è‡ªåŠ¨æŽˆäºˆæµç¨‹")),await q()}catch{W.error(s("dashboard.badgeAutoTriggerFailed","è§¦å‘è‡ªåŠ¨æŽˆäºˆå¤±è´¥"))}};return T?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsx(Ae,{variant:"destructive",children:e.jsx(ke,{children:T})})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[s("dashboard.welcome"),(d==null?void 0:d.username)&&`, ${d.username}`,"ï¼"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.welcomeDesc")})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-sm text-gray-500",children:[e.jsxs("span",{children:[s("dashboard.lastLogin"),":"]}),e.jsx("span",{children:d!=null&&d.lastlgn?new Date(d.lastlgn).toLocaleString("zh-CN"):s("dashboard.firstTime")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(L,{title:s("dashboard.totalPoints"),value:a.total_points||0,unit:s("dashboard.points"),change:a.points_change,changeType:a.points_change>0?"increase":a.points_change<0?"decrease":"neutral",icon:y,color:"blue",loading:t}),e.jsx(L,{title:s("dashboard.carbonSaved"),value:a.total_carbon_saved||0,unit:"kg COâ‚‚",change:a.carbon_change,changeType:a.carbon_change>0?"increase":a.carbon_change<0?"decrease":"neutral",icon:me,color:"green",loading:t}),e.jsx(L,{title:s("dashboard.activitiesCount"),value:a.total_activities||0,unit:s("dashboard.activities"),change:a.activities_change,changeType:a.activities_change>0?"increase":a.activities_change<0?"decrease":"neutral",icon:Z,color:"orange",loading:t}),e.jsx(L,{title:s("dashboard.rank"),value:a.rank||"-",unit:a.total_users?`/ ${a.total_users}`:"",change:a.rank_change,changeType:a.rank_change>0?"decrease":a.rank_change<0?"increase":"neutral",icon:O,color:"purple",loading:t})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Le,{data:n,title:s("dashboard.activityTrend"),description:s("dashboard.activityTrendDesc"),dataKey:"carbon_saved",xAxisKey:"date",color:"#10b981",loading:t})}),e.jsx("div",{children:e.jsx(Te,{userStats:{points_balance:a.total_points,unread_messages:a.unread_messages,pending_reviews:a.pending_reviews,available_products:a.available_products,new_achievements:a.new_achievements},onActionClick:ae})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Re,{activities:b,loading:t,onViewAll:te}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(qe,{badges:p,userBadges:i,loading:t,onTriggerAuto:F?re:void 0,isAdmin:F}),B.length>0&&e.jsxs("div",{className:"bg-white border rounded-lg shadow-sm p-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-amber-700 flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),s("dashboard.monthlyAchievements","æœ¬æœˆæˆå°±")]}),e.jsx("p",{className:"text-sm text-amber-600",children:s("dashboard.monthlyAchievementsDescription","è¿½è¸ªä½ æ¯æœˆçš„ç¢³å‡æŽ’è¡¨çŽ°")})]})}),(()=>{const r=B[0],c=B.slice(1,4);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border border-amber-200 bg-gradient-to-br from-amber-50 to-orange-50 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700",children:s("dashboard.currentMonthAchievement","{{month}} æˆå°±æ¦‚è§ˆ",{month:r.label})}),e.jsxs("div",{className:"mt-3 grid gap-3 sm:grid-cols-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-amber-500 uppercase tracking-wide",children:s("dashboard.monthlyPointsLabel","ç§¯åˆ†èŽ·å¾—")}),e.jsx("span",{className:"text-lg font-semibold text-amber-700",children:s("dashboard.monthlyPointsWithUnit","{{points}} ç§¯åˆ†",{points:r.points.toLocaleString()})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-amber-500 uppercase tracking-wide",children:s("dashboard.monthlyCarbonLabel","ç¢³å‡æŽ’")}),e.jsx("span",{className:"text-lg font-semibold text-amber-700",children:s("dashboard.monthlyCarbonSaved","{{amount}} åƒå…‹",{amount:r.carbon.toLocaleString(void 0,{maximumFractionDigits:2})})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-amber-500 uppercase tracking-wide",children:s("dashboard.monthlyRecordsLabel","è®°å½•æ¬¡æ•°")}),e.jsx("span",{className:"text-lg font-semibold text-amber-700",children:s("dashboard.monthlyRecords","{{count}} æ¡",{count:r.records.toLocaleString()})})]})]})]}),c.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-amber-600 uppercase tracking-wide",children:s("dashboard.previousMonths","åŽ†å²æœˆä»½")}),e.jsx("div",{className:"space-y-2",children:c.map(m=>e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-amber-100 bg-amber-50/60 px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-amber-700",children:m.label}),e.jsx("span",{className:"text-xs text-amber-500",children:s("dashboard.monthlyCarbonSummary","{{carbon}} åƒå…‹å‡æŽ’ Â· {{records}} æ¡è®°å½•",{carbon:m.carbon.toLocaleString(void 0,{maximumFractionDigits:2}),records:m.records.toLocaleString()})})]}),e.jsx("span",{className:"text-sm font-semibold text-amber-700",children:s("dashboard.monthlyPointsShort","+{{points}} ç§¯åˆ†",{points:m.points.toLocaleString()})})]},m.month||m.label))})]})]})})()]}),a.leaderboard&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-800 mb-4 flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),s("dashboard.leaderboard")]}),e.jsx("div",{className:"space-y-3",children:a.leaderboard.slice(0,5).map((r,c)=>{const m=r.username||r.name||"â€”";return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${c===0?"bg-yellow-500 text-white":c===1?"bg-gray-400 text-white":c===2?"bg-orange-500 text-white":"bg-gray-200 text-gray-600"}`,children:c+1}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[se(r),e.jsx("span",{className:"truncate text-sm text-blue-700 font-medium",children:m})]}),Number.isFinite(r.total_points)?e.jsxs("span",{className:"text-sm text-blue-600",children:[r.total_points," ",s("common.points")]}):null]},r.id??`${c}-${m}`)})})]})]})]})]})}function Ze(){return e.jsx(Be,{})}export{Ze as default};
