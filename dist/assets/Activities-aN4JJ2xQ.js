import{u as ce,Z as ve,r as m,F as je,j as e,B as h,I as P,w as S,aj as Ie,G as Re,N as fe,O as be,Q as ye,T as Ne,V as _e,Y as we,n as j,ai as E,y as ze,k as Pe,i as ie,E as Ee,R as M}from"./index-D2v4yG6T.js";import{u as q}from"./useMutation-DncYtfXb.js";import{T as ne}from"./textarea-B4VMM8a9.js";import{S as pe}from"./switch-DRoi93dX.js";import{A as Le,a as Te,b as Fe,c as Me,d as Be,e as Oe,f as Qe,g as qe}from"./alert-dialog-CCv3ZIdT.js";import{P as ke}from"./Pagination-Cil7p5-c.js";import{C as Ue}from"./circle-plus-Djrvq0Fc.js";import{S as He}from"./square-pen-BLWKfPQH.js";import{R as $e}from"./rotate-ccw-C2aji0uD.js";import{T as Ve}from"./trash-2-BzTw91V-.js";import{I as Ge,A as Ke}from"./ActivityDetailModal-BnWAl9k1.js";import{C as he}from"./checkbox-DXEyWj8W.js";import{A as We,b as Xe,a as Ye}from"./Alert-Dt08zODj.js";import{C as W}from"./circle-check-big-CgI8Ek9_.js";import{C as ee}from"./circle-x-_Ahr8e_A.js";import{C as Ze}from"./clock-DZbEnN-n.js";import{E as Je}from"./eye-CzuPyST7.js";import"./index-ta97Wrgg.js";import"./image-CBwLSAuA.js";import"./chevron-left-DRTGR6c4.js";import"./chevron-right-C7zHSOLe.js";import"./Card-DCtTO9ti.js";const re={id:null,name_zh:"",name_en:"",category:"",unit:"times",carbon_factor:"",description_zh:"",description_en:"",icon:"",sort_order:0,is_active:!0},et=["times","km","kg","hours","kWh","liters","days","minutes","sheets"];function tt(){var Y,N,Z,J;const{t}=ce(),o=ve(),[r,f]=m.useState({search:"",category:"",status:"active",page:1,limit:10}),[n,g]=m.useState(re),[C,b]=m.useState(null),[i,v]=m.useState(""),[X,D]=m.useState(!1),[L,U]=m.useState({open:!1,activity:null}),T=je(["adminActivitiesLibrary",r],async()=>{const a=r.status==="inactive"||r.status==="all",u=r.status==="deleted",A=r.status&&r.status!=="all"?r.status:void 0,K={page:r.page,limit:r.limit,search:r.search||void 0,category:r.category||void 0,include_inactive:a?"true":void 0,include_deleted:u?"true":void 0,status:A};return(await E.getActivities(K)).data},{keepPreviousData:!0}),F=((N=(Y=T.data)==null?void 0:Y.data)==null?void 0:N.activities)??[],c=((J=(Z=T.data)==null?void 0:Z.data)==null?void 0:J.pagination)??{page:r.page,limit:r.limit,total:F.length,pages:1},B=m.useMemo(()=>{var a,u;return((u=(a=T.data)==null?void 0:a.data)==null?void 0:u.categories)??[]},[T.data]),I=()=>{D(!1),v(""),g(re),b(null)},H=()=>{b(null),g({...re}),v(""),D(!0)},se=a=>{b(a.id),g({id:a.id,name_zh:a.name_zh||"",name_en:a.name_en||"",category:a.category||"",unit:a.unit||"times",carbon_factor:a.carbon_factor??"",description_zh:a.description_zh||"",description_en:a.description_en||"",icon:a.icon||"",sort_order:a.sort_order??0,is_active:!!a.is_active}),v(""),D(!0)},$=q(a=>E.createActivity(a),{onSuccess:()=>{j.success(t("admin.activities.library.saveSuccess","Activity saved successfully")),o.invalidateQueries("adminActivitiesLibrary"),I()},onError:()=>j.error(t("common.error"))}),O=q(a=>E.updateActivity(a.id,a.data),{onSuccess:(a,u)=>{o.invalidateQueries("adminActivitiesLibrary"),(u==null?void 0:u.mode)==="toggle"?j.success(t("admin.activities.library.toggleActiveSuccess","Activity status updated")):(j.success(t("admin.activities.library.saveSuccess","Activity saved successfully")),I())},onError:()=>j.error(t("common.error"))}),_=q(a=>E.deleteActivity(a),{onSuccess:()=>{j.success(t("admin.activities.library.deleteSuccess","Activity archived")),o.invalidateQueries("adminActivitiesLibrary"),U({open:!1,activity:null})},onError:()=>j.error(t("common.error"))}),R=q(a=>E.restoreActivity(a),{onSuccess:()=>{j.success(t("admin.activities.library.restoreSuccess","Activity restored")),o.invalidateQueries("adminActivitiesLibrary")},onError:()=>j.error(t("common.error"))}),x=(a,u)=>{f(A=>({...A,[a]:u,page:a==="page"?u:1}))},y=(a,u)=>{g(A=>({...A,[a]:u}))},w=()=>{const a={name_zh:n.name_zh.trim(),name_en:n.name_en.trim(),category:n.category.trim(),unit:n.unit.trim()||"times",carbon_factor:parseFloat(n.carbon_factor),description_zh:n.description_zh.trim()||null,description_en:n.description_en.trim()||null,icon:n.icon.trim()||null,sort_order:Number.isFinite(Number(n.sort_order))?Number(n.sort_order):0,is_active:!!n.is_active};if(!a.name_zh||!a.name_en||!a.category||!a.unit||Number.isNaN(a.carbon_factor)){v(t("admin.activities.library.validationError","Please complete all required fields."));return}v(""),C?O.mutate({id:C,data:a}):$.mutate(a)},V=(a,u)=>{O.mutate({id:a.id,data:{is_active:u},mode:"toggle"})},k=a=>{U({open:!0,activity:a})},G=()=>{L.activity&&_.mutate(L.activity.id)},Q=$.isLoading||O.isLoading;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:t("admin.activities.library.title","Activity Library")}),e.jsx("p",{className:"text-muted-foreground",children:t("admin.activities.library.description","Maintain the catalogue of carbon-reduction activities available to users.")})]}),e.jsxs(h,{onClick:H,className:"w-full md:w-auto",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),t("admin.activities.library.create","Create Activity")]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.filters.search","Search")}),e.jsx(P,{value:r.search,onChange:a=>x("search",a.target.value),placeholder:t("admin.activities.library.searchPlaceholder","Search by name or description...")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.filters.category","Category")}),e.jsxs("select",{value:r.category,onChange:a=>x("category",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:t("common.all")}),B.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.filters.status","Status")}),e.jsxs("select",{value:r.status,onChange:a=>x("status",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"active",children:t("admin.activities.library.status.active","Active")}),e.jsx("option",{value:"inactive",children:t("admin.activities.library.status.inactive","Inactive")}),e.jsx("option",{value:"deleted",children:t("admin.activities.library.status.deleted","Deleted")}),e.jsx("option",{value:"all",children:t("admin.activities.library.status.all","All")})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.library.table.name","Name")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.library.table.category","Category")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.library.table.unit","Unit")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.library.table.carbon_factor","Carbon factor")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.library.table.status","Status")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.library.table.updated_at","Updated")}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.library.table.actions","Actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.isLoading?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-sm text-gray-500",children:e.jsx(S,{className:"mx-auto h-5 w-5 animate-spin"})})}):F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-sm text-gray-500",children:t("admin.activities.library.empty","No activities match the current filters.")})}):F.map(a=>{const u=a.updated_at?Ie(new Date(a.updated_at),"yyyy-MM-dd HH:mm"):"—",A=a.deleted_at?t("admin.activities.library.status.deleted","Deleted"):a.is_active?t("admin.activities.library.status.active","Active"):t("admin.activities.library.status.inactive","Inactive");return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3 text-sm",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:a.name_zh}),e.jsx("div",{className:"text-gray-500 text-xs",children:a.name_en})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(Re,{variant:"secondary",children:a.category||"—"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a.unit}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Number(a.carbon_factor).toFixed(4)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{disabled:!!a.deleted_at,checked:!!a.is_active,onCheckedChange:K=>V(a,K)}),e.jsx("span",{className:"text-xs text-gray-600",children:A})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:u}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!a.deleted_at&&e.jsx(h,{variant:"outline",size:"sm",onClick:()=>se(a),children:e.jsx(He,{className:"h-4 w-4"})}),a.deleted_at?e.jsx(h,{variant:"outline",size:"sm",onClick:()=>R.mutate(a.id),children:e.jsx($e,{className:"h-4 w-4"})}):e.jsx(h,{variant:"outline",size:"sm",onClick:()=>k(a),children:e.jsx(Ve,{className:"h-4 w-4"})})]})})]},a.id)})})]})}),e.jsx(ke,{currentPage:c.page,totalPages:c.pages,onPageChange:a=>x("page",a),itemsPerPage:c.limit,totalItems:c.total})]}),e.jsx(fe,{open:X,onOpenChange:a=>!a&&!Q&&I(),children:e.jsxs(be,{children:[e.jsxs(ye,{children:[e.jsx(Ne,{children:C?t("admin.activities.library.edit","Edit Activity"):t("admin.activities.library.create","Create Activity")}),e.jsx(_e,{children:t("admin.activities.library.description","Maintain the catalogue of carbon-reduction activities available to users.")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.name_zh","Name (Chinese)")}),e.jsx(P,{value:n.name_zh,onChange:a=>y("name_zh",a.target.value),placeholder:"例如：公交地铁通勤"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.name_en","Name (English)")}),e.jsx(P,{value:n.name_en,onChange:a=>y("name_en",a.target.value),placeholder:"e.g. Use public transport"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.category","Category")}),e.jsx(P,{value:n.category,onChange:a=>y("category",a.target.value),placeholder:"transport",list:"activity-category-options"}),e.jsx("datalist",{id:"activity-category-options",children:B.map(a=>e.jsx("option",{value:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.unit","Unit")}),e.jsx("select",{value:n.unit,onChange:a=>y("unit",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:et.map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.carbon_factor","Carbon factor")}),e.jsx(P,{type:"number",step:"0.0001",value:n.carbon_factor,onChange:a=>y("carbon_factor",a.target.value),placeholder:"0.1234"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.sort_order","Sort order")}),e.jsx(P,{type:"number",value:n.sort_order,onChange:a=>y("sort_order",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.description_zh","Description (Chinese)")}),e.jsx(ne,{value:n.description_zh,onChange:a=>y("description_zh",a.target.value),rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.description_en","Description (English)")}),e.jsx(ne,{value:n.description_en,onChange:a=>y("description_en",a.target.value),rows:3})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.icon","Icon key")}),e.jsx(P,{value:n.icon,onChange:a=>y("icon",a.target.value),placeholder:"optional"})]}),e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.library.fields.is_active","Active")}),e.jsx(pe,{checked:!!n.is_active,onCheckedChange:a=>y("is_active",a)})]})})]}),i&&e.jsx("p",{className:"text-sm text-red-600",children:i})]}),e.jsxs(we,{children:[e.jsx(h,{variant:"outline",onClick:I,disabled:Q,children:t("admin.activities.library.actions.cancel","Cancel")}),e.jsxs(h,{onClick:w,disabled:Q,children:[Q&&e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),t("admin.activities.library.actions.save","Save")]})]})]})}),e.jsx(Le,{open:L.open,onOpenChange:a=>!a&&U({open:!1,activity:null}),children:e.jsxs(Te,{children:[e.jsxs(Fe,{children:[e.jsx(Me,{children:t("admin.activities.library.actions.delete","Disable")}),e.jsx(Be,{children:t("admin.activities.library.confirmDelete","Disable and archive this activity?")})]}),e.jsxs(Oe,{children:[e.jsx(Qe,{children:t("common.cancel")}),e.jsxs(qe,{onClick:G,children:[_.isLoading&&e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),t("common.confirm")]})]})]})})]})}function st(){var me,ue,xe;const{t}=ce(),o=ve(),[r,f]=m.useState({search:"",status:"pending",page:1,limit:10,sort:"created_at_asc"}),[n,g]=m.useState(null),[C,b]=m.useState([]),[i,v]=m.useState({open:!1,mode:null,activity:null,bulkIds:[],reason:"",error:""}),[X,D]=m.useState(!1),[L,U]=m.useState(!0),[te,T]=m.useState(15e3),F=m.useRef(!1),{data:c,isLoading:B,error:I,isFetching:H,refetch:se}=je(["adminActivities",r],()=>E.getActivityRecords(r).then(s=>s.data),{keepPreviousData:!0,refetchInterval:L&&!n?te:!1,refetchIntervalInBackground:!0});m.useEffect(()=>{!B&&!I&&(F.current=!0)},[B,I]);const $=((me=c==null?void 0:c.data)==null?void 0:me.activities)||((ue=c==null?void 0:c.data)==null?void 0:ue.records)||(c==null?void 0:c.data)||(c==null?void 0:c.activities)||[],O=Array.isArray($)?$:[],_=m.useMemo(()=>O.map(s=>{const l="status"in s&&("carbon_saved"in s||"points_earned"in s||"user_id"in s),d=s.user_username||s.username||s.user_name||s.user||"-",p=s.activity_name||s.activity_name_zh||s.activity_name_en||s.combined_name||s.name_zh||s.name_en||t("activities.unknownActivity"),z=s.activity_category||s.category||"unknown",ae=s.activity_unit||s.unit||"",De=s.description||s.notes||s.note||s.remark||s.comments||"";return{id:s.id,images:s.images||[],user_username:d,activity_name:p,activity_category:z||"unknown",activity_unit:ae||"-",data_value:s.data_value||s.amount||s.data||0,carbon_saved:s.carbon_saved||0,points_earned:s.points_earned||0,status:s.status||(l?"pending":s.is_active?"approved":"pending"),created_at:s.created_at||s.date||s.updated_at||null,description:De}}),[O,t]);m.useEffect(()=>{const s=new Set(_.filter(l=>l.status==="pending").map(l=>l.id));b(l=>{const d=l.filter(p=>s.has(p));return d.length===l.length&&d.every((p,z)=>p===l[z])?l:d})},[_]);const R=_.filter(s=>s.status==="pending").map(s=>s.id),x=C.filter(s=>R.includes(s)),y=R.length===0?!1:x.length===R.length?!0:x.length>0?"indeterminate":!1,w=((xe=c==null?void 0:c.data)==null?void 0:xe.pagination)||(c==null?void 0:c.pagination)||{page:r.page,limit:r.limit,total:_.length,pages:1},V=q(({id:s,status:l,admin_notes:d})=>E.reviewActivity(s,{status:l,admin_notes:d}),{onSuccess:()=>{D(!0),setTimeout(()=>{D(!1),o.invalidateQueries("adminActivities"),o.invalidateQueries("activities"),j.success(t("admin.activities.reviewSuccess")),g(null),N()},600)},onError:s=>{j.error(t("admin.activities.reviewFailed")),console.error("Activity review failed:",s)}}),k=q(({action:s,review_note:l,record_ids:d})=>E.reviewActivitiesBulk({action:s,review_note:l,record_ids:d}),{onSuccess:()=>{D(!0),setTimeout(()=>{D(!1),o.invalidateQueries("adminActivities"),o.invalidateQueries("activities"),j.success(t("admin.activities.reviewSuccess")),g(null),b([]),N()},600)},onError:s=>{j.error(t("admin.activities.reviewFailed")),console.error("Bulk activity review failed:",s)}}),G=(s,l)=>{f(d=>({...d,[s]:l,page:1}))},Q=s=>{f(l=>({...l,page:s}))},Y=s=>{g(s)},N=()=>{v({open:!1,mode:null,activity:null,bulkIds:[],reason:"",error:""})},Z=s=>{v({open:!0,mode:"approve",activity:s,bulkIds:[],reason:"",error:""})},J=s=>{v({open:!0,mode:"reject",activity:s,bulkIds:[],reason:"",error:""})},a=()=>b([]),u=(s,l,d)=>{l==="pending"&&b(p=>{const z=p.includes(s);return d&&!z?[...p,s]:!d&&z?p.filter(ae=>ae!==s):p})},A=s=>{b(s?l=>Array.from(new Set([...l,...R])):l=>l.filter(d=>!R.includes(d)))},K=()=>{x.length!==0&&v({open:!0,mode:"approve",activity:null,bulkIds:x,reason:"",error:""})},oe=()=>{x.length!==0&&v({open:!0,mode:"reject",activity:null,bulkIds:x,reason:"",error:""})},Ae=s=>{const l=s.target.value;v(d=>({...d,reason:l,error:l.trim()?"":d.error}))},Se=()=>{const s=i.bulkIds||[];if(s.length>0){if(i.mode==="approve"){k.mutate({action:"approve",record_ids:s},{onSettled:N});return}const p=i.reason.trim();if(!p){v(z=>({...z,error:t("admin.activities.rejectReasonRequired","请填写拒绝原因")}));return}k.mutate({action:"reject",review_note:p,record_ids:s},{onSettled:N});return}if(!i.activity)return;const l={id:i.activity.id};if(i.mode==="approve"){V.mutate({...l,status:"approved"},{onSettled:N});return}const d=i.reason.trim();if(!d){v(p=>({...p,error:t("admin.activities.rejectReasonRequired","请填写拒绝原因")}));return}V.mutate({...l,status:"rejected",admin_notes:d},{onSettled:N})},de=V.isLoading||k.isLoading;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:t("admin.activities.title")}),e.jsx("p",{className:"text-muted-foreground",children:t("admin.activities.description")}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{type:"text",value:r.search,onChange:s=>G("search",s.target.value),placeholder:t("admin.activities.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.activities.status")}),e.jsxs("select",{value:r.status,onChange:s=>G("status",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:t("common.all")}),e.jsx("option",{value:"pending",children:t("activities.status.pending")}),e.jsx("option",{value:"approved",children:t("activities.status.approved")}),e.jsx("option",{value:"rejected",children:t("activities.status.rejected")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("common.sort.sortBy")}),e.jsxs("select",{value:r.sort,onChange:s=>G("sort",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"created_at_asc",children:t("common.sort.oldest")}),e.jsx("option",{value:"created_at_desc",children:t("common.sort.newest")})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:col-span-3 lg:col-span-1",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 space-x-2",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-green-600 focus:ring-green-500",checked:L,onChange:s=>U(s.target.checked)}),e.jsx("span",{children:t("common.autoRefresh")||"Auto Refresh"})]}),L&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:te,onChange:s=>T(parseInt(s.target.value,10)),className:"w-full px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:5e3,children:"5s"}),e.jsx("option",{value:1e4,children:"10s"}),e.jsx("option",{value:15e3,children:"15s"}),e.jsx("option",{value:3e4,children:"30s"}),e.jsx("option",{value:6e4,children:"60s"})]}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>se(),disabled:H,children:H?e.jsx(S,{className:"h-3 w-3 animate-spin"}):t("common.refreshNow")||"Refresh"})]})]})]})}),!F.current&&B?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-green-500"})}):I?e.jsxs(We,{variant:"destructive",children:[e.jsx(Xe,{children:t("common.error")}),e.jsx(Ye,{children:t("errors.loadFailed")})]}):_.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-xl font-semibold",children:t("admin.activities.noActivitiesFound")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:t("admin.activities.tryDifferentFilters")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("div",{children:x.length>0?e.jsx("p",{className:"text-sm text-gray-600",children:t("admin.activities.selectedCount",{count:x.length})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.activities.selectionHint","选择待审核的记录后即可批量处理。")})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:a,disabled:x.length===0||k.isLoading,children:t("admin.activities.clearSelection","Clear selection")}),e.jsxs(h,{variant:"outline",size:"sm",onClick:K,disabled:x.length===0||k.isLoading,className:"group inline-flex items-center transition-transform duration-150 hover:scale-105",children:[k.isLoading&&i.bulkIds&&i.bulkIds.length>0&&i.mode==="approve"?e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(W,{className:"mr-2 h-4 w-4 transition-transform duration-200 group-hover:scale-110"}),t("admin.activities.bulkApprove","批量通过")]}),e.jsxs(h,{variant:"destructive",size:"sm",onClick:oe,disabled:x.length===0||k.isLoading,children:[k.isLoading&&i.bulkIds&&i.bulkIds.length>0&&i.mode==="reject"?e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ee,{className:"mr-2 h-4 w-4"}),t("admin.activities.bulkReject","批量驳回")]})]})]}),e.jsxs("div",{className:"overflow-x-auto bg-white rounded-lg shadow-sm border relative",children:[F.current&&H&&e.jsxs("div",{className:"absolute top-2 right-2 flex items-center text-xs text-gray-500",children:[e.jsx(S,{className:"h-3 w-3 animate-spin mr-1"})," ",t("common.loading")]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsx(he,{"aria-label":t("admin.activities.selectAll","Select all pending"),checked:y,onCheckedChange:s=>A(s===!0),disabled:R.length===0})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.table.images","Images")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.table.user")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.table.activity")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.table.data")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.table.carbonSaved")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.table.points")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.table.status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.activities.table.date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("common.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsx(he,{"aria-label":t("admin.activities.selectRecord","Select record"),checked:C.includes(s.id),disabled:s.status!=="pending",onCheckedChange:l=>u(s.id,s.status,l===!0)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap align-top",children:e.jsx(Ge,{images:s.images||[],maxThumbnails:1})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.user_username}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.activity_name}),e.jsx("div",{className:"text-sm text-gray-500",children:t(`activities.categories.${s.activity_category}`,s.activity_category)}),s.description&&e.jsxs("div",{className:"mt-1 text-xs text-gray-600 flex items-start max-w-[36rem]",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1 mt-[2px] text-gray-500"}),e.jsx("span",{className:"truncate",title:s.description,children:s.description})]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[ie(s.data_value)," ",t(`units.${s.activity_unit}`,s.activity_unit)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[ie(s.carbon_saved)," kg CO2e"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold",children:["+",ie(s.points_earned)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[s.status==="pending"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"})," ",t("activities.status.pending")]}),s.status==="approved"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(W,{className:"h-3 w-3 mr-1"})," ",t("activities.status.approved")]}),s.status==="rejected"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"})," ",t("activities.status.rejected")]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:Ee(s.created_at,"yyyy-MM-dd")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>Y(s),className:"mr-2",children:e.jsx(Je,{className:"h-4 w-4"})}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>Z(s),className:"mr-2 text-green-600 hover:text-green-800",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>J(s),className:"text-red-600 hover:text-red-800",children:e.jsx(ee,{className:"h-4 w-4"})})]})]})]},s.id))})]})]}),e.jsx(ke,{currentPage:w.page||w.current_page||1,totalPages:w.pages||w.total_pages||1,onPageChange:Q,itemsPerPage:w.limit||w.per_page||r.limit,totalItems:w.total||w.total_items||_.length})]}),e.jsx(Ke,{activity:n,isOpen:!!n,onClose:()=>g(null)}),e.jsx(fe,{open:i.open,onOpenChange:s=>s?null:N(),children:e.jsxs(be,{className:"sm:max-w-lg",children:[e.jsxs(ye,{children:[e.jsx(Ne,{children:i.mode==="approve"?t("admin.activities.dialog.approveTitle","确认通过审核"):t("admin.activities.dialog.rejectTitle","拒绝该活动")}),e.jsx(_e,{children:i.mode==="approve"?t("admin.activities.dialog.approveDescription","该活动将计入用户积分并发送通知。"):t("admin.activities.dialog.rejectDescription","请填写拒绝原因，我们会通知提交者。")})]}),i.activity&&e.jsxs("div",{className:"mb-4 rounded-xl border border-emerald-200/40 bg-emerald-50/40 px-3 py-2 text-sm text-emerald-700",children:[e.jsx("span",{className:"font-medium",children:i.activity.activity_name})," · ",i.activity.user_username]}),i.mode==="reject"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"reject-reason",children:t("admin.activities.dialog.reasonLabel","拒绝原因")}),e.jsx(ne,{id:"reject-reason",rows:4,value:i.reason,onChange:Ae,placeholder:t("admin.activities.dialog.reasonPlaceholder","请简要说明拒绝的原因")}),i.error&&e.jsx("p",{className:"text-xs text-red-500",children:i.error})]}),e.jsxs(we,{children:[e.jsx(h,{variant:"outline",onClick:N,children:t("common.cancel","取消")}),e.jsxs(h,{variant:i.mode==="reject"?"destructive":"default",onClick:Se,disabled:de,className:"group inline-flex items-center transition-transform duration-150 hover:scale-105",children:[X?e.jsxs("span",{className:"inline-flex items-center bg-green-600 text-white px-3 py-1 rounded-md animate-pulse",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),t("admin.activities.dialog.approveAction","通过审核")]}):de?e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}):i.mode==="approve"?e.jsx(W,{className:"mr-2 h-4 w-4 transition-transform duration-200 group-hover:scale-110"}):e.jsx(ee,{className:"mr-2 h-4 w-4"}),!X&&(i.mode==="approve"?t("admin.activities.dialog.approveAction","通过审核"):t("admin.activities.dialog.rejectAction","拒绝活动"))]})]})]})})]})}function at({children:t,value:o,onValueChange:r,className:f=""}){const[n,g]=m.useState(o||""),C=o!==void 0?o:n,b=i=>{r&&r(i),o===void 0&&g(i)};return e.jsx("div",{className:f,"data-tabs":!0,children:M.Children.map(t,i=>M.isValidElement(i)?i.type===Ce?M.cloneElement(i,{active:C,setActive:b}):i.type===le?M.cloneElement(i,{active:C}):i:i)})}function Ce({children:t,active:o,setActive:r,className:f=""}){return e.jsx("div",{className:`inline-flex rounded-md border bg-white ${f}`,role:"tablist",children:M.Children.map(t,n=>M.isValidElement(n)?M.cloneElement(n,{active:o,setActive:r}):n)})}function ge({value:t,children:o,active:r,setActive:f,className:n=""}){const g=r===t;return e.jsx("button",{role:"tab","aria-selected":g,onClick:()=>f(t),className:`px-3 py-2 text-sm border-r last:border-r-0 ${g?"bg-gray-100 font-semibold":"hover:bg-gray-50"} ${n}`,children:o})}function le({value:t,active:o,children:r,className:f=""}){return o!==t?null:e.jsx("div",{role:"tabpanel",className:f,children:r})}function Ct(){const{t}=ce(),[o,r]=m.useState("library");return e.jsxs(at,{value:o,onValueChange:r,className:"space-y-6",children:[e.jsxs(Ce,{children:[e.jsx(ge,{value:"library",children:t("admin.activities.tab.library","Activity Library")}),e.jsx(ge,{value:"review",children:t("admin.activities.tab.review","Record Review")})]}),e.jsx(le,{value:"library",children:e.jsx(tt,{})}),e.jsx(le,{value:"review",children:e.jsx(st,{})})]})}export{Ct as default};
