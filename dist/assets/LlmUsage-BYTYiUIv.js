import{j as e}from"./motion-vendor-C11-9Hm-.js";import{r as n}from"./react-vendor-CFnAvB5y.js";import{u as ze,Z as Q,W as Qe,ai as Je,U as ve,B as v,a as ie,J as k,I as _e,P as se,a1 as Oe,a2 as Ee,a3 as We,a4 as Xe,aj as ae}from"./index-CQ91Xfn2.js";import{a as Ye,J as be,R as Ge,s as Ve}from"./RequestIdRelatedDrawer-BTdVPlFH.js";import{C as u,a as g,b as p,c as f,d as j}from"./Card-CvB_sIzW.js";import{S as Ze}from"./scroll-area-CVgIHlKF.js";import{A as we,b as ke,a as De}from"./Alert-B9j1D3yi.js";import{C as es}from"./clock-xsfGEZBf.js";import{A as ss}from"./activity-Bpc2oucE.js";import{R as as}from"./refresh-cw-Ci8sJxJs.js";import{R as T,e as Ce,C as te,X as le,Y as F,T as R,f as J,d as O,b as Le,g as Se,h as Ae,i as Ie,B as ts}from"./charts-vendor-DJkHj7pX.js";import{T as ls}from"./trending-up-rf66WW_z.js";import{T as ns}from"./trending-down-CdZ74rDI.js";import"./i18n-vendor-DK0x1_bH.js";import"./chevron-down-BZ9rTcfe.js";import"./chevron-right-DHB02DZ1.js";import"./index-BdQq_4o_.js";const x=s=>{const i=Number(s);return Number.isFinite(i)?i.toLocaleString():"-"},H=s=>s?new Date(s).toLocaleString():"-",ne=s=>{if(s==null)return null;if(typeof s=="object"||typeof s!="string")return s;try{return JSON.parse(s)}catch{return s}},h=["#10b981","#3b82f6","#f59e0b","#8b5cf6","#ef4444","#14b8a6","#f97316","#0ea5e9"],Te=(s,i=0)=>{const d=Number(s);return Number.isFinite(d)?d:i},Fe=(s,i,d,o="Other")=>{const m=Array.isArray(s)?s:[];if(m.length<=d)return m;const q=m.slice(0,d),E=m.slice(d).reduce((D,_)=>({calls:D.calls+Te(_.calls),tokens:D.tokens+Te(_.tokens)}),{calls:0,tokens:0});return[...q,{[i]:o,...E}]};function rs({title:s,value:i,subtitle:d,icon:o,tone:m}){return e.jsxs(u,{className:ie("border-l-4",m),children:[e.jsx(g,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]})}),e.jsxs(j,{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl font-semibold",children:i}),d&&e.jsx("p",{className:"text-xs text-muted-foreground",children:d})]})]})}function is({title:s,value:i,subtitle:d,trend:o}){const m=o==="up"?ls:o==="down"?ns:null;return e.jsxs("div",{className:"rounded-xl border bg-card px-4 py-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:s}),m&&e.jsx(m,{className:ie("h-4 w-4",o==="up"?"text-emerald-500":"text-rose-500")})]}),e.jsx("div",{className:"mt-2 text-xl font-semibold",children:i}),d&&e.jsx("div",{className:"mt-1 text-[11px] text-muted-foreground",children:d})]})}function ws(){var ge,pe,je,fe,ye;const{t:s}=ze(),[i,d]=n.useState(""),[o,m]=n.useState(1),[q]=n.useState(20),[M,E]=n.useState(30),[D]=n.useState(8),[_,Re]=n.useState(""),[C,W]=n.useState(null),[$,de]=n.useState(null),[He,qe]=n.useState({system:[],audit:[],error:[],llm:[]}),[Me,me]=n.useState(!1),N=Q(["llmUsage",{search:i,page:o,limit:q}],async()=>{var t;const a=await ae.getLlmUsage({q:i,page:o,limit:q});return((t=a.data)==null?void 0:t.data)||a.data},{keepPreviousData:!0}),L=Q(["llmUsageLogs",_],async()=>{const a=await Ve({q:_,types:["llm"],limit_per_type:30});return a.data||a},{keepPreviousData:!0}),c=Q(["llmUsageAnalytics",M,D],async()=>{var t;const a=await ae.getLlmUsageAnalytics({days:M,recent_limit:D});return((t=a.data)==null?void 0:t.data)||a.data},{keepPreviousData:!0}),r=Q(["llmLogDetail",C],async()=>{var t;const a=await ae.getLlmLogDetail(C);return((t=a.data)==null?void 0:t.data)||a.data},{enabled:!!C}),X=N.data||{},U=X.summary||{},ce=X.users||[],Y=X.pagination||{},K=c.data||{},P=K.trends||[],b=K.distributions||{},l=K.insights||{},oe=K.recent_conversations||[],xe=((je=(pe=(ge=L.data)==null?void 0:ge.data)==null?void 0:pe.llm)==null?void 0:je.items)||[],$e=o>1,Ke=o<(Y.total_pages||1),w=n.useMemo(()=>new Intl.NumberFormat,[]),S=n.useMemo(()=>new Intl.NumberFormat(void 0,{maximumFractionDigits:2}),[]),A=n.useMemo(()=>new Intl.NumberFormat(void 0,{style:"percent",maximumFractionDigits:1}),[]),he=n.useMemo(()=>new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}),[]),G=n.useMemo(()=>Fe(b.models,"model",6,s("admin.llmUsage.other")),[b.models,s]),ue=n.useMemo(()=>Fe(b.sources,"source",6,s("admin.llmUsage.other")),[b.sources,s]),V=n.useMemo(()=>(b.actors||[]).map(a=>({...a,actor_label:a.actor_type==="admin"?s("admin.llmUsage.actorAdmin"):a.actor_type==="user"?s("admin.llmUsage.actorUser"):a.actor_type})),[b.actors,s]),B=n.useCallback(a=>{if(!a)return a;const t=new Date(`${a}T00:00:00`);return Number.isNaN(t.getTime())?a:he.format(t)},[he]),Z=n.useCallback((a,t)=>{if(a==null)return"-";const I=`${a>0?"+":""}${w.format(a)}`;return t==null?I:`${I} (${A.format(Math.abs(t))})`},[w,A]),Pe=n.useMemo(()=>[{key:"successRate",title:s("admin.llmUsage.insights.successRate"),value:l.success_rate==null?"-":A.format(l.success_rate),subtitle:s("admin.llmUsage.insights.successRateHint",{total:w.format(l.total_calls||0)})},{key:"avgLatency",title:s("admin.llmUsage.insights.avgLatency"),value:l.avg_latency_ms==null?"-":`${S.format(l.avg_latency_ms)} ms`,subtitle:s("admin.llmUsage.insights.avgLatencyHint")},{key:"p95Latency",title:s("admin.llmUsage.insights.p95Latency"),value:l.p95_latency_ms==null?"-":`${S.format(l.p95_latency_ms)} ms`,subtitle:s("admin.llmUsage.insights.p95LatencyHint")},{key:"avgTokens",title:s("admin.llmUsage.insights.avgTokens"),value:l.avg_tokens_per_call==null?"-":S.format(l.avg_tokens_per_call),subtitle:s("admin.llmUsage.insights.avgTokensHint")},{key:"callsDelta",title:s("admin.llmUsage.insights.callsDelta"),value:Z(l.calls_delta,l.calls_delta_rate),subtitle:s("admin.llmUsage.insights.callsDeltaHint",{recent:w.format(l.calls_last_7d||0)}),trend:l.calls_delta>0?"up":l.calls_delta<0?"down":null},{key:"tokensDelta",title:s("admin.llmUsage.insights.tokensDelta"),value:Z(l.tokens_delta,l.tokens_delta_rate),subtitle:s("admin.llmUsage.insights.tokensDeltaHint",{recent:w.format(l.tokens_last_7d||0)}),trend:l.tokens_delta>0?"up":l.tokens_delta<0?"down":null},{key:"topModel",title:s("admin.llmUsage.insights.topModel"),value:l.top_model||"-",subtitle:s("admin.llmUsage.insights.topModelHint")},{key:"topSource",title:s("admin.llmUsage.insights.topSource"),value:l.top_source||"-",subtitle:s("admin.llmUsage.insights.topSourceHint")},{key:"adminShare",title:s("admin.llmUsage.insights.adminShare"),value:l.admin_share==null?"-":A.format(l.admin_share),subtitle:s("admin.llmUsage.insights.adminShareHint")}],[l,s,A,S,w,Z]),Be=n.useMemo(()=>[{title:s("admin.llmUsage.summary.calls24h"),value:x(U.calls_24h),subtitle:s("admin.llmUsage.summary.calls24hHint"),icon:es,tone:"border-amber-400"},{title:s("admin.llmUsage.summary.calls7d"),value:x(U.calls_7d),subtitle:s("admin.llmUsage.summary.calls7dHint"),icon:ss,tone:"border-emerald-400"},{title:s("admin.llmUsage.summary.calls30d"),value:x(U.calls_30d),subtitle:s("admin.llmUsage.summary.calls30dHint"),icon:Qe,tone:"border-indigo-400"},{title:s("admin.llmUsage.summary.tokens30d"),value:x(U.tokens_30d),subtitle:s("admin.llmUsage.summary.tokens30dHint"),icon:Je,tone:"border-slate-400"},{title:s("admin.llmUsage.summary.adminCalls"),value:x(U.admin_calls_30d),subtitle:s("admin.llmUsage.summary.adminCallsHint"),icon:ve,tone:"border-blue-400"},{title:s("admin.llmUsage.summary.userCalls"),value:x(U.user_calls_30d),subtitle:s("admin.llmUsage.summary.userCallsHint"),icon:ve,tone:"border-green-400"}],[U,s]),ee=n.useCallback(async a=>{if(a){de(a),me(!0);try{const t=await Ye(a);qe((t==null?void 0:t.data)||t||{system:[],audit:[],error:[],llm:[]})}finally{me(!1)}}},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:s("admin.llmUsage.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.llmUsage.subtitle")})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{N.refetch(),L.refetch(),c.refetch()},disabled:N.isFetching||L.isFetching||c.isFetching,children:[e.jsx(as,{className:ie("mr-2 h-4 w-4",(N.isFetching||L.isFetching||c.isFetching)&&"animate-spin")}),s("admin.llmUsage.refresh")]})]}),N.isError&&e.jsxs(we,{variant:"destructive",children:[e.jsx(ke,{children:s("common.error")}),e.jsx(De,{children:((fe=N.error)==null?void 0:fe.message)||s("errors.loadFailed")})]}),c.isError&&e.jsxs(we,{variant:"destructive",children:[e.jsx(ke,{children:s("common.error")}),e.jsx(De,{children:((ye=c.error)==null?void 0:ye.message)||s("errors.loadFailed")})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:Be.map(a=>e.jsx(rs,{...a},a.title))}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold",children:s("admin.llmUsage.charts.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.llmUsage.charts.subtitle")})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:[7,30,60].map(a=>e.jsx(v,{size:"sm",variant:M===a?"default":"outline",className:"h-8",onClick:()=>E(a),disabled:c.isFetching,children:s("admin.llmUsage.charts.range",{days:a})},a))})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(p,{children:s("admin.llmUsage.charts.callsTokens")}),e.jsx(f,{children:s("admin.llmUsage.charts.callsTokensHint")})]}),e.jsx(j,{className:"h-72",children:P.length?e.jsx(T,{children:e.jsxs(Ce,{data:P,children:[e.jsx(te,{strokeDasharray:"3 3",vertical:!1}),e.jsx(le,{dataKey:"date",tickFormatter:B}),e.jsx(F,{yAxisId:"left",allowDecimals:!1}),e.jsx(F,{yAxisId:"right",orientation:"right",allowDecimals:!1}),e.jsx(R,{formatter:(a,t)=>[a,s(t==="tokens"?"admin.llmUsage.charts.tokens":"admin.llmUsage.charts.calls")],labelFormatter:B}),e.jsx(J,{}),e.jsx(O,{yAxisId:"left",dataKey:"calls",name:s("admin.llmUsage.charts.calls"),fill:h[0],radius:[6,6,0,0]}),e.jsx(Le,{yAxisId:"right",type:"monotone",dataKey:"tokens",name:s("admin.llmUsage.charts.tokens"),stroke:h[1],strokeWidth:2,dot:!1})]})}):e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:c.isLoading?s("common.loading"):s("admin.llmUsage.noData")})})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(p,{children:s("admin.llmUsage.charts.successLatency")}),e.jsx(f,{children:s("admin.llmUsage.charts.successLatencyHint")})]}),e.jsx(j,{className:"h-72",children:P.length?e.jsx(T,{children:e.jsxs(Ce,{data:P,children:[e.jsx(te,{strokeDasharray:"3 3",vertical:!1}),e.jsx(le,{dataKey:"date",tickFormatter:B}),e.jsx(F,{yAxisId:"left",allowDecimals:!1}),e.jsx(F,{yAxisId:"right",orientation:"right"}),e.jsx(R,{formatter:(a,t)=>t==="avg_latency_ms"?[a==null?"-":`${S.format(a)} ms`,s("admin.llmUsage.charts.latency")]:[a,s(t==="success_calls"?"admin.llmUsage.charts.success":"admin.llmUsage.charts.failed")],labelFormatter:B}),e.jsx(J,{}),e.jsx(O,{yAxisId:"left",dataKey:"success_calls",stackId:"status",name:s("admin.llmUsage.charts.success"),fill:h[2]}),e.jsx(O,{yAxisId:"left",dataKey:"failed_calls",stackId:"status",name:s("admin.llmUsage.charts.failed"),fill:h[4]}),e.jsx(Le,{yAxisId:"right",type:"monotone",dataKey:"avg_latency_ms",name:s("admin.llmUsage.charts.latency"),stroke:h[3],strokeWidth:2,dot:!1})]})}):e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:c.isLoading?s("common.loading"):s("admin.llmUsage.noData")})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(p,{children:s("admin.llmUsage.charts.modelShare")}),e.jsx(f,{children:s("admin.llmUsage.charts.modelShareHint")})]}),e.jsx(j,{className:"h-72",children:G.length?e.jsx(T,{children:e.jsxs(Se,{children:[e.jsx(Ae,{data:G,dataKey:"calls",nameKey:"model",innerRadius:50,outerRadius:90,paddingAngle:2,children:G.map((a,t)=>e.jsx(Ie,{fill:h[t%h.length]},`model-${a.model}-${t}`))}),e.jsx(R,{formatter:(a,t)=>[a,t]}),e.jsx(J,{})]})}):e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:c.isLoading?s("common.loading"):s("admin.llmUsage.noData")})})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(p,{children:s("admin.llmUsage.charts.sourceShare")}),e.jsx(f,{children:s("admin.llmUsage.charts.sourceShareHint")})]}),e.jsx(j,{className:"h-72",children:ue.length?e.jsx(T,{children:e.jsxs(ts,{data:ue,layout:"vertical",margin:{left:12},children:[e.jsx(te,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(le,{type:"number",allowDecimals:!1}),e.jsx(F,{type:"category",dataKey:"source",width:90}),e.jsx(R,{formatter:a=>[a,s("admin.llmUsage.charts.calls")]}),e.jsx(O,{dataKey:"calls",fill:h[1],radius:[0,6,6,0]})]})}):e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:c.isLoading?s("common.loading"):s("admin.llmUsage.noData")})})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(p,{children:s("admin.llmUsage.charts.actorShare")}),e.jsx(f,{children:s("admin.llmUsage.charts.actorShareHint")})]}),e.jsx(j,{className:"h-72",children:V.length?e.jsx(T,{children:e.jsxs(Se,{children:[e.jsx(Ae,{data:V,dataKey:"calls",nameKey:"actor_label",innerRadius:50,outerRadius:90,paddingAngle:2,children:V.map((a,t)=>e.jsx(Ie,{fill:h[t%h.length]},`actor-${a.actor_label||a.actor_type}-${t}`))}),e.jsx(R,{formatter:(a,t)=>[a,t]}),e.jsx(J,{})]})}):e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:c.isLoading?s("common.loading"):s("admin.llmUsage.noData")})})]})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(p,{children:s("admin.llmUsage.insights.title")}),e.jsx(f,{children:s("admin.llmUsage.insights.subtitle")})]}),e.jsx(j,{children:e.jsx("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:Pe.map(a=>e.jsx(is,{title:a.title,value:a.value,subtitle:a.subtitle,trend:a.trend},a.key))})})]}),e.jsxs(u,{children:[e.jsxs(g,{className:"space-y-2",children:[e.jsx(p,{children:s("admin.llmUsage.recent.title")}),e.jsx(f,{children:s("admin.llmUsage.recent.subtitle")})]}),e.jsxs(j,{className:"space-y-4",children:[oe.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground",children:c.isLoading?s("common.loading"):s("admin.llmUsage.recent.empty")}),oe.map(a=>{var z,I,Ne,Ue;const t=a.actor_type==="admin"?s("admin.llmUsage.actorAdmin"):a.actor_type==="user"?s("admin.llmUsage.actorUser"):a.actor_type;return e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(k,{variant:a.actor_type==="admin"?"default":"secondary",children:t||a.actor_type}),e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["#",a.actor_id??"-"]}),a.actor_name&&e.jsx("span",{className:"text-xs font-medium",children:a.actor_name}),e.jsx(k,{variant:a.status==="failed"?"destructive":"outline",children:a.status||"-"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:H(a.created_at)})]}),e.jsxs("div",{className:"mt-3 grid gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{children:[s("admin.llmUsage.recent.source"),": ",e.jsx("span",{className:"font-mono text-foreground",children:a.source||"-"})]}),e.jsxs("span",{children:[s("admin.llmUsage.recent.model"),": ",e.jsx("span",{className:"font-mono text-foreground",children:a.model||"-"})]}),a.system_path&&e.jsxs("span",{children:[s("admin.llmUsage.recent.path"),":"," ",e.jsxs("span",{className:"font-mono text-foreground",children:[a.system_path,a.system_status_code?` (${a.system_status_code})`:""]})]})]}),((z=a.context)==null?void 0:z.client_time)&&e.jsxs("div",{children:[s("admin.llmUsage.recent.clientTime"),": ",e.jsx("span",{className:"font-mono text-foreground",children:a.context.client_time})]})]}),e.jsxs("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:s("admin.llmUsage.recent.prompt")}),e.jsx("pre",{className:"mt-1 max-h-40 overflow-auto whitespace-pre-wrap rounded bg-slate-900 p-3 text-[11px] text-green-200",children:a.prompt_preview||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:s("admin.llmUsage.recent.response")}),e.jsx("pre",{className:"mt-1 max-h-40 overflow-auto whitespace-pre-wrap rounded bg-slate-900 p-3 text-[11px] text-emerald-200",children:a.response_preview||"-"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{children:[s("admin.llmUsage.recent.tokens"),": ",e.jsx("span",{className:"font-mono text-foreground",children:a.total_tokens??"-"})]}),e.jsxs("span",{children:[s("admin.llmUsage.recent.latency"),": ",e.jsx("span",{className:"font-mono text-foreground",children:a.latency_ms??"-"})]}),e.jsxs("span",{children:[s("admin.llmUsage.recent.requestId"),": ",e.jsx("span",{className:"font-mono text-foreground",children:a.request_id||"-"})]}),a.response_id&&e.jsxs("span",{children:[s("admin.llmUsage.recent.responseId"),": ",e.jsx("span",{className:"font-mono text-foreground",children:a.response_id})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"secondary",children:s("admin.llmUsage.recent.relatedCounts",{system:((I=a.related)==null?void 0:I.system)??0,audit:((Ne=a.related)==null?void 0:Ne.audit)??0,error:((Ue=a.related)==null?void 0:Ue.error)??0})}),a.request_id&&e.jsx(v,{size:"sm",variant:"outline",onClick:()=>ee(a.request_id),children:s("admin.llmUsage.recent.related")}),e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>W(a.id),children:s("admin.llmUsage.recent.viewDetail")})]})]})]},a.id)})]})]}),e.jsxs(u,{children:[e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:s("admin.llmUsage.users.title")}),e.jsx(f,{children:s("admin.llmUsage.users.subtitle")})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(_e,{value:i,onChange:a=>{d(a.target.value),m(1)},placeholder:s("admin.llmUsage.users.searchPlaceholder"),className:"h-9 w-64"})})]})}),e.jsx(j,{className:"p-0",children:N.isLoading?e.jsxs("div",{className:"flex items-center gap-2 px-6 py-8 text-sm text-muted-foreground",children:[e.jsx(se,{className:"h-4 w-4 animate-spin"}),s("common.loading")]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.users.columns.user")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.users.columns.role")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.users.columns.group")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("admin.llmUsage.users.columns.dailyUsed")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("admin.llmUsage.users.columns.dailyLimit")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("admin.llmUsage.users.columns.remaining")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("admin.llmUsage.users.columns.rateLimit")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.users.columns.resetAt")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.users.columns.lastUsed")})]})}),e.jsxs("tbody",{children:[ce.map(a=>e.jsxs("tr",{className:"border-b",children:[e.jsxs("td",{className:"px-4 py-2",children:[e.jsx("div",{className:"font-medium",children:a.username||s("common.none")}),e.jsx("div",{className:"text-[11px] text-muted-foreground",children:a.email})]}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(k,{variant:a.is_admin?"default":"secondary",children:a.is_admin?s("admin.llmUsage.users.admin"):s("admin.llmUsage.users.user")})}),e.jsx("td",{className:"px-4 py-2",children:a.group_name||s("common.none")}),e.jsx("td",{className:"px-4 py-2 text-right",children:x(a.daily_used)}),e.jsx("td",{className:"px-4 py-2 text-right",children:a.daily_limit==null?s("admin.llmUsage.users.unlimited"):x(a.daily_limit)}),e.jsx("td",{className:"px-4 py-2 text-right",children:a.daily_remaining==null?"-":x(a.daily_remaining)}),e.jsx("td",{className:"px-4 py-2 text-right",children:a.rate_limit==null?"-":x(a.rate_limit)}),e.jsx("td",{className:"px-4 py-2",children:H(a.reset_at)}),e.jsx("td",{className:"px-4 py-2",children:H(a.last_used_at)})]},a.id)),ce.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-muted-foreground",children:s("admin.llmUsage.users.empty")})})]})]})})}),e.jsxs("div",{className:"flex items-center justify-between border-t px-6 py-3 text-xs text-muted-foreground",children:[e.jsx("span",{children:s("admin.llmUsage.users.pagination",{page:Y.current_page||1,total:Y.total_pages||1})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:"sm",variant:"outline",disabled:!$e,onClick:()=>m(a=>Math.max(1,a-1)),children:s("admin.llmUsage.users.prev")}),e.jsx(v,{size:"sm",variant:"outline",disabled:!Ke,onClick:()=>m(a=>a+1),children:s("admin.llmUsage.users.next")})]})]})]}),e.jsxs(u,{children:[e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:s("admin.llmUsage.logs.title")}),e.jsx(f,{children:s("admin.llmUsage.logs.subtitle")})]}),e.jsx(_e,{value:_,onChange:a=>Re(a.target.value),placeholder:s("admin.llmUsage.logs.searchPlaceholder"),className:"h-9 w-64"})]})}),e.jsx(j,{className:"p-0",children:L.isLoading?e.jsxs("div",{className:"flex items-center gap-2 px-6 py-8 text-sm text-muted-foreground",children:[e.jsx(se,{className:"h-4 w-4 animate-spin"}),s("common.loading")]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.logs.columns.time")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.logs.columns.actor")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.logs.columns.source")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.logs.columns.model")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.logs.columns.status")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("admin.llmUsage.logs.columns.tokens")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("admin.llmUsage.logs.columns.latency")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.logs.columns.requestId")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("admin.llmUsage.logs.columns.prompt")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("admin.llmUsage.logs.columns.actions")})]})}),e.jsxs("tbody",{children:[xe.map(a=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:H(a.created_at)}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:a.actor_type==="admin"?"default":"secondary",children:a.actor_type||s("common.none")}),e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["#",a.actor_id??"-"]})]})}),e.jsx("td",{className:"px-4 py-2 max-w-[160px] truncate",title:a.source||"",children:a.source||"-"}),e.jsx("td",{className:"px-4 py-2",children:a.model||"-"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(k,{variant:a.status==="failed"?"destructive":"outline",children:a.status||"-"})}),e.jsx("td",{className:"px-4 py-2 text-right",children:a.total_tokens??"-"}),e.jsx("td",{className:"px-4 py-2 text-right",children:a.latency_ms??"-"}),e.jsx("td",{className:"px-4 py-2 font-mono text-[11px] truncate max-w-[140px]",title:a.request_id,children:a.request_id?e.jsx("button",{type:"button",className:"text-blue-600 hover:underline",onClick:()=>ee(a.request_id),children:a.request_id}):"-"}),e.jsx("td",{className:"px-4 py-2 max-w-[220px] truncate font-mono text-[11px]",title:a.prompt,children:a.prompt?String(a.prompt).slice(0,120):"-"}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>W(a.id),children:s("admin.llmUsage.logs.view")})})]},a.id)),xe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-4 py-8 text-center text-muted-foreground",children:s("admin.llmUsage.logs.empty")})})]})]})})})]}),e.jsx(Oe,{open:!!C,onOpenChange:a=>!a&&W(null),children:e.jsxs(Ee,{className:"max-w-5xl",children:[e.jsx(We,{children:e.jsx(Xe,{children:s("admin.llmUsage.logs.detailTitle",{id:C})})}),r.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 py-6 text-sm text-muted-foreground",children:[e.jsx(se,{className:"h-4 w-4 animate-spin"}),s("common.loading")]}),r.data&&e.jsx(Ze,{className:"max-h-[70vh] pr-2",children:e.jsxs("div",{className:"space-y-4 text-xs",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsx(y,{label:s("admin.llmUsage.logs.columns.requestId"),value:r.data.request_id}),e.jsx(y,{label:s("admin.llmUsage.logs.columns.model"),value:r.data.model}),e.jsx(y,{label:s("admin.llmUsage.logs.columns.source"),value:r.data.source}),e.jsx(y,{label:s("admin.llmUsage.logs.columns.status"),value:r.data.status}),e.jsx(y,{label:s("admin.llmUsage.logs.columns.tokens"),value:r.data.total_tokens}),e.jsx(y,{label:s("admin.llmUsage.logs.columns.latency"),value:r.data.latency_ms}),e.jsx(y,{label:s("admin.llmUsage.logs.columns.actor"),value:`${r.data.actor_type} #${r.data.actor_id??"-"}`}),e.jsx(y,{label:s("admin.llmUsage.logs.columns.responseId"),value:r.data.response_id||"-"}),e.jsx(y,{label:s("admin.llmUsage.logs.columns.time"),value:H(r.data.created_at)})]}),r.data.prompt&&e.jsx(re,{title:s("admin.llmUsage.logs.prompt"),children:e.jsx(be,{value:ne(r.data.prompt)})}),r.data.response_raw&&e.jsx(re,{title:s("admin.llmUsage.logs.response"),children:typeof ne(r.data.response_raw)=="string"?e.jsx("pre",{className:"max-h-80 overflow-auto whitespace-pre-wrap rounded bg-slate-900 p-3 text-[11px] text-green-200",children:r.data.response_raw}):e.jsx(be,{value:ne(r.data.response_raw)})}),r.data.error_message&&e.jsx(re,{title:s("admin.llmUsage.logs.error"),children:e.jsx("pre",{className:"whitespace-pre-wrap rounded bg-rose-50 p-3 text-[11px] text-rose-600",children:r.data.error_message})})]})})]})}),e.jsx(Ge,{open:!!$,requestId:$,onClose:()=>de(null),loading:Me,data:He,onRefresh:()=>$&&ee($)})]})}function y({label:s,value:i}){return e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:s}),e.jsx("div",{className:"font-mono",children:i??"-"})]})}function re({title:s,children:i}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:s}),i]})}export{ws as default};
