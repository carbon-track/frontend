import{u as M,e as V,r,j as e,L as h,I as d,g as $,B as z,s as G,f as J,n as K}from"./index-9oiziVwF.js";import{u as Q}from"./index.esm-CHdFkG8q.js";import{C as W,a as X,b as Y,c as Z,d as ee}from"./Card-DiZzX4G1.js";import{A as E,a as F}from"./Alert-DMTWhZOi.js";import{T as se}from"./Turnstile-CFijfuaa.js";import{U as te}from"./user-plus-BeF-O73P.js";import{E as R}from"./eye-off-BVqitGWE.js";import{E as T}from"./eye-QkcRAVlH.js";function ae(){const{t:s}=M(),A=V(),[x,U]=r.useState(!1),[u,L]=r.useState(!1),[y,p]=r.useState(""),[N,b]=r.useState(""),[f,S]=r.useState(!1),[D,O]=r.useState([]),[g,P]=r.useState(""),I=r.useRef(null),[_,j]=r.useState(""),{register:n,handleSubmit:q,watch:v,formState:{errors:a}}=Q(),w=$(),B=v("password");r.useEffect(()=>{(async()=>{var c,m,o;try{const i=await G.getSchools({limit:100,page:1});if((c=i.data)!=null&&c.success){const l=((o=(m=i.data)==null?void 0:m.data)==null?void 0:o.schools)||[];O(l)}}catch(i){console.error("Failed to fetch schools:",i)}})()},[]);const H=async t=>{var c,m;S(!0),p(""),b("");try{const o={username:t.username,email:t.email,password:t.password,confirm_password:t.confirmPassword,cf_turnstile_response:_||void 0};if(t.schoolId){const l=parseInt(t.schoolId,10);Number.isNaN(l)||(o.school_id=l)}else g.trim()&&(o.new_school_name=g.trim());const i=await J.register(o);if(i.success){const l=t.email,C=i.data??{};sessionStorage.setItem("pending_verification_email",l),C.verification_resend_available_at?sessionStorage.setItem("verification_resend_available_at",C.verification_resend_available_at):sessionStorage.removeItem("verification_resend_available_at"),sessionStorage.setItem("verification_return_path","/dashboard");const k=s("auth.verification.checkInbox",{email:l});b(k),K.success(k),A(`/auth/verify-email?email=${encodeURIComponent(l)}`,{replace:!0})}else p(i.message||s("auth.registerFailed"))}catch(o){p(o.message||s("auth.registerFailed")),(m=(c=I.current)==null?void 0:c.reset)==null||m.call(c)}finally{S(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-100",children:e.jsx(te,{className:"h-6 w-6 text-green-600"})}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:s("auth.createAccount")}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[s("auth.orSignInPrompt")," ",e.jsx(h,{to:"/auth/login",className:"font-medium text-green-600 hover:text-green-500",children:s("auth.signIn")})]})]}),e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:s("auth.signUp")}),e.jsx(Z,{children:s("auth.fillInformation")})]}),e.jsx(ee,{children:e.jsxs("form",{onSubmit:q(H),className:"space-y-6",children:[y&&e.jsx(E,{variant:"destructive",children:e.jsx(F,{children:y})}),N&&e.jsx(E,{variant:"success",children:e.jsx(F,{children:N})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:s("auth.username")}),e.jsxs("div",{className:"mt-1",children:[e.jsx(d,{id:"username",type:"text",autoComplete:"username",placeholder:s("auth.usernamePlaceholder"),error:a.username,...n("username",w.username)}),a.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.username.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:s("auth.email")}),e.jsxs("div",{className:"mt-1",children:[e.jsx(d,{id:"email",type:"email",autoComplete:"email",placeholder:s("auth.emailPlaceholder"),error:a.email,...n("email",w.email)}),a.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.email.message})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"schoolId",className:"block text-sm font-medium text-gray-700",children:[s("auth.school"),"（",s("common.optional")||"可选","）"]}),e.jsxs("div",{className:"mt-1 space-y-2",children:[e.jsxs("select",{id:"schoolId",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500",...n("schoolId"),onChange:t=>{t.target.value&&P("")},children:[e.jsx("option",{value:"",children:s("auth.selectSchool")}),D.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"text",placeholder:s("auth.schoolPlaceholder","输入以创建新学校 (可选)"),value:g,onChange:t=>{P(t.target.value),t.target.value},disabled:!!v("schoolId")}),v("schoolId")&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500",children:s("common.selected","Selected")})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:s("auth.schoolOptionalHint")}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:s("auth.newSchoolNote")})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:s("auth.password")}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(d,{id:"password",type:x?"text":"password",autoComplete:"new-password",placeholder:s("auth.passwordPlaceholder"),error:a.password,...n("password",w.password)}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>U(!x),children:x?e.jsx(R,{className:"h-4 w-4 text-gray-400"}):e.jsx(T,{className:"h-4 w-4 text-gray-400"})}),a.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.password.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:s("auth.confirmPassword")}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(d,{id:"confirmPassword",type:u?"text":"password",autoComplete:"new-password",placeholder:s("auth.confirmPasswordPlaceholder"),error:a.confirmPassword,...n("confirmPassword",{required:s("auth.confirmPasswordRequired"),validate:t=>t===B||s("auth.passwordMismatch")})}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>L(!u),children:u?e.jsx(R,{className:"h-4 w-4 text-gray-400"}):e.jsx(T,{className:"h-4 w-4 text-gray-400"})}),a.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.confirmPassword.message})]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(se,{ref:I,className:"mt-2",onVerify:t=>j(t),onExpire:()=>j(""),onError:()=>j("")})}),e.jsx("div",{children:e.jsx(z,{type:"submit",className:"w-full",loading:f,disabled:f||!_,children:s(f?"auth.registering":"auth.signUp")})}),e.jsx("div",{className:"text-sm text-gray-600",children:e.jsxs("p",{children:[s("auth.agreementText")," ",e.jsx(h,{to:"/terms",className:"text-green-600 hover:text-green-500",children:s("auth.termsOfService")})," ",s("auth.and")," ",e.jsx(h,{to:"/privacy",className:"text-green-600 hover:text-green-500",children:s("auth.privacyPolicy")})]})})]})})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[s("auth.haveAccount")," ",e.jsx(h,{to:"/auth/login",className:"font-medium text-green-600 hover:text-green-500",children:s("auth.signInNow")})]})})]})})}function he(){return e.jsx(ae,{})}export{he as default};
