import{j as e}from"./motion-vendor-C11-9Hm-.js";import{R as O,r as _}from"./react-vendor-CFnAvB5y.js";import{u as b,B as P,X as x,T as R,I as j,o as v,Y as $,Z as C,P as z,C as E,K as k}from"./index-DTb_MiA2.js";import{C as S}from"./clock-D6XRiE4e.js";import{C as T}from"./circle-check-big-DY8MNPjT.js";import{C as D}from"./circle-x-CRdIQpkI.js";import{F as A}from"./funnel-CH9oGJX7.js";import{C as F}from"./calendar-days-Bz5lxOQ6.js";import{I as L,A as H}from"./ActivityDetailModal-C10lp9FR.js";import{E as X}from"./eye-DtcVFdyd.js";import{P as G}from"./Pagination-CzrPUGhr.js";import{A as K,b as Q,a as U}from"./Alert-CAcIl8e7.js";import"./i18n-vendor-DK0x1_bH.js";import"./charts-vendor-DJkHj7pX.js";import"./image-9-IEiIti.js";import"./chevron-left-B7pzJfHJ.js";import"./chevron-right-CW1xHJEG.js";import"./Card-COwhRA1q.js";function Y({filters:t,onFiltersChange:n,categories:r=[],isLoading:o=!1}){const{t:i}=b(),c=O.useMemo(()=>Array.isArray(r)?r:r&&typeof r=="object"?Object.keys(r).map(a=>({category:a})):typeof r=="string"?[{category:r}]:[],[r]),l=(a,g)=>{n({...t,[a]:g,page:1})},s=()=>{n({search:"",category:"",status:"",start_date:"",end_date:"",sort:"created_at_desc",page:1})},u=t.search||t.category||t.status||t.start_date||t.end_date,d=[{value:"pending",label:i("activities.status.pending"),icon:e.jsx(S,{className:"h-4 w-4 text-blue-500"})},{value:"approved",label:i("activities.status.approved"),icon:e.jsx(T,{className:"h-4 w-4 text-green-500"})},{value:"rejected",label:i("activities.status.rejected"),icon:e.jsx(D,{className:"h-4 w-4 text-red-500"})}],h=[{value:"created_at_desc",label:i("common.sort.newest")},{value:"created_at_asc",label:i("common.sort.oldest")},{value:"points_desc",label:i("common.sort.pointsHighToLow")},{value:"points_asc",label:i("common.sort.pointsLowToHigh")}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:i("activities.filters.title")})]}),u&&e.jsxs(P,{variant:"ghost",size:"sm",onClick:s,className:"text-gray-500 hover:text-gray-700",children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),i("common.clear")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:i("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(j,{type:"text",value:t.search,onChange:a=>l("search",a.target.value),placeholder:i("activities.filters.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:i("activities.filters.category")}),e.jsxs("select",{value:t.category,onChange:a=>l("category",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:o,children:[e.jsx("option",{value:"",children:i("activities.filters.allCategories")}),c.map(a=>e.jsx("option",{value:a.category,children:i(`activities.categories.${a.category}`,a.category)},a.category))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:i("activities.filters.status")}),e.jsxs("select",{value:t.status,onChange:a=>l("status",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:o,children:[e.jsx("option",{value:"",children:i("activities.filters.allStatus")}),d.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(F,{className:"h-4 w-4 inline mr-1"}),i("activities.filters.startDate")]}),e.jsx(j,{type:"date",value:t.start_date,onChange:a=>l("start_date",a.target.value),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(F,{className:"h-4 w-4 inline mr-1"}),i("activities.filters.endDate")]}),e.jsx(j,{type:"date",value:t.end_date,onChange:a=>l("end_date",a.target.value),className:"w-full"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:i("common.sort.sortBy")}),e.jsx("select",{value:t.sort,onChange:a=>l("sort",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:o,children:h.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),u&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-blue-700",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs("span",{children:[i("activities.filters.activeFilters"),":"]})]})}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[t.search&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[i("common.search"),': "',t.search,'"',e.jsx("button",{onClick:()=>l("search",""),className:"ml-1 hover:text-blue-600",children:e.jsx(x,{className:"h-3 w-3"})})]}),t.category&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[i(`activities.categories.${t.category}`,t.category),e.jsx("button",{onClick:()=>l("category",""),className:"ml-1 hover:text-blue-600",children:e.jsx(x,{className:"h-3 w-3"})})]}),t.status&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[i(`activities.status.${t.status}`),e.jsx("button",{onClick:()=>l("status",""),className:"ml-1 hover:text-blue-600",children:e.jsx(x,{className:"h-3 w-3"})})]}),(t.start_date||t.end_date)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[t.start_date," - ",t.end_date,e.jsx("button",{onClick:()=>{l("start_date",""),l("end_date","")},className:"ml-1 hover:text-blue-600",children:e.jsx(x,{className:"h-3 w-3"})})]})]})]})]})}function Z({activities:t,onRowClick:n}){const{t:r}=b(),o=s=>s.activity_name||s.activity_name_zh||s.activity_name_en||s.activity||"",i=s=>s.activity_category||s.category||"unknown",c=s=>s.activity_unit||s.unit||"",l=s=>{switch(s){case"pending":return e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(S,{className:"h-3 w-3 mr-1"})," ",r("activities.status.pending")]});case"approved":return e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(T,{className:"h-3 w-3 mr-1"})," ",r("activities.status.approved")]});case"rejected":return e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(D,{className:"h-3 w-3 mr-1"})," ",r("activities.status.rejected")]});default:return null}};return e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow-sm border",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r("activities.table.images","Images")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r("activities.table.activity")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r("activities.table.data")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r("activities.table.carbonSaved")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r("activities.table.points")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r("activities.table.status")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r("activities.table.date")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r("activities.table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap align-top",children:e.jsx(L,{images:s.images||[],maxThumbnails:1})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:o(s)}),e.jsx("div",{className:"text-sm text-gray-500",children:r(`activities.categories.${i(s)}`,i(s))})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[v(s.data_value??s.amount)," ",r(`units.${c(s)}`,c(s))]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[v(s.carbon_saved)," kg CO2e"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-green-600 font-semibold",children:["+",v(s.points_earned)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l(s.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:$(s.activity_date,"yyyy-MM-dd")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs(P,{variant:"ghost",size:"sm",onClick:()=>n(s),children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," ",r("common.view")]})})]},s.id))})]})})}function pe(){var f,N,w;const{t}=b(),[n,r]=_.useState({search:"",category:"",status:"",start_date:"",end_date:"",sort:"created_at_desc",page:1,limit:10}),[o,i]=_.useState(null),{data:c,isLoading:l,error:s,isFetching:u}=C(["activities",n],()=>k.getTransactions(n),{keepPreviousData:!0}),{data:d}=C("activityCategories",()=>k.getActivities({grouped:!0})),h=m=>{r(m)},a=m=>{r(M=>({...M,page:m}))},g=m=>{i(m)},I=()=>{i(null)},y=((f=c==null?void 0:c.data)==null?void 0:f.data)||[],p=((N=c==null?void 0:c.data)==null?void 0:N.pagination)||{},B=((w=d==null?void 0:d.data)==null?void 0:w.data)||[];return e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:t("activities.history.title")}),e.jsx("p",{className:"text-muted-foreground",children:t("activities.history.subtitle")})]}),e.jsx(Y,{filters:n,onFiltersChange:h,categories:B,isLoading:u}),l?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(z,{className:"h-8 w-8 animate-spin text-green-500"})}):s?e.jsxs(K,{variant:"destructive",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(Q,{children:t("common.error")}),e.jsx(U,{children:t("errors.loadFailed")})]}):y.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-xl font-semibold",children:t("activities.history.noActivitiesFound")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:t("activities.history.tryDifferentFilters")})]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{activities:y,onRowClick:g}),e.jsx(G,{currentPage:p.current_page,totalPages:p.total_pages,onPageChange:a,itemsPerPage:p.per_page,totalItems:p.total_items})]}),e.jsx(H,{activity:o,isOpen:!!o,onClose:I})]})}export{pe as default};
