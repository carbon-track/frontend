import{c as K,u as y,j as e,M as C,B as x,X as w,y as W,I as X,G as f,E as S,K as t,N as Y,O as J,Q as U,T as ee,V as se,k as te,W as ae,Y as le,Z as re,r as k,F as ne,w as ie,C as ce,n as u,$ as j}from"./index-C4ClwSHN.js";import{u as A}from"./useMutation-BLMaklX2.js";import{F}from"./funnel-BWcRnN9X.js";import{E as oe}from"./eye-CsnfpsPn.js";import{T as O}from"./trash-2-1VfJdTuZ.js";import{P as de}from"./Pagination-BXbKOlfC.js";import{A as me,b as xe,a as ue}from"./Alert-BS-wSso6.js";import{A as he,a as ge,b as pe,c as je,d as fe,e as ye,f as Ne,g as be}from"./alert-dialog-CKWOvkTz.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]],h=K("mail-open",ve);function we({filters:s,onFiltersChange:d,isLoading:o=!1}){const{t:i}=y(),l=(n,N)=>{d({...s,[n]:N,page:1})},m=()=>{d({search:"",status:"",sort:"created_at_desc",page:1})},c=!!(s.search||s.status),a=[{value:"unread",label:i("messages.unread"),icon:e.jsx(C,{className:"h-4 w-4 text-blue-500"})},{value:"read",label:i("messages.read"),icon:e.jsx(h,{className:"h-4 w-4 text-gray-500"})}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:i("messages.filters.title")})]}),c&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:m,className:"text-gray-500 hover:text-gray-700",children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),i("common.clear")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:i("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(X,{type:"text",value:s.search,onChange:n=>l("search",n.target.value),placeholder:i("messages.filters.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:i("messages.filters.status")}),e.jsxs("select",{value:s.status,onChange:n=>l("status",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:o,children:[e.jsx("option",{value:"",children:i("messages.filters.allStatus")}),a.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:i("common.sort.sortBy")}),e.jsxs("select",{value:s.sort,onChange:n=>l("sort",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:o,children:[e.jsx("option",{value:"created_at_desc",children:i("common.sort.newest")}),e.jsx("option",{value:"created_at_asc",children:i("common.sort.oldest")}),e.jsx("option",{value:"priority_desc",children:i("messages.filters.priorityHighToLow")}),e.jsx("option",{value:"priority_asc",children:i("messages.filters.priorityLowToHigh")})]})]}),c&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-blue-700",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:[i("messages.filters.activeFilters"),":"]})]})}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[s.search&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[i("common.search"),': "',s.search,'"',e.jsx("button",{onClick:()=>l("search",""),className:"ml-1 hover:text-blue-600",children:e.jsx(w,{className:"h-3 w-3"})})]}),s.status&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[i(`messages.${s.status}`),e.jsx("button",{onClick:()=>l("status",""),className:"ml-1 hover:text-blue-600",children:e.jsx(w,{className:"h-3 w-3"})})]})]})]})]})}function q({messages:s,onRowClick:d,onMarkRead:o,onDelete:i}){const{t:l}=y(),m=a=>a?e.jsx(h,{className:"h-4 w-4 text-gray-500"}):e.jsx(C,{className:"h-4 w-4 text-blue-500"}),c=a=>{if(a.type==="system")return!0;if(a.sender_id!==null)return!1;const n=(a.title||"").toLowerCase();return/\b(公告|announcement|system|系统|broadcast|boardcast)\b/i.test(n)};return e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow-sm border",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("messages.subject")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("messages.content")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("messages.status")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("messages.date")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("common.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(a=>{var n;return e.jsxs("tr",{className:`hover:bg-gray-50 ${a.is_read?"":"bg-blue-50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[m(a.is_read),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-900 line-clamp-1",children:a.title}),a.priority&&e.jsx(f,{variant:a.sender_id===null?"secondary":"default",className:"ml-3",children:l(`messages.priority.${a.priority}`)}),c(a)&&e.jsx(f,{variant:"outline",className:"ml-2",children:l("messages.labels.announcement")})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 line-clamp-1",children:(n=a.content)==null?void 0:n.slice(0,120)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.is_read?l("messages.read"):l("messages.unread")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:S(a.created_at,"yyyy-MM-dd HH:mm")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>d(a),className:"mr-2",children:[e.jsx(oe,{className:"h-4 w-4 mr-1"})," ",l("common.view")]}),!a.is_read&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>o(a.id),className:"mr-2",children:[e.jsx(h,{className:"h-4 w-4 mr-1"})," ",l("messages.markRead")]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>i(a.id),className:"text-red-600 hover:text-red-800",children:[e.jsx(O,{className:"h-4 w-4 mr-1"})," ",l("common.delete")]})]})]},a.id)})})]})})}q.propTypes={messages:t.arrayOf(t.shape({id:t.oneOfType([t.string,t.number]).isRequired,is_read:t.bool,title:t.string,content:t.string,created_at:t.oneOfType([t.string,t.number,t.instanceOf(Date)]),priority:t.string,sender_id:t.oneOfType([t.string,t.number])})).isRequired,onRowClick:t.func.isRequired,onMarkRead:t.func.isRequired,onDelete:t.func.isRequired};function P({message:s,isOpen:d,onClose:o,onMarkRead:i}){const{t:l}=y();if(!d||!s)return null;const m=a=>a?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(h,{className:"h-3 w-3 mr-1"})," ",l("messages.read")]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(C,{className:"h-3 w-3 mr-1"})," ",l("messages.unread")]}),c=a=>{if(!a)return!1;if(a.type==="system")return!0;if(a.sender_id!==null)return!1;const n=(a.title||"").toLowerCase();return/\b(公告|announcement|system|系统|broadcast|boardcast)\b/i.test(n)};return e.jsx(Y,{open:d,onOpenChange:a=>{a||o==null||o()},children:e.jsxs(J,{className:"max-w-2xl",children:[e.jsxs(U,{children:[e.jsx(ee,{className:"text-xl",children:l("messages.detail.title")}),e.jsx(se,{children:l("messages.detail.subtitle")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.priority&&e.jsx(f,{variant:s.priority,children:l(`messages.priority.${s.priority}`)}),c(s)&&e.jsx(f,{variant:"outline",children:l("messages.labels.announcement")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:l("messages.status")}),m(s.is_read)]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:l("messages.date")}),e.jsx("p",{className:"text-gray-900",children:S(s.created_at,"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-700 mb-2 flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),l("messages.subject")]}),e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-md",children:s.title})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-700 mb-2 flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),l("messages.content")]}),e.jsx("div",{className:"text-gray-700 bg-gray-50 p-3 rounded-md",dangerouslySetInnerHTML:{__html:s.content}})]}),e.jsxs(le,{className:"pt-2",children:[!s.is_read&&e.jsxs(x,{variant:"outline",onClick:()=>i(s.id),className:"mr-2",children:[e.jsx(h,{className:"h-4 w-4 mr-1"})," ",l("messages.markRead")]}),e.jsx(x,{onClick:o,children:l("common.close")})]})]})]})})}P.propTypes={isOpen:t.bool.isRequired,onClose:t.func.isRequired,onMarkRead:t.func.isRequired,message:t.shape({id:t.oneOfType([t.string,t.number]).isRequired,is_read:t.bool.isRequired,title:t.string,created_at:t.oneOfType([t.string,t.number,t.instanceOf(Date)]).isRequired,content:t.string,priority:t.string,sender_id:t.oneOfType([t.string,t.number]),type:t.string})};function Fe(){var M,T;const{t:s}=y(),d=re(),[o,i]=k.useState({search:"",type:"",status:"",priority:"",sort:"created_at_desc",page:1,limit:10}),[l,m]=k.useState(null),[c,a]=k.useState({open:!1,type:null,data:null}),{data:n,isLoading:N,error:L,isFetching:H}=ne(["messages",o],()=>j.getMessages(o),{keepPreviousData:!0}),R=A(r=>j.markAsRead(r),{onSuccess:()=>{d.invalidateQueries("messages"),u.success(s("messages.markReadSuccess")),l&&m(r=>r&&{...r,is_read:!0})},onError:()=>{u.error(s("messages.markReadFailed"))}}),I=A(r=>j.deleteMessage(r),{onSuccess:()=>{d.invalidateQueries("messages"),u.success(s("messages.deleteSuccess")),m(null)},onError:()=>{u.error(s("messages.deleteFailed"))}}),_=A(()=>j.markAllAsRead(),{onSuccess:()=>{d.invalidateQueries("messages"),u.success(s("messages.markAllReadSuccess"))},onError:()=>{u.error(s("messages.markAllReadFailed"))}}),E=r=>{i(r)},Q=r=>{i(v=>({...v,page:r}))},B=r=>{m(r),r.is_read||R.mutate(r.id)},$=()=>{m(null)},D=r=>{R.mutate(r)},z=r=>{a({open:!0,type:"delete",data:r})},V=()=>{a({open:!0,type:"markAllRead",data:null})},Z=()=>{a({open:!0,type:"deleteAll",data:null})},G=()=>{const{type:r,data:v}=c;r==="delete"?I.mutate(v):r==="markAllRead"?_.mutate():r==="deleteAll"&&u.error(s("messages.deleteAllNotImplemented")),b()},b=()=>{a({open:!1,type:null,data:null})},g=((M=n==null?void 0:n.data)==null?void 0:M.data)||[],p=((T=n==null?void 0:n.data)==null?void 0:T.pagination)||{};return e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:s("messages.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("messages.subtitle")})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(x,{variant:"outline",onClick:V,disabled:_.isLoading||g.filter(r=>!r.is_read).length===0,children:[e.jsx(h,{className:"h-4 w-4 mr-2"})," ",s("messages.markAllRead")]}),e.jsxs(x,{variant:"destructive",onClick:Z,disabled:g.length===0,children:[e.jsx(O,{className:"h-4 w-4 mr-2"})," ",s("messages.deleteAll")]})]})]}),e.jsx(we,{filters:o,onFiltersChange:E,isLoading:H}),N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ie,{className:"h-8 w-8 animate-spin text-green-500"})}):L?e.jsxs(me,{variant:"destructive",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(xe,{children:s("common.error")}),e.jsx(ue,{children:s("errors.loadFailed")})]}):g.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-xl font-semibold",children:s("messages.noMessagesFound")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("messages.tryDifferentFilters")})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{messages:g,onRowClick:B,onMarkRead:D,onDelete:z}),e.jsx(de,{currentPage:p.current_page,totalPages:p.total_pages,onPageChange:Q,itemsPerPage:p.per_page,totalItems:p.total_items})]}),e.jsx(P,{message:l,isOpen:!!l,onClose:$,onMarkRead:D}),e.jsx(he,{open:c.open,onOpenChange:r=>!r&&b(),children:e.jsxs(ge,{children:[e.jsxs(pe,{children:[e.jsxs(je,{children:[c.type==="delete"&&s("messages.confirmDeleteTitle","Confirm Delete"),c.type==="deleteAll"&&s("messages.confirmDeleteAllTitle","Confirm Delete All"),c.type==="markAllRead"&&s("messages.confirmMarkAllReadTitle","Confirm Mark All Read")]}),e.jsxs(fe,{children:[c.type==="delete"&&s("messages.confirmDelete","Are you sure you want to delete this message?"),c.type==="deleteAll"&&s("messages.confirmDeleteAll","Are you sure you want to delete all messages?"),c.type==="markAllRead"&&s("messages.confirmMarkAllRead","Are you sure you want to mark all messages as read?")]})]}),e.jsxs(ye,{children:[e.jsx(Ne,{onClick:b,children:s("common.cancel","Cancel")}),e.jsx(be,{onClick:G,children:s("common.confirm","Confirm")})]})]})})]})}export{Fe as default};
