import{c as Y,a2 as Z,u as le,r as f,j as e,a as H,I as pe,y as me,B as Q,R as xe,G as fe,bb as te,bc as se,bd as ae,K as p,ai as he,w as re}from"./index-D2v4yG6T.js";import{C as ye}from"./chevron-down-L6Uv8N57.js";import{C as be}from"./chevron-right-C7zHSOLe.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]],ge=Y("chevrons-down",je);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]],ve=Y("chevrons-up",_e);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],oe=Y("copy",we);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],Le=Y("file-json",Ne);async function ke(s){return(await Z.get(`/admin/system-logs/${s}`)).data}async function Ae(s={}){const{q:a,date_from:n,date_to:m,types:l,limit_per_type:c,method:x,status_code:d,user_id:w,request_id:$,path:i,min_duration:v,max_duration:h,action:S,audit_status:V,error_type:g,model:D,source:P,actor_type:q,actor_id:T,llm_status:k,system_page:C,audit_page:u,error_page:N,llm_page:A}=s,b=new URLSearchParams;return a&&b.append("q",a),n&&b.append("date_from",n),m&&b.append("date_to",m),l!=null&&l.length&&b.append("types",l.join(",")),c&&b.append("limit_per_type",c),C&&b.append("system_page",C),u&&b.append("audit_page",u),N&&b.append("error_page",N),A&&b.append("llm_page",A),x&&b.append("method",x),d&&b.append("status_code",d),w&&b.append("user_id",w),$&&b.append("request_id",$),i&&b.append("path",i),v&&b.append("min_duration",v),h&&b.append("max_duration",h),S&&b.append("action",S),V&&b.append("audit_status",V),g&&b.append("error_type",g),D&&b.append("model",D),P&&b.append("source",P),q&&b.append("actor_type",q),T&&b.append("actor_id",T),k&&b.append("llm_status",k),(await Z.get(`/admin/logs/search?${b.toString()}`)).data}async function Re(s){var l,c,x,d,w;if(!s)return{system:[],audit:[],error:[],llm:[]};const a=new URLSearchParams;a.append("request_id",s),a.append("types","system,audit,error,llm"),a.append("limit_per_type","200");const n=await Z.get(`/admin/logs/search?${a.toString()}`),m=((l=n.data)==null?void 0:l.data)||n.data||{};return{system:((c=m.system)==null?void 0:c.items)||m.system||[],audit:((x=m.audit)==null?void 0:x.items)||m.audit||[],error:((d=m.error)==null?void 0:d.items)||m.error||[],llm:((w=m.llm)==null?void 0:w.items)||m.llm||[]}}async function Fe(s={},a="csv"){const{q:n,date_from:m,date_to:l,types:c,method:x,status_code:d,user_id:w,request_id:$,path:i,min_duration:v,max_duration:h,action:S,audit_status:V,error_type:g,model:D,source:P,actor_type:q,actor_id:T,llm_status:k,max:C}=s,u=new URLSearchParams;return n&&u.append("q",n),m&&u.append("date_from",m),l&&u.append("date_to",l),c!=null&&c.length&&u.append("types",c.join(",")),x&&u.append("method",x),d&&u.append("status_code",d),w&&u.append("user_id",w),$&&u.append("request_id",$),i&&u.append("path",i),v&&u.append("min_duration",v),h&&u.append("max_duration",h),S&&u.append("action",S),V&&u.append("audit_status",V),g&&u.append("error_type",g),D&&u.append("model",D),P&&u.append("source",P),q&&u.append("actor_type",q),T&&u.append("actor_id",T),k&&u.append("llm_status",k),C&&u.append("max",C),u.append("format",a),(await Z.get(`/admin/logs/export?${u.toString()}`,{responseType:"blob"})).data}const Ce=[],R="$";function F(s){return s===null?"null":Array.isArray(s)?"array":typeof s}function I(s){return s==="object"||s==="array"}function Se(s,a){switch(a){case"string":return`"${s}"`;case"number":case"boolean":return String(s);case"null":return"null";case"undefined":return"undefined";default:return String(s)}}function Te(s){switch(s){case"string":return"text-emerald-600";case"number":return"text-sky-600";case"boolean":return"text-purple-600";case"null":case"undefined":return"text-muted-foreground";default:return"text-foreground"}}function K(s){return!s||s.length===0?R:`${R}${s.map(a=>typeof a=="number"?`[${a}]`:`.${a}`).join("")}`}function $e(s){return!s||s.length===0?R:s.reduce((a,n)=>typeof n=="number"?`${a}[${n}]`:`${a}.${n}`,R)}function ie(s,a=[],n=new Set){const m=F(s);return I(m)&&(n.add(K(a)),(m==="array"?s.map((c,x)=>[x,c]):Object.entries(s||{})).forEach(([c,x])=>{ie(x,a.concat(c),n)})),n}function W(s,a,n=[],m=[]){if(a==="")return m;const l=F(s);return l==="object"?Object.entries(s||{}).forEach(([c,x])=>{c.toLowerCase().includes(a)&&m.push(n.concat(c)),W(x,a,n.concat(c),m)}):l==="array"?s.forEach((c,x)=>{W(c,a,n.concat(x),m)}):String(s??"").toLowerCase().includes(a)&&m.push(n),m}function De(s){const a=[];for(let n=0;n<=s.length;n+=1)a.push(K(s.slice(0,n)));return a}function Oe(s,a){return s===void 0?a:typeof s=="number"?`[${s}]`:s}const ce=xe.memo(function s({name:a,value:n,path:m,searchTerm:l,labels:c,typeLabels:x,expandedPaths:d,onToggle:w,onCopyPath:$,onCopyValue:i}){const v=F(n),h=I(v),S=K(m),V=d.has(S),g=Oe(a,c.root),D=f.useMemo(()=>h?v==="array"?n.map((C,u)=>[u,C]):Object.entries(n||{}):[],[h,v,n]),P=h?"":String(n??""),q=!!(l&&(g&&g.toLowerCase().includes(l)||!h&&P.toLowerCase().includes(l))),T=x[v]||x.unknown,k=h?`${D.length}`:void 0;return e.jsxs("div",{className:H("group relative border-l border-muted-foreground/20 pl-3",q&&"bg-amber-50/60"),children:[e.jsxs("div",{className:"flex items-start gap-2 py-1",children:[e.jsx("button",{type:"button",className:H("mt-1 flex h-4 w-4 items-center justify-center rounded text-muted-foreground transition hover:bg-muted hover:text-foreground",!h&&"opacity-0"),onClick:()=>h&&w(m),"aria-label":V?c.collapse:c.expand,children:V?e.jsx(ye,{className:"h-3 w-3"}):e.jsx(be,{className:"h-3 w-3"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"font-mono text-[12px] text-foreground",children:g}),e.jsxs(fe,{variant:"secondary",className:"text-[10px] uppercase tracking-wide",children:[T,k?` · ${k}`:""]})]}),!h&&e.jsx("div",{className:H("font-mono text-[11px] break-all",Te(v)),children:Se(n,v)})]}),e.jsxs("div",{className:"flex items-center gap-1 pt-0.5 opacity-0 transition group-hover:opacity-100",children:[e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded text-muted-foreground hover:bg-muted hover:text-foreground",onClick:()=>$(m),"aria-label":c.copyPath,children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsx(ae,{children:c.copyPath})]}),e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded text-muted-foreground hover:bg-muted hover:text-foreground",onClick:()=>i(n),"aria-label":c.copyValue,children:e.jsx(oe,{className:"h-4 w-4"})})}),e.jsx(ae,{children:c.copyValue})]})]})]}),h&&V&&D.length>0&&e.jsx("div",{className:"pl-4",children:D.map(([C,u])=>e.jsx(s,{name:C,value:u,path:m.concat(C),searchTerm:l,labels:c,typeLabels:x,expandedPaths:d,onToggle:w,onCopyPath:$,onCopyValue:i},typeof C=="number"?C:String(C)))})]})});ce.displayName="JsonNode";function G({value:s,collapsed:a=!1,maxHeight:n="20rem",className:m}){const{t:l}=le(),[c,x]=f.useState(""),[d,w]=f.useState(new Set([R])),[$,i]=f.useState(""),v=f.useRef(),h=f.useMemo(()=>s,[s]),S=c.trim().toLowerCase(),V=f.useMemo(()=>({object:l("jsonViewer.typeLabels.object"),array:l("jsonViewer.typeLabels.array"),string:l("jsonViewer.typeLabels.string"),number:l("jsonViewer.typeLabels.number"),boolean:l("jsonViewer.typeLabels.boolean"),null:l("jsonViewer.typeLabels.null"),undefined:l("jsonViewer.typeLabels.undefined"),unknown:l("jsonViewer.typeLabels.unknown")}),[l]),g=f.useMemo(()=>({root:l("jsonViewer.root"),searchPlaceholder:l("jsonViewer.searchPlaceholder"),expandAll:l("jsonViewer.expandAll"),collapseAll:l("jsonViewer.collapseAll"),copyJson:l("jsonViewer.copyJson"),copyPath:l("jsonViewer.copyPath"),copyValue:l("jsonViewer.copyValue"),expand:l("jsonViewer.expandNode"),collapse:l("jsonViewer.collapseNode"),copied:l("jsonViewer.copied"),noData:l("jsonViewer.noData")}),[l]),D=f.useMemo(()=>{const j=new Set([R]);return a||(F(h)==="array"?h.map((M,t)=>[t,h[t]]):Object.entries(h||{})).forEach(([M,t])=>{I(F(t))&&j.add(K([M]))}),j},[h,a]);f.useEffect(()=>{w(D)},[D]);const P=f.useCallback(j=>{i(j),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>i(""),1200)},[]);f.useEffect(()=>()=>{v.current&&clearTimeout(v.current)},[]),f.useEffect(()=>{if(!S)return;const j=W(h,S);j.length!==0&&w(O=>{const r=new Set(O);return j.forEach(M=>{De(M).forEach(t=>r.add(t))}),r})},[h,S]);const q=f.useMemo(()=>ie(h),[h]),T=f.useCallback(j=>{const O=K(j);w(r=>{const M=new Set(r);return M.has(O)?M.delete(O):M.add(O),M})},[]),k=f.useCallback(()=>{w(new Set(q))},[q]),C=f.useCallback(()=>{w(new Set([R]))},[]),u=f.useCallback(j=>{var O;!j&&j!==""||typeof navigator<"u"&&((O=navigator.clipboard)!=null&&O.writeText)&&navigator.clipboard.writeText(j).then(()=>{P(g.copied)}).catch(()=>{})},[g.copied,P]),N=f.useCallback(()=>{try{const j=JSON.stringify(h,null,2);u(j)}catch{u(String(h))}},[u,h]),A=f.useCallback(j=>{u($e(j))},[u]),b=f.useCallback(j=>{const O=F(j),r=I(O)?JSON.stringify(j,null,2):String(j??"");u(r)},[u]);return e.jsxs("div",{className:H("border rounded bg-background text-xs shadow-sm",m),style:{maxHeight:n,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex items-center gap-2 border-b bg-muted/30 px-2 py-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pe,{value:c,onChange:j=>x(j.target.value),placeholder:g.searchPlaceholder,className:"h-8 w-full pl-7 text-xs"}),e.jsx("span",{className:"pointer-events-none absolute left-2 top-1/2 flex -translate-y-1/2 text-muted-foreground",children:e.jsx(me,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{size:"icon",variant:"ghost",onClick:k,className:"h-8 w-8","aria-label":g.expandAll,children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(Q,{size:"icon",variant:"ghost",onClick:C,className:"h-8 w-8","aria-label":g.collapseAll,children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(Q,{size:"icon",variant:"ghost",onClick:N,className:"h-8 w-8","aria-label":g.copyJson,children:e.jsx(oe,{className:"h-4 w-4"})})]}),$&&e.jsx("span",{className:"ml-2 text-[10px] text-muted-foreground",children:$})]}),e.jsx("div",{className:"flex-1 overflow-auto px-2 py-2",children:h==null?e.jsx("div",{className:"text-xs text-muted-foreground",children:g.noData}):e.jsx(ce,{name:g.root,value:h,path:Ce,searchTerm:S,labels:g,typeLabels:V,expandedPaths:d,onToggle:T,onCopyPath:A,onCopyValue:b})})]})}G.propTypes={value:p.any,collapsed:p.bool,maxHeight:p.oneOfType([p.string,p.number]),className:p.string};function ne(s){if(s==null)return null;if(typeof s=="object")return s;try{return JSON.parse(s)}catch{return s}}function de(s,a,n=[]){if(Object.is(s,a))return[];if(typeof s!=="object"||typeof a!=="object"||s===null||a===null)return[{path:n.join("."),old:s,new:a}];const c=Array.from(new Set([...Object.keys(s),...Object.keys(a)])),x=[];for(const d of c)x.push(...de(s[d],a[d],n.concat(d)));return x.filter(d=>d.old!==d.new)}function Ee({oldData:s,newData:a}){const[n,m]=f.useState("inline"),l=f.useMemo(()=>ne(s),[s]),c=f.useMemo(()=>ne(a),[a]),x=f.useMemo(()=>de(l||{},c||{}),[l,c]);return e.jsxs("div",{className:"border rounded bg-white text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-gray-50",children:[e.jsx("strong",{children:"变更 Diff"}),e.jsx("div",{className:"ml-auto flex gap-1",children:["inline","side","tree"].map(d=>e.jsx("button",{onClick:()=>m(d),className:`px-2 py-0.5 rounded ${n===d?"bg-blue-600 text-white":"bg-gray-200"}`,children:d},d))})]}),n==="tree"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"旧"}),e.jsx(G,{value:l,collapsed:!0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"新"}),e.jsx(G,{value:c,collapsed:!0})]})]}),n==="side"&&e.jsx("div",{className:"p-2 overflow-auto",children:e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-1 text-left",children:"字段"}),e.jsx("th",{className:"p-1 text-left",children:"旧"}),e.jsx("th",{className:"p-1 text-left",children:"新"})]})}),e.jsxs("tbody",{children:[x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"p-2 text-center text-gray-500",children:"无差异"})}),x.map(d=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-1 align-top font-mono",children:d.path||"(root)"}),e.jsx("td",{className:"p-1 text-red-600 break-all font-mono",children:JSON.stringify(d.old)}),e.jsx("td",{className:"p-1 text-green-700 break-all font-mono",children:JSON.stringify(d.new)})]},d.path))]})]})}),n==="inline"&&e.jsxs("div",{className:"p-2 space-y-1 max-h-80 overflow-auto",children:[x.length===0&&e.jsx("div",{className:"text-gray-500",children:"无差异"}),x.map(d=>e.jsxs("div",{className:"border rounded p-1 bg-gray-50",children:[e.jsx("div",{className:"font-mono text-[10px] mb-1 text-gray-600",children:d.path||"(root)"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1 bg-red-50 p-1 rounded",children:[e.jsx("span",{className:"text-red-700",children:"旧:"})," ",e.jsx("code",{className:"break-all",children:JSON.stringify(d.old)})]}),e.jsxs("div",{className:"flex-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"text-green-700",children:"新:"})," ",e.jsx("code",{className:"break-all",children:JSON.stringify(d.new)})]})]})]},d.path))]})]})}function Ve({open:s,onClose:a,requestId:n,data:m,loading:l,onRefresh:c,system:x,audit:d,error:w,llm:$}){const{t:i}=le(),[v,h]=f.useState({}),[S,V]=f.useState({}),[g,D]=f.useState({system:{},llm:{}}),[P,q]=f.useState({system:{},llm:{}});f.useEffect(()=>{h({}),V({}),D({system:{},llm:{}}),q({system:{},llm:{}})},[n]);const T=f.useCallback((t,o,L)=>{D(E=>{const y={...E[t]||{}};return L?y[o]=!0:delete y[o],{...E,[t]:y}})},[]),k=f.useCallback((t,o,L)=>{q(E=>{const y={...E[t]||{}};return L?y[o]=L:delete y[o],{...E,[t]:y}})},[]),C=f.useCallback(async t=>{if(!(!t||v[t]||g.system[t])){T("system",t,!0),k("system",t,null);try{const o=await ke(t),L=(o==null?void 0:o.data)||o,E=(L==null?void 0:L.data)||L;h(y=>({...y,[t]:E}))}catch(o){k("system",t,(o==null?void 0:o.message)||i("errors.loadFailed"))}finally{T("system",t,!1)}}},[g.system,k,T,v,i]),u=f.useCallback(async t=>{if(!(!t||S[t]||g.llm[t])){T("llm",t,!0),k("llm",t,null);try{const o=await he.getLlmLogDetail(t),L=(o==null?void 0:o.data)||o,E=(L==null?void 0:L.data)||L;V(y=>({...y,[t]:E}))}catch(o){k("llm",t,(o==null?void 0:o.message)||i("errors.loadFailed"))}finally{T("llm",t,!1)}}},[g.llm,S,k,T,i]);if(!s)return null;const N=m??{system:x,audit:d,error:w,llm:$},A=(N==null?void 0:N.system)||[],b=(N==null?void 0:N.audit)||[],j=(N==null?void 0:N.error)||[],O=(N==null?void 0:N.llm)||[],r=t=>i(`admin.systemLogs.columns.${t}`,{defaultValue:t}),M=()=>e.jsx("div",{className:"text-xs text-muted-foreground",children:i("common.none")});return e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"flex-1 bg-black/40",onClick:a}),e.jsxs("div",{className:"flex h-full w-full max-w-3xl flex-col bg-white shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:i("admin.systemLogs.drawer.title",{id:n})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-sm text-blue-600",onClick:c,children:i("admin.systemLogs.drawer.refresh")}),e.jsx("button",{className:"text-gray-500",onClick:a,"aria-label":i("common.close"),children:"×"})]})]}),e.jsxs("div",{className:"flex-1 space-y-6 overflow-auto p-4 text-sm",children:[l&&e.jsx("div",{children:i("admin.systemLogs.drawer.loading")}),!l&&e.jsxs(e.Fragment,{children:[e.jsxs(B,{title:i("admin.systemLogs.drawer.systemTitle",{count:A.length}),children:[A.length===0&&M(),A.map(t=>{const o=v[t.id],L=g.system[t.id],E=P.system[t.id],y=o||t;return e.jsx(U,{toneClass:"bg-gray-50",summary:e.jsxs(e.Fragment,{children:[e.jsx(_,{label:r("id"),value:t.id}),e.jsx(_,{label:r("method"),value:t.method}),e.jsx(_,{label:r("path"),value:t.path}),e.jsx(_,{label:r("status_code"),value:t.status_code}),e.jsx(_,{label:r("duration_ms"),value:t.duration_ms}),e.jsx(_,{label:r("created_at"),value:t.created_at})]}),onOpen:()=>C(t.id),openLabel:i("admin.systemLogs.actions.expand"),closeLabel:i("admin.systemLogs.actions.collapse"),detail:e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsx(z,{items:[{label:r("request_id"),value:y.request_id||n},{label:r("method"),value:y.method},{label:r("path"),value:y.path,span:!0},{label:r("status_code"),value:y.status_code},{label:r("user_id"),value:y.user_id??"-"},{label:r("duration_ms"),value:y.duration_ms??"-"},{label:r("ip_address"),value:y.ip_address??"-"},{label:r("created_at"),value:y.created_at??"-"},{label:r("user_agent"),value:y.user_agent??"-",span:!0}]}),L&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(re,{className:"h-3.5 w-3.5 animate-spin"}),i("common.loading")]}),E&&e.jsx("div",{className:"text-xs text-rose-600",children:E}),o&&e.jsxs(e.Fragment,{children:[e.jsx(J,{title:i("admin.systemLogs.requestBody"),value:o.request_body}),e.jsx(J,{title:i("admin.systemLogs.responseBody"),value:o.response_body}),e.jsx(J,{title:i("admin.systemLogs.serverMeta"),value:o.server_meta})]})]})},`system-${t.id}`)})]}),e.jsxs(B,{title:i("admin.systemLogs.drawer.auditTitle",{count:b.length}),children:[b.length===0&&M(),b.map(t=>e.jsx(U,{toneClass:"bg-gray-50",summary:e.jsxs(e.Fragment,{children:[e.jsx(_,{label:r("id"),value:t.id}),e.jsx(_,{label:r("action"),value:t.action}),e.jsx(_,{label:r("operation_category"),value:t.operation_category}),e.jsx(_,{label:r("actor_type"),value:t.actor_type}),e.jsx(_,{label:r("status"),value:t.status}),e.jsx(_,{label:r("created_at"),value:t.created_at})]}),openLabel:i("admin.systemLogs.actions.expand"),closeLabel:i("admin.systemLogs.actions.collapse"),detail:e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsx(z,{items:[{label:r("id"),value:t.id},{label:r("action"),value:t.action},{label:r("operation_category"),value:t.operation_category||"-"},{label:r("actor_type"),value:t.actor_type},{label:r("status"),value:t.status},{label:r("user_id"),value:t.user_id??"-"},{label:r("ip_address"),value:t.ip_address??"-"},{label:r("created_at"),value:t.created_at}]}),(t.old_data||t.new_data)&&e.jsx(Ee,{oldData:t.old_data,newData:t.new_data}),t.data&&e.jsx(J,{title:i("admin.audit.requestData"),value:t.data})]})},`audit-${t.id}`))]}),e.jsxs(B,{title:i("admin.systemLogs.drawer.errorsTitle",{count:j.length}),children:[j.length===0&&M(),j.map(t=>e.jsx(U,{toneClass:"bg-rose-50/60",summary:e.jsxs(e.Fragment,{children:[e.jsx(_,{label:r("error_type"),value:t.error_type}),e.jsx(_,{label:r("error_file"),value:t.error_file}),e.jsx(_,{label:r("error_line"),value:t.error_line}),e.jsx(_,{label:r("error_time"),value:t.error_time})]}),openLabel:i("admin.systemLogs.actions.expand"),closeLabel:i("admin.systemLogs.actions.collapse"),detail:e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsx(z,{items:[{label:r("error_type"),value:t.error_type},{label:r("error_file"),value:t.error_file},{label:r("error_line"),value:t.error_line},{label:r("error_time"),value:t.error_time}]}),t.error_message&&e.jsx(X,{title:r("error_message"),value:t.error_message,toneClass:"bg-rose-50 text-rose-700"})]})},`error-${t.id}`))]}),e.jsxs(B,{title:i("admin.systemLogs.drawer.llmTitle",{count:O.length}),children:[O.length===0&&M(),O.map(t=>{const o=S[t.id],L=g.llm[t.id],E=P.llm[t.id],y=o||t;return e.jsx(U,{toneClass:"bg-indigo-50/60",summary:e.jsxs(e.Fragment,{children:[e.jsx(_,{label:r("actor_type"),value:t.actor_type}),e.jsx(_,{label:r("actor_id"),value:t.actor_id}),e.jsx(_,{label:r("model"),value:t.model}),e.jsx(_,{label:r("llm_status"),value:t.status}),e.jsx(_,{label:r("total_tokens"),value:t.total_tokens}),e.jsx(_,{label:r("latency_ms"),value:t.latency_ms}),e.jsx(_,{label:r("created_at"),value:t.created_at})]}),onOpen:()=>u(t.id),openLabel:i("admin.systemLogs.actions.expand"),closeLabel:i("admin.systemLogs.actions.collapse"),detail:e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsx(z,{items:[{label:r("request_id"),value:y.request_id||n},{label:r("actor_type"),value:y.actor_type},{label:r("actor_id"),value:y.actor_id??"-"},{label:r("source"),value:y.source||"-"},{label:r("model"),value:y.model||"-"},{label:r("llm_status"),value:y.status||"-"},{label:r("response_id"),value:y.response_id||"-"},{label:r("total_tokens"),value:y.total_tokens??"-"},{label:r("latency_ms"),value:y.latency_ms??"-"},{label:r("created_at"),value:y.created_at??"-"}]}),L&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(re,{className:"h-3.5 w-3.5 animate-spin"}),i("common.loading")]}),E&&e.jsx("div",{className:"text-xs text-rose-600",children:E}),e.jsx(J,{title:i("admin.llmUsage.logs.prompt"),value:(o==null?void 0:o.prompt)??t.prompt}),(o==null?void 0:o.response_raw)&&e.jsx(J,{title:i("admin.llmUsage.logs.response"),value:o.response_raw}),((o==null?void 0:o.error_message)||t.error_message)&&e.jsx(X,{title:i("admin.llmUsage.logs.error"),value:(o==null?void 0:o.error_message)||t.error_message,toneClass:"bg-rose-50 text-rose-700"}),(o==null?void 0:o.usage)&&e.jsx(J,{title:"usage",value:o.usage}),(o==null?void 0:o.context)&&e.jsx(J,{title:"context",value:o.context})]})},`llm-${t.id}`)})]})]})]})]})]})}function B({title:s,children:a}){return e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 font-semibold",children:s}),a]})}function U({summary:s,detail:a,openLabel:n,closeLabel:m,onOpen:l,toneClass:c}){const[x,d]=f.useState(!1),w=()=>{d($=>{const i=!$;return i&&(l==null||l()),i})};return e.jsxs("div",{className:`mb-2 rounded border p-2 ${c}`,children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[e.jsx("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-[11px]",children:s}),e.jsx("button",{type:"button",className:"text-[11px] text-blue-600",onClick:w,"aria-expanded":x,children:x?m:n})]}),x&&e.jsx("div",{className:"mt-2 border-t pt-2",children:a})]})}function _({label:s,value:a}){return e.jsxs("div",{children:[e.jsxs("span",{className:"mr-1 text-muted-foreground",children:[s,":"]}),e.jsx("span",{className:"font-mono",children:String(a??"-")})]})}function z({items:s}){return e.jsx("div",{className:"grid gap-2 text-[11px] md:grid-cols-2",children:s.map((a,n)=>e.jsx("div",{className:a.span?"md:col-span-2":"",children:e.jsx(_,{label:a.label,value:a.value})},`${a.label}-${n}`))})}function ee({title:s,children:a}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:s}),a]})}function J({title:s,value:a}){return a==null||a===""?null:e.jsx(ee,{title:s,children:e.jsx(ue,{value:a})})}function X({title:s,value:a,toneClass:n}){return a==null||a===""?null:e.jsx(ee,{title:s,children:e.jsx("pre",{className:`max-h-64 overflow-auto whitespace-pre-wrap rounded p-3 text-[11px] ${n}`,children:String(a)})})}function ue({value:s}){if(s==null||s==="")return null;const a=Me(s);return typeof a=="string"?e.jsx("pre",{className:"max-h-64 overflow-auto whitespace-pre-wrap rounded bg-slate-900 p-3 text-[11px] text-green-200",children:a}):e.jsx(G,{value:a,collapsed:!0,maxHeight:"18rem"})}function Me(s){if(s==null)return null;if(typeof s=="object"||typeof s!="string")return s;try{return JSON.parse(s)}catch{return s}}Ve.propTypes={open:p.bool,onClose:p.func,requestId:p.string,data:p.object,loading:p.bool,onRefresh:p.func,system:p.array,audit:p.array,error:p.array,llm:p.array};B.propTypes={title:p.node,children:p.node};U.propTypes={summary:p.node,detail:p.node,openLabel:p.node,closeLabel:p.node,onOpen:p.func,toneClass:p.string};_.propTypes={label:p.node,value:p.any};z.propTypes={items:p.arrayOf(p.shape({label:p.node,value:p.any,span:p.bool}))};ee.propTypes={title:p.node,children:p.node};J.propTypes={title:p.node,value:p.any};X.propTypes={title:p.node,value:p.any,toneClass:p.string};ue.propTypes={value:p.any};export{Ee as A,G as J,Ve as R,Re as a,Fe as e,ke as f,Ae as s};
