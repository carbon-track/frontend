import{c as Z,u as G,j as e,z as ae,P as re,v as R,B as p,r as m,a0 as U,I as Q,a4 as ce,a5 as ie,w as oe,a6 as X,Z as me,X as xe,S as de,C as he,d as ge}from"./index-BR4S2x3M.js";import{C as O,a as Y,b as K,c as W,d as V}from"./Card-Bh70Uy8-.js";import{S as le}from"./star-B3IMZtWC.js";import{P as J}from"./package-CRbs_Cjz.js";import{C as ue}from"./clock-C2odvhlJ.js";import{F as ee}from"./funnel-C1Wpvt9X.js";import{A as se}from"./Alert-Cn1DWQJN.js";import{C as pe}from"./circle-check-big-CSx05GyK.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],te=Z("coins",fe);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],ye=Z("history",je);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],ne=Z("shopping-cart",Ne);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ve=Z("tag",be);function we({product:s,onExchange:h,userPoints:_=0}){const{t:i}=G(),n=_>=s.points_required,C=s.is_available,v=s.stock>0||s.stock===-1,r=()=>s.stock===-1?i("store.unlimited"):s.stock===0?i("store.outOfStock"):s.stock<=5?i("store.lowStock",{count:s.stock}):i("store.inStock",{count:s.stock}),A=()=>s.stock===-1?"text-green-600":s.stock===0?"text-red-600":s.stock<=5?"text-orange-600":"text-green-600",$=()=>{const l={electronics:"ðŸ“±",books:"ðŸ“š",lifestyle:"ðŸŽ",food:"ðŸŽ",sports:"âš½",travel:"âœˆï¸",eco:"ðŸŒ±",default:"ðŸŽ"};return l[s.category]||l.default},N=l=>typeof l=="string"&&/^https?:\/\//.test(l),z=l=>{if(!l)return{src:null,path:null};if(typeof l=="string")return N(l)?{src:l,path:null}:{src:null,path:l};if(Array.isArray(l)&&l.length)return z(l[0]);if(typeof l=="object"){const F=typeof l.presigned_url=="string"&&l.presigned_url?l.presigned_url:null,t=typeof l.url=="string"&&l.url?l.url:typeof l.public_url=="string"?l.public_url:null;let c=F||(t&&N(t)?t:null),o=typeof l.file_path=="string"&&l.file_path!==""?l.file_path:null;return!o&&t&&!N(t)&&(o=t),!o&&typeof l.path=="string"&&l.path!==""&&(o=l.path),{src:c,path:o}}return{src:null,path:null}},j=Array.isArray(s.images)&&s.images.length>0?s.images[0]:s.images,g=z(j),T=z(s.image_presigned_url||s.image_url||s.image_path),k=g.src||T.src,P=g.path||T.path,u=!!(k||P);return e.jsxs(O,{className:`h-full transition-all duration-200 hover:shadow-lg ${!C||!n?"opacity-75":"hover:scale-105"}`,children:[e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:$()}),e.jsxs("div",{children:[e.jsx(K,{className:"text-lg line-clamp-2",children:s.name}),e.jsx(W,{className:"text-sm text-gray-500",children:i(`store.categories.${s.category}`,s.category)})]})]}),s.is_featured&&e.jsxs("div",{className:"flex items-center space-x-1 bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs",children:[e.jsx(le,{className:"h-3 w-3 fill-current"}),e.jsx("span",{children:i("store.featured")})]})]})}),e.jsxs(V,{className:"space-y-4",children:[u&&e.jsx("div",{className:"aspect-video bg-gray-100 rounded-lg overflow-hidden",children:e.jsx(ae,{src:k||void 0,filePath:P||void 0,alt:s.name,className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:s.description}),Array.isArray(s.tags)&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tags.map((l,F)=>e.jsx(re,{variant:"secondary",className:"text-xs uppercase",children:l.name},`product-tag-${s.id}-${l.id??l.slug??F}`))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl font-bold text-green-600",children:R(s.points_required)}),e.jsx("span",{className:"text-sm text-gray-500",children:i("common.points")})]}),e.jsxs("div",{className:`flex items-center space-x-1 text-sm ${A()}`,children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:r()})]})]}),s.total_exchanged>0&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:i("store.exchangedCount",{count:s.total_exchanged})})]})]}),e.jsx("div",{className:"pt-2",children:C?v?n?e.jsxs(p,{onClick:()=>h(s),className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),i("store.exchange.button")]}):e.jsx(p,{disabled:!0,className:"w-full",children:e.jsxs("span",{className:"flex items-center justify-center space-x-2",children:[e.jsx("span",{children:i("store.insufficientPoints")}),e.jsxs("span",{className:"text-xs",children:["(",i("store.need")," ",R(s.points_required-_),")"]})]})}):e.jsx(p,{disabled:!0,className:"w-full",children:i("store.outOfStock")}):e.jsx(p,{disabled:!0,className:"w-full",children:i("store.unavailable")})}),n&&C&&v&&e.jsxs("div",{className:"text-xs text-center text-gray-500",children:[i("store.afterExchange"),": ",R(_-s.points_required)," ",i("common.points")]})]})]})}function Ce({product:s,userPoints:h,userEmail:_,isOpen:i,onClose:n,onConfirm:C,isLoading:v}){const{t:r}=G(),A=a=>typeof a=="string"&&/^https?:\/\//.test(a),$=a=>{if(!a)return{src:null,path:null};if(typeof a=="string")return A(a)?{src:a,path:null}:{src:null,path:a};if(Array.isArray(a)&&a.length)return $(a[0]);if(typeof a=="object"){const b=typeof a.presigned_url=="string"&&a.presigned_url?a.presigned_url:null,f=typeof a.url=="string"&&a.url?a.url:typeof a.public_url=="string"?a.public_url:null;let E=b||(f&&A(f)?f:null),H=typeof a.file_path=="string"&&a.file_path!==""?a.file_path:null;return!H&&f&&!A(f)&&(H=f),!H&&typeof a.path=="string"&&a.path!==""&&(H=a.path),{src:E,path:H}}return{src:null,path:null}},[N,z]=m.useState(1),[j,g]=m.useState(""),[T,k]=m.useState(""),[P,u]=m.useState(""),[l,F]=m.useState(""),[t,c]=m.useState({});if(m.useEffect(()=>{i&&(z(1),g(_||""),k(""),u(""),F(""),c({}))},[i,s==null?void 0:s.id,_]),!i||!s)return null;const o=Array.isArray(s.images)&&s.images.length>0?s.images[0]:s.images,q=$(o),M=$(s.image_presigned_url||s.image_url||s.image_path),B=q.src||M.src,D=q.path||M.path,L=!!(B||D),y=s.points_required*N,d=h>=y,x=s.stock===-1?10:Math.min(s.stock,Math.floor(h/s.points_required)),w=()=>{const a={};(N<1||N>x)&&(a.quantity=r("store.exchange.invalidQuantity"));const b=j.trim(),f=T.trim(),E=P.trim();return b||(a.deliveryAddress=r("store.exchange.addressRequired")),E?(f?/^\+?\d{1,5}$/.test(f)||(a.contactAreaCode=r("store.exchange.invalidAreaCode")):a.contactAreaCode=r("store.exchange.areaCodeRequired"),/^[0-9\-\s]{5,20}$/.test(E)||(a.contactPhone=r("store.exchange.invalidPhone"))):f&&(a.contactPhone=r("store.exchange.phoneRequiredWhenAreaCode")),c(a),Object.keys(a).length===0},S=a=>{if(a.preventDefault(),!w())return;const b=j.trim(),f=T.trim(),E=P.trim(),H=l.trim();C({product_id:s.id,quantity:N,delivery_address:b,contact_area_code:f||void 0,contact_phone:E||void 0,notes:H||void 0})},I=a=>{const b=Math.max(1,Math.min(x,parseInt(a)||1));z(b),t.quantity&&c(f=>({...f,quantity:null}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs(O,{className:"border-0 shadow-none",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-xl",children:r("store.exchange.title")}),e.jsx(W,{children:r("store.exchange.subtitle")})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:n,className:"h-8 w-8 p-0",children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsxs(V,{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[L&&e.jsx(ae,{src:B||void 0,filePath:D||void 0,alt:s.name,className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-lg font-bold text-green-600",children:R(s.points_required)}),e.jsx("span",{className:"text-sm text-gray-500",children:r("common.points")})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:s.stock===-1?r("store.unlimited"):r("store.stock",{count:s.stock})})]})]})]})]})}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("store.exchange.quantity")}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(p,{type:"button",variant:"outline",size:"sm",onClick:()=>I(N-1),disabled:N<=1,children:"-"}),e.jsx(Q,{type:"number",min:"1",max:x,value:N,onChange:a=>I(a.target.value),className:"w-20 text-center"}),e.jsx(p,{type:"button",variant:"outline",size:"sm",onClick:()=>I(N+1),disabled:N>=x,children:"+"}),e.jsx("span",{className:"text-sm text-gray-500",children:r("store.exchange.maxQuantity",{max:x})})]}),t.quantity&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.quantity})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ce,{className:"h-4 w-4 inline mr-1"}),r("store.exchange.deliveryAddress")]}),e.jsx(Q,{type:"text",value:j,onChange:a=>{g(a.target.value),t.deliveryAddress&&c(b=>({...b,deliveryAddress:null}))},placeholder:r("store.exchange.addressPlaceholder"),className:t.deliveryAddress?"border-red-500":""}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:r("store.exchange.addressHint")}),t.deliveryAddress&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.deliveryAddress})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"h-4 w-4 inline mr-1"}),r("store.exchange.contactPhone")," (",r("common.optional"),")"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"md:w-32",children:[e.jsx(Q,{type:"text",value:T,onChange:a=>{const b=a.target.value;k(b),t.contactAreaCode&&c(f=>({...f,contactAreaCode:null}))},placeholder:r("store.exchange.areaCodePlaceholder"),className:t.contactAreaCode?"border-red-500":""}),t.contactAreaCode&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.contactAreaCode})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Q,{type:"tel",value:P,onChange:a=>{u(a.target.value),c(b=>({...b,contactPhone:null,contactAreaCode:null}))},placeholder:r("store.exchange.phonePlaceholder"),className:t.contactPhone?"border-red-500":""}),t.contactPhone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.contactPhone})]})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:r("store.exchange.phoneOptionalHint")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"h-4 w-4 inline mr-1"}),r("store.exchange.notes")," (",r("common.optional"),")"]}),e.jsx("textarea",{value:l,onChange:a=>F(a.target.value),placeholder:r("store.exchange.notesPlaceholder"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[r("store.exchange.unitPrice"),":"]}),e.jsxs("span",{children:[R(s.points_required)," ",r("common.points")]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[r("store.exchange.quantity"),":"]}),e.jsx("span",{children:N})]}),e.jsx("hr",{className:"border-gray-300"}),e.jsxs("div",{className:"flex justify-between items-center font-semibold text-lg",children:[e.jsxs("span",{children:[r("store.exchange.totalCost"),":"]}),e.jsxs("span",{className:"text-green-600",children:[R(y)," ",r("common.points")]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:[r("store.exchange.currentPoints"),":"]}),e.jsxs("span",{children:[R(h)," ",r("common.points")]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{children:[r("store.exchange.afterExchange"),":"]}),e.jsxs("span",{className:d?"text-green-600":"text-red-600",children:[R(h-y)," ",r("common.points")]})]})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:n,className:"flex-1",disabled:v,children:r("common.cancel")}),e.jsx(p,{type:"submit",disabled:!d||v,className:"flex-1 bg-green-600 hover:bg-green-700",children:v?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:r("store.exchange.processing")})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:r("store.exchange.confirm")})]})})]})]})]})]})})})}function _e({filters:s,onFiltersChange:h,categories:_=[],isLoading:i=!1}){const{t:n}=G(),C=m.useCallback(t=>{typeof t!="string"&&(t=t!=null?String(t):"");const c=t.trim().toLowerCase();return c?c.replace(/[^a-z0-9\-\s]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"tag-"+Math.random().toString(36).slice(2,8):""},[]),[v,r]=m.useState(""),[A,$]=m.useState([]),[N,z]=m.useState(!1),j=m.useMemo(()=>Array.isArray(s.tags)?s.tags:[],[s.tags]),g=(t,c)=>{h({...s,[t]:c,page:1})},T=()=>{h({search:"",category:"",min_points:"",max_points:"",sort:"created_at",page:1,limit:s.limit??12,tags:[]})},k=!!(s.search||s.category||s.min_points||s.max_points||j.length),P=m.useCallback(async t=>{var c,o;z(!0);try{const M=(o=(c=(await X.searchTags({search:t||"",limit:12})).data)==null?void 0:c.data)==null?void 0:o.tags;$(Array.isArray(M)?M:[])}catch(q){console.error("Failed to load tag suggestions",q),$([])}finally{z(!1)}},[]);m.useEffect(()=>{P("")},[P]),m.useEffect(()=>{const t=setTimeout(()=>{P(v.trim())},250);return()=>clearTimeout(t)},[v,P]);const u=t=>{const c=(t==null?void 0:t.name)||(t==null?void 0:t.label)||(t==null?void 0:t.value)||t,o=c!=null?String(c).trim():"",q=(t==null?void 0:t.slug)||(t==null?void 0:t.value)||t,M=C(q??o);if(!o||!M)return;const B={name:o,slug:M};!B||!B.slug||j.some(L=>(L.slug||L)===B.slug)||g("tags",j.concat([{name:B.name,slug:B.slug}]))},l=t=>{const c=j.slice();c.splice(t,1),g("tags",c)},F=[{value:"created_at",label:n("store.filters.sort.newest")},{value:"points_asc",label:n("store.filters.sort.pointsLowToHigh")},{value:"points_desc",label:n("store.filters.sort.pointsHighToLow")},{value:"popular",label:n("store.filters.sort.popular")},{value:"name",label:n("store.filters.sort.name")}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:n("store.filters.title")})]}),k&&e.jsxs(p,{variant:"ghost",size:"sm",onClick:T,className:"text-gray-500 hover:text-gray-700",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),n("store.filters.clear")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Q,{type:"text",value:s.search,onChange:t=>g("search",t.target.value),placeholder:n("store.filters.searchPlaceholder"),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.category")}),e.jsxs("select",{value:s.category,onChange:t=>g("category",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:i,children:[e.jsx("option",{value:"",children:n("store.filters.allCategories")}),_.map((t,c)=>{const o=(t.slug||t.category||t.name||`category-${c}`).toString(),q=t.name||t.category||o,M=t.product_count??t.count??t.total??0;return e.jsxs("option",{value:o,children:[n(`store.categories.${o}`,q)," (",M,")"]},o)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.sortBy")}),e.jsx("select",{value:s.sort,onChange:t=>g("sort",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:i,children:F.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("store.filters.pointsRange")}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Q,{type:"number",value:s.min_points,onChange:t=>g("min_points",t.target.value),placeholder:n("store.filters.minPoints"),className:"w-32",min:"0"}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx(Q,{type:"number",value:s.max_points,onChange:t=>g("max_points",t.target.value),placeholder:n("store.filters.maxPoints"),className:"w-32",min:"0"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-500"}),n("store.filters.tags")]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:j.map((t,c)=>e.jsxs(re,{variant:"secondary",className:"flex items-center gap-1 uppercase",children:[e.jsx("span",{children:t.name||t.slug}),e.jsx("button",{type:"button",className:"rounded-full p-0.5 hover:bg-gray-200",onClick:()=>l(c),"aria-label":n("store.filters.removeTag"),children:e.jsx(U,{className:"h-3 w-3"})})]},`selected-tag-${t.slug}-${c}`))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{value:v,onChange:t=>r(t.target.value),onKeyDown:t=>{if(t.key==="Enter"&&(t.preventDefault(),v.trim())){const c=v.trim();u({name:c,slug:C(c)}),r("")}},placeholder:n("store.filters.tagPlaceholder"),disabled:i}),e.jsx(p,{type:"button",variant:"outline",onClick:()=>{if(v.trim()){const t=v.trim();u({name:t,slug:C(t)}),r("")}},disabled:!v.trim()||i,children:n("store.filters.addTag")})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:n("store.filters.tagHint")}),e.jsxs("div",{className:"mt-3 rounded-md border bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-3 py-2 text-xs font-medium uppercase tracking-wide text-gray-500",children:[e.jsx("span",{children:n("store.filters.suggestions")}),N?e.jsx(xe,{className:"h-3.5 w-3.5 animate-spin text-emerald-500"}):null]}),e.jsx("div",{className:"max-h-44 overflow-y-auto",children:A.length===0&&!N?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:n("store.filters.noTagSuggestions")}):A.map((t,c)=>e.jsxs("button",{type:"button",onClick:()=>{u(t),r("")},className:"flex w-full items-center justify-between px-3 py-2 text-left text-sm hover:bg-white",children:[e.jsx("span",{children:t.name}),t.slug?e.jsx("span",{className:"text-xs uppercase text-gray-400",children:t.slug}):null]},`tag-suggestion-${t.id??t.slug??t.name??c}`))})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(p,{variant:s.category?"outline":"default",size:"sm",onClick:()=>g("category",""),className:"text-xs",children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),n("store.filters.allProducts")]}),_.slice(0,5).map((t,c)=>{const o=(t.slug||t.category||t.name||`category-${c}`).toString(),q=t.name||t.category||o,M=t.product_count??t.count??t.total??0;return e.jsxs(p,{variant:s.category===o?"default":"outline",size:"sm",onClick:()=>g("category",o),className:"text-xs",children:[n(`store.categories.${o}`,q),e.jsxs("span",{className:"ml-1 text-xs opacity-75",children:["(",M,")"]})]},o)}),e.jsxs(p,{variant:s.sort==="popular"?"default":"outline",size:"sm",onClick:()=>g("sort","popular"),className:"text-xs",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),n("store.filters.popular")]})]})}),k&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-blue-700",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("span",{children:[n("store.filters.activeFilters"),":"]})]})}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[s.search&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[n("store.filters.search"),': "',s.search,'"',e.jsx("button",{onClick:()=>g("search",""),className:"ml-1 hover:text-blue-600",children:e.jsx(U,{className:"h-3 w-3"})})]}),s.category&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[n(`store.categories.${s.category}`,s.category),e.jsx("button",{onClick:()=>g("category",""),className:"ml-1 hover:text-blue-600",children:e.jsx(U,{className:"h-3 w-3"})})]}),(s.min_points||s.max_points)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[s.min_points||0," - ",s.max_points||"âˆž"," ",n("common.points"),e.jsx("button",{onClick:()=>{g("min_points",""),g("max_points","")},className:"ml-1 hover:text-blue-600",children:e.jsx(U,{className:"h-3 w-3"})})]}),j.map((t,c)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[t.name||t.slug,e.jsx("button",{onClick:()=>l(c),className:"ml-1 hover:text-blue-600",children:e.jsx(U,{className:"h-3 w-3"})})]},`active-tag-${t.slug}-${c}`))]})]})]})}const ke=s=>{if(!s)return null;if(typeof s=="string"){const A=s.trim();if(!A)return null;const $=A.trim();return{name:A,category:A,slug:$,product_count:0}}const h=s.name??s.category??"",_=typeof h=="string"?h.trim():String(h||"").trim(),i=s.slug??s.category_slug??s.category??_,C=((typeof i=="string"?i.trim():String(i||"").trim())||_||"").toString().trim(),v=C&&C.toLowerCase(),r=s.product_count??s.count??s.total??0;return{...s,name:_||C,category:s.category??_??C,slug:v||C,product_count:r}};function Te(){const{t:s}=G(),[h,_]=m.useState(null),[i,n]=m.useState([]),[C,v]=m.useState([]),[r,A]=m.useState(!0),[$,N]=m.useState(!1),[z,j]=m.useState(null),[g,T]=m.useState(null),[k,P]=m.useState({search:"",category:"",min_points:"",max_points:"",sort:"created_at",page:1,limit:12,tags:[]}),[u,l]=m.useState({page:1,pages:1,total:0}),[F,t]=m.useState(null),[c,o]=m.useState(!1);m.useEffect(()=>{(async()=>{try{const d=await ge();d.isAuthenticated&&_(d.user)}catch(d){console.error("Failed to fetch user:",d)}})()},[]),m.useEffect(()=>{q()},[k]),m.useEffect(()=>{M()},[]);const q=async()=>{var y,d;try{A(!0),j(null);const x={};Object.entries(k).forEach(([f,E])=>{if(f==="tags"){Array.isArray(E)&&E.length&&(x.tags=E.map(H=>H.slug||H).join(","));return}E!==""&&E!==null&&E!==void 0&&(x[f]=E)});const w=await X.getProducts(x),S=((y=w.data)==null?void 0:y.data)??w.data,I=Array.isArray(S)?S:(S==null?void 0:S.products)??[],a=(Array.isArray(S)?null:S==null?void 0:S.pagination)||{},b={page:a.page??a.current_page??x.page??k.page??1,pages:a.pages??a.total_pages??1,total:a.total??a.total_items??I.length};((d=w.data)==null?void 0:d.success)!==!1?(n(I),l({page:b.page??1,pages:b.pages??1,total:b.total??I.length})):(n([]),l({page:1,pages:1,total:0}),j(s("store.errors.loadFailed")))}catch(x){console.error("Failed to fetch products:",x),j(s("store.errors.loadFailed"))}finally{A(!1)}},M=async()=>{var y,d;try{const x=await X.getCategories(),w=(y=x.data)==null?void 0:y.data,S=Array.isArray(w==null?void 0:w.categories)?w.categories:Array.isArray(w)?w:((d=x.data)==null?void 0:d.categories)||[],I=Array.isArray(S)?S.map(a=>ke(a)).filter(Boolean):[];v(I)}catch(x){console.error("Failed to fetch categories:",x)}},B=y=>{if(!h){j(s("store.errors.loginRequired"));return}t(y),o(!0)},D=async y=>{try{N(!0),j(null);const d=await X.exchangeProduct(y),{success:x,data:w,points_used:S,remaining_points:I}=d.data||{};if(x){const a=S??(w==null?void 0:w.points_used)??0,b=I??(w==null?void 0:w.remaining_points);T(s("store.exchange.success",{product:F.name,points:a})),_(f=>({...f,points:typeof b=="number"?b:f.points})),q(),o(!1),t(null)}else j(s("store.errors.exchangeFailed"))}catch(d){console.error("Exchange failed:",d),j(s("store.errors.exchangeFailed"))}finally{N(!1)}},L=y=>{P(d=>({...d,page:y})),window.scrollTo({top:0,behavior:"smooth"})};return h?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:s("store.title")}),e.jsx("p",{className:"text-gray-600",children:s("store.subtitle")})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx(O,{className:"bg-gradient-to-r from-green-500 to-blue-500 text-white",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:s("store.yourPoints")}),e.jsxs("p",{className:"text-2xl font-bold",children:[R(h.points)," ",s("common.points")]})]})]})})})})]})}),z&&e.jsxs(se,{variant:"destructive",className:"mb-6",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:z}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>j(null),className:"ml-auto",children:"Ã—"})]}),g&&e.jsxs(se,{variant:"default",className:"mb-6 border-green-200 bg-green-50 text-green-800",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:g}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>T(null),className:"ml-auto",children:"Ã—"})]}),e.jsx(_e,{filters:k,onFiltersChange:P,categories:C,isLoading:r}),r?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Array.from({length:8}).map((y,d)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsx("div",{className:"h-48 bg-gray-200 rounded-lg mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 mb-4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]})},d))}):i.length===0?e.jsx(O,{className:"text-center py-12",children:e.jsxs(V,{children:[e.jsx(J,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx(K,{className:"text-xl text-gray-600 mb-2",children:s("store.noProducts.title")}),e.jsx(W,{children:s("store.noProducts.description")}),(k.search||k.category||k.min_points||k.max_points)&&e.jsx(p,{variant:"outline",onClick:()=>P({search:"",category:"",min_points:"",max_points:"",sort:"created_at",page:1,limit:12,tags:[]}),className:"mt-4",children:s("store.filters.clear")})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8",children:i.map(y=>e.jsx(we,{product:y,userPoints:h.points,onExchange:B},y.id))}),u.pages>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>L(u.page-1),disabled:u.page<=1,children:s("common.previous")}),e.jsx("div",{className:"flex space-x-1",children:Array.from({length:Math.min(5,u.pages)},(y,d)=>{let x;return u.pages<=5||u.page<=3?x=d+1:u.page>=u.pages-2?x=u.pages-4+d:x=u.page-2+d,e.jsx(p,{variant:u.page===x?"default":"outline",onClick:()=>L(x),className:"w-10",children:x},x)})}),e.jsx(p,{variant:"outline",onClick:()=>L(u.page+1),disabled:u.page>=u.pages,children:s("common.next")})]})]}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsxs(p,{variant:"outline",onClick:()=>window.location.href="/activities",className:"mr-4",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),s("store.viewExchangeHistory")]}),e.jsxs(p,{onClick:()=>window.location.href="/calculate",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),s("store.earnMorePoints")]})]})]}),e.jsx(Ce,{product:F,userPoints:(h==null?void 0:h.points)||0,userEmail:(h==null?void 0:h.email)||"",isOpen:c,onClose:()=>{o(!1),t(null)},onConfirm:D,isLoading:$})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(O,{className:"max-w-md w-full mx-4",children:[e.jsxs(Y,{className:"text-center",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx(K,{children:s("store.loginRequired.title")}),e.jsx(W,{children:s("store.loginRequired.description")})]}),e.jsx(V,{className:"text-center",children:e.jsx(p,{onClick:()=>window.location.href="/auth/login",children:s("auth.signIn")})})]})})}export{Te as default};
