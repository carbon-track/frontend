import{c as Et,b1 as Ft,r as p,b2 as At,a4 as at,j as t,a8 as F,B as A,aR as ot,aS as Dt,aT as $t,aH as zt,b9 as Mt,aF as nt,aV as it,aJ as me,aU as lt,aW as ct,aX as qt,ba as Ut,bb as Wt,bc as Ht,bd as Bt,be as Vt,aY as Kt,aZ as Jt,a_ as Gt,a as xe,u as Qt,I as R,Y as Yt,a9 as Xt,aa as Zt,ab as es,ac as ts,ad as ss,Q as Se,a1 as rs}from"./index-CUFwAzZ6.js";import{f as as,s as os,a as ns,e as is,R as ls,A as cs,J as dt}from"./RequestIdRelatedDrawer-DxsTiuWC.js";import{C as Y,a as pe,b as he,c as Re,d as X,e as ds}from"./Card-r7cmfhD9.js";import{S as us}from"./scroll-area-Bu6AM59U.js";import{S as ms}from"./switch-DX6ZXUrP.js";import{L as ut}from"./label-CQOP96-U.js";import{T as Qe,a as Q}from"./toggle-group-DnIYlNdg.js";import{A as ps,b as hs,a as xs}from"./Alert-DK8cqnXb.js";import{R as fs}from"./refresh-cw-D5PjY9Sq.js";import{D as Ye}from"./download-CCjHa9JY.js";import"./chevron-down-CQ8xU3KX.js";import"./chevron-right-B33-i3D1.js";import"./index-BdQq_4o_.js";import"./index-CJRIEbcJ.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],ys=Et("columns-2",gs);function Xe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Ze=Number.isNaN||function(s){return typeof s=="number"&&s!==s};function vs(e,s){return!!(e===s||Ze(e)&&Ze(s))}function js(e,s){if(e.length!==s.length)return!1;for(var r=0;r<e.length;r++)if(!vs(e[r],s[r]))return!1;return!0}function ke(e,s){s===void 0&&(s=js);var r,a=[],i,c=!1;function m(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];return c&&r===this&&s(o,a)||(i=e.apply(this,o),c=!0,r=this,a=o),i}return m}var _s=typeof performance=="object"&&typeof performance.now=="function",et=_s?function(){return performance.now()}:function(){return Date.now()};function tt(e){cancelAnimationFrame(e.id)}function bs(e,s){var r=et();function a(){et()-r>=s?e.call(null):i.id=requestAnimationFrame(a)}var i={id:requestAnimationFrame(a)};return i}var Ee=-1;function st(e){if(e===void 0&&(e=!1),Ee===-1||e){var s=document.createElement("div"),r=s.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(s),Ee=s.offsetWidth-s.clientWidth,document.body.removeChild(s)}return Ee}var oe=null;function rt(e){if(e===void 0&&(e=!1),oe===null||e){var s=document.createElement("div"),r=s.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var a=document.createElement("div"),i=a.style;return i.width="100px",i.height="100px",s.appendChild(a),document.body.appendChild(s),s.scrollLeft>0?oe="positive-descending":(s.scrollLeft=1,s.scrollLeft===0?oe="negative":oe="positive-ascending"),document.body.removeChild(s),oe}return oe}var Ns=150,Cs=function(s,r){return s};function Ss(e){var s,r=e.getItemOffset,a=e.getEstimatedTotalSize,i=e.getItemSize,c=e.getOffsetForIndexAndAlignment,m=e.getStartIndexForOffset,o=e.getStopIndexForStartIndex,u=e.initInstanceProps,h=e.shouldResetStyleCacheOnItemSizeChange,j=e.validateProps;return s=(function(y){Ft(_,y);function _(I){var l;return l=y.call(this,I)||this,l._instanceProps=u(l.props,Xe(l)),l._outerRef=void 0,l._resetIsScrollingTimeoutId=null,l.state={instance:Xe(l),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof l.props.initialScrollOffset=="number"?l.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},l._callOnItemsRendered=void 0,l._callOnItemsRendered=ke(function(f,x,b,S){return l.props.onItemsRendered({overscanStartIndex:f,overscanStopIndex:x,visibleStartIndex:b,visibleStopIndex:S})}),l._callOnScroll=void 0,l._callOnScroll=ke(function(f,x,b){return l.props.onScroll({scrollDirection:f,scrollOffset:x,scrollUpdateWasRequested:b})}),l._getItemStyle=void 0,l._getItemStyle=function(f){var x=l.props,b=x.direction,S=x.itemSize,T=x.layout,N=l._getItemStyleCache(h&&S,h&&T,h&&b),w;if(N.hasOwnProperty(f))w=N[f];else{var O=r(l.props,f,l._instanceProps),$=i(l.props,f,l._instanceProps),z=b==="horizontal"||T==="horizontal",te=b==="rtl",se=z?O:0;N[f]=w={position:"absolute",left:te?void 0:se,right:te?se:void 0,top:z?0:O,height:z?"100%":$,width:z?$:"100%"}}return w},l._getItemStyleCache=void 0,l._getItemStyleCache=ke(function(f,x,b){return{}}),l._onScrollHorizontal=function(f){var x=f.currentTarget,b=x.clientWidth,S=x.scrollLeft,T=x.scrollWidth;l.setState(function(N){if(N.scrollOffset===S)return null;var w=l.props.direction,O=S;if(w==="rtl")switch(rt()){case"negative":O=-S;break;case"positive-descending":O=T-b-S;break}return O=Math.max(0,Math.min(O,T-b)),{isScrolling:!0,scrollDirection:N.scrollOffset<O?"forward":"backward",scrollOffset:O,scrollUpdateWasRequested:!1}},l._resetIsScrollingDebounced)},l._onScrollVertical=function(f){var x=f.currentTarget,b=x.clientHeight,S=x.scrollHeight,T=x.scrollTop;l.setState(function(N){if(N.scrollOffset===T)return null;var w=Math.max(0,Math.min(T,S-b));return{isScrolling:!0,scrollDirection:N.scrollOffset<w?"forward":"backward",scrollOffset:w,scrollUpdateWasRequested:!1}},l._resetIsScrollingDebounced)},l._outerRefSetter=function(f){var x=l.props.outerRef;l._outerRef=f,typeof x=="function"?x(f):x!=null&&typeof x=="object"&&x.hasOwnProperty("current")&&(x.current=f)},l._resetIsScrollingDebounced=function(){l._resetIsScrollingTimeoutId!==null&&tt(l._resetIsScrollingTimeoutId),l._resetIsScrollingTimeoutId=bs(l._resetIsScrolling,Ns)},l._resetIsScrolling=function(){l._resetIsScrollingTimeoutId=null,l.setState({isScrolling:!1},function(){l._getItemStyleCache(-1,null)})},l}_.getDerivedStateFromProps=function(l,f){return ws(l,f),j(l),null};var v=_.prototype;return v.scrollTo=function(l){l=Math.max(0,l),this.setState(function(f){return f.scrollOffset===l?null:{scrollDirection:f.scrollOffset<l?"forward":"backward",scrollOffset:l,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},v.scrollToItem=function(l,f){f===void 0&&(f="auto");var x=this.props,b=x.itemCount,S=x.layout,T=this.state.scrollOffset;l=Math.max(0,Math.min(l,b-1));var N=0;if(this._outerRef){var w=this._outerRef;S==="vertical"?N=w.scrollWidth>w.clientWidth?st():0:N=w.scrollHeight>w.clientHeight?st():0}this.scrollTo(c(this.props,l,f,T,this._instanceProps,N))},v.componentDidMount=function(){var l=this.props,f=l.direction,x=l.initialScrollOffset,b=l.layout;if(typeof x=="number"&&this._outerRef!=null){var S=this._outerRef;f==="horizontal"||b==="horizontal"?S.scrollLeft=x:S.scrollTop=x}this._callPropsCallbacks()},v.componentDidUpdate=function(){var l=this.props,f=l.direction,x=l.layout,b=this.state,S=b.scrollOffset,T=b.scrollUpdateWasRequested;if(T&&this._outerRef!=null){var N=this._outerRef;if(f==="horizontal"||x==="horizontal")if(f==="rtl")switch(rt()){case"negative":N.scrollLeft=-S;break;case"positive-ascending":N.scrollLeft=S;break;default:var w=N.clientWidth,O=N.scrollWidth;N.scrollLeft=O-w-S;break}else N.scrollLeft=S;else N.scrollTop=S}this._callPropsCallbacks()},v.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&tt(this._resetIsScrollingTimeoutId)},v.render=function(){var l=this.props,f=l.children,x=l.className,b=l.direction,S=l.height,T=l.innerRef,N=l.innerElementType,w=l.innerTagName,O=l.itemCount,$=l.itemData,z=l.itemKey,te=z===void 0?Cs:z,se=l.layout,Le=l.outerElementType,Ie=l.outerTagName,Te=l.style,le=l.useIsScrolling,Oe=l.width,W=this.state.isScrolling,ce=b==="horizontal"||se==="horizontal",ge=ce?this._onScrollHorizontal:this._onScrollVertical,M=this._getRangeToRender(),P=M[0],D=M[1],de=[];if(O>0)for(var H=P;H<=D;H++)de.push(p.createElement(f,{data:$,key:te(H,$),index:H,isScrolling:le?W:void 0,style:this._getItemStyle(H)}));var re=a(this.props,this._instanceProps);return p.createElement(Le||Ie||"div",{className:x,onScroll:ge,ref:this._outerRefSetter,style:At({position:"relative",height:S,width:Oe,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:b},Te)},p.createElement(N||w||"div",{children:de,ref:T,style:{height:ce?"100%":re,pointerEvents:W?"none":void 0,width:ce?re:"100%"}}))},v._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var l=this.props.itemCount;if(l>0){var f=this._getRangeToRender(),x=f[0],b=f[1],S=f[2],T=f[3];this._callOnItemsRendered(x,b,S,T)}}if(typeof this.props.onScroll=="function"){var N=this.state,w=N.scrollDirection,O=N.scrollOffset,$=N.scrollUpdateWasRequested;this._callOnScroll(w,O,$)}},v._getRangeToRender=function(){var l=this.props,f=l.itemCount,x=l.overscanCount,b=this.state,S=b.isScrolling,T=b.scrollDirection,N=b.scrollOffset;if(f===0)return[0,0,0,0];var w=m(this.props,N,this._instanceProps),O=o(this.props,w,N,this._instanceProps),$=!S||T==="backward"?Math.max(1,x):1,z=!S||T==="forward"?Math.max(1,x):1;return[Math.max(0,w-$),Math.max(0,Math.min(f-1,O+z)),w,O]},_})(p.PureComponent),s.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},s}var ws=function(s,r){s.children,s.direction,s.height,s.layout,s.innerTagName,s.outerTagName,s.width,r.instance},Ls=Ss({getItemOffset:function(s,r){var a=s.itemSize;return r*a},getItemSize:function(s,r){var a=s.itemSize;return a},getEstimatedTotalSize:function(s){var r=s.itemCount,a=s.itemSize;return a*r},getOffsetForIndexAndAlignment:function(s,r,a,i,c,m){var o=s.direction,u=s.height,h=s.itemCount,j=s.itemSize,y=s.layout,_=s.width,v=o==="horizontal"||y==="horizontal",I=v?_:u,l=Math.max(0,h*j-I),f=Math.min(l,r*j),x=Math.max(0,r*j-I+j+m);switch(a==="smart"&&(i>=x-I&&i<=f+I?a="auto":a="center"),a){case"start":return f;case"end":return x;case"center":{var b=Math.round(x+(f-x)/2);return b<Math.ceil(I/2)?0:b>l+Math.floor(I/2)?l:b}case"auto":default:return i>=x&&i<=f?i:i<x?x:f}},getStartIndexForOffset:function(s,r){var a=s.itemCount,i=s.itemSize;return Math.max(0,Math.min(a-1,Math.floor(r/i)))},getStopIndexForStartIndex:function(s,r,a){var i=s.direction,c=s.height,m=s.itemCount,o=s.itemSize,u=s.layout,h=s.width,j=i==="horizontal"||u==="horizontal",y=r*o,_=j?h:c,v=Math.ceil((_+a-y)/o);return Math.max(0,Math.min(m-1,r+v-1))},initInstanceProps:function(s){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(s){s.itemSize}});function Is(e){return at(["systemLog",e],()=>as(e),{enabled:!!e})}function Ts(e,s=400){const[r,a]=p.useState(e);return p.useEffect(()=>{const i=setTimeout(()=>a(e),s);return()=>clearTimeout(i)},[e,s]),r}function Os(e){const s=Ts(e.q||""),r={...e,q:s};return at(["logSearch",r],()=>os(r),{keepPreviousData:!0})}const Ps={req:"request_id",rid:"request_id",request_id:"request_id",user:"user_id",uid:"user_id",user_id:"user_id",dur:"duration_ms",time:"duration_ms",duration:"duration_ms",status:"status_code",code:"status_code",status_code:"status_code",path:"path",url:"path",method:"method",action:"action",astatus:"audit_status",audit_status:"audit_status",etype:"error_type",error_type:"error_type",model:"model",source:"source",actor:"actor_type",atype:"actor_type",actor_type:"actor_type",actor_id:"actor_id",aid:"actor_id",lstatus:"llm_status",llm_status:"llm_status"},Rs=new Set(["duration_ms","status_code"]);function Z(e){const s={},r={},a=[],i=/("[^"]+"|\S+)/g,c=(e||"").match(i)||[];for(const m of c){const o=m.trim();if(!o)continue;const u=o.match(/^([^:!<>=]+)(!?=|>=|<=|>|<|:)(.+)$/);if(u){let[,h,j,y]=u;h=h.trim(),y=y.trim(),y.startsWith('"')&&y.endsWith('"')&&(y=y.slice(1,-1));const _=Ps[h]||h;if(Rs.has(_)&&/^(>=|<=|>|<)$/.test(j)){r[_]=r[_]||{},r[_][j]=y;continue}if(j==="!="){s[_]={value:y,negate:!0};continue}s[_]=y}else a.push(o.replace(/^"|"$/g,""))}return{tokens:s,free:a.join(" "),ranges:r,raw:e}}function mt({system:e=[],audit:s=[],error:r=[],llm:a=[],onSelectRequest:i,emptyLabel:c="No events"}){const m=p.useMemo(()=>{const o=(u,h)=>{let j=u.created_at||u.error_time||u.time||u.timestamp;return{...u,__type:h,__ts:j&&Date.parse(j)||0}};return[...e.map(u=>o(u,"system")),...s.map(u=>o(u,"audit")),...r.map(u=>o(u,"error")),...a.map(u=>o(u,"llm"))].sort((u,h)=>h.__ts-u.__ts).slice(0,500)},[e,s,r,a]);return t.jsxs("div",{className:"space-y-3",children:[m.map(o=>t.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[t.jsx("div",{className:`w-20 text-right pr-2 font-mono ${Fs(o.__type)}`,children:o.__type}),t.jsxs("div",{className:"flex-1 border-l pl-3 pb-3 relative",children:[t.jsx("div",{className:"absolute -left-[5px] top-1 w-2 h-2 rounded-full bg-green-500"}),t.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1",children:[o.request_id&&t.jsx(U,{asButton:!0,onClick:()=>i==null?void 0:i(o.request_id),children:As(o.request_id)}),o.method&&t.jsx(U,{children:o.method}),o.status_code&&t.jsx(U,{tone:ks(o.status_code),children:o.status_code}),o.duration_ms!==void 0&&t.jsxs(U,{tone:Es(o.duration_ms),children:[o.duration_ms,"ms"]}),o.error_type&&t.jsx(U,{tone:"red",children:o.error_type}),o.action&&t.jsx(U,{children:o.action}),o.model&&t.jsx(U,{tone:"blue",children:o.model}),o.status&&o.__type==="llm"&&t.jsx(U,{tone:o.status==="failed"?"red":"green",children:o.status}),o.total_tokens!==void 0&&o.__type==="llm"&&t.jsx(U,{tone:"orange",children:o.total_tokens})]}),o.path&&t.jsx("div",{className:"font-mono text-[10px] mt-1 break-all text-gray-600",children:o.path}),o.error_message&&t.jsx("div",{className:"font-mono text-[10px] mt-1 text-rose-600 break-all",title:o.error_message,children:o.error_message.slice(0,180)}),o.prompt&&o.__type==="llm"&&t.jsx("div",{className:"font-mono text-[10px] mt-1 text-gray-600 break-all",title:o.prompt,children:String(o.prompt).slice(0,180)}),t.jsx("div",{className:"text-[10px] text-gray-400 mt-1",children:o.created_at||o.error_time})]})]},`${o.__type}-${o.id||o.request_id||o.__ts}`)),m.length===0&&t.jsx("div",{className:"text-xs text-gray-400",children:c})]})}function U({children:e,tone:s="gray",onClick:r,asButton:a=!1}){const i={gray:"bg-gray-200 text-gray-700",green:"bg-green-200 text-green-800",yellow:"bg-yellow-200 text-yellow-800",red:"bg-red-200 text-red-800",blue:"bg-blue-200 text-blue-800",orange:"bg-orange-200 text-orange-800"},c=`px-1.5 py-0.5 rounded ${r?"cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400":"cursor-default"} ${i[s]||i.gray} text-[10px] inline-flex items-center`;return a||r?t.jsx("button",{type:"button",className:c,onClick:r,children:e}):t.jsx("span",{className:c,children:e})}U.propTypes={children:F.node,tone:F.string,onClick:F.func,asButton:F.bool};function ks(e){return e>=500?"red":e>=400?"orange":e>=300?"yellow":e>=200?"green":"gray"}function Es(e){return e>=1500?"red":e>=1e3?"orange":e>=500?"yellow":"green"}function Fs(e){switch(e){case"system":return"text-green-600";case"audit":return"text-blue-600";case"error":return"text-red-600";case"llm":return"text-indigo-600";default:return"text-gray-500"}}function As(e){return e&&e.length>10?e.slice(0,6)+"â€¦"+e.slice(-4):e}mt.propTypes={system:F.array,audit:F.array,error:F.array,llm:F.array,onSelectRequest:F.func,emptyLabel:F.string};const Ds={copy:"Copy NDJSON",exportNdjson:"Export NDJSON",exportCsv:"Export CSV",records:"records",maxHint:"(max 1000)"};function pt({system:e=[],audit:s=[],error:r=[],llm:a=[],onExportCsv:i,onExportNdjson:c,labels:m={}}){const o=p.useMemo(()=>[...e.map(y=>({...y,__type:"system"})),...s.map(y=>({...y,__type:"audit"})),...r.map(y=>({...y,__type:"error"})),...a.map(y=>({...y,__type:"llm"}))].sort((y,_)=>{const v=Date.parse(y.created_at||y.error_time||y.time||y.timestamp||0)||0;return(Date.parse(_.created_at||_.error_time||_.time||_.timestamp||0)||0)-v}).slice(0,1e3),[e,s,r,a]),u={...Ds,...m},h=p.useMemo(()=>o.map(y=>JSON.stringify(y)).join(`
`),[o]),j=()=>{h&&navigator.clipboard.writeText(h).catch(()=>{})};return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[t.jsx(A,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:j,children:u.copy}),t.jsx(A,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:c,children:u.exportNdjson}),t.jsx(A,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:i,children:u.exportCsv}),t.jsxs("div",{className:"text-muted-foreground",children:[o.length," ",u.records," ",u.maxHint]})]}),t.jsx("pre",{className:"max-h-[60vh] overflow-auto whitespace-pre rounded bg-black p-3 text-[10px] leading-tight text-green-300",children:h})]})}pt.propTypes={system:F.array,audit:F.array,error:F.array,llm:F.array,onExportCsv:F.func,onExportNdjson:F.func,labels:F.object};var we="Popover",[ht]=zt(we,[ot]),fe=ot(),[$s,J]=ht(we),xt=e=>{const{__scopePopover:s,children:r,open:a,defaultOpen:i,onOpenChange:c,modal:m=!1}=e,o=fe(s),u=p.useRef(null),[h,j]=p.useState(!1),[y,_]=Dt({prop:a,defaultProp:i??!1,onChange:c,caller:we});return t.jsx($t,{...o,children:t.jsx($s,{scope:s,contentId:Mt(),triggerRef:u,open:y,onOpenChange:_,onOpenToggle:p.useCallback(()=>_(v=>!v),[_]),hasCustomAnchor:h,onCustomAnchorAdd:p.useCallback(()=>j(!0),[]),onCustomAnchorRemove:p.useCallback(()=>j(!1),[]),modal:m,children:r})})};xt.displayName=we;var ft="PopoverAnchor",zs=p.forwardRef((e,s)=>{const{__scopePopover:r,...a}=e,i=J(ft,r),c=fe(r),{onCustomAnchorAdd:m,onCustomAnchorRemove:o}=i;return p.useEffect(()=>(m(),()=>o()),[m,o]),t.jsx(lt,{...c,...a,ref:s})});zs.displayName=ft;var gt="PopoverTrigger",yt=p.forwardRef((e,s)=>{const{__scopePopover:r,...a}=e,i=J(gt,r),c=fe(r),m=nt(s,i.triggerRef),o=t.jsx(it.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":Nt(i.open),...a,ref:m,onClick:me(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?o:t.jsx(lt,{asChild:!0,...c,children:o})});yt.displayName=gt;var $e="PopoverPortal",[Ms,qs]=ht($e,{forceMount:void 0}),vt=e=>{const{__scopePopover:s,forceMount:r,children:a,container:i}=e,c=J($e,s);return t.jsx(Ms,{scope:s,forceMount:r,children:t.jsx(ct,{present:r||c.open,children:t.jsx(qt,{asChild:!0,container:i,children:a})})})};vt.displayName=$e;var ne="PopoverContent",jt=p.forwardRef((e,s)=>{const r=qs(ne,e.__scopePopover),{forceMount:a=r.forceMount,...i}=e,c=J(ne,e.__scopePopover);return t.jsx(ct,{present:a||c.open,children:c.modal?t.jsx(Ws,{...i,ref:s}):t.jsx(Hs,{...i,ref:s})})});jt.displayName=ne;var Us=Ht("PopoverContent.RemoveScroll"),Ws=p.forwardRef((e,s)=>{const r=J(ne,e.__scopePopover),a=p.useRef(null),i=nt(s,a),c=p.useRef(!1);return p.useEffect(()=>{const m=a.current;if(m)return Ut(m)},[]),t.jsx(Wt,{as:Us,allowPinchZoom:!0,children:t.jsx(_t,{...e,ref:i,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:me(e.onCloseAutoFocus,m=>{var o;m.preventDefault(),c.current||(o=r.triggerRef.current)==null||o.focus()}),onPointerDownOutside:me(e.onPointerDownOutside,m=>{const o=m.detail.originalEvent,u=o.button===0&&o.ctrlKey===!0,h=o.button===2||u;c.current=h},{checkForDefaultPrevented:!1}),onFocusOutside:me(e.onFocusOutside,m=>m.preventDefault(),{checkForDefaultPrevented:!1})})})}),Hs=p.forwardRef((e,s)=>{const r=J(ne,e.__scopePopover),a=p.useRef(!1),i=p.useRef(!1);return t.jsx(_t,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:c=>{var m,o;(m=e.onCloseAutoFocus)==null||m.call(e,c),c.defaultPrevented||(a.current||(o=r.triggerRef.current)==null||o.focus(),c.preventDefault()),a.current=!1,i.current=!1},onInteractOutside:c=>{var u,h;(u=e.onInteractOutside)==null||u.call(e,c),c.defaultPrevented||(a.current=!0,c.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const m=c.target;((h=r.triggerRef.current)==null?void 0:h.contains(m))&&c.preventDefault(),c.detail.originalEvent.type==="focusin"&&i.current&&c.preventDefault()}})}),_t=p.forwardRef((e,s)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:i,onCloseAutoFocus:c,disableOutsidePointerEvents:m,onEscapeKeyDown:o,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:j,...y}=e,_=J(ne,r),v=fe(r);return Bt(),t.jsx(Vt,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:i,onUnmountAutoFocus:c,children:t.jsx(Kt,{asChild:!0,disableOutsidePointerEvents:m,onInteractOutside:j,onEscapeKeyDown:o,onPointerDownOutside:u,onFocusOutside:h,onDismiss:()=>_.onOpenChange(!1),children:t.jsx(Jt,{"data-state":Nt(_.open),role:"dialog",id:_.contentId,...v,...y,ref:s,style:{...y.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),bt="PopoverClose",Bs=p.forwardRef((e,s)=>{const{__scopePopover:r,...a}=e,i=J(bt,r);return t.jsx(it.button,{type:"button",...a,ref:s,onClick:me(e.onClick,()=>i.onOpenChange(!1))})});Bs.displayName=bt;var Vs="PopoverArrow",Ks=p.forwardRef((e,s)=>{const{__scopePopover:r,...a}=e,i=fe(r);return t.jsx(Gt,{...i,...a,ref:s})});Ks.displayName=Vs;function Nt(e){return e?"open":"closed"}var Js=xt,Gs=yt,Qs=vt,Ys=jt;function Xs({...e}){return t.jsx(Js,{"data-slot":"popover",...e})}function Zs({...e}){return t.jsx(Gs,{"data-slot":"popover-trigger",...e})}function er({className:e,align:s="center",sideOffset:r=4,...a}){return t.jsx(Qs,{children:t.jsx(Ys,{"data-slot":"popover-content",align:s,sideOffset:r,className:xe("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...a})})}const Ct=["id","method","path","status_code","user_id","duration_ms","created_at","ops"],St=["id","actor_type","action","operation_category","status","user_id","ip_address","created_at","ops"],wt=["id","request_id","error_type","error_message","error_file","error_line","error_time","ops"],Lt=["id","actor_type","actor_id","source","model","llm_status","total_tokens","latency_ms","created_at","ops"],K={system:"logCols_system",audit:"logCols_audit",error:"logCols_error",llm:"logCols_llm"};function Ne(e,s){try{const r=localStorage.getItem(e),a=r?JSON.parse(r):null;return Array.isArray(a)&&a.length?a:s}catch(r){return console.warn("Failed to load stored columns",r),s}}function Sr(){var qe,Ue,We,He,Be,Ve,Ke,Je,Ge;const{t:e}=Qt(),[s,r]=p.useState(""),[a,i]=p.useState(""),[c,m]=p.useState(""),[o,u]=p.useState(["system","audit","error","llm"]),[h,j]=p.useState(50),[y,_]=p.useState(null),[v,I]=p.useState("table"),[l,f]=p.useState(!1),[x,b]=p.useState(null),[S,T]=p.useState({system:[],audit:[],error:[],llm:[]}),[N,w]=p.useState(!1),[O,$]=p.useState(!1),[z,te]=p.useState(()=>Ne(K.system,Ct)),[se,Le]=p.useState(()=>Ne(K.audit,St)),[Ie,Te]=p.useState(()=>Ne(K.error,wt)),[le,Oe]=p.useState(()=>Ne(K.llm,Lt)),W=p.useRef(0),[ce,ge]=p.useState(new Set),M=p.useMemo(()=>Z(s||""),[s]),P=p.useMemo(()=>{var g;const n={},d=M.tokens||{};if(["method","status_code","user_id","request_id","path","action","audit_status","error_type","model","source","actor_type","actor_id","llm_status"].forEach(C=>{d[C]&&(n[C]=d[C])}),(g=M.ranges)!=null&&g.duration_ms){const C=M.ranges.duration_ms;(C[">"]||C[">="])&&(n.min_duration=C[">"]||C[">="]),(C["<"]||C["<="])&&(n.max_duration=C["<"]||C["<="])}return n},[M]),{data:D,isLoading:de,isError:H,error:re,refetch:Pe,isFetching:ze}=Os({q:M.free,date_from:a,date_to:c,types:o,limit_per_type:h,...P}),{data:k,isLoading:Tt}=Is(y);p.useEffect(()=>{if(!l)return;const n=setInterval(()=>{Pe()},8e3);return()=>clearInterval(n)},[l,Pe]);const ye=p.useCallback(n=>{if(n!=null)try{const d=typeof n=="string"?n:JSON.stringify(n,null,2);navigator.clipboard.writeText(d)}catch(d){console.warn("Failed to copy content",d)}},[]),B=((Ue=(qe=D==null?void 0:D.data)==null?void 0:qe.system)==null?void 0:Ue.items)||[],ve=((He=(We=D==null?void 0:D.data)==null?void 0:We.audit)==null?void 0:He.items)||[],je=((Ve=(Be=D==null?void 0:D.data)==null?void 0:Be.error)==null?void 0:Ve.items)||[],_e=((Je=(Ke=D==null?void 0:D.data)==null?void 0:Ke.llm)==null?void 0:Je.items)||[];p.useEffect(()=>{if(!B.length)return;const n=Math.max(...B.map(d=>d.id));if(W.current===0){W.current=n;return}if(n>W.current){const d=B.filter(C=>C.id>W.current).map(C=>C.id);ge(new Set(d)),W.current=n;const g=setTimeout(()=>ge(new Set),4e3);return()=>clearTimeout(g)}},[B]);const Ot=p.useCallback(n=>{n&&u(n)},[]),ue=p.useCallback((n,d)=>{try{localStorage.setItem(n,JSON.stringify(d))}catch(g){console.warn("Failed to persist selected columns",g)}},[]),Pt=p.useCallback((n,d)=>{d==="id"||d==="ops"||(n==="system"?te(g=>{const C=g.includes(d)?g.filter(G=>G!==d):[...g,d];return ue(K.system,C),C}):n==="audit"?Le(g=>{const C=g.includes(d)?g.filter(G=>G!==d):[...g,d];return ue(K.audit,C),C}):n==="error"?Te(g=>{const C=g.includes(d)?g.filter(G=>G!==d):[...g,d];return ue(K.error,C),C}):n==="llm"&&Oe(g=>{const C=g.includes(d)?g.filter(G=>G!==d):[...g,d];return ue(K.llm,C),C}))},[ue]),ae=p.useCallback(async n=>{b(n),w(!0);try{const d=await ns(n);T((d==null?void 0:d.data)||d||{system:[],audit:[],error:[],llm:[]})}finally{w(!1)}},[]),be=p.useCallback(async n=>{$(!0);try{const d=await is({q:M.free,date_from:a,date_to:c,types:o,limit_per_type:h,...P},n),g=URL.createObjectURL(d),C=document.createElement("a");C.href=g,C.download=`logs_${Date.now()}.${n==="csv"?"csv":"ndjson"}`,C.click(),setTimeout(()=>URL.revokeObjectURL(g),2e3)}finally{$(!1)}},[s,a,c,o,h,P]),Rt=B.length+ve.length+je.length+_e.length>0,kt=Object.entries(M.tokens||{}).filter(([,n])=>n&&typeof n!="object").length>0||!!M.free,V=p.useCallback(n=>e(`admin.systemLogs.columns.${n}`,{defaultValue:n}),[e]),Me=p.useMemo(()=>le.filter(n=>n!=="ops"),[le]);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs(Y,{children:[t.jsxs(pe,{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(he,{children:e("admin.systemLogs.title")}),t.jsx(Re,{children:e("admin.systemLogs.subtitle")})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs(Qe,{type:"single",value:v,onValueChange:n=>n&&I(n),variant:"outline",size:"sm",children:[t.jsx(Q,{value:"table",children:e("admin.systemLogs.views.table")}),t.jsx(Q,{value:"timeline",children:e("admin.systemLogs.views.timeline")}),t.jsx(Q,{value:"raw",children:e("admin.systemLogs.views.raw")})]}),t.jsxs(A,{size:"sm",variant:"outline",onClick:()=>Pe(),disabled:ze,children:[t.jsx(fs,{className:xe("mr-2 h-4 w-4",ze&&"animate-spin")}),e("admin.systemLogs.refresh")]}),t.jsxs(A,{size:"sm",variant:"outline",onClick:()=>be("csv"),disabled:O,children:[t.jsx(Ye,{className:"mr-2 h-4 w-4"}),e("admin.systemLogs.exportCsv")]}),t.jsxs(A,{size:"sm",variant:"outline",onClick:()=>be("ndjson"),disabled:O,children:[t.jsx(Ye,{className:"mr-2 h-4 w-4"}),e("admin.systemLogs.exportNdjson")]}),t.jsx(tr,{systemCols:z,auditCols:se,errorCols:Ie,llmCols:le,onToggle:Pt,columnLabel:V,t:e})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ms,{id:"logs-auto-refresh",checked:l,onCheckedChange:f}),t.jsx(ut,{htmlFor:"logs-auto-refresh",className:"text-sm text-muted-foreground",children:e("admin.systemLogs.autoRefresh")})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-muted-foreground",children:[t.jsx("span",{children:e("admin.systemLogs.perTypeLimit")}),t.jsx(R,{id:"limit-per-type",type:"number",min:1,max:200,value:h,onChange:n=>{const d=Number(n.target.value);j(Number.isNaN(d)?50:d)},className:"h-9 w-24"})]}),t.jsxs(Qe,{type:"multiple",value:o,onValueChange:Ot,variant:"outline",size:"sm",className:"flex-wrap",children:[t.jsx(Q,{value:"system",children:e("admin.systemLogs.types.system")}),t.jsx(Q,{value:"audit",children:e("admin.systemLogs.types.audit")}),t.jsx(Q,{value:"error",children:e("admin.systemLogs.types.error")}),t.jsx(Q,{value:"llm",children:e("admin.systemLogs.types.llm")})]})]})]}),t.jsx(X,{className:"pt-0",children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4",children:[t.jsx(E,{label:e("admin.systemLogs.filters.keyword"),htmlFor:"log-search",children:t.jsx(R,{id:"log-search",value:s,onChange:n=>r(n.target.value),placeholder:e("admin.systemLogs.searchPlaceholder"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.method"),htmlFor:"log-method",children:t.jsx(R,{id:"log-method",value:P.method||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"method",d))},placeholder:e("admin.systemLogs.placeholders.method"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.status"),htmlFor:"log-status",children:t.jsx(R,{id:"log-status",value:P.status_code||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"status",d))},placeholder:e("admin.systemLogs.placeholders.status"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.userId"),htmlFor:"log-user-id",children:t.jsx(R,{id:"log-user-id",value:P.user_id||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"user",d))},placeholder:e("admin.systemLogs.placeholders.userId"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.requestId"),htmlFor:"log-request-id",children:t.jsx(R,{id:"log-request-id",value:P.request_id||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"rid",d))},placeholder:e("admin.systemLogs.placeholders.requestId"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.path"),htmlFor:"log-path",children:t.jsx(R,{id:"log-path",value:P.path||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"path",d))},placeholder:e("admin.systemLogs.placeholders.path"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.durationMin"),htmlFor:"log-duration-min",children:t.jsx(R,{id:"log-duration-min",value:P.min_duration||"",onChange:n=>r(d=>It(d,"dur",">=",n.target.value)),placeholder:e("admin.systemLogs.placeholders.duration"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.durationMax"),htmlFor:"log-duration-max",children:t.jsx(R,{id:"log-duration-max",value:P.max_duration||"",onChange:n=>r(d=>lr(d,n.target.value)),placeholder:e("admin.systemLogs.placeholders.duration"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.auditAction"),htmlFor:"log-audit-action",children:t.jsx(R,{id:"log-audit-action",value:P.action||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"action",d))},placeholder:e("admin.systemLogs.placeholders.auditAction"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.auditStatus"),htmlFor:"log-audit-status",children:t.jsx(R,{id:"log-audit-status",value:P.audit_status||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"astatus",d))},placeholder:e("admin.systemLogs.placeholders.auditStatus"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.errorType"),htmlFor:"log-error-type",children:t.jsx(R,{id:"log-error-type",value:P.error_type||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"etype",d))},placeholder:e("admin.systemLogs.placeholders.errorType"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.model"),htmlFor:"log-model",children:t.jsx(R,{id:"log-model",value:P.model||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"model",d))},placeholder:e("admin.systemLogs.placeholders.model"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.source"),htmlFor:"log-source",children:t.jsx(R,{id:"log-source",value:P.source||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"source",d))},placeholder:e("admin.systemLogs.placeholders.source"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.actorType"),htmlFor:"log-actor-type",children:t.jsx(R,{id:"log-actor-type",value:P.actor_type||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"actor",d))},placeholder:e("admin.systemLogs.placeholders.actorType"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.filters.llmStatus"),htmlFor:"log-llm-status",children:t.jsx(R,{id:"log-llm-status",value:P.llm_status||"",onChange:n=>{const d=n.target.value;r(g=>q(g,"lstatus",d))},placeholder:e("admin.systemLogs.placeholders.llmStatus"),className:"font-mono"})}),t.jsx(E,{label:e("admin.systemLogs.dateFrom"),htmlFor:"log-date-from",children:t.jsx(R,{id:"log-date-from",type:"date",value:a,onChange:n=>i(n.target.value)})}),t.jsx(E,{label:e("admin.systemLogs.dateTo"),htmlFor:"log-date-to",children:t.jsx(R,{id:"log-date-to",type:"date",value:c,onChange:n=>m(n.target.value)})})]})}),kt&&t.jsx(ds,{className:"pt-0",children:t.jsx(sr,{parsed:M,onRemove:n=>r(d=>cr(d,n)),t:e})})]}),de&&t.jsx(Y,{children:t.jsxs(X,{className:"flex items-center gap-2 py-8 text-sm text-muted-foreground",children:[t.jsx(Yt,{className:"h-4 w-4 animate-spin"}),e("common.loading")]})}),H&&t.jsxs(ps,{variant:"destructive",children:[t.jsx(hs,{children:e("common.error")}),t.jsx(xs,{children:(re==null?void 0:re.message)||e("errors.loadFailed")})]}),!de&&!H&&t.jsxs(t.Fragment,{children:[v==="table"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx(rr,{title:e("admin.systemLogs.sections.system"),items:B,emptyText:e("admin.systemLogs.empty.system"),columns:z,highlightIds:ce,onDetail:_,onCopyReq:ye,onRelated:ae,columnLabel:V,t:e}),t.jsx(Fe,{title:e("admin.systemLogs.sections.llm"),items:_e,emptyText:e("admin.systemLogs.empty.llm"),headers:Me,columnLabel:V,renderItem:n=>t.jsx(Ae,{summaryCells:Me.map(d=>ir(n,d)),detail:t.jsx(nr,{log:n,columnLabel:V,onRelated:ae,t:e}),t:e},`llm-${n.id}`)}),t.jsx(Fe,{title:e("admin.systemLogs.sections.audit"),items:ve,emptyText:e("admin.systemLogs.empty.audit"),headers:["id","actor_type","action","operation_category","status","user_id","ip_address","created_at"],columnLabel:V,renderItem:n=>t.jsx(Ae,{summaryCells:[n.id,n.actor_type,n.action,n.operation_category||"- ",n.status,n.user_id||"-",n.ip_address||"-",n.created_at],detail:t.jsx(ar,{log:n,columnLabel:V}),t:e},`audit-${n.id}`)}),t.jsx(Fe,{title:e("admin.systemLogs.sections.error"),items:je,emptyText:e("admin.systemLogs.empty.error"),headers:["id","request_id","error_type","error_message","error_file","error_line","error_time"],columnLabel:V,renderItem:n=>{var d;return t.jsx(Ae,{summaryCells:[n.id,n.request_id?t.jsx(A,{variant:"link",className:"h-auto p-0 text-[11px] font-mono text-indigo-600",onClick:()=>ae(n.request_id),children:n.request_id},"request"):"-",n.error_type,t.jsx("span",{className:"font-mono text-[11px] max-w-[240px] truncate",title:n.error_message,children:n.error_message},"message"),((d=n.error_file)==null?void 0:d.split("/").pop())||"-",n.error_line,n.error_time],detail:t.jsx(or,{log:n,columnLabel:V,onRelated:ae,t:e}),t:e},`error-${n.id}`)}}),!Rt&&t.jsx(Y,{children:t.jsx(X,{className:"py-12 text-center text-sm text-muted-foreground",children:e("admin.systemLogs.noEvents")})})]}),v==="timeline"&&t.jsxs(Y,{children:[t.jsxs(pe,{children:[t.jsx(he,{className:"text-lg",children:e("admin.systemLogs.views.timeline")}),t.jsx(Re,{children:e("admin.systemLogs.timelineDescription")})]}),t.jsx(X,{children:t.jsx(mt,{system:B,audit:ve,error:je,llm:_e,onSelectRequest:ae,emptyLabel:e("admin.systemLogs.noEvents")})})]}),v==="raw"&&t.jsxs(Y,{children:[t.jsxs(pe,{children:[t.jsx(he,{className:"text-lg",children:e("admin.systemLogs.views.raw")}),t.jsx(Re,{children:e("admin.systemLogs.rawDescription")})]}),t.jsx(X,{children:t.jsx(pt,{system:B,audit:ve,error:je,llm:_e,onExportCsv:()=>be("csv"),onExportNdjson:()=>be("ndjson"),labels:{copy:e("admin.systemLogs.copyNdjson"),exportNdjson:e("admin.systemLogs.exportNdjson"),exportCsv:e("admin.systemLogs.exportCsv"),records:e("admin.systemLogs.records"),maxHint:e("admin.systemLogs.maxRecords")}})})]})]}),t.jsx(Xt,{open:!!y,onOpenChange:n=>!n&&_(null),children:t.jsxs(Zt,{className:"max-w-4xl",children:[t.jsxs(es,{children:[t.jsx(ts,{children:y?e("admin.systemLogs.dialog.titleWithId",{id:y}):e("admin.systemLogs.dialog.title")}),t.jsx(ss,{children:e("admin.systemLogs.dialog.requestId",{id:((Ge=k==null?void 0:k.data)==null?void 0:Ge.request_id)||e("common.none")})})]}),Tt&&t.jsx("div",{className:"py-4 text-sm text-muted-foreground",children:e("admin.systemLogs.dialog.loading")}),(k==null?void 0:k.data)&&t.jsx(us,{className:"max-h-[70vh] pr-2",children:t.jsxs("div",{className:"space-y-6 text-sm",children:[t.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[t.jsx(L,{label:e("admin.systemLogs.columns.request_id"),value:k.data.request_id}),t.jsx(L,{label:e("admin.systemLogs.columns.method"),value:k.data.method}),t.jsx(L,{label:e("admin.systemLogs.columns.path"),value:k.data.path,className:"md:col-span-2"}),t.jsx(L,{label:e("admin.systemLogs.columns.status_code"),value:k.data.status_code}),t.jsx(L,{label:e("admin.systemLogs.columns.user_id"),value:k.data.user_id||e("common.none")}),t.jsx(L,{label:e("admin.systemLogs.columns.duration_ms"),value:`${k.data.duration_ms} ms`}),t.jsx(L,{label:e("admin.systemLogs.columns.created_at"),value:k.data.created_at,className:"md:col-span-2"})]}),t.jsx(De,{title:e("admin.systemLogs.requestBody"),value:k.data.request_body,onCopy:ye,copyLabel:e("common.copy")}),t.jsx(De,{title:e("admin.systemLogs.responseBody"),value:k.data.response_body,onCopy:ye,copyLabel:e("common.copy")}),k.data.server_meta&&t.jsx(De,{title:e("admin.systemLogs.serverMeta"),value:k.data.server_meta,onCopy:ye,copyLabel:e("common.copy")})]})})]})}),t.jsx(ls,{open:!!x,requestId:x,onClose:()=>b(null),loading:N,data:S,onRefresh:()=>x&&ae(x)})]})}function E({label:e,htmlFor:s,children:r}){return t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(ut,{htmlFor:s,className:"text-xs font-medium uppercase tracking-wide text-muted-foreground",children:e}),r]})}function tr({systemCols:e,auditCols:s,errorCols:r,llmCols:a,onToggle:i,columnLabel:c,t:m}){return t.jsxs(Xs,{children:[t.jsx(Zs,{asChild:!0,children:t.jsxs(A,{size:"sm",variant:"outline",children:[t.jsx(ys,{className:"mr-2 h-4 w-4"}),m("admin.systemLogs.columnSettings")]})}),t.jsxs(er,{className:"w-64 space-y-4",align:"end",children:[t.jsx(Ce,{title:m("admin.systemLogs.types.system"),columns:Ct,active:e,onToggle:o=>i("system",o),columnLabel:c}),t.jsx(Ce,{title:m("admin.systemLogs.types.audit"),columns:St,active:s,onToggle:o=>i("audit",o),columnLabel:c}),t.jsx(Ce,{title:m("admin.systemLogs.types.error"),columns:wt,active:r,onToggle:o=>i("error",o),columnLabel:c}),t.jsx(Ce,{title:m("admin.systemLogs.types.llm"),columns:Lt,active:a,onToggle:o=>i("llm",o),columnLabel:c})]})]})}function Ce({title:e,columns:s,active:r,onToggle:a,columnLabel:i}){return t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-[11px] font-semibold uppercase text-muted-foreground",children:e}),t.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(c=>t.jsx(A,{size:"sm",variant:r.includes(c)?"default":"outline",onClick:()=>a(c),className:"h-8 text-xs",children:i(c)},c))})]})}function sr({parsed:e,onRemove:s,t:r}){const a=Object.entries(e.tokens||{}).filter(([,i])=>i&&typeof i!="object");return a.length===0&&!e.free?null:t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[a.map(([i,c])=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(Se,{variant:"secondary",className:"font-mono",children:[i,":",String(c)]}),t.jsx(A,{type:"button",size:"icon",variant:"ghost",className:"h-6 w-6 text-muted-foreground",onClick:()=>s(i),"aria-label":r("admin.systemLogs.activeFilters.remove",{key:i}),children:t.jsx(rs,{className:"h-3 w-3"})})]},i)),e.free&&t.jsx(Se,{variant:"outline",className:"font-mono",children:e.free})]})}function rr({title:e,items:s,emptyText:r,columns:a,highlightIds:i,onDetail:c,onCopyReq:m,onRelated:o,columnLabel:u,t:h}){const j=s.length>120,y=t.jsx("thead",{className:"bg-muted/60",children:t.jsxs("tr",{children:[a.includes("id")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("id")}),a.includes("method")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("method")}),a.includes("path")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("path")}),a.includes("status_code")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("status_code")}),a.includes("user_id")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("user_id")}),a.includes("duration_ms")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("duration_ms")}),a.includes("created_at")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("created_at")}),a.includes("ops")&&t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:u("ops")})]})}),_=v=>{const I=i.has(v.id);return t.jsxs("tr",{className:xe("border-b text-xs transition-colors hover:bg-muted/30",I&&"bg-amber-50"),children:[a.includes("id")&&t.jsx("td",{className:"px-3 py-2 font-medium",children:v.id}),a.includes("method")&&t.jsx("td",{className:"px-3 py-2 uppercase",children:v.method}),a.includes("path")&&t.jsx("td",{className:"px-3 py-2",children:t.jsx("span",{className:"font-mono text-[11px]",title:v.path,children:v.path})}),a.includes("status_code")&&t.jsx("td",{className:"px-3 py-2",children:v.status_code}),a.includes("user_id")&&t.jsx("td",{className:"px-3 py-2",children:v.user_id||"-"}),a.includes("duration_ms")&&t.jsx("td",{className:"px-3 py-2",children:v.duration_ms}),a.includes("created_at")&&t.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:v.created_at}),a.includes("ops")&&t.jsx("td",{className:"px-3 py-2",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[t.jsx(A,{variant:"link",className:"h-auto p-0",onClick:()=>c(v.id),children:h("admin.systemLogs.details")}),t.jsx(A,{variant:"link",className:"h-auto p-0 text-muted-foreground",onClick:()=>m(v.request_id),children:h("admin.systemLogs.copyReqId")}),v.request_id&&t.jsx(A,{variant:"link",className:"h-auto p-0 text-indigo-600",onClick:()=>o(v.request_id),children:h("admin.systemLogs.related")})]})})]},v.id)};return t.jsxs(Y,{children:[t.jsx(pe,{className:"flex flex-row items-center justify-between space-y-0",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(he,{className:"text-lg",children:e}),t.jsx(Se,{variant:"outline",className:"text-xs",children:h("admin.systemLogs.recordCount",{count:s.length})})]})}),t.jsx(X,{className:"p-0",children:t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full border-t text-xs",children:[y,!j&&t.jsxs("tbody",{children:[s.map(v=>_(v)),s.length===0&&t.jsx("tr",{children:t.jsx("td",{className:"px-4 py-6 text-center text-muted-foreground",colSpan:a.length,children:r})})]})]}),j&&t.jsx(Ls,{height:480,itemCount:s.length,itemSize:44,width:"100%",children:({index:v,style:I})=>t.jsx("table",{style:{...I,width:"100%"},className:"table-fixed text-xs",children:t.jsx("tbody",{children:_(s[v])})},s[v].id)})]})})]})}function Fe({title:e,items:s,emptyText:r,renderItem:a,headers:i,columnLabel:c}){return t.jsxs(Y,{children:[t.jsx(pe,{className:"flex flex-row items-center justify-between space-y-0",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(he,{className:"text-lg",children:e}),t.jsx(Se,{variant:"outline",className:"text-xs",children:s.length})]})}),t.jsx(X,{className:"p-0",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full border-t text-xs",children:[t.jsx("thead",{className:"bg-muted/60",children:t.jsxs("tr",{children:[i.map(m=>t.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:c(m)},m)),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-semibold uppercase text-muted-foreground",children:c("ops")})]})}),t.jsxs("tbody",{children:[s.map(a),s.length===0&&t.jsx("tr",{children:t.jsx("td",{className:"px-4 py-6 text-center text-muted-foreground",colSpan:i.length+1,children:r})})]})]})})})]})}function Ae({summaryCells:e,detail:s,t:r}){const[a,i]=p.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsxs("tr",{className:xe("border-b",a&&"bg-muted/40"),children:[e.map((c,m)=>t.jsx("td",{className:"px-3 py-2 align-top",children:c},m)),t.jsx("td",{className:"px-3 py-2 text-right",children:t.jsx(A,{variant:"link",className:"h-auto p-0 text-xs",onClick:()=>i(c=>!c),children:r(a?"admin.systemLogs.actions.collapse":"admin.systemLogs.actions.expand")})})]}),a&&t.jsx("tr",{className:"border-b bg-muted/30",children:t.jsx("td",{colSpan:e.length+1,className:"px-3 py-3",children:s})})]})}function ar({log:e,columnLabel:s}){return t.jsxs("div",{className:"space-y-2 text-xs",children:[t.jsx(L,{label:s("id"),value:e.id}),t.jsx(L,{label:s("action"),value:e.action}),t.jsx(L,{label:s("operation_category"),value:e.operation_category||"-"}),t.jsx(L,{label:s("actor_type"),value:e.actor_type}),t.jsx(L,{label:s("status"),value:e.status}),e.details_raw&&t.jsx(ie,{title:"details_raw",value:ee(e.details_raw)}),e.summary&&t.jsx(ie,{title:"summary",value:ee(e.summary)}),(e.old_data||e.new_data)&&t.jsx("div",{className:"space-y-1",children:t.jsx(cs,{oldData:e.old_data,newData:e.new_data})})]})}function or({log:e,columnLabel:s,onRelated:r,t:a}){return t.jsxs("div",{className:"space-y-2 text-xs",children:[t.jsx(L,{label:s("id"),value:e.id}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(L,{label:s("request_id"),value:e.request_id||"-"}),e.request_id&&t.jsx(A,{variant:"link",className:"h-auto p-0 text-xs",onClick:()=>r==null?void 0:r(e.request_id),children:a("admin.systemLogs.related")})]}),t.jsx(L,{label:s("error_type"),value:e.error_type}),t.jsx(L,{label:s("error_file"),value:e.error_file}),t.jsx(L,{label:s("error_line"),value:e.error_line}),t.jsx(ie,{title:"message",value:ee(e.error_message)}),e.stack_trace&&t.jsx("pre",{className:"max-h-64 overflow-auto whitespace-pre-wrap rounded bg-slate-900 p-3 font-mono text-[11px] text-green-300",children:e.stack_trace}),e.context_json&&t.jsx(ie,{title:"context",value:ee(e.context_json)})]})}function nr({log:e,columnLabel:s,onRelated:r,t:a}){return t.jsxs("div",{className:"space-y-2 text-xs",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(L,{label:s("request_id"),value:e.request_id||"-"}),e.request_id&&t.jsx(A,{variant:"link",className:"h-auto p-0 text-xs",onClick:()=>r==null?void 0:r(e.request_id),children:a("admin.systemLogs.related")})]}),t.jsx(L,{label:s("actor_type"),value:e.actor_type}),t.jsx(L,{label:s("actor_id"),value:e.actor_id||"-"}),t.jsx(L,{label:s("source"),value:e.source||"-"}),t.jsx(L,{label:s("model"),value:e.model||"-"}),t.jsx(L,{label:s("llm_status"),value:e.status||"-"}),t.jsx(L,{label:s("response_id"),value:e.response_id||"-"}),t.jsx(L,{label:s("total_tokens"),value:e.total_tokens??"-"}),t.jsx(L,{label:s("latency_ms"),value:e.latency_ms??"-"}),e.prompt&&t.jsx(ie,{title:"prompt",value:ee(e.prompt)}),e.error_message&&t.jsx(ie,{title:"error_message",value:ee(e.error_message)})]})}function De({title:e,value:s,onCopy:r,copyLabel:a}){return s?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-sm font-semibold",children:e}),t.jsx(A,{variant:"link",className:"h-auto p-0 text-xs",onClick:()=>r(s),children:a})]}),t.jsx(dt,{value:ee(s)})]}):null}function ie({title:e,value:s}){return s?t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:e}),t.jsx(dt,{value:s})]}):null}function L({label:e,value:s,className:r}){return t.jsxs("div",{className:xe("space-x-2",r),children:[t.jsxs("span",{className:"font-semibold",children:[e,":"]}),t.jsx("span",{className:"font-mono break-all text-xs",children:String(s??"-")})]})}function ee(e){if(e==null)return null;if(typeof e=="object")return e;try{return JSON.parse(e)}catch{return e}}function ir(e,s){switch(s){case"id":return e.id;case"actor_type":return e.actor_type;case"actor_id":return e.actor_id??"-";case"source":return e.source||"-";case"model":return e.model||"-";case"llm_status":return e.status||"-";case"total_tokens":return e.total_tokens??"-";case"latency_ms":return e.latency_ms??"-";case"created_at":return e.created_at;default:return e[s]??"-"}}function q(e,s,r){const a=Z(e||""),c=Z(`${s}:${r!==void 0&&r!==""?r:"__probe__"}`),m=Object.keys(c.tokens||{})[0]||s;r?(a.tokens=a.tokens||{},a.tokens[m]=r):a.tokens&&delete a.tokens[m];const o=[];return Object.entries(a.tokens||{}).forEach(([u,h])=>{h&&typeof h=="object"?h.negate?o.push(`${u}!=${h.value}`):o.push(`${u}:${h.value}`):o.push(`${u}:${h}`)}),Object.entries(a.ranges||{}).forEach(([u,h])=>{Object.entries(h).forEach(([j,y])=>{o.push(`${u}${j}${y}`)})}),a.free&&o.push(a.free),o.join(" ").trim()}function It(e,s,r,a){const i=Z(e||""),m=Z(`${s}${r}${a!==void 0&&a!==""?a:"__probe__"}`),o=Object.keys(m.ranges||{})[0]||Object.keys(m.tokens||{})[0]||s;i.ranges=i.ranges||{},a?(i.ranges[o]=i.ranges[o]||{},i.ranges[o][r]=a):i.ranges[o]&&(delete i.ranges[o][r],Object.keys(i.ranges[o]).length===0&&delete i.ranges[o]);const u=[];return Object.entries(i.tokens||{}).forEach(([h,j])=>{j&&typeof j=="object"?j.negate?u.push(`${h}!=${j.value}`):u.push(`${h}:${j.value}`):u.push(`${h}:${j}`)}),Object.entries(i.ranges||{}).forEach(([h,j])=>{Object.entries(j).forEach(([y,_])=>{u.push(`${h}${y}${_}`)})}),i.free&&u.push(i.free),u.join(" ").trim()}function lr(e,s){return It(e,"dur","<=",s)}function cr(e,s){const r=Z(e||""),a=Z(`${s}:__probe__`),i=Object.keys(a.tokens||{})[0]||s;r.tokens&&delete r.tokens[i];const c=[];return Object.entries(r.tokens||{}).forEach(([m,o])=>{o&&typeof o=="object"?o.negate?c.push(`${m}!=${o.value}`):c.push(`${m}:${o.value}`):c.push(`${m}:${o}`)}),Object.entries(r.ranges||{}).forEach(([m,o])=>{Object.entries(o).forEach(([u,h])=>{c.push(`${m}${u}${h}`)})}),r.free&&c.push(r.free),c.join(" ").trim()}export{Sr as default};
