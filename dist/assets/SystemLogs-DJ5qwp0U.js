import{c as be,aP as Ht,r as u,aQ as Kt,a2 as Ie,F as pt,j as e,K as k,B as E,u as Ue,a as B,I as F,y as Bt,R as Gt,G as ge,aX as Xe,aY as et,aZ as tt,aC as ht,aD as Qt,aE as Yt,as as Zt,a_ as Xt,aq as xt,aG as ft,au as he,aF as gt,aH as yt,aI as es,a$ as ts,b0 as ss,b1 as rs,b2 as as,b3 as ns,aJ as os,aK as is,aL as ls,w as cs,N as ds,O as us,Q as ms,T as ps,V as hs,X as xs}from"./index-DKb51nO3.js";import{C as fs}from"./chevron-down-C2nHE_wd.js";import{C as gs}from"./chevron-right-LLwLKp-y.js";import{C as ee,a as xe,b as fe,c as $e,d as te,e as ys}from"./Card-DL0reMrt.js";import{S as js}from"./scroll-area-DGC3imJG.js";import{S as vs}from"./switch-DT3P0lYC.js";import{L as jt}from"./label-Bw3IDxCF.js";import{T as st,a as oe}from"./toggle-group-DJtwZEbs.js";import{A as bs,b as _s,a as Ns}from"./Alert-DO4oIoau.js";import{R as ws}from"./refresh-cw-iGOobEFD.js";import{D as rt}from"./download-CbbCWqli.js";import"./index-BdQq_4o_.js";import"./index-MtTC-7Wf.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]],Cs=be("chevrons-down",Ss);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]],ks=be("chevrons-up",Ls);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],Ts=be("columns-2",Os);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],vt=be("copy",Ps);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],Rs=be("file-json",Is);function at(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var nt=Number.isNaN||function(s){return typeof s=="number"&&s!==s};function Es(t,s){return!!(t===s||nt(t)&&nt(s))}function $s(t,s){if(t.length!==s.length)return!1;for(var r=0;r<t.length;r++)if(!Es(t[r],s[r]))return!1;return!0}function Ae(t,s){s===void 0&&(s=$s);var r,a=[],n,l=!1;function o(){for(var i=[],p=0;p<arguments.length;p++)i[p]=arguments[p];return l&&r===this&&s(i,a)||(n=t.apply(this,i),l=!0,r=this,a=i),n}return o}var As=typeof performance=="object"&&typeof performance.now=="function",ot=As?function(){return performance.now()}:function(){return Date.now()};function it(t){cancelAnimationFrame(t.id)}function Fs(t,s){var r=ot();function a(){ot()-r>=s?t.call(null):n.id=requestAnimationFrame(a)}var n={id:requestAnimationFrame(a)};return n}var Fe=-1;function lt(t){if(t===void 0&&(t=!1),Fe===-1||t){var s=document.createElement("div"),r=s.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(s),Fe=s.offsetWidth-s.clientWidth,document.body.removeChild(s)}return Fe}var ie=null;function ct(t){if(t===void 0&&(t=!1),ie===null||t){var s=document.createElement("div"),r=s.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var a=document.createElement("div"),n=a.style;return n.width="100px",n.height="100px",s.appendChild(a),document.body.appendChild(s),s.scrollLeft>0?ie="positive-descending":(s.scrollLeft=1,s.scrollLeft===0?ie="negative":ie="positive-ascending"),document.body.removeChild(s),ie}return ie}var Ms=150,Ds=function(s,r){return s};function zs(t){var s,r=t.getItemOffset,a=t.getEstimatedTotalSize,n=t.getItemSize,l=t.getOffsetForIndexAndAlignment,o=t.getStartIndexForOffset,i=t.getStopIndexForStartIndex,p=t.initInstanceProps,x=t.shouldResetStyleCacheOnItemSizeChange,h=t.validateProps;return s=(function(j){Ht(f,j);function f(C){var c;return c=j.call(this,C)||this,c._instanceProps=p(c.props,at(c)),c._outerRef=void 0,c._resetIsScrollingTimeoutId=null,c.state={instance:at(c),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof c.props.initialScrollOffset=="number"?c.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},c._callOnItemsRendered=void 0,c._callOnItemsRendered=Ae(function(g,m,_,v){return c.props.onItemsRendered({overscanStartIndex:g,overscanStopIndex:m,visibleStartIndex:_,visibleStopIndex:v})}),c._callOnScroll=void 0,c._callOnScroll=Ae(function(g,m,_){return c.props.onScroll({scrollDirection:g,scrollOffset:m,scrollUpdateWasRequested:_})}),c._getItemStyle=void 0,c._getItemStyle=function(g){var m=c.props,_=m.direction,v=m.itemSize,T=m.layout,N=c._getItemStyleCache(x&&v,x&&T,x&&_),w;if(N.hasOwnProperty(g))w=N[g];else{var P=r(c.props,g,c._instanceProps),M=n(c.props,g,c._instanceProps),D=_==="horizontal"||T==="horizontal",L=_==="rtl",I=D?P:0;N[g]=w={position:"absolute",left:L?void 0:I,right:L?I:void 0,top:D?0:P,height:D?"100%":M,width:D?M:"100%"}}return w},c._getItemStyleCache=void 0,c._getItemStyleCache=Ae(function(g,m,_){return{}}),c._onScrollHorizontal=function(g){var m=g.currentTarget,_=m.clientWidth,v=m.scrollLeft,T=m.scrollWidth;c.setState(function(N){if(N.scrollOffset===v)return null;var w=c.props.direction,P=v;if(w==="rtl")switch(ct()){case"negative":P=-v;break;case"positive-descending":P=T-_-v;break}return P=Math.max(0,Math.min(P,T-_)),{isScrolling:!0,scrollDirection:N.scrollOffset<P?"forward":"backward",scrollOffset:P,scrollUpdateWasRequested:!1}},c._resetIsScrollingDebounced)},c._onScrollVertical=function(g){var m=g.currentTarget,_=m.clientHeight,v=m.scrollHeight,T=m.scrollTop;c.setState(function(N){if(N.scrollOffset===T)return null;var w=Math.max(0,Math.min(T,v-_));return{isScrolling:!0,scrollDirection:N.scrollOffset<w?"forward":"backward",scrollOffset:w,scrollUpdateWasRequested:!1}},c._resetIsScrollingDebounced)},c._outerRefSetter=function(g){var m=c.props.outerRef;c._outerRef=g,typeof m=="function"?m(g):m!=null&&typeof m=="object"&&m.hasOwnProperty("current")&&(m.current=g)},c._resetIsScrollingDebounced=function(){c._resetIsScrollingTimeoutId!==null&&it(c._resetIsScrollingTimeoutId),c._resetIsScrollingTimeoutId=Fs(c._resetIsScrolling,Ms)},c._resetIsScrolling=function(){c._resetIsScrollingTimeoutId=null,c.setState({isScrolling:!1},function(){c._getItemStyleCache(-1,null)})},c}f.getDerivedStateFromProps=function(c,g){return qs(c,g),h(c),null};var b=f.prototype;return b.scrollTo=function(c){c=Math.max(0,c),this.setState(function(g){return g.scrollOffset===c?null:{scrollDirection:g.scrollOffset<c?"forward":"backward",scrollOffset:c,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},b.scrollToItem=function(c,g){g===void 0&&(g="auto");var m=this.props,_=m.itemCount,v=m.layout,T=this.state.scrollOffset;c=Math.max(0,Math.min(c,_-1));var N=0;if(this._outerRef){var w=this._outerRef;v==="vertical"?N=w.scrollWidth>w.clientWidth?lt():0:N=w.scrollHeight>w.clientHeight?lt():0}this.scrollTo(l(this.props,c,g,T,this._instanceProps,N))},b.componentDidMount=function(){var c=this.props,g=c.direction,m=c.initialScrollOffset,_=c.layout;if(typeof m=="number"&&this._outerRef!=null){var v=this._outerRef;g==="horizontal"||_==="horizontal"?v.scrollLeft=m:v.scrollTop=m}this._callPropsCallbacks()},b.componentDidUpdate=function(){var c=this.props,g=c.direction,m=c.layout,_=this.state,v=_.scrollOffset,T=_.scrollUpdateWasRequested;if(T&&this._outerRef!=null){var N=this._outerRef;if(g==="horizontal"||m==="horizontal")if(g==="rtl")switch(ct()){case"negative":N.scrollLeft=-v;break;case"positive-ascending":N.scrollLeft=v;break;default:var w=N.clientWidth,P=N.scrollWidth;N.scrollLeft=P-w-v;break}else N.scrollLeft=v;else N.scrollTop=v}this._callPropsCallbacks()},b.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&it(this._resetIsScrollingTimeoutId)},b.render=function(){var c=this.props,g=c.children,m=c.className,_=c.direction,v=c.height,T=c.innerRef,N=c.innerElementType,w=c.innerTagName,P=c.itemCount,M=c.itemData,D=c.itemKey,L=D===void 0?Ds:D,I=c.layout,J=c.outerElementType,z=c.outerTagName,W=c.style,Z=c.useIsScrolling,Ee=c.width,ue=this.state.isScrolling,V=_==="horizontal"||I==="horizontal",A=V?this._onScrollHorizontal:this._onScrollVertical,U=this._getRangeToRender(),Ne=U[0],we=U[1],ae=[];if(P>0)for(var H=Ne;H<=we;H++)ae.push(u.createElement(g,{data:M,key:L(H,M),index:H,isScrolling:Z?ue:void 0,style:this._getItemStyle(H)}));var me=a(this.props,this._instanceProps);return u.createElement(J||z||"div",{className:m,onScroll:A,ref:this._outerRefSetter,style:Kt({position:"relative",height:v,width:Ee,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:_},W)},u.createElement(N||w||"div",{children:ae,ref:T,style:{height:V?"100%":me,pointerEvents:ue?"none":void 0,width:V?me:"100%"}}))},b._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var c=this.props.itemCount;if(c>0){var g=this._getRangeToRender(),m=g[0],_=g[1],v=g[2],T=g[3];this._callOnItemsRendered(m,_,v,T)}}if(typeof this.props.onScroll=="function"){var N=this.state,w=N.scrollDirection,P=N.scrollOffset,M=N.scrollUpdateWasRequested;this._callOnScroll(w,P,M)}},b._getRangeToRender=function(){var c=this.props,g=c.itemCount,m=c.overscanCount,_=this.state,v=_.isScrolling,T=_.scrollDirection,N=_.scrollOffset;if(g===0)return[0,0,0,0];var w=o(this.props,N,this._instanceProps),P=i(this.props,w,N,this._instanceProps),M=!v||T==="backward"?Math.max(1,m):1,D=!v||T==="forward"?Math.max(1,m):1;return[Math.max(0,w-M),Math.max(0,Math.min(g-1,P+D)),w,P]},f})(u.PureComponent),s.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},s}var qs=function(s,r){s.children,s.direction,s.height,s.layout,s.innerTagName,s.outerTagName,s.width,r.instance},Vs=zs({getItemOffset:function(s,r){var a=s.itemSize;return r*a},getItemSize:function(s,r){var a=s.itemSize;return a},getEstimatedTotalSize:function(s){var r=s.itemCount,a=s.itemSize;return a*r},getOffsetForIndexAndAlignment:function(s,r,a,n,l,o){var i=s.direction,p=s.height,x=s.itemCount,h=s.itemSize,j=s.layout,f=s.width,b=i==="horizontal"||j==="horizontal",C=b?f:p,c=Math.max(0,x*h-C),g=Math.min(c,r*h),m=Math.max(0,r*h-C+h+o);switch(a==="smart"&&(n>=m-C&&n<=g+C?a="auto":a="center"),a){case"start":return g;case"end":return m;case"center":{var _=Math.round(m+(g-m)/2);return _<Math.ceil(C/2)?0:_>c+Math.floor(C/2)?c:_}case"auto":default:return n>=m&&n<=g?n:n<m?m:g}},getStartIndexForOffset:function(s,r){var a=s.itemCount,n=s.itemSize;return Math.max(0,Math.min(a-1,Math.floor(r/n)))},getStopIndexForStartIndex:function(s,r,a){var n=s.direction,l=s.height,o=s.itemCount,i=s.itemSize,p=s.layout,x=s.width,h=n==="horizontal"||p==="horizontal",j=r*i,f=h?x:l,b=Math.ceil((f+a-j)/i);return Math.max(0,Math.min(o-1,r+b-1))},initInstanceProps:function(s){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(s){s.itemSize}});async function Us(t){return(await Ie.get(`/admin/system-logs/${t}`)).data}function Js(t){return pt(["systemLog",t],()=>Us(t),{enabled:!!t})}async function Ws(t={}){const{q:s,date_from:r,date_to:a,types:n,limit_per_type:l,method:o,status_code:i,user_id:p,request_id:x,path:h,min_duration:j,max_duration:f,action:b,audit_status:C,error_type:c,system_page:g,audit_page:m,error_page:_}=t,v=new URLSearchParams;return s&&v.append("q",s),r&&v.append("date_from",r),a&&v.append("date_to",a),n!=null&&n.length&&v.append("types",n.join(",")),l&&v.append("limit_per_type",l),g&&v.append("system_page",g),m&&v.append("audit_page",m),_&&v.append("error_page",_),o&&v.append("method",o),i&&v.append("status_code",i),p&&v.append("user_id",p),x&&v.append("request_id",x),h&&v.append("path",h),j&&v.append("min_duration",j),f&&v.append("max_duration",f),b&&v.append("action",b),C&&v.append("audit_status",C),c&&v.append("error_type",c),(await Ie.get(`/admin/logs/search?${v.toString()}`)).data}async function Hs(t){return t?(await Ie.get(`/admin/logs/related?request_id=${encodeURIComponent(t)}`)).data:{system:[],audit:[],error:[]}}async function Ks(t={},s="csv"){const{q:r,date_from:a,date_to:n,types:l,method:o,status_code:i,user_id:p,request_id:x,path:h,min_duration:j,max_duration:f,action:b,audit_status:C,error_type:c,max:g}=t,m=new URLSearchParams;return r&&m.append("q",r),a&&m.append("date_from",a),n&&m.append("date_to",n),l!=null&&l.length&&m.append("types",l.join(",")),o&&m.append("method",o),i&&m.append("status_code",i),p&&m.append("user_id",p),x&&m.append("request_id",x),h&&m.append("path",h),j&&m.append("min_duration",j),f&&m.append("max_duration",f),b&&m.append("action",b),C&&m.append("audit_status",C),c&&m.append("error_type",c),g&&m.append("max",g),m.append("format",s),(await Ie.get(`/admin/logs/export?${m.toString()}`,{responseType:"blob"})).data}function Bs(t,s=400){const[r,a]=u.useState(t);return u.useEffect(()=>{const n=setTimeout(()=>a(t),s);return()=>clearTimeout(n)},[t,s]),r}function Gs(t){const s=Bs(t.q||""),r={...t,q:s};return pt(["logSearch",r],()=>Ws(r),{keepPreviousData:!0})}const Qs={req:"request_id",rid:"request_id",request_id:"request_id",user:"user_id",uid:"user_id",user_id:"user_id",dur:"duration_ms",time:"duration_ms",duration:"duration_ms",status:"status_code",code:"status_code",status_code:"status_code",path:"path",url:"path",method:"method",action:"action",astatus:"audit_status",audit_status:"audit_status",etype:"error_type",error_type:"error_type"},Ys=new Set(["duration_ms","status_code"]);function re(t){const s={},r={},a=[],n=/("[^"]+"|\S+)/g,l=(t||"").match(n)||[];for(const o of l){const i=o.trim();if(!i)continue;const p=i.match(/^([^:!<>=]+)(!?=|>=|<=|>|<|:)(.+)$/);if(p){let[,x,h,j]=p;x=x.trim(),j=j.trim(),j.startsWith('"')&&j.endsWith('"')&&(j=j.slice(1,-1));const f=Qs[x]||x;if(Ys.has(f)&&/^(>=|<=|>|<)$/.test(h)){r[f]=r[f]||{},r[f][h]=j;continue}if(h==="!="){s[f]={value:j,negate:!0};continue}s[f]=j}else a.push(i.replace(/^"|"$/g,""))}return{tokens:s,free:a.join(" "),ranges:r,raw:t}}function bt({system:t=[],audit:s=[],error:r=[],onSelectRequest:a,emptyLabel:n="No events"}){const l=u.useMemo(()=>{const o=(i,p)=>{let x=i.created_at||i.error_time||i.time||i.timestamp;return{...i,__type:p,__ts:x&&Date.parse(x)||0}};return[...t.map(i=>o(i,"system")),...s.map(i=>o(i,"audit")),...r.map(i=>o(i,"error"))].sort((i,p)=>p.__ts-i.__ts).slice(0,500)},[t,s,r]);return e.jsxs("div",{className:"space-y-3",children:[l.map(o=>e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("div",{className:`w-20 text-right pr-2 font-mono ${er(o.__type)}`,children:o.__type}),e.jsxs("div",{className:"flex-1 border-l pl-3 pb-3 relative",children:[e.jsx("div",{className:"absolute -left-[5px] top-1 w-2 h-2 rounded-full bg-green-500"}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1",children:[o.request_id&&e.jsx(X,{asButton:!0,onClick:()=>a==null?void 0:a(o.request_id),children:tr(o.request_id)}),o.method&&e.jsx(X,{children:o.method}),o.status_code&&e.jsx(X,{tone:Zs(o.status_code),children:o.status_code}),o.duration_ms!==void 0&&e.jsxs(X,{tone:Xs(o.duration_ms),children:[o.duration_ms,"ms"]}),o.error_type&&e.jsx(X,{tone:"red",children:o.error_type}),o.action&&e.jsx(X,{children:o.action})]}),o.path&&e.jsx("div",{className:"font-mono text-[10px] mt-1 break-all text-gray-600",children:o.path}),o.error_message&&e.jsx("div",{className:"font-mono text-[10px] mt-1 text-rose-600 break-all",title:o.error_message,children:o.error_message.slice(0,180)}),e.jsx("div",{className:"text-[10px] text-gray-400 mt-1",children:o.created_at||o.error_time})]})]},`${o.__type}-${o.id||o.request_id||o.__ts}`)),l.length===0&&e.jsx("div",{className:"text-xs text-gray-400",children:n})]})}function X({children:t,tone:s="gray",onClick:r,asButton:a=!1}){const n={gray:"bg-gray-200 text-gray-700",green:"bg-green-200 text-green-800",yellow:"bg-yellow-200 text-yellow-800",red:"bg-red-200 text-red-800",blue:"bg-blue-200 text-blue-800",orange:"bg-orange-200 text-orange-800"},l=`px-1.5 py-0.5 rounded ${r?"cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400":"cursor-default"} ${n[s]||n.gray} text-[10px] inline-flex items-center`;return a||r?e.jsx("button",{type:"button",className:l,onClick:r,children:t}):e.jsx("span",{className:l,children:t})}X.propTypes={children:k.node,tone:k.string,onClick:k.func,asButton:k.bool};function Zs(t){return t>=500?"red":t>=400?"orange":t>=300?"yellow":t>=200?"green":"gray"}function Xs(t){return t>=1500?"red":t>=1e3?"orange":t>=500?"yellow":"green"}function er(t){switch(t){case"system":return"text-green-600";case"audit":return"text-blue-600";case"error":return"text-red-600";default:return"text-gray-500"}}function tr(t){return t&&t.length>10?t.slice(0,6)+"…"+t.slice(-4):t}bt.propTypes={system:k.array,audit:k.array,error:k.array,onSelectRequest:k.func,emptyLabel:k.string};const sr={copy:"Copy NDJSON",exportNdjson:"Export NDJSON",exportCsv:"Export CSV",records:"records",maxHint:"(max 1000)"};function _t({system:t=[],audit:s=[],error:r=[],onExportCsv:a,onExportNdjson:n,labels:l={}}){const o=u.useMemo(()=>[...t.map(h=>({...h,__type:"system"})),...s.map(h=>({...h,__type:"audit"})),...r.map(h=>({...h,__type:"error"}))].sort((h,j)=>{const f=Date.parse(h.created_at||h.error_time||h.time||h.timestamp||0)||0;return(Date.parse(j.created_at||j.error_time||j.time||j.timestamp||0)||0)-f}).slice(0,1e3),[t,s,r]),i={...sr,...l},p=u.useMemo(()=>o.map(h=>JSON.stringify(h)).join(`
`),[o]),x=()=>{p&&navigator.clipboard.writeText(p).catch(()=>{})};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsx(E,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:x,children:i.copy}),e.jsx(E,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:n,children:i.exportNdjson}),e.jsx(E,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:a,children:i.exportCsv}),e.jsxs("div",{className:"text-muted-foreground",children:[o.length," ",i.records," ",i.maxHint]})]}),e.jsx("pre",{className:"max-h-[60vh] overflow-auto whitespace-pre rounded bg-black p-3 text-[10px] leading-tight text-green-300",children:p})]})}_t.propTypes={system:k.array,audit:k.array,error:k.array,onExportCsv:k.func,onExportNdjson:k.func,labels:k.object};function Nt({open:t,onClose:s,requestId:r,data:a,loading:n,onRefresh:l}){const{t:o}=Ue();if(!t)return null;const i=(a==null?void 0:a.audit)||[],p=(a==null?void 0:a.error)||[],x=()=>e.jsx("div",{className:"text-xs text-muted-foreground",children:o("common.none")});return e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"flex-1 bg-black/40",onClick:s}),e.jsxs("div",{className:"w-full max-w-3xl h-full bg-white shadow-xl flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-lg",children:o("admin.systemLogs.drawer.title",{id:r})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-sm text-blue-600",onClick:l,children:o("admin.systemLogs.drawer.refresh")}),e.jsx("button",{className:"text-gray-500",onClick:s,"aria-label":o("common.close"),children:"×"})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-6 text-sm",children:[n&&e.jsx("div",{children:o("admin.systemLogs.drawer.loading")}),!n&&e.jsxs(e.Fragment,{children:[e.jsxs(qe,{title:o("admin.systemLogs.drawer.auditTitle",{count:i.length}),children:[i.length===0&&x(),i.map(h=>e.jsx("div",{className:"border rounded p-2 mb-2 bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-[11px]",children:[e.jsx(K,{label:o("admin.systemLogs.columns.id"),value:h.id}),e.jsx(K,{label:o("admin.systemLogs.columns.action"),value:h.action}),e.jsx(K,{label:o("admin.systemLogs.columns.operation_category"),value:h.operation_category}),e.jsx(K,{label:o("admin.systemLogs.columns.actor_type"),value:h.actor_type}),e.jsx(K,{label:o("admin.systemLogs.columns.status"),value:h.status})]})},h.id))]}),e.jsxs(qe,{title:o("admin.systemLogs.drawer.errorsTitle",{count:p.length}),children:[p.length===0&&x(),p.map(h=>e.jsxs("div",{className:"border rounded p-2 mb-2 bg-rose-50/60",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-[11px]",children:[e.jsx(K,{label:o("admin.systemLogs.columns.error_type"),value:h.error_type}),e.jsx(K,{label:o("admin.systemLogs.columns.error_file"),value:h.error_file}),e.jsx(K,{label:o("admin.systemLogs.columns.error_line"),value:h.error_line})]}),h.error_message&&e.jsx("div",{className:"font-mono text-[11px] break-all mt-1 text-muted-foreground",children:h.error_message})]},h.id))]})]})]})]})]})}function qe({title:t,children:s}){return e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:t}),s]})}function K({label:t,value:s}){return e.jsxs("div",{children:[e.jsxs("span",{className:"text-muted-foreground mr-1",children:[t,":"]}),e.jsx("span",{className:"font-mono",children:String(s??"-")})]})}Nt.propTypes={open:k.bool,onClose:k.func,requestId:k.string,data:k.object,loading:k.bool,onRefresh:k.func};qe.propTypes={title:k.node,children:k.node};K.propTypes={label:k.node,value:k.any};const rr=[],se="$";function ce(t){return t===null?"null":Array.isArray(t)?"array":typeof t}function Te(t){return t==="object"||t==="array"}function ar(t,s){switch(s){case"string":return`"${t}"`;case"number":case"boolean":return String(t);case"null":return"null";case"undefined":return"undefined";default:return String(t)}}function nr(t){switch(t){case"string":return"text-emerald-600";case"number":return"text-sky-600";case"boolean":return"text-purple-600";case"null":case"undefined":return"text-muted-foreground";default:return"text-foreground"}}function ye(t){return!t||t.length===0?se:`${se}${t.map(s=>typeof s=="number"?`[${s}]`:`.${s}`).join("")}`}function or(t){return!t||t.length===0?se:t.reduce((s,r)=>typeof r=="number"?`${s}[${r}]`:`${s}.${r}`,se)}function wt(t,s=[],r=new Set){const a=ce(t);return Te(a)&&(r.add(ye(s)),(a==="array"?t.map((l,o)=>[o,l]):Object.entries(t||{})).forEach(([l,o])=>{wt(o,s.concat(l),r)})),r}function Ve(t,s,r=[],a=[]){if(s==="")return a;const n=ce(t);return n==="object"?Object.entries(t||{}).forEach(([l,o])=>{l.toLowerCase().includes(s)&&a.push(r.concat(l)),Ve(o,s,r.concat(l),a)}):n==="array"?t.forEach((l,o)=>{Ve(l,s,r.concat(o),a)}):String(t??"").toLowerCase().includes(s)&&a.push(r),a}function ir(t){const s=[];for(let r=0;r<=t.length;r+=1)s.push(ye(t.slice(0,r)));return s}function lr(t,s){return t===void 0?s:typeof t=="number"?`[${t}]`:t}const St=Gt.memo(function t({name:s,value:r,path:a,searchTerm:n,labels:l,typeLabels:o,expandedPaths:i,onToggle:p,onCopyPath:x,onCopyValue:h}){const j=ce(r),f=Te(j),b=ye(a),C=i.has(b),c=lr(s,l.root),g=u.useMemo(()=>f?j==="array"?r.map((N,w)=>[w,N]):Object.entries(r||{}):[],[f,j,r]),m=f?"":String(r??""),_=!!(n&&(c&&c.toLowerCase().includes(n)||!f&&m.toLowerCase().includes(n))),v=o[j]||o.unknown,T=f?`${g.length}`:void 0;return e.jsxs("div",{className:B("group relative border-l border-muted-foreground/20 pl-3",_&&"bg-amber-50/60"),children:[e.jsxs("div",{className:"flex items-start gap-2 py-1",children:[e.jsx("button",{type:"button",className:B("mt-1 flex h-4 w-4 items-center justify-center rounded text-muted-foreground transition hover:bg-muted hover:text-foreground",!f&&"opacity-0"),onClick:()=>f&&p(a),"aria-label":C?l.collapse:l.expand,children:C?e.jsx(fs,{className:"h-3 w-3"}):e.jsx(gs,{className:"h-3 w-3"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"font-mono text-[12px] text-foreground",children:c}),e.jsxs(ge,{variant:"secondary",className:"text-[10px] uppercase tracking-wide",children:[v,T?` · ${T}`:""]})]}),!f&&e.jsx("div",{className:B("font-mono text-[11px] break-all",nr(j)),children:ar(r,j)})]}),e.jsxs("div",{className:"flex items-center gap-1 pt-0.5 opacity-0 transition group-hover:opacity-100",children:[e.jsxs(Xe,{children:[e.jsx(et,{asChild:!0,children:e.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded text-muted-foreground hover:bg-muted hover:text-foreground",onClick:()=>x(a),"aria-label":l.copyPath,children:e.jsx(Rs,{className:"h-4 w-4"})})}),e.jsx(tt,{children:l.copyPath})]}),e.jsxs(Xe,{children:[e.jsx(et,{asChild:!0,children:e.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded text-muted-foreground hover:bg-muted hover:text-foreground",onClick:()=>h(r),"aria-label":l.copyValue,children:e.jsx(vt,{className:"h-4 w-4"})})}),e.jsx(tt,{children:l.copyValue})]})]})]}),f&&C&&g.length>0&&e.jsx("div",{className:"pl-4",children:g.map(([N,w])=>e.jsx(t,{name:N,value:w,path:a.concat(N),searchTerm:n,labels:l,typeLabels:o,expandedPaths:i,onToggle:p,onCopyPath:x,onCopyValue:h},typeof N=="number"?N:String(N)))})]})});St.displayName="JsonNode";function je({value:t,collapsed:s=!1,maxHeight:r="20rem",className:a}){const{t:n}=Ue(),[l,o]=u.useState(""),[i,p]=u.useState(new Set([se])),[x,h]=u.useState(""),j=u.useRef(),f=u.useMemo(()=>t,[t]),b=l.trim().toLowerCase(),C=u.useMemo(()=>({object:n("jsonViewer.typeLabels.object"),array:n("jsonViewer.typeLabels.array"),string:n("jsonViewer.typeLabels.string"),number:n("jsonViewer.typeLabels.number"),boolean:n("jsonViewer.typeLabels.boolean"),null:n("jsonViewer.typeLabels.null"),undefined:n("jsonViewer.typeLabels.undefined"),unknown:n("jsonViewer.typeLabels.unknown")}),[n]),c=u.useMemo(()=>({root:n("jsonViewer.root"),searchPlaceholder:n("jsonViewer.searchPlaceholder"),expandAll:n("jsonViewer.expandAll"),collapseAll:n("jsonViewer.collapseAll"),copyJson:n("jsonViewer.copyJson"),copyPath:n("jsonViewer.copyPath"),copyValue:n("jsonViewer.copyValue"),expand:n("jsonViewer.expandNode"),collapse:n("jsonViewer.collapseNode"),copied:n("jsonViewer.copied"),noData:n("jsonViewer.noData")}),[n]),g=u.useMemo(()=>{const L=new Set([se]);return s||(ce(f)==="array"?f.map((z,W)=>[W,f[W]]):Object.entries(f||{})).forEach(([z,W])=>{Te(ce(W))&&L.add(ye([z]))}),L},[f,s]);u.useEffect(()=>{p(g)},[g]);const m=u.useCallback(L=>{h(L),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>h(""),1200)},[]);u.useEffect(()=>()=>{j.current&&clearTimeout(j.current)},[]),u.useEffect(()=>{if(!b)return;const L=Ve(f,b);L.length!==0&&p(I=>{const J=new Set(I);return L.forEach(z=>{ir(z).forEach(W=>J.add(W))}),J})},[f,b]);const _=u.useMemo(()=>wt(f),[f]),v=u.useCallback(L=>{const I=ye(L);p(J=>{const z=new Set(J);return z.has(I)?z.delete(I):z.add(I),z})},[]),T=u.useCallback(()=>{p(new Set(_))},[_]),N=u.useCallback(()=>{p(new Set([se]))},[]),w=u.useCallback(L=>{var I;!L&&L!==""||typeof navigator<"u"&&((I=navigator.clipboard)!=null&&I.writeText)&&navigator.clipboard.writeText(L).then(()=>{m(c.copied)}).catch(()=>{})},[c.copied,m]),P=u.useCallback(()=>{try{const L=JSON.stringify(f,null,2);w(L)}catch{w(String(f))}},[w,f]),M=u.useCallback(L=>{w(or(L))},[w]),D=u.useCallback(L=>{const I=ce(L),J=Te(I)?JSON.stringify(L,null,2):String(L??"");w(J)},[w]);return e.jsxs("div",{className:B("border rounded bg-background text-xs shadow-sm",a),style:{maxHeight:r,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex items-center gap-2 border-b bg-muted/30 px-2 py-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(F,{value:l,onChange:L=>o(L.target.value),placeholder:c.searchPlaceholder,className:"h-8 w-full pl-7 text-xs"}),e.jsx("span",{className:"pointer-events-none absolute left-2 top-1/2 flex -translate-y-1/2 text-muted-foreground",children:e.jsx(Bt,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{size:"icon",variant:"ghost",onClick:T,className:"h-8 w-8","aria-label":c.expandAll,children:e.jsx(Cs,{className:"h-4 w-4"})}),e.jsx(E,{size:"icon",variant:"ghost",onClick:N,className:"h-8 w-8","aria-label":c.collapseAll,children:e.jsx(ks,{className:"h-4 w-4"})}),e.jsx(E,{size:"icon",variant:"ghost",onClick:P,className:"h-8 w-8","aria-label":c.copyJson,children:e.jsx(vt,{className:"h-4 w-4"})})]}),x&&e.jsx("span",{className:"ml-2 text-[10px] text-muted-foreground",children:x})]}),e.jsx("div",{className:"flex-1 overflow-auto px-2 py-2",children:f==null?e.jsx("div",{className:"text-xs text-muted-foreground",children:c.noData}):e.jsx(St,{name:c.root,value:f,path:rr,searchTerm:b,labels:c,typeLabels:C,expandedPaths:i,onToggle:v,onCopyPath:M,onCopyValue:D})})]})}je.propTypes={value:k.any,collapsed:k.bool,maxHeight:k.oneOfType([k.string,k.number]),className:k.string};function dt(t){if(t==null)return null;if(typeof t=="object")return t;try{return JSON.parse(t)}catch{return t}}function Ct(t,s,r=[]){if(Object.is(t,s))return[];if(typeof t!=="object"||typeof s!=="object"||t===null||s===null)return[{path:r.join("."),old:t,new:s}];const l=Array.from(new Set([...Object.keys(t),...Object.keys(s)])),o=[];for(const i of l)o.push(...Ct(t[i],s[i],r.concat(i)));return o.filter(i=>i.old!==i.new)}function cr({oldData:t,newData:s}){const[r,a]=u.useState("inline"),n=u.useMemo(()=>dt(t),[t]),l=u.useMemo(()=>dt(s),[s]),o=u.useMemo(()=>Ct(n||{},l||{}),[n,l]);return e.jsxs("div",{className:"border rounded bg-white text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-gray-50",children:[e.jsx("strong",{children:"变更 Diff"}),e.jsx("div",{className:"ml-auto flex gap-1",children:["inline","side","tree"].map(i=>e.jsx("button",{onClick:()=>a(i),className:`px-2 py-0.5 rounded ${r===i?"bg-blue-600 text-white":"bg-gray-200"}`,children:i},i))})]}),r==="tree"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"旧"}),e.jsx(je,{value:n,collapsed:!0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"新"}),e.jsx(je,{value:l,collapsed:!0})]})]}),r==="side"&&e.jsx("div",{className:"p-2 overflow-auto",children:e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-1 text-left",children:"字段"}),e.jsx("th",{className:"p-1 text-left",children:"旧"}),e.jsx("th",{className:"p-1 text-left",children:"新"})]})}),e.jsxs("tbody",{children:[o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"p-2 text-center text-gray-500",children:"无差异"})}),o.map(i=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-1 align-top font-mono",children:i.path||"(root)"}),e.jsx("td",{className:"p-1 text-red-600 break-all font-mono",children:JSON.stringify(i.old)}),e.jsx("td",{className:"p-1 text-green-700 break-all font-mono",children:JSON.stringify(i.new)})]},i.path))]})]})}),r==="inline"&&e.jsxs("div",{className:"p-2 space-y-1 max-h-80 overflow-auto",children:[o.length===0&&e.jsx("div",{className:"text-gray-500",children:"无差异"}),o.map(i=>e.jsxs("div",{className:"border rounded p-1 bg-gray-50",children:[e.jsx("div",{className:"font-mono text-[10px] mb-1 text-gray-600",children:i.path||"(root)"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1 bg-red-50 p-1 rounded",children:[e.jsx("span",{className:"text-red-700",children:"旧:"})," ",e.jsx("code",{className:"break-all",children:JSON.stringify(i.old)})]}),e.jsxs("div",{className:"flex-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"text-green-700",children:"新:"})," ",e.jsx("code",{className:"break-all",children:JSON.stringify(i.new)})]})]})]},i.path))]})]})}var Re="Popover",[Lt]=Zt(Re,[ht]),_e=ht(),[dr,Y]=Lt(Re),kt=t=>{const{__scopePopover:s,children:r,open:a,defaultOpen:n,onOpenChange:l,modal:o=!1}=t,i=_e(s),p=u.useRef(null),[x,h]=u.useState(!1),[j,f]=Qt({prop:a,defaultProp:n??!1,onChange:l,caller:Re});return e.jsx(Yt,{...i,children:e.jsx(dr,{scope:s,contentId:Xt(),triggerRef:p,open:j,onOpenChange:f,onOpenToggle:u.useCallback(()=>f(b=>!b),[f]),hasCustomAnchor:x,onCustomAnchorAdd:u.useCallback(()=>h(!0),[]),onCustomAnchorRemove:u.useCallback(()=>h(!1),[]),modal:o,children:r})})};kt.displayName=Re;var Ot="PopoverAnchor",ur=u.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Y(Ot,r),l=_e(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:i}=n;return u.useEffect(()=>(o(),()=>i()),[o,i]),e.jsx(gt,{...l,...a,ref:s})});ur.displayName=Ot;var Tt="PopoverTrigger",Pt=u.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Y(Tt,r),l=_e(r),o=xt(s,n.triggerRef),i=e.jsx(ft.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":At(n.open),...a,ref:o,onClick:he(t.onClick,n.onOpenToggle)});return n.hasCustomAnchor?i:e.jsx(gt,{asChild:!0,...l,children:i})});Pt.displayName=Tt;var Je="PopoverPortal",[mr,pr]=Lt(Je,{forceMount:void 0}),It=t=>{const{__scopePopover:s,forceMount:r,children:a,container:n}=t,l=Y(Je,s);return e.jsx(mr,{scope:s,forceMount:r,children:e.jsx(yt,{present:r||l.open,children:e.jsx(es,{asChild:!0,container:n,children:a})})})};It.displayName=Je;var de="PopoverContent",Rt=u.forwardRef((t,s)=>{const r=pr(de,t.__scopePopover),{forceMount:a=r.forceMount,...n}=t,l=Y(de,t.__scopePopover);return e.jsx(yt,{present:a||l.open,children:l.modal?e.jsx(xr,{...n,ref:s}):e.jsx(fr,{...n,ref:s})})});Rt.displayName=de;var hr=rs("PopoverContent.RemoveScroll"),xr=u.forwardRef((t,s)=>{const r=Y(de,t.__scopePopover),a=u.useRef(null),n=xt(s,a),l=u.useRef(!1);return u.useEffect(()=>{const o=a.current;if(o)return ts(o)},[]),e.jsx(ss,{as:hr,allowPinchZoom:!0,children:e.jsx(Et,{...t,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:he(t.onCloseAutoFocus,o=>{var i;o.preventDefault(),l.current||(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:he(t.onPointerDownOutside,o=>{const i=o.detail.originalEvent,p=i.button===0&&i.ctrlKey===!0,x=i.button===2||p;l.current=x},{checkForDefaultPrevented:!1}),onFocusOutside:he(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),fr=u.forwardRef((t,s)=>{const r=Y(de,t.__scopePopover),a=u.useRef(!1),n=u.useRef(!1);return e.jsx(Et,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{var o,i;(o=t.onCloseAutoFocus)==null||o.call(t,l),l.defaultPrevented||(a.current||(i=r.triggerRef.current)==null||i.focus(),l.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:l=>{var p,x;(p=t.onInteractOutside)==null||p.call(t,l),l.defaultPrevented||(a.current=!0,l.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=l.target;((x=r.triggerRef.current)==null?void 0:x.contains(o))&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&n.current&&l.preventDefault()}})}),Et=u.forwardRef((t,s)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:l,disableOutsidePointerEvents:o,onEscapeKeyDown:i,onPointerDownOutside:p,onFocusOutside:x,onInteractOutside:h,...j}=t,f=Y(de,r),b=_e(r);return as(),e.jsx(ns,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:l,children:e.jsx(os,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:h,onEscapeKeyDown:i,onPointerDownOutside:p,onFocusOutside:x,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(is,{"data-state":At(f.open),role:"dialog",id:f.contentId,...b,...j,ref:s,style:{...j.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),$t="PopoverClose",gr=u.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Y($t,r);return e.jsx(ft.button,{type:"button",...a,ref:s,onClick:he(t.onClick,()=>n.onOpenChange(!1))})});gr.displayName=$t;var yr="PopoverArrow",jr=u.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=_e(r);return e.jsx(ls,{...n,...a,ref:s})});jr.displayName=yr;function At(t){return t?"open":"closed"}var vr=kt,br=Pt,_r=It,Nr=Rt;function wr({...t}){return e.jsx(vr,{"data-slot":"popover",...t})}function Sr({...t}){return e.jsx(br,{"data-slot":"popover-trigger",...t})}function Cr({className:t,align:s="center",sideOffset:r=4,...a}){return e.jsx(_r,{children:e.jsx(Nr,{"data-slot":"popover-content",align:s,sideOffset:r,className:B("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...a})})}const Ft=["id","method","path","status_code","user_id","duration_ms","created_at","ops"],Mt=["id","actor_type","action","operation_category","status","user_id","ip_address","created_at","ops"],Dt=["id","error_type","error_message","error_file","error_line","error_time","ops"],le={system:"logCols_system",audit:"logCols_audit",error:"logCols_error"};function Me(t,s){try{const r=localStorage.getItem(t),a=r?JSON.parse(r):null;return Array.isArray(a)&&a.length?a:s}catch(r){return console.warn("Failed to load stored columns",r),s}}function Br(){var He,Ke,Be,Ge,Qe,Ye,Ze;const{t}=Ue(),[s,r]=u.useState(""),[a,n]=u.useState(""),[l,o]=u.useState(""),[i,p]=u.useState(["system","audit","error"]),[x,h]=u.useState(50),[j,f]=u.useState(null),[b,C]=u.useState("table"),[c,g]=u.useState(!1),[m,_]=u.useState(null),[v,T]=u.useState({system:[],audit:[],error:[]}),[N,w]=u.useState(!1),[P,M]=u.useState(!1),[D,L]=u.useState(()=>Me(le.system,Ft)),[I,J]=u.useState(()=>Me(le.audit,Mt)),[z,W]=u.useState(()=>Me(le.error,Dt)),Z=u.useRef(0),[Ee,ue]=u.useState(new Set),V=u.useMemo(()=>re(s||""),[s]),A=u.useMemo(()=>{var S;const d={},y=V.tokens||{};if(["method","status_code","user_id","request_id","path","action","audit_status","error_type"].forEach(O=>{y[O]&&(d[O]=y[O])}),(S=V.ranges)!=null&&S.duration_ms){const O=V.ranges.duration_ms;(O[">"]||O[">="])&&(d.min_duration=O[">"]||O[">="]),(O["<"]||O["<="])&&(d.max_duration=O["<"]||O["<="])}return d},[V]),{data:U,isLoading:Ne,isError:we,error:ae,refetch:H,isFetching:me}=Gs({q:V.free||s,date_from:a,date_to:l,types:i,limit_per_type:x,...A}),{data:R,isLoading:qt}=Js(j);u.useEffect(()=>{if(!c)return;const d=setInterval(()=>{H()},8e3);return()=>clearInterval(d)},[c,H]);const Se=u.useCallback(d=>{if(d!=null)try{const y=typeof d=="string"?d:JSON.stringify(d,null,2);navigator.clipboard.writeText(y)}catch(y){console.warn("Failed to copy content",y)}},[]),G=((Ke=(He=U==null?void 0:U.data)==null?void 0:He.system)==null?void 0:Ke.items)||[],Ce=((Ge=(Be=U==null?void 0:U.data)==null?void 0:Be.audit)==null?void 0:Ge.items)||[],Le=((Ye=(Qe=U==null?void 0:U.data)==null?void 0:Qe.error)==null?void 0:Ye.items)||[];u.useEffect(()=>{if(!G.length)return;const d=Math.max(...G.map(y=>y.id));if(Z.current===0){Z.current=d;return}if(d>Z.current){const y=G.filter(O=>O.id>Z.current).map(O=>O.id);ue(new Set(y)),Z.current=d;const S=setTimeout(()=>ue(new Set),4e3);return()=>clearTimeout(S)}},[G]);const Vt=u.useCallback(d=>{d&&p(d)},[]),ke=u.useCallback((d,y)=>{try{localStorage.setItem(d,JSON.stringify(y))}catch(S){console.warn("Failed to persist selected columns",S)}},[]),Ut=u.useCallback((d,y)=>{y==="id"||y==="ops"||(d==="system"?L(S=>{const O=S.includes(y)?S.filter(pe=>pe!==y):[...S,y];return ke(le.system,O),O}):d==="audit"?J(S=>{const O=S.includes(y)?S.filter(pe=>pe!==y):[...S,y];return ke(le.audit,O),O}):d==="error"&&W(S=>{const O=S.includes(y)?S.filter(pe=>pe!==y):[...S,y];return ke(le.error,O),O}))},[ke]),We=u.useCallback(async d=>{_(d),w(!0);try{const y=await Hs(d);T((y==null?void 0:y.data)||y||{system:[],audit:[],error:[]})}finally{w(!1)}},[]),Oe=u.useCallback(async d=>{M(!0);try{const y=await Ks({q:s,date_from:a,date_to:l,types:i,limit_per_type:x,...A},d),S=URL.createObjectURL(y),O=document.createElement("a");O.href=S,O.download=`logs_${Date.now()}.${d==="csv"?"csv":"ndjson"}`,O.click(),setTimeout(()=>URL.revokeObjectURL(S),2e3)}finally{M(!1)}},[s,a,l,i,x,A]),Jt=G.length+Ce.length+Le.length>0,Wt=Object.entries(V.tokens||{}).filter(([,d])=>d&&typeof d!="object").length>0||!!V.free,ne=u.useCallback(d=>t(`admin.systemLogs.columns.${d}`,{defaultValue:d}),[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ee,{children:[e.jsxs(xe,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(fe,{children:t("admin.systemLogs.title")}),e.jsx($e,{children:t("admin.systemLogs.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(st,{type:"single",value:b,onValueChange:d=>d&&C(d),variant:"outline",size:"sm",children:[e.jsx(oe,{value:"table",children:t("admin.systemLogs.views.table")}),e.jsx(oe,{value:"timeline",children:t("admin.systemLogs.views.timeline")}),e.jsx(oe,{value:"raw",children:t("admin.systemLogs.views.raw")})]}),e.jsxs(E,{size:"sm",variant:"outline",onClick:()=>H(),disabled:me,children:[e.jsx(ws,{className:B("mr-2 h-4 w-4",me&&"animate-spin")}),t("admin.systemLogs.refresh")]}),e.jsxs(E,{size:"sm",variant:"outline",onClick:()=>Oe("csv"),disabled:P,children:[e.jsx(rt,{className:"mr-2 h-4 w-4"}),t("admin.systemLogs.exportCsv")]}),e.jsxs(E,{size:"sm",variant:"outline",onClick:()=>Oe("ndjson"),disabled:P,children:[e.jsx(rt,{className:"mr-2 h-4 w-4"}),t("admin.systemLogs.exportNdjson")]}),e.jsx(Lr,{systemCols:D,auditCols:I,errorCols:z,onToggle:Ut,columnLabel:ne,t})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{id:"logs-auto-refresh",checked:c,onCheckedChange:g}),e.jsx(jt,{htmlFor:"logs-auto-refresh",className:"text-sm text-muted-foreground",children:t("admin.systemLogs.autoRefresh")})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:t("admin.systemLogs.perTypeLimit")}),e.jsx(F,{id:"limit-per-type",type:"number",min:1,max:200,value:x,onChange:d=>{const y=Number(d.target.value);h(Number.isNaN(y)?50:y)},className:"h-9 w-24"})]}),e.jsxs(st,{type:"multiple",value:i,onValueChange:Vt,variant:"outline",size:"sm",className:"flex-wrap",children:[e.jsx(oe,{value:"system",children:t("admin.systemLogs.types.system")}),e.jsx(oe,{value:"audit",children:t("admin.systemLogs.types.audit")}),e.jsx(oe,{value:"error",children:t("admin.systemLogs.types.error")})]})]})]}),e.jsx(te,{className:"pt-0",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4",children:[e.jsx(q,{label:t("admin.systemLogs.filters.keyword"),htmlFor:"log-search",children:e.jsx(F,{id:"log-search",value:s,onChange:d=>r(d.target.value),placeholder:t("admin.systemLogs.searchPlaceholder"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.method"),htmlFor:"log-method",children:e.jsx(F,{id:"log-method",value:A.method||"",onChange:d=>{const y=d.target.value;r(S=>Q(S,"method",y))},placeholder:t("admin.systemLogs.placeholders.method"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.status"),htmlFor:"log-status",children:e.jsx(F,{id:"log-status",value:A.status_code||"",onChange:d=>{const y=d.target.value;r(S=>Q(S,"status",y))},placeholder:t("admin.systemLogs.placeholders.status"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.userId"),htmlFor:"log-user-id",children:e.jsx(F,{id:"log-user-id",value:A.user_id||"",onChange:d=>{const y=d.target.value;r(S=>Q(S,"user",y))},placeholder:t("admin.systemLogs.placeholders.userId"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.requestId"),htmlFor:"log-request-id",children:e.jsx(F,{id:"log-request-id",value:A.request_id||"",onChange:d=>{const y=d.target.value;r(S=>Q(S,"rid",y))},placeholder:t("admin.systemLogs.placeholders.requestId"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.path"),htmlFor:"log-path",children:e.jsx(F,{id:"log-path",value:A.path||"",onChange:d=>{const y=d.target.value;r(S=>Q(S,"path",y))},placeholder:t("admin.systemLogs.placeholders.path"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.durationMin"),htmlFor:"log-duration-min",children:e.jsx(F,{id:"log-duration-min",value:A.min_duration||"",onChange:d=>r(y=>zt(y,"dur",">=",d.target.value)),placeholder:t("admin.systemLogs.placeholders.duration"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.durationMax"),htmlFor:"log-duration-max",children:e.jsx(F,{id:"log-duration-max",value:A.max_duration||"",onChange:d=>r(y=>Ir(y,d.target.value)),placeholder:t("admin.systemLogs.placeholders.duration"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.auditAction"),htmlFor:"log-audit-action",children:e.jsx(F,{id:"log-audit-action",value:A.action||"",onChange:d=>{const y=d.target.value;r(S=>Q(S,"action",y))},placeholder:t("admin.systemLogs.placeholders.auditAction"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.auditStatus"),htmlFor:"log-audit-status",children:e.jsx(F,{id:"log-audit-status",value:A.audit_status||"",onChange:d=>{const y=d.target.value;r(S=>Q(S,"astatus",y))},placeholder:t("admin.systemLogs.placeholders.auditStatus"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.filters.errorType"),htmlFor:"log-error-type",children:e.jsx(F,{id:"log-error-type",value:A.error_type||"",onChange:d=>{const y=d.target.value;r(S=>Q(S,"etype",y))},placeholder:t("admin.systemLogs.placeholders.errorType"),className:"font-mono"})}),e.jsx(q,{label:t("admin.systemLogs.dateFrom"),htmlFor:"log-date-from",children:e.jsx(F,{id:"log-date-from",type:"date",value:a,onChange:d=>n(d.target.value)})}),e.jsx(q,{label:t("admin.systemLogs.dateTo"),htmlFor:"log-date-to",children:e.jsx(F,{id:"log-date-to",type:"date",value:l,onChange:d=>o(d.target.value)})})]})}),Wt&&e.jsx(ys,{className:"pt-0",children:e.jsx(kr,{parsed:V,onRemove:d=>r(y=>Rr(y,d)),t})})]}),Ne&&e.jsx(ee,{children:e.jsxs(te,{className:"flex items-center gap-2 py-8 text-sm text-muted-foreground",children:[e.jsx(cs,{className:"h-4 w-4 animate-spin"}),t("common.loading")]})}),we&&e.jsxs(bs,{variant:"destructive",children:[e.jsx(_s,{children:t("common.error")}),e.jsx(Ns,{children:(ae==null?void 0:ae.message)||t("errors.loadFailed")})]}),!Ne&&!we&&e.jsxs(e.Fragment,{children:[b==="table"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Or,{title:t("admin.systemLogs.sections.system"),items:G,emptyText:t("admin.systemLogs.empty.system"),columns:D,highlightIds:Ee,onDetail:f,onCopyReq:Se,onRelated:We,columnLabel:ne,t}),e.jsx(ut,{title:t("admin.systemLogs.sections.audit"),items:Ce,emptyText:t("admin.systemLogs.empty.audit"),headers:["id","actor_type","action","operation_category","status","user_id","ip_address","created_at"],columnLabel:ne,renderItem:d=>e.jsx(mt,{summaryCells:[d.id,d.actor_type,d.action,d.operation_category||"- ",d.status,d.user_id||"-",d.ip_address||"-",d.created_at],detail:e.jsx(Tr,{log:d,columnLabel:ne}),t},`audit-${d.id}`)}),e.jsx(ut,{title:t("admin.systemLogs.sections.error"),items:Le,emptyText:t("admin.systemLogs.empty.error"),headers:["id","error_type","error_message","error_file","error_line","error_time"],columnLabel:ne,renderItem:d=>{var y;return e.jsx(mt,{summaryCells:[d.id,d.error_type,e.jsx("span",{className:"font-mono text-[11px] max-w-[240px] truncate",title:d.error_message,children:d.error_message},"message"),((y=d.error_file)==null?void 0:y.split("/").pop())||"-",d.error_line,d.error_time],detail:e.jsx(Pr,{log:d,columnLabel:ne}),t},`error-${d.id}`)}}),!Jt&&e.jsx(ee,{children:e.jsx(te,{className:"py-12 text-center text-sm text-muted-foreground",children:t("admin.systemLogs.noEvents")})})]}),b==="timeline"&&e.jsxs(ee,{children:[e.jsxs(xe,{children:[e.jsx(fe,{className:"text-lg",children:t("admin.systemLogs.views.timeline")}),e.jsx($e,{children:t("admin.systemLogs.timelineDescription")})]}),e.jsx(te,{children:e.jsx(bt,{system:G,audit:Ce,error:Le,onSelectRequest:We,emptyLabel:t("admin.systemLogs.noEvents")})})]}),b==="raw"&&e.jsxs(ee,{children:[e.jsxs(xe,{children:[e.jsx(fe,{className:"text-lg",children:t("admin.systemLogs.views.raw")}),e.jsx($e,{children:t("admin.systemLogs.rawDescription")})]}),e.jsx(te,{children:e.jsx(_t,{system:G,audit:Ce,error:Le,onExportCsv:()=>Oe("csv"),onExportNdjson:()=>Oe("ndjson"),labels:{copy:t("admin.systemLogs.copyNdjson"),exportNdjson:t("admin.systemLogs.exportNdjson"),exportCsv:t("admin.systemLogs.exportCsv"),records:t("admin.systemLogs.records"),maxHint:t("admin.systemLogs.maxRecords")}})})]})]}),e.jsx(ds,{open:!!j,onOpenChange:d=>!d&&f(null),children:e.jsxs(us,{className:"max-w-4xl",children:[e.jsxs(ms,{children:[e.jsx(ps,{children:j?t("admin.systemLogs.dialog.titleWithId",{id:j}):t("admin.systemLogs.dialog.title")}),e.jsx(hs,{children:t("admin.systemLogs.dialog.requestId",{id:((Ze=R==null?void 0:R.data)==null?void 0:Ze.request_id)||t("common.none")})})]}),qt&&e.jsx("div",{className:"py-4 text-sm text-muted-foreground",children:t("admin.systemLogs.dialog.loading")}),(R==null?void 0:R.data)&&e.jsx(js,{className:"max-h-[70vh] pr-2",children:e.jsxs("div",{className:"space-y-6 text-sm",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsx($,{label:t("admin.systemLogs.columns.request_id"),value:R.data.request_id}),e.jsx($,{label:t("admin.systemLogs.columns.method"),value:R.data.method}),e.jsx($,{label:t("admin.systemLogs.columns.path"),value:R.data.path,className:"md:col-span-2"}),e.jsx($,{label:t("admin.systemLogs.columns.status_code"),value:R.data.status_code}),e.jsx($,{label:t("admin.systemLogs.columns.user_id"),value:R.data.user_id||t("common.none")}),e.jsx($,{label:t("admin.systemLogs.columns.duration_ms"),value:`${R.data.duration_ms} ms`}),e.jsx($,{label:t("admin.systemLogs.columns.created_at"),value:R.data.created_at,className:"md:col-span-2"})]}),e.jsx(ze,{title:t("admin.systemLogs.requestBody"),value:R.data.request_body,onCopy:Se,copyLabel:t("common.copy")}),e.jsx(ze,{title:t("admin.systemLogs.responseBody"),value:R.data.response_body,onCopy:Se,copyLabel:t("common.copy")}),R.data.server_meta&&e.jsx(ze,{title:t("admin.systemLogs.serverMeta"),value:R.data.server_meta,onCopy:Se,copyLabel:t("common.copy")})]})})]})}),e.jsx(Nt,{open:!!m,requestId:m,onClose:()=>_(null),loading:N,system:v.system,audit:v.audit,error:v.error})]})}function q({label:t,htmlFor:s,children:r}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(jt,{htmlFor:s,className:"text-xs font-medium uppercase tracking-wide text-muted-foreground",children:t}),r]})}function Lr({systemCols:t,auditCols:s,errorCols:r,onToggle:a,columnLabel:n,t:l}){return e.jsxs(wr,{children:[e.jsx(Sr,{asChild:!0,children:e.jsxs(E,{size:"sm",variant:"outline",children:[e.jsx(Ts,{className:"mr-2 h-4 w-4"}),l("admin.systemLogs.columnSettings")]})}),e.jsxs(Cr,{className:"w-64 space-y-4",align:"end",children:[e.jsx(De,{title:l("admin.systemLogs.types.system"),columns:Ft,active:t,onToggle:o=>a("system",o),columnLabel:n}),e.jsx(De,{title:l("admin.systemLogs.types.audit"),columns:Mt,active:s,onToggle:o=>a("audit",o),columnLabel:n}),e.jsx(De,{title:l("admin.systemLogs.types.error"),columns:Dt,active:r,onToggle:o=>a("error",o),columnLabel:n})]})]})}function De({title:t,columns:s,active:r,onToggle:a,columnLabel:n}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase text-muted-foreground",children:t}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(l=>e.jsx(E,{size:"sm",variant:r.includes(l)?"default":"outline",onClick:()=>a(l),className:"h-8 text-xs",children:n(l)},l))})]})}function kr({parsed:t,onRemove:s,t:r}){const a=Object.entries(t.tokens||{}).filter(([,n])=>n&&typeof n!="object");return a.length===0&&!t.free?null:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[a.map(([n,l])=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(ge,{variant:"secondary",className:"font-mono",children:[n,":",String(l)]}),e.jsx(E,{type:"button",size:"icon",variant:"ghost",className:"h-6 w-6 text-muted-foreground",onClick:()=>s(n),"aria-label":r("admin.systemLogs.activeFilters.remove",{key:n}),children:e.jsx(xs,{className:"h-3 w-3"})})]},n)),t.free&&e.jsx(ge,{variant:"outline",className:"font-mono",children:t.free})]})}function Or({title:t,items:s,emptyText:r,columns:a,highlightIds:n,onDetail:l,onCopyReq:o,onRelated:i,columnLabel:p,t:x}){const h=s.length>120,j=e.jsx("thead",{className:"bg-muted/60",children:e.jsxs("tr",{children:[a.includes("id")&&e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:p("id")}),a.includes("method")&&e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:p("method")}),a.includes("path")&&e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:p("path")}),a.includes("status_code")&&e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:p("status_code")}),a.includes("user_id")&&e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:p("user_id")}),a.includes("duration_ms")&&e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:p("duration_ms")}),a.includes("created_at")&&e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:p("created_at")}),a.includes("ops")&&e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:p("ops")})]})}),f=b=>{const C=n.has(b.id);return e.jsxs("tr",{className:B("border-b text-xs transition-colors hover:bg-muted/30",C&&"bg-amber-50"),children:[a.includes("id")&&e.jsx("td",{className:"px-3 py-2 font-medium",children:b.id}),a.includes("method")&&e.jsx("td",{className:"px-3 py-2 uppercase",children:b.method}),a.includes("path")&&e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:"font-mono text-[11px]",title:b.path,children:b.path})}),a.includes("status_code")&&e.jsx("td",{className:"px-3 py-2",children:b.status_code}),a.includes("user_id")&&e.jsx("td",{className:"px-3 py-2",children:b.user_id||"-"}),a.includes("duration_ms")&&e.jsx("td",{className:"px-3 py-2",children:b.duration_ms}),a.includes("created_at")&&e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:b.created_at}),a.includes("ops")&&e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsx(E,{variant:"link",className:"h-auto p-0",onClick:()=>l(b.id),children:x("admin.systemLogs.details")}),e.jsx(E,{variant:"link",className:"h-auto p-0 text-muted-foreground",onClick:()=>o(b.request_id),children:x("admin.systemLogs.copyReqId")}),b.request_id&&e.jsx(E,{variant:"link",className:"h-auto p-0 text-indigo-600",onClick:()=>i(b.request_id),children:x("admin.systemLogs.related")})]})})]},b.id)};return e.jsxs(ee,{children:[e.jsx(xe,{className:"flex flex-row items-center justify-between space-y-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"text-lg",children:t}),e.jsx(ge,{variant:"outline",className:"text-xs",children:x("admin.systemLogs.recordCount",{count:s.length})})]})}),e.jsx(te,{className:"p-0",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full border-t text-xs",children:[j,!h&&e.jsxs("tbody",{children:[s.map(b=>f(b)),s.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-muted-foreground",colSpan:a.length,children:r})})]})]}),h&&e.jsx(Vs,{height:480,itemCount:s.length,itemSize:44,width:"100%",children:({index:b,style:C})=>e.jsx("table",{style:{...C,width:"100%"},className:"table-fixed text-xs",children:e.jsx("tbody",{children:f(s[b])})},s[b].id)})]})})]})}function ut({title:t,items:s,emptyText:r,renderItem:a,headers:n,columnLabel:l}){return e.jsxs(ee,{children:[e.jsx(xe,{className:"flex flex-row items-center justify-between space-y-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"text-lg",children:t}),e.jsx(ge,{variant:"outline",className:"text-xs",children:s.length})]})}),e.jsx(te,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-t text-xs",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsxs("tr",{children:[n.map(o=>e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase text-muted-foreground",children:l(o)},o)),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-semibold uppercase text-muted-foreground",children:l("ops")})]})}),e.jsxs("tbody",{children:[s.map(a),s.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-muted-foreground",colSpan:n.length+1,children:r})})]})]})})})]})}function mt({summaryCells:t,detail:s,t:r}){const[a,n]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:B("border-b",a&&"bg-muted/40"),children:[t.map((l,o)=>e.jsx("td",{className:"px-3 py-2 align-top",children:l},o)),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx(E,{variant:"link",className:"h-auto p-0 text-xs",onClick:()=>n(l=>!l),children:r(a?"admin.systemLogs.actions.collapse":"admin.systemLogs.actions.expand")})})]}),a&&e.jsx("tr",{className:"border-b bg-muted/30",children:e.jsx("td",{colSpan:t.length+1,className:"px-3 py-3",children:s})})]})}function Tr({log:t,columnLabel:s}){return e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsx($,{label:s("id"),value:t.id}),e.jsx($,{label:s("action"),value:t.action}),e.jsx($,{label:s("operation_category"),value:t.operation_category||"-"}),e.jsx($,{label:s("actor_type"),value:t.actor_type}),e.jsx($,{label:s("status"),value:t.status}),t.details_raw&&e.jsx(Pe,{title:"details_raw",value:ve(t.details_raw)}),t.summary&&e.jsx(Pe,{title:"summary",value:ve(t.summary)}),(t.old_data||t.new_data)&&e.jsx("div",{className:"space-y-1",children:e.jsx(cr,{oldData:t.old_data,newData:t.new_data})})]})}function Pr({log:t,columnLabel:s}){return e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsx($,{label:s("id"),value:t.id}),e.jsx($,{label:s("error_type"),value:t.error_type}),e.jsx($,{label:s("error_file"),value:t.error_file}),e.jsx($,{label:s("error_line"),value:t.error_line}),e.jsx(Pe,{title:"message",value:ve(t.error_message)}),t.stack_trace&&e.jsx("pre",{className:"max-h-64 overflow-auto whitespace-pre-wrap rounded bg-slate-900 p-3 font-mono text-[11px] text-green-300",children:t.stack_trace}),t.context_json&&e.jsx(Pe,{title:"context",value:ve(t.context_json)})]})}function ze({title:t,value:s,onCopy:r,copyLabel:a}){return s?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:t}),e.jsx(E,{variant:"link",className:"h-auto p-0 text-xs",onClick:()=>r(s),children:a})]}),e.jsx(je,{value:ve(s)})]}):null}function Pe({title:t,value:s}){return s?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:t}),e.jsx(je,{value:s})]}):null}function $({label:t,value:s,className:r}){return e.jsxs("div",{className:B("space-x-2",r),children:[e.jsxs("span",{className:"font-semibold",children:[t,":"]}),e.jsx("span",{className:"font-mono break-all text-xs",children:String(s??"-")})]})}function ve(t){if(t==null)return null;if(typeof t=="object")return t;try{return JSON.parse(t)}catch{return t}}function Q(t,s,r){const a=re(t||""),l=re(`${s}:${r!==void 0&&r!==""?r:"__probe__"}`),o=Object.keys(l.tokens||{})[0]||s;r?(a.tokens=a.tokens||{},a.tokens[o]=r):a.tokens&&delete a.tokens[o];const i=[];return Object.entries(a.tokens||{}).forEach(([p,x])=>{x&&typeof x=="object"?x.negate?i.push(`${p}!=${x.value}`):i.push(`${p}:${x.value}`):i.push(`${p}:${x}`)}),Object.entries(a.ranges||{}).forEach(([p,x])=>{Object.entries(x).forEach(([h,j])=>{i.push(`${p}${h}${j}`)})}),a.free&&i.push(a.free),i.join(" ").trim()}function zt(t,s,r,a){const n=re(t||""),o=re(`${s}${r}${a!==void 0&&a!==""?a:"__probe__"}`),i=Object.keys(o.ranges||{})[0]||Object.keys(o.tokens||{})[0]||s;n.ranges=n.ranges||{},a?(n.ranges[i]=n.ranges[i]||{},n.ranges[i][r]=a):n.ranges[i]&&(delete n.ranges[i][r],Object.keys(n.ranges[i]).length===0&&delete n.ranges[i]);const p=[];return Object.entries(n.tokens||{}).forEach(([x,h])=>{h&&typeof h=="object"?h.negate?p.push(`${x}!=${h.value}`):p.push(`${x}:${h.value}`):p.push(`${x}:${h}`)}),Object.entries(n.ranges||{}).forEach(([x,h])=>{Object.entries(h).forEach(([j,f])=>{p.push(`${x}${j}${f}`)})}),n.free&&p.push(n.free),p.join(" ").trim()}function Ir(t,s){return zt(t,"dur","<=",s)}function Rr(t,s){const r=re(t||""),a=re(`${s}:__probe__`),n=Object.keys(a.tokens||{})[0]||s;r.tokens&&delete r.tokens[n];const l=[];return Object.entries(r.tokens||{}).forEach(([o,i])=>{i&&typeof i=="object"?i.negate?l.push(`${o}!=${i.value}`):l.push(`${o}:${i.value}`):l.push(`${o}:${i}`)}),Object.entries(r.ranges||{}).forEach(([o,i])=>{Object.entries(i).forEach(([p,x])=>{l.push(`${o}${p}${x}`)})}),r.free&&l.push(r.free),l.join(" ").trim()}export{Br as default};
