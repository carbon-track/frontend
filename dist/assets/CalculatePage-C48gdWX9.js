import{c as U,u as G,r as h,j as e,B as $,L as z,S as ye,f as M,o as Ne,P as de,p as V,k as be,q as we,X as Ce,C as ke}from"./index-BKjOfV5l.js";import{C as A,a as T,b as O,c as E,d as B}from"./Card-BjV_5Hz9.js";import{I as Z}from"./Input-CQCfPgps.js";import{S as te}from"./search-B4M-0oqD.js";import{F as Se}from"./funnel-Ch0r0Cl2.js";import{u as Fe}from"./index.esm-B6HbNfYb.js";import{A as Q,a as Y}from"./Alert-Tl0dtwbA.js";import{C as q}from"./circle-alert-IgYmallE.js";import{I as _e}from"./image-CLrOna7A.js";import{C as ae}from"./circle-check-big-iU2hGy9Z.js";import{A as Pe}from"./arrow-left-CHNgtEOb.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Me=U("calendar",De);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],re=U("car",$e);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ee=U("circle-check",Ae);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ie=U("file-text",Ue);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],ze=U("file",Le);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M7 19H4.815a1.83 1.83 0 0 1-1.57-.881 1.785 1.785 0 0 1-.004-1.784L7.196 9.5",key:"x6z5xu"}],["path",{d:"M11 19h8.203a1.83 1.83 0 0 0 1.556-.89 1.784 1.784 0 0 0 0-1.775l-1.226-2.12",key:"1x4zh5"}],["path",{d:"m14 16-3 3 3 3",key:"f6jyew"}],["path",{d:"M8.293 13.596 7.196 9.5 3.1 10.598",key:"wf1obh"}],["path",{d:"m9.344 5.811 1.093-1.892A1.83 1.83 0 0 1 11.985 3a1.784 1.784 0 0 1 1.546.888l3.943 6.843",key:"9tzpgr"}],["path",{d:"m13.378 9.633 4.096 1.098 1.097-4.096",key:"1oe83g"}]],ie=U("recycle",Re);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],J=U("upload",Ve),Te={daily:z,transport:re,consumption:ye,environmental:ie,lifestyle:z,energy:z,water:z,waste:ie,travel:re};function Oe({onActivitySelect:s,selectedActivity:a}){const{t}=G(),[i,r]=h.useState([]),[m,l]=h.useState([]),[v,u]=h.useState([]),[d,b]=h.useState("all"),[g,x]=h.useState(""),[f,y]=h.useState(!0),[p,C]=h.useState("");h.useEffect(()=>{(async()=>{try{y(!0);const n=await M.get("/carbon-activities");if(n.data.success){const j=n.data.data;r(j),l(j);const I=[...new Set(j.map(W=>W.category))];u(I)}else C(n.data.message||t("errors.loadFailed"))}catch(n){C(n.message||t("errors.network"))}finally{y(!1)}})()},[t]),h.useEffect(()=>{let c=i;d!=="all"&&(c=c.filter(n=>n.category===d)),g&&(c=c.filter(n=>n.name_zh.toLowerCase().includes(g.toLowerCase())||n.name_en.toLowerCase().includes(g.toLowerCase())||n.description_zh.toLowerCase().includes(g.toLowerCase())||n.description_en.toLowerCase().includes(g.toLowerCase()))),l(c)},[i,d,g]);const P=c=>{s(c)},_=c=>t(`activities.categories.${c}`)||c,D=c=>c.name_zh||c.name_en||c.name,S=c=>c.description_zh||c.description_en||c.description;return f?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:t("common.loading")})]}):p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 mb-4",children:p}),e.jsx($,{onClick:()=>window.location.reload(),children:t("common.retry")})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Z,{type:"text",placeholder:t("activities.searchPlaceholder"),value:g,onChange:c=>x(c.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:d,onChange:c=>b(c.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"all",children:t("activities.categories.all")}),v.map(c=>e.jsx("option",{value:c,children:_(c)},c))]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(c=>{const n=Te[c.category]||z,j=(a==null?void 0:a.uuid)===c.uuid;return e.jsxs(A,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${j?"ring-2 ring-green-500 bg-green-50":"hover:bg-gray-50"}`,onClick:()=>P(c),children:[e.jsx(T,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${j?"bg-green-200":"bg-gray-100"}`,children:e.jsx(n,{className:`h-5 w-5 ${j?"text-green-700":"text-gray-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(O,{className:"text-sm font-medium",children:D(c)}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:_(c.category)})]})]})}),e.jsxs(E,{className:"pt-0",children:[e.jsx(B,{className:"text-sm text-gray-600 mb-3",children:S(c)}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"text-gray-500",children:[t("activities.unit"),": ",c.unit]}),e.jsxs("div",{className:"text-green-600 font-medium",children:[c.carbon_factor," ",t("activities.carbonFactor")]})]}),c.points_per_unit&&e.jsxs("div",{className:"mt-2 text-xs text-blue-600",children:[c.points_per_unit," ",t("activities.pointsPerUnit")]})]})]},c.uuid)})}),m.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx(te,{className:"h-12 w-12 mx-auto"})}),e.jsx("p",{className:"text-gray-600",children:t("activities.noActivitiesFound")}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t("activities.tryDifferentSearch")})]})]})}var ee="Progress",se=100,[Be,gs]=Ne(ee),[qe,He]=Be(ee),me=h.forwardRef((s,a)=>{const{__scopeProgress:t,value:i=null,max:r,getValueLabel:m=Ge,...l}=s;(r||r===0)&&!ne(r)&&console.error(We(`${r}`,"Progress"));const v=ne(r)?r:se;i!==null&&!le(i,v)&&console.error(Xe(`${i}`,"Progress"));const u=le(i,v)?i:null,d=H(u)?m(u,v):void 0;return e.jsx(qe,{scope:t,value:u,max:v,children:e.jsx(de.div,{"aria-valuemax":v,"aria-valuemin":0,"aria-valuenow":H(u)?u:void 0,"aria-valuetext":d,role:"progressbar","data-state":he(u,v),"data-value":u??void 0,"data-max":v,...l,ref:a})})});me.displayName=ee;var ue="ProgressIndicator",xe=h.forwardRef((s,a)=>{const{__scopeProgress:t,...i}=s,r=He(ue,t);return e.jsx(de.div,{"data-state":he(r.value,r.max),"data-value":r.value??void 0,"data-max":r.max,...i,ref:a})});xe.displayName=ue;function Ge(s,a){return`${Math.round(s/a*100)}%`}function he(s,a){return s==null?"indeterminate":s===a?"complete":"loading"}function H(s){return typeof s=="number"}function ne(s){return H(s)&&!isNaN(s)&&s>0}function le(s,a){return H(s)&&!isNaN(s)&&s<=a&&s>=0}function We(s,a){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${a}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${se}\`.`}function Xe(s,a){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${se} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Ke=me,Ze=xe;function Je({className:s,value:a,...t}){return e.jsx(Ke,{"data-slot":"progress",className:V("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...t,children:e.jsx(Ze,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})})}const ce=s=>typeof s=="boolean"?`${s}`:s===0?"0":s,oe=be,Qe=(s,a)=>t=>{var i;if((a==null?void 0:a.variants)==null)return oe(s,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:r,defaultVariants:m}=a,l=Object.keys(r).map(d=>{const b=t==null?void 0:t[d],g=m==null?void 0:m[d];if(b===null)return null;const x=ce(b)||ce(g);return r[d][x]}),v=t&&Object.entries(t).reduce((d,b)=>{let[g,x]=b;return x===void 0||(d[g]=x),d},{}),u=a==null||(i=a.compoundVariants)===null||i===void 0?void 0:i.reduce((d,b)=>{let{class:g,className:x,...f}=b;return Object.entries(f).every(y=>{let[p,C]=y;return Array.isArray(C)?C.includes({...m,...v}[p]):{...m,...v}[p]===C})?[...d,g,x]:d},[]);return oe(s,l,u,t==null?void 0:t.class,t==null?void 0:t.className)},Ye=Qe("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function K({className:s,variant:a,asChild:t=!1,...i}){const r=t?we:"span";return e.jsx(r,{"data-slot":"badge",className:V(Ye({variant:a}),s),...i})}class es{constructor(a={}){this.maxFileSize=a.maxFileSize||5*1024*1024,this.allowedTypes=a.allowedTypes||["image/jpeg","image/jpg","image/png","image/gif","image/webp"],this.allowedExtensions=a.allowedExtensions||["jpg","jpeg","png","gif","webp"]}validateFile(a){const t=[];a.size>this.maxFileSize&&t.push(`文件大小不能超过 ${this.formatFileSize(this.maxFileSize)}`),this.allowedTypes.includes(a.type)||t.push(`不支持的文件类型。支持的类型：${this.allowedTypes.join(", ")}`);const i=this.getFileExtension(a.name);return this.allowedExtensions.includes(i)||t.push(`不支持的文件扩展名。支持的扩展名：${this.allowedExtensions.join(", ")}`),{isValid:t.length===0,errors:t}}async uploadFile(a,t={}){var m,l;const i=this.validateFile(a);if(!i.isValid)throw new Error(i.errors.join("; "));const r=new FormData;r.append("file",a),t.directory&&r.append("directory",t.directory),t.entityType&&r.append("entity_type",t.entityType),t.entityId&&r.append("entity_id",t.entityId.toString());try{return(await M.post("/files/upload",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t.onProgress})).data}catch(v){throw new Error(((l=(m=v.response)==null?void 0:m.data)==null?void 0:l.message)||"文件上传失败")}}async uploadMultipleFiles(a,t={}){var l,v;const r=a.map(u=>({file:u,validation:this.validateFile(u)})).filter(u=>!u.validation.isValid);if(r.length>0){const u=r.map(d=>`${d.file.name}: ${d.validation.errors.join("; ")}`);throw new Error(`文件验证失败:
`+u.join(`
`))}const m=new FormData;a.forEach(u=>{m.append("files[]",u)}),t.directory&&m.append("directory",t.directory),t.entityType&&m.append("entity_type",t.entityType),t.entityId&&m.append("entity_id",t.entityId.toString());try{return(await M.post("/files/upload-multiple",m,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t.onProgress})).data}catch(u){throw new Error(((v=(l=u.response)==null?void 0:l.data)==null?void 0:v.message)||"文件上传失败")}}async deleteFile(a){var t,i;try{const r=encodeURIComponent(a);return(await M.delete(`/files/${r}`)).data}catch(r){throw new Error(((i=(t=r.response)==null?void 0:t.data)==null?void 0:i.message)||"文件删除失败")}}async getFileInfo(a){var t,i;try{const r=encodeURIComponent(a);return(await M.get(`/files/${r}/info`)).data}catch(r){throw new Error(((i=(t=r.response)==null?void 0:t.data)==null?void 0:i.message)||"获取文件信息失败")}}async generatePresignedUrl(a,t=3600){var i,r;try{const m=encodeURIComponent(a);return(await M.get(`/files/${m}/presigned-url`,{params:{expires_in:t}})).data}catch(m){throw new Error(((r=(i=m.response)==null?void 0:i.data)==null?void 0:r.message)||"生成预签名URL失败")}}getFileExtension(a){return a.split(".").pop().toLowerCase()}formatFileSize(a){if(a===0)return"0 B";const t=1024,i=["B","KB","MB","GB"],r=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,r)).toFixed(1))+" "+i[r]}isImageFile(a){return a.type.startsWith("image/")}createPreviewUrl(a){return this.isImageFile(a)?URL.createObjectURL(a):null}revokePreviewUrl(a){a&&URL.revokeObjectURL(a)}async compressImage(a,t={}){const{maxWidth:i=1920,maxHeight:r=1080,quality:m=.8,outputFormat:l="image/jpeg"}=t;return new Promise((v,u)=>{const d=document.createElement("canvas"),b=d.getContext("2d"),g=new Image;g.onload=()=>{let{width:x,height:f}=g;x>i&&(f=f*i/x,x=i),f>r&&(x=x*r/f,f=r),d.width=x,d.height=f,b.drawImage(g,0,0,x,f),d.toBlob(y=>{if(y){const p=new File([y],a.name,{type:l,lastModified:Date.now()});v(p)}else u(new Error("图片压缩失败"))},l,m)},g.onerror=()=>u(new Error("图片加载失败")),g.src=URL.createObjectURL(a)})}}const F=new es,ss=({multiple:s=!1,directory:a="uploads",entityType:t=null,entityId:i=null,onUploadSuccess:r=()=>{},onUploadError:m=()=>{},className:l="",accept:v="image/*",maxFiles:u=5,disabled:d=!1,showPreview:b=!0,compressImages:g=!1})=>{const{t:x}=G(),[f,y]=h.useState([]),[p,C]=h.useState(!1),[P,_]=h.useState(0),[D,S]=h.useState(""),[c,n]=h.useState(!1),j=h.useRef(null),I=h.useCallback(async o=>{S("");const N=Array.from(o);if(s&&N.length>u){S(x("errors.tooManyFiles",{max:u}));return}if(!s&&N.length>1){S(x("errors.singleFileOnly"));return}const k=[];for(const w of N){const L=F.validateFile(w);if(L.isValid){let R=w;if(g&&F.isImageFile(w))try{R=await F.compressImage(w)}catch(je){console.warn("Image compression failed, using original file:",je)}k.push({file:R,id:Math.random().toString(36).substr(2,9),preview:b&&F.isImageFile(R)?F.createPreviewUrl(R):null,status:"pending",progress:0,error:null})}else{S(L.errors.join("; "));return}}y(k)},[s,u,g,b,x]),W=h.useCallback(async()=>{if(!(f.length===0||p)){C(!0),_(0),S("");try{const o=f.map(w=>w.file),N={directory:a,entityType:t,entityId:i,onProgress:w=>{const L=Math.round(w.loaded*100/w.total);_(L)}};let k;s&&o.length>1?k=await F.uploadMultipleFiles(o,N):k=await F.uploadFile(o[0],N),y(w=>w.map(L=>({...L,status:"success",progress:100}))),r(k),f.forEach(w=>{w.preview&&F.revokePreviewUrl(w.preview)}),setTimeout(()=>{y([]),_(0)},2e3)}catch(o){S(o.message),y(N=>N.map(k=>({...k,status:"error",error:o.message}))),m(o)}finally{C(!1)}}},[f,p,a,t,i,s,r,m]),ge=h.useCallback(o=>{y(N=>{const k=N.find(w=>w.id===o);return k!=null&&k.preview&&F.revokePreviewUrl(k.preview),N.filter(w=>w.id!==o)})},[]),X=h.useCallback(o=>{o.preventDefault(),o.stopPropagation(),o.type==="dragenter"||o.type==="dragover"?n(!0):o.type==="dragleave"&&n(!1)},[]),pe=h.useCallback(o=>{if(o.preventDefault(),o.stopPropagation(),n(!1),d||p)return;const N=o.dataTransfer.files;(N==null?void 0:N.length)>0&&I(N)},[d,p,I]),fe=h.useCallback(()=>{var o;!d&&!p&&((o=j.current)==null||o.click())},[d,p]),ve=h.useCallback(o=>{const N=o.target.files;(N==null?void 0:N.length)>0&&I(N),o.target.value=""},[I]);return e.jsxs("div",{className:V("space-y-4",l),children:[e.jsxs("div",{className:V("border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors",c?"border-primary bg-primary/5":"border-gray-300 hover:border-gray-400",d&&"opacity-50 cursor-not-allowed",p&&"pointer-events-none"),onDragEnter:X,onDragLeave:X,onDragOver:X,onDrop:pe,onClick:fe,children:[e.jsx("input",{ref:j,type:"file",multiple:s,accept:v,onChange:ve,className:"hidden",disabled:d||p}),e.jsx(J,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:x(c?"upload.dropFiles":"upload.clickOrDrag")}),e.jsx("p",{className:"text-sm text-gray-500",children:s?x("upload.supportMultiple",{max:u}):x("upload.supportSingle")}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[x("upload.supportedFormats"),": JPG, PNG, GIF, WebP (最大 5MB)"]})]}),D&&e.jsxs(Q,{variant:"destructive",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx(Y,{children:D})]}),f.length>0&&e.jsx("div",{className:"space-y-2",children:f.map(o=>e.jsx(A,{className:"p-3",children:e.jsx(E,{className:"p-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:o.preview?e.jsx("img",{src:o.preview,alt:o.file.name,className:"w-12 h-12 object-cover rounded"}):e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded flex items-center justify-center",children:F.isImageFile(o.file)?e.jsx(_e,{className:"h-6 w-6 text-gray-400"}):e.jsx(ze,{className:"h-6 w-6 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:o.file.name}),e.jsx("p",{className:"text-xs text-gray-500",children:F.formatFileSize(o.file.size)}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[o.status==="pending"&&e.jsx(K,{variant:"secondary",children:x("upload.pending")}),o.status==="success"&&e.jsxs(K,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),x("upload.success")]}),o.status==="error"&&e.jsxs(K,{variant:"destructive",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),x("upload.error")]})]}),o.error&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:o.error})]}),o.status!=="success"&&!p&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>ge(o.id),className:"flex-shrink-0",children:e.jsx(Ce,{className:"h-4 w-4"})})]})})},o.id))}),p&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:x("upload.uploading")}),e.jsxs("span",{children:[P,"%"]})]}),e.jsx(Je,{value:P,className:"w-full"})]}),f.length>0&&!p&&f.some(o=>o.status==="pending")&&e.jsxs($,{onClick:W,disabled:d||p,className:"w-full",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),s&&f.length>1?x("upload.uploadFiles",{count:f.length}):x("upload.uploadFile")]})]})};function ts({activity:s,onCalculate:a,onSubmit:t,calculationResult:i,isCalculating:r,isSubmitting:m}){var c;const{t:l}=G(),[v,u]=h.useState([]),[d,b]=h.useState(!1),{register:g,handleSubmit:x,watch:f,setValue:y,formState:{errors:p}}=Fe({defaultValues:{activity_date:new Date().toISOString().split("T")[0],notes:""}}),C=f("data");h.useEffect(()=>{if(s&&C&&parseFloat(C)>0){const n=parseFloat(C);isNaN(n)||(a(n),b(!0))}else b(!1)},[s,C,a]);const P=n=>{const j={activity_id:s.uuid,data:parseFloat(n.data),activity_date:n.activity_date,notes:n.notes,uploaded_files:v};t(j)},_=n=>{u(n)};if(!s)return e.jsx(A,{children:e.jsxs(E,{className:"py-12 text-center",children:[e.jsx(q,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:l("activities.selectActivityFirst")})]})});const D=n=>n.name_zh||n.name_en||n.name,S=n=>n.description_zh||n.description_en||n.description;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(A,{children:[e.jsxs(T,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-green-600"}),D(s)]}),e.jsx(B,{children:S(s)})]}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-500",children:[l("activities.category"),":"]}),e.jsx("div",{className:"font-medium",children:l(`activities.categories.${s.category}`)})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-500",children:[l("activities.unit"),":"]}),e.jsx("div",{className:"font-medium",children:s.unit})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-500",children:[l("activities.carbonFactor"),":"]}),e.jsx("div",{className:"font-medium text-green-600",children:s.carbon_factor})]}),s.points_per_unit&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-500",children:[l("activities.pointsPerUnit"),":"]}),e.jsx("div",{className:"font-medium text-blue-600",children:s.points_per_unit})]})]})})]}),e.jsxs(A,{children:[e.jsxs(T,{children:[e.jsx(O,{children:l("activities.form.dataInput")}),e.jsx(B,{children:l("activities.form.inputDescription")})]}),e.jsx(E,{children:e.jsxs("form",{onSubmit:x(P),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[l("activities.form.dataValue")," (",s.unit,")"]}),e.jsx(Z,{type:"number",step:"0.01",min:"0",placeholder:l("activities.form.dataPlaceholder"),error:p.data,...g("data",{required:l("activities.form.dataRequired"),min:{value:.01,message:l("activities.form.dataMinimum")}})}),p.data&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.data.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Me,{className:"inline h-4 w-4 mr-1"}),l("activities.form.activityDate")]}),e.jsx(Z,{type:"date",max:new Date().toISOString().split("T")[0],error:p.activity_date,...g("activity_date",{required:l("activities.form.dateRequired")})}),p.activity_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.activity_date.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ie,{className:"inline h-4 w-4 mr-1"}),l("activities.form.notes")]}),e.jsx("textarea",{rows:3,placeholder:l("activities.form.notesPlaceholder"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",...g("notes")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(J,{className:"inline h-4 w-4 mr-1"}),l("activities.form.uploadImage")]}),e.jsx(ss,{accept:"image/*",maxFiles:3,maxSize:5*1024*1024,onUpload:_,className:"border-2 border-dashed border-gray-300 rounded-lg p-6"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:l("activities.form.uploadHint")})]}),d&&i&&e.jsx(A,{className:"bg-green-50 border-green-200",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4",children:l("activities.form.calculationResult")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((c=i.carbon_saved)==null?void 0:c.toFixed(2))||"0.00"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[l("activities.carbonSaved")," (kg CO₂)"]})]}),i.points_earned&&e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.points_earned}),e.jsx("div",{className:"text-sm text-gray-600",children:l("activities.form.expectedPoints")})]})]})]})})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx($,{type:"submit",className:"flex-1",loading:m,disabled:m||!d,children:l(m?"activities.form.submitting":"activities.form.submit")}),e.jsx($,{type:"button",variant:"outline",onClick:()=>window.location.reload(),children:l("common.reset")})]}),e.jsxs(Q,{variant:"info",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx(Y,{children:l("activities.form.submitHint")})]})]})})]})]})}function as(){var c;const{t:s}=G(),[a,t]=h.useState(1),[i,r]=h.useState(null),[m,l]=h.useState(null),[v,u]=h.useState(!1),[d,b]=h.useState(!1),[g,x]=h.useState(null),[f,y]=h.useState(""),p=[{id:1,title:s("activities.form.selectActivity"),description:s("activities.form.selectActivityDesc")},{id:2,title:s("activities.form.dataInput"),description:s("activities.form.dataInputDesc")},{id:3,title:s("activities.form.submit"),description:s("activities.form.submitDesc")}],C=n=>{r(n),l(null),y(""),t(2)},P=async n=>{if(i){u(!0),y("");try{const j=await M.post("/carbon-track/calculate",{activity_id:i.uuid,data:n});j.data.success?l(j.data.data):y(j.data.message||s("activities.form.calculationFailed"))}catch(j){y(j.message||s("activities.form.calculationFailed"))}finally{u(!1)}}},_=async n=>{b(!0),y("");try{const j=await M.post("/carbon-track/record",n);j.data.success?(x(j.data.data),t(3)):y(j.data.message||s("activities.form.submitFailed"))}catch(j){y(j.message||s("activities.form.submitFailed"))}finally{b(!1)}},D=()=>{t(1),r(null),l(null),x(null),y("")},S=()=>{a>1&&(t(a-1),y(""))};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:e.jsx(z,{className:"w-8 h-8 text-green-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:s("activities.title")}),e.jsx("p",{className:"text-gray-600",children:s("activities.description")})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:p.map((n,j)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${a>=n.id?"bg-green-600 border-green-600 text-white":"border-gray-300 text-gray-500"}`,children:a>n.id?e.jsx(ae,{className:"w-6 h-6"}):e.jsx("span",{className:"text-sm font-medium",children:n.id})}),e.jsxs("div",{className:"ml-3 hidden sm:block",children:[e.jsx("div",{className:`text-sm font-medium ${a>=n.id?"text-green-600":"text-gray-500"}`,children:n.title}),e.jsx("div",{className:"text-xs text-gray-500",children:n.description})]}),j<p.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-4 ${a>n.id?"bg-green-600":"bg-gray-300"}`})]},n.id))})}),f&&e.jsx(Q,{variant:"destructive",className:"mb-6",children:e.jsx(Y,{children:f})}),e.jsxs("div",{className:"space-y-6",children:[a===1&&e.jsx(Oe,{onActivitySelect:C,selectedActivity:i}),a===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs($,{variant:"outline",onClick:S,className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),s("common.back")]}),e.jsx("div",{className:"text-sm text-gray-600",children:s("activities.form.step2Of3")})]}),e.jsx(ts,{activity:i,onCalculate:P,onSubmit:_,calculationResult:m,isCalculating:v,isSubmitting:d})]}),a===3&&g&&e.jsxs(A,{className:"bg-green-50 border-green-200",children:[e.jsxs(T,{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4 mx-auto",children:e.jsx(ae,{className:"w-8 h-8 text-green-600"})}),e.jsx(O,{className:"text-green-800",children:s("activities.form.submitSuccess")}),e.jsx(B,{children:s("activities.form.submitSuccessDesc")})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((c=g.carbon_saved)==null?void 0:c.toFixed(2))||"0.00"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s("activities.carbonSaved")," (kg CO₂)"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.points_earned||0}),e.jsx("div",{className:"text-sm text-gray-600",children:s("activities.pointsEarned")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:s("activities.status.pending")}),e.jsx("div",{className:"text-sm text-gray-600",children:s("activities.currentStatus")})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("activities.form.reviewNotice")}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx($,{onClick:D,children:s("activities.form.recordAnother")}),e.jsx($,{variant:"outline",onClick:()=>window.location.href="/dashboard",children:s("activities.form.goToDashboard")})]})]})]})]})]})]})}function ps(){return e.jsx(as,{})}export{ps as default};
