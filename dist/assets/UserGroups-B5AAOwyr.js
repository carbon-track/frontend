import{u as A,Z as k,r as p,F as O,j as e,B as o,w as T,N as L,O as Q,Q as U,T as _,I as y,Y as q,n as c,ai as d}from"./index-Bx6Hir0b.js";import{u as h}from"./useMutation-CO474zu2.js";import{L as l}from"./label-Dv-tUw_I.js";import{T as v}from"./textarea-CYHz5N_p.js";import{C as J}from"./checkbox-JH6RmVE8.js";import{A as E,a as I,b as M,c as P,d as F,e as z,f as B,g as H}from"./alert-dialog-bfYaOCOQ.js";import{C as R}from"./circle-plus-GnYsOw3f.js";import{S as W}from"./square-pen-DujK9E-i.js";import{T as Y}from"./trash-2-pDhtkEqZ.js";import"./index-CgbFjYnG.js";function Z(){const{t}=A(),m=k(),[s,n]=p.useState(null),[N,r]=p.useState(!1),[g,u]=p.useState({open:!1,group:null}),{data:x,isLoading:C}=O("userGroups",()=>d.getUserGroups().then(a=>a.data.data)),f=h(d.createUserGroup,{onSuccess:()=>{m.invalidateQueries("userGroups"),r(!1),c.success(t("admin.groups.createSuccess","创建成功"))}}),j=h(({id:a,data:i})=>d.updateUserGroup(a,i),{onSuccess:()=>{m.invalidateQueries("userGroups"),r(!1),c.success(t("admin.groups.updateSuccess","更新成功"))}}),w=h(d.deleteUserGroup,{onSuccess:()=>{m.invalidateQueries("userGroups"),u({open:!1,group:null}),c.success(t("admin.groups.deleteSuccess","删除成功"))}}),D=a=>{n({...a,config:JSON.stringify(a.config||{},null,2)}),r(!0)},S=()=>{n({name:"",code:"",config:`{
  "llm": {
    "daily_limit": 10,
    "rate_limit": 60
  }
}`,is_default:!1,notes:""}),r(!0)},b=a=>{a.preventDefault();try{const i={...s,config:JSON.parse(s.config)};s.id?j.mutate({id:s.id,data:i}):f.mutate(i)}catch{c.error(t("admin.groups.invalidJson","JSON 格式错误"))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:t("admin.groups.title","用户组管理")}),e.jsx("p",{className:"text-muted-foreground",children:t("admin.groups.description","管理用户组及配额设置")})]}),e.jsxs(o,{onClick:S,children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),t("admin.groups.create","创建用户组")]})]}),C?e.jsx(T,{className:"h-8 w-8 animate-spin mx-auto"}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.groups.name","名称")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.groups.code","代码")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.groups.isDefault","默认")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.groups.actions","操作")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x==null?void 0:x.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.is_default?t("common.yes","是"):t("common.no","否")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>D(a),children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>u({open:!0,group:a}),className:"text-red-600 hover:text-red-800",children:e.jsx(Y,{className:"h-4 w-4"})})]})]},a.id))})]})}),e.jsx(L,{open:N,onOpenChange:r,children:e.jsxs(Q,{className:"max-w-lg",children:[e.jsx(U,{children:e.jsx(_,{children:s!=null&&s.id?t("admin.groups.edit","编辑用户组"):t("admin.groups.create","创建用户组")})}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:t("admin.groups.name","名称")}),e.jsx(y,{value:(s==null?void 0:s.name)||"",onChange:a=>n({...s,name:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{children:t("admin.groups.code","代码")}),e.jsx(y,{value:(s==null?void 0:s.code)||"",onChange:a=>n({...s,code:a.target.value}),required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{checked:s==null?void 0:s.is_default,onCheckedChange:a=>n({...s,is_default:a})}),e.jsx(l,{children:t("admin.groups.setAsDefault","设为默认用户组")})]}),e.jsxs("div",{children:[e.jsx(l,{children:t("admin.groups.config","配置 (JSON)")}),e.jsx(v,{value:(s==null?void 0:s.config)||"",onChange:a=>n({...s,config:a.target.value}),className:"font-mono h-32",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{children:t("admin.groups.notes","备注")}),e.jsx(v,{value:(s==null?void 0:s.notes)||"",onChange:a=>n({...s,notes:a.target.value})})]}),e.jsx(q,{children:e.jsx(o,{type:"submit",disabled:f.isLoading||j.isLoading,children:t("common.save","保存")})})]})]})}),e.jsx(E,{open:g.open,onOpenChange:a=>!a&&u({open:!1,group:null}),children:e.jsxs(I,{children:[e.jsxs(M,{children:[e.jsx(P,{children:t("admin.groups.confirmDelete","确认删除？")}),e.jsx(F,{children:t("admin.groups.deleteWarning","此操作无法撤销。该组下的用户将不再属于任何组（或回退到默认组）。")})]}),e.jsxs(z,{children:[e.jsx(B,{children:t("common.cancel","取消")}),e.jsx(H,{onClick:()=>w.mutate(g.group.id),children:t("common.confirm","确认")})]})]})})]})}function re(){return e.jsx(Z,{})}export{re as default};
